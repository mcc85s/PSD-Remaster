# ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____  
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\   ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯   //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//  [ Secure Digits Plus LLC | Hybrid | Desired State Controller ]  \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯       _____________________________________________________        ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯        __/¯¯\__[ Dynamically Engineered Digital Security ]__/¯¯\__         ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\  _________________________ ________________ ___________________________________  //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯\\__//¯¯\\__//¯¯\\__// | Application Development | Virtualization | Network and Hardware Magistration | \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\  ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯  //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//   https://www.securedigitsplus.com | Server-Client | Seedling-Spawning Script    \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\___¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯   ¯¯¯¯¯¯¯¯¯¯¯¯¯   ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ___//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\   [ Provisional Author : Michael C Cook Sr. | "The Buck Stops Here" ]    //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//   ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__/====\__/----\__/====\__/----\__/====\__/----\__/====\__/----\__/====\__/----\__/====\__/----\__/====\__/----\__/====\__/----\__/====\__/----\__// 
#//¯¯¯    
#\\  [ Provision-DomainController ] @: Orchestrates the process of provisioning server prerequisites in order to install Hybrid-DSC                     
#//   ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____      
#\\__/----\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//==\\__/---\\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//==\\___  
#//¯¯\\___________________________________________________________________________________¯¯¯¯ -- ¯¯¯¯ ¯¯ ¯¯¯¯ -- ¯¯¯¯ ¯¯ ¯¯¯¯ -- ¯¯¯¯ ¯¯ ¯¯¯¯ -- ¯¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\___ __ ____ -- ____ __ ____ -- ____ __ ____ -- ____ __ ___// 
# ¯¯¯¯   [ Declare Namespaces & Load Modules ] __________________________________________//¯¯\----/¯¯\\==//¯¯\----/¯¯\\==//¯¯\----/¯¯\\==//¯¯\----/¯¯¯  
     #/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯      
        "Security.Principal" , "Management.Automation" , "DirectoryServices" | % { IEX "Using Namespace System.$_" } 
    
        $ENV:PSModulePath.Split( ';' ) | % { GCI $_ -Recurse "Hybrid-DSC.psm1" } | % {
        
        IPMO $_.FullName -Force
        
        If ( $? -ne $True ) { Write-Error "Module Not Loaded/Found" ; Read-Host "Press Enter to Exit" ; Exit }
        
        Sleep 1 }                                                                    #____ -- ____    ____ -- ____    ____ -- ____    ____ -- ____      
}#____                                                                             __//¯¯\\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//¯¯\\___  
#//¯¯\\___________________________________________________________________________/¯¯¯    ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯        ____    ____    ____    ____    ____                    ___// 
    Function Enter-ServiceAccount # Allows entry / use of an AD service account _________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\                  //¯¯¯  
    {#/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯  #//                  \\     
        [ CmdLetBinding () ] Param (                                                                                        #\\                  //     
                                                                                                                            #//                  \\     
            [ Parameter ( Position = 0 , Mandatory = $True , ValueFromPipeline = $True ) ] [ String ] $DC      ,            #\\               ___//     
            [ Parameter ( Position = 1 , Mandatory = $True , ValueFromPipeline = $True ) ] [ String ] $Domain  ,            #//              //¯¯¯      
            [ Parameter ( Position = 2 , ValueFromPipeline = $True ) ] [ String ] $NetBIOS )  # Currently Unused            #\\              \\         
                                                                                                                            #//           ___//
        $Stuff = Generate-XAML -Login

        $NamedElements = "Username" , "Password" , "Confirm" , "Switch" , "Port" , "Ok" , "Cancel"                          #\\__// 
                                                                                                                            #//¯¯\\ 
        $0 = "Username" , "Password" , "Confirmation" ;                                                                     #//¯¯\\ 
        $1 = $0 | % { "You must enter a $_" } ; $2 = $0 | % { "$_ Error" }                                                  #\\__// 
        $1[2] = $1[2].Replace( "You must enter a" , "Password Must Match the" )                                             #//¯¯\\ 
        $1   += "Invalid information. All fields must be correct and valid." ; $2 += "Authentication Failure"               #\\__// 
                                                                                                                            #//¯¯\\ 
        $MSG  = 0..3 | % { "[ System.Windows.MessageBox ]::Show( '$( $1[$_] )' , '$( $2[$_] )' )" }                         #\\__// 
                                                                                                                            #//¯¯\\ 
        $GUIX = Convert-XAMLtoWindow -Xaml $Stuff -NE $NamedElements -PassThru                                              #\\__// 
                                                                                                                            #//¯¯\\ 
        $GUIX.Switch.Add_Click({ $GUIX.Port.IsEnabled = $True  })                                                           #\\__// 
        $GUIX.Cancel.Add_Click({ $GUIX.DialogResult   = $False })                                                           #//¯¯\\ 
        $GUIX.Ok.Add_Click({                                                                                                #\\__// 
                                                                                                                            #//¯¯\\ 
            $Port = $( If ( $GUIX.Port.IsEnabled -eq $True ) { $GUIX.Port.Text } Else { 389 } )                             #\\__// 
            $Cred = [ PSCredential ]::New( $GUIX.Username.Text , $GUIX.Password.SecurePassword )                            #//¯¯\\ 
            $AD   = "LDAP://$( $DC ):$Port/DC=$( $Domain.Split('.') -join ',DC=' )"                                         #\\__// 
            $DX   = [ DirectoryEntry ]::New( "$AD" , $Cred.Username , $Cred.GetNetworkCredential().Password )               #//¯¯\\ 
                                                                                                                            #\\__// 
                If ( $GUIX.Username | ? { $_.Text     -eq $Null } )                     { IEX $MSG[0] }                     #//¯¯\\ 
            ElseIf ( $GUIX.Password | ? { $_.Password -eq $Null } )                     { IEX $MSG[1] }                     #\\__// 
            ElseIf ( $GUIX.Confirm  | ? { $_.Password -eq $Null } )                     { IEX $MSG[2] }                     #//¯¯\\ 
            ElseIf ( $GUIX | ? { $_.Password.Password -notmatch $_.Confirm.Password } ) { IEX $MSG[2] }                     #\\__// 
            ElseIf ( $DX.Name -eq $Null )                                               { IEX $MSG[3] }                     #//¯¯\\ 
                                                                                                                            #\\__// 
            Else { $GUIX.DialogResult = $True }                                                                             #//¯¯\\ 
        })                                                                                                                  #\\__// 
                                                                                                                            #//¯¯\\ 
        $Null = $GUIX.Username.Focus()                                                                                      #\\__// 
                                                                                                                            #//¯¯\\ 
        $OP = Show-WPFWindow -GUI $GUIX                                                                                     #\\__// 
                                                                                                                            #//¯¯\\ 
        If ( $OP -eq $True )                                                                                                #\\__// 
        {                                                                                                                   #//¯¯\\ 
            Write-Theme -Action "Login [+]" "Successful" 11 12 15                                                           #\\__// 
            Return [ PSCredential ]::New( $GUIX.Username.Text , $GUIX.Password.SecurePassword )                             #//¯¯\\ 
        }                                                                                                                   #\\__// 
                                                                                                                            #//¯¯\\ 
        Else                                                                                                                #\\__// 
        {                                                                                                                   #//¯¯\\ 
            Write-Theme -Action "Login [!]" "Failed"                                                                        #\\__// 
        }                                                                                                                   #//¯¯\\ 
                                                                                     #____ -- ____ -- ____ -- ____ -- ____ --\\__//-- ____    ____           
}

    # ____            ____            ____            ____            ____            ____    ____    ____    ____    ____   \\__// 
    #//¯¯\\__________//¯¯\\__________//¯¯\\__________//¯¯\\__________//¯¯\\__________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
    #\\__//¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
        Function Get-DomainType # Collects the DomainType ___________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
        {#/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
            Return @( "N/A" , "TreeDomain" , "ChildDomain" , "N/A" ) }                                                      #//¯¯\\ 
    # ____            ____            ____            ____            ____            ____    ____    ____    ____    ____   \\__// 
    #//¯¯\\__________//¯¯\\__________//¯¯\\__________//¯¯\\__________//¯¯\\__________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
    #\\__//¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
        Function Get-DCPromoBoxControls # Collects the names for Box Controls________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
        {#/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
            Return @( "Database" , "Sysvol" , "Log" | % { "$_`Path" } ; "Credential" ;                                      #\\__// 
            @( "Domain" | % { $_ , "New$_" } | % { $_ , "$_`NetBIOS" } ; "Site" ) | % { "$_`Name" } ;                       #//¯¯\\ 
            "ReplicationSourceDC" , "Forest" , "Domain" , "Child" , "Clone" ) | % { "$_`Box" }                              #\\__// 
        }                                                                                                                   #//¯¯\\ 
    # ____            ____            ____            ____            ____            ____    ____    ____    ____    ____   \\__// 
    #//¯¯\\__________//¯¯\\__________//¯¯\\__________//¯¯\\__________//¯¯\\__________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
    #\\__//¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
        Function Get-DCPromoControl # Provides backend for reliable XAML Control  ___//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
        {#/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                 [ CmdLetBinding () ] Param (                                                                               #//¯¯\\ 
                                                                                                                            #\\__// 
                    [ ValidateSet ( 0 , 1 , 2 , 3 ) ][ Parameter ( Mandatory = $True ) ][ Int ] $DType = 0 )                #//¯¯\\ 
                                                                                                                            #\\__// 
                 $T = ( Get-DomainType )[ $DType ]                                                                          #//¯¯\\ 
                 Return [ PSCustomObject ]@{                                                                                #\\__// 
                                                                                                                            #//¯¯\\ 
                 # ______________________________________________________________________________ #                         #\\__// 
                 # [ Services ] # - Entries for [ Windows Server @: Desired State Configuration ] #                         #//¯¯\\ 
                 # ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ #                         #\\__// 
                                                                                                                            #//¯¯\\ 
                 AD_Domain_Services      = "" ; DHCP                     = "" ; DNS                     = "" ;              #\\__// 
                 GPMC                    = "" ; RSAT                     = "" ; RSAT_AD_AdminCenter     = "" ;              #//¯¯\\ 
                 RSAT_AD_PowerShell      = "" ; RSAT_AD_Tools            = "" ; RSAT_ADDS               = "" ;              #\\__// 
                 RSAT_ADDS_Tools         = "" ; RSAT_DHCP                = "" ; RSAT_DNS_Server         = "" ;              #//¯¯\\ 
                 RSAT_Role_Tools         = "" ; WDS                      = "" ; WDS_AdminPack           = "" ;              #\\__// 
                 WDS_Deployment          = "" ; WDS_Transport            = "" ;                                             #//¯¯\\ 
                                                                                                                            #\\__// 
                 # ______________________________________________________________________________ #                         #//¯¯\\ 
                 # [ Menu Items ] # Entries for [ Windows Server @: Desired State Configuration ] #                         #\\__// 
                 # ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ #                         #//¯¯\\ 
                                                                                                                            #\\__// 
                 Forest = "" ; Tree = "" ; Child = "" ; Clone = "" ; Process = $DType ;                                     #//¯¯\\ 
                                                                                                                            #\\__// 
                 # ________________________________________________________________________________ #                       #//¯¯\\ 
                 # [ ADDS-Deployment ] # - Entries for [ Active Directory @: Deployment / DCPromo ] #                       #\\__// 
                 # ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ #                       #//¯¯\\ 
                                                                                                                            #\\__// 
                 DomainType              = $T ; ForestMode              = "" ; DomainMode              = "" ;               #//¯¯\\ 
                 ParentDomainName        = "" ; DatabasePath            = "" ; SysvolPath              = "" ;               #\\__// 
                 LogPath                 = "" ; Credential              = "" ; DomainName              = "" ;               #//¯¯\\ 
                 DomainNetBIOSName       = "" ; NewDomainName           = "" ; NewDomainNetBIOSName    = "" ;               #\\__// 
                 SiteName                = "" ; ReplicationSourceDC     = "" ; InstallDNS              = "" ;               #//¯¯\\ 
                 CreateDNSDelegation     = "" ; NoGlobalCatalog         = "" ; CriticalReplicationOnly = "" ;               #\\__// 
                 Force      = $True ; NoRebootUponCompletion  = $False ; SafeModeAdministratorPassword = "" } }             #//¯¯\\ 
    # ____            ____            ____            ____            ____            ____    ____    ____    ____    ____   \\__// 
    #//¯¯\\__________//¯¯\\__________//¯¯\\__________//¯¯\\__________//¯¯\\__________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
    #\\__//¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
        Function Filter-DCPromoGUI # Clears and refreshes items in the GUI __________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
        {#/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                [ CmdLetBinding ( ) ] Param (                                                                               #//¯¯\\ 
                                                                                                                            #\\__// 
                    [ ValidateSet ( 0 , 1 , 2 , 3 ) ][ Parameter ( Mandatory = $True ) ][ Int ] $Type = 0 )                 #//¯¯\\ 
                                                                                                                            #\\__// 
                $P         = $Type                                                                                          #//¯¯\\ 
                $Code      = Get-DCPromoControl -DType $P                                                                   #\\__// 
                                                                                                                            #//¯¯\\ 
                $DType     = "Forest" , "Tree" , "Child" , "Clone"                                                          #\\__// 
                                                                                                                            #//¯¯\\ 
                $DType     | % { $Code.$_ = "N/A" }                                                                         #\\__// 
                $DType[$P] | % { $Code.$_ = "Selected" }                                                                    #//¯¯\\ 
             # ____   ___________________________     ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
             #//¯¯\\__[_ Hides all boxed items _]____//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
             #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                $Boxes     = Get-DCPromoBoxControls                                                                         #//¯¯\\ 
                $Boxes     | % { $GUI.$_.Visibility = "Hidden" }                                                            #\\__// 
                                                                                                                            #//¯¯\\ 
                $Text      = "Domain" | % { "Parent$_`Name" , "Credential" , "$_`Name" , "$_`NetBIOSName" , "SiteName"      #\\__// 
                              "Credential" , "$_`NetBIOSName" , "New$_`Name" , "New$_`NetBIOSName" , "ReplicationSourceDC"} #//¯¯\\ 
                $Text      | % { $GUI.$_.Text = "" }                                                                        #\\__// 
                                                                                                                            #//¯¯\\ 
             # ____   ___________________________     ____    ____    ____    ____    ____    ____    ____    ____    ____  #\\__// 
             #//¯¯\\__[__ Domain Mode Toggler __]____//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
             #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                $Modes     = "Forest" , "Domain" , "Child" , "Clone" | % { "$_`Box" }                                       #//¯¯\\ 
                $Top       = @{ 0 = 0 , 1 ; 1 = 2 , 1 ; 2 = 2 , 1 ; 3 = 3 }                                                 #\\__// 
                $Top[$P]   | % { $Modes[$_] } | % { $GUI.$_.Visibility = "Visible" }                                        #//¯¯\\ 
                                                                                                                            #\\__// 
                $DMCode    = "ForestMode" , "DomainMode" , "ParentDomainName"                                               #//¯¯\\ 
                $DMID      = @{ 0 = 1,1,0 ; 1 = 0,1,1 ; 2 = 0,1,1 ; 3 = 0,0,0 }                                             #\\__// 
                                                                                                                            #//¯¯\\ 
                ForEach ( $I in 0..2 )                                                                                      #\\__// 
                {                                                                                                           #//¯¯\\ 
                    If ( $DMID[$P][$I] -eq 0 ) { $Code.$( $DMCode[$I] ) = "N/A" }                                           #\\__// 
                }                                                                                                           #//¯¯\\ 
             # ____   ___________________________     ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
             #//¯¯\\__[______ Role Toggler _____]____//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
             #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                $Roles     = "InstallDNS" , "CreateDNSDelegation" , "NoGlobalCatalog" , "CriticalReplicationOnly"           #//¯¯\\ 
                $Roles     | % { $GUI.$_ | % { $_.IsEnabled = $True ; $_.IsChecked = $False } }                             #\\__// 
                                                                                                                            #//¯¯\\ 
                $Enabled   = @{ 0 = 1 , 1 , 0 , 0 ; 1 = 1 , 1 , 1 , 0 ; 2 = 1 , 1 , 1 , 0 ; 3 = 1 , 1 , 1 , 1 }             #\\__// 
                $Checked   = @{ 0 = 1 , 0 , 0 , 0 ; 1 = 1 , 0 , 0 , 0 ; 2 = 1 , 1 , 0 , 0 ; 3 = 1 , 0 , 0 , 0 }             #//¯¯\\ 
                                                                                                                            #\\__// 
                ForEach ( $i in 0..( $Roles.Count - 1 ) )                                                                   #//¯¯\\ 
                {                                                                                                           #\\__// 
                    $X = $Enabled[$P][$I]                                                                                   #//¯¯\\ 
                    $Y = $Checked[$P][$I]                                                                                   #\\__// 
                    $Z = $Roles[$I]                                                                                         #//¯¯\\ 
                     $GUI.$Z | % { $_.IsEnabled = $X ; $_.IsChecked = $Y }                                                  #\\__// 
                    $Code.$Z = $( If ( $X -eq 0 ) { "N/A" } Else { $Y } )                                                   #//¯¯\\ 
                }                                                                                                           #\\__// 
                                                                                                                            #//¯¯\\ 
                $DomaInfo  = @( @( "Domain" | % { $_ , "New$_" } | % { $_ , "$_`NetBIOS" } ; "Site" ) | % { "$_`Name" } ;   #\\__// 
                                "ReplicationSourceDC" , "Credential" ) | Sort                                               #//¯¯\\ 
                $Enabled   = @{ 0 = 0,1,1,0,0,0,1 ; 1 = 1,0,0,1,1,0,1 ; 2 = 1,0,0,1,1,0,1 ; 3 = 1,1,0,0,0,1,1 }             #\\__// 
                                                                                                                            #//¯¯\\ 
                ForEach ( $i in 0..( $DomaInfo.Count - 1 ) )                                                                #\\__// 
                {                                                                                                           #//¯¯\\ 
                    $X = $Enabled[$P][$I]                                                                                   #\\__// 
                    $Y = $DomaInfo[$I]                                                                                      #//¯¯\\ 
                     $GUI."$Y`Box" | % { $_.Visibility = $X }                                                               #\\__// 
                    If ( $X -eq 0 ) { $Code.$Y = "N/A" }                                                                    #//¯¯\\ 
                }                                                                                                           #\\__// 
                                                                                                                            #//¯¯\\ 
                $SVC  = Get-FeatureList -Underscore                                                                         #\\__// 
                                                                                                                            #//¯¯\\ 
                ForEach ( $i in 0..16 )                                                                                     #\\__// 
                {                                                                                                           #//¯¯\\ 
                    $X = $ST[$I].Split( ' ' )[1]                                                                            #\\__// 
                    $Y = $SVC[$I]                                                                                           #//¯¯\\ 
                    If ( $X -like "*[X]*" )                                                                                 #\\__// 
                    {                                                                                                       #//¯¯\\ 
                         $GUI.$Y | % { $_.IsEnabled = $False ; $_.IsChecked =  $True }                                      #\\__// 
                        $Code.$Y = "Installed"                                                                              #//¯¯\\ 
                    }                                                                                                       #\\__// 
                    If ( $X -like "*[_]*" )                                                                                 #//¯¯\\ 
                    {                                                                                                       #\\__// 
                         $GUI.$Y | % { $_.IsEnabled =  $True ; $_.IsChecked =  $True }                                      #//¯¯\\ 
                        $Code.$Y = "Available"                                                                              #\\__// 
                    }                                                                                                       #//¯¯\\ 
                }                                                                                                           #\\__// 
                                                                                                                            #//¯¯\\ 
            Return $Code                                                                                                    #\\__// 
        }                                                                                                                   #//¯¯\\ 
    # ____            ____            ____            ____            ____            ____    ____    ____    ____    ____   \\__// 
    #//¯¯\\__________//¯¯\\__________//¯¯\\__________//¯¯\\__________//¯¯\\__________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
    #\\__//¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
        Function Validate-DomainName # Verfies that text entries are valid __________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
        {#/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                [ CmdLetBinding () ] [ OutputType ( "String" ) ] Param (                                                    #//¯¯\\ 
                                                                                                                            #\\__// 
                    [ Parameter ( Mandatory = $True , ParameterSetName = "0" ) ][ Switch ] $Domain ,                        #//¯¯\\ 
                    [ Parameter ( Mandatory = $True , ParameterSetName = "1" ) ][ Switch ] $NetBIOS ,                       #\\__// 
                    [ Parameter ( Mandatory = $True , ParameterSetName = "2" ) ][ Switch ] $SiteName ,                      #//¯¯\\ 
                    [ Parameter ( Mandatory = $True , ParameterSetName = "0" ) ]                                            #\\__// 
                    [ Parameter ( Mandatory = $True , ParameterSetName = "1" ) ]                                            #//¯¯\\ 
                    [ Parameter ( Mandatory = $True , ParameterSetName = "2" ) ][ String ] $Name )                          #\\__// 
                                                                                                                            #//¯¯\\ 
                $Char = "abcdefghijklmnopqrstuvwxyz0123456789.-\/:*?$( '"' )<>|,~:!@#$%^&'(){}_ "                           #\\__// 
                $Char | % { $AL =    $_[0..25] ; $NU =   $_[26..35] ; $SP = $_[38..64] ;                                    #//¯¯\\ 
                            $AN = $Char[0..35] ; $NN = $Char[0..25] }                                                       #\\__// 
                $DNS  = @{ Min = 2 ; Max = 255 ; Allow = $Char[ 0..37] ; Invalid = $SP }                                    #//¯¯\\ 
                $NBT  = @{ Min = 1 ; Max =  15 ; Allow = $Char[ 0..37] ; Invalid = $SP }                                    #\\__// 
                $SN   = @{ Min = 1 ; Max =  63 ; Allow = $Char[ 0..37] ; Invalid = $SP }                                    #//¯¯\\ 
                                                                                                                            #\\__// 
                $Reserved = @( "ANONYMOUS" , "AUTHENTICATED USER" , "BATCH" , "BUILTIN" ;                                   #//¯¯\\ 
                "GROUP" , "OWNER" | % { $_ , "$_ SERVER" } | % { "CREATOR $_" } ;                                           #\\__// 
                "DIALUP" , "DIGEST AUTH" , "INTERACTIVE" , "INTERNET" ;                                                     #//¯¯\\ 
                "LOCAL" | % { $_ , "$_ SYSTEM" } ; "NETWORK" | % { $_ , "$_ SERVICE" } ;                                    #\\__// 
                "NT AUTHORITY" , "NT DOMAIN" , "NTLM AUTH" , "NULL" , "PROXY" , "REMOTE INTERACTIVE"                        #//¯¯\\ 
                "RESTRICTED" , "SCHANNEL AUTH" , "SELF" , "SERVER" , "SERVICE" , "SYSTEM"                                   #\\__// 
                "TERMINAL SERVER" , "THIS ORGANIZATION" , "USERS" , "WORLD" )                                               #//¯¯\\ 
                                                                                                                            #\\__// 
                If ( $Domain   ) { $X = $DNS }                                                                              #//¯¯\\ 
                If ( $NetBIOS  ) { $X = $NBT }                                                                              #\\__// 
                If ( $SiteName ) { $X = $SN }                                                                               #//¯¯\\ 
                                                                                                                            #\\__// 
                    If ( $Name.Length -lt $X.Min ) { Return "Short of minimum length" }                                     #//¯¯\\ 
                ElseIf ( $Name.Length -gt $X.Max ) { Return "Exceeds maximum length" }                                      #\\__// 
                ElseIf ( ( $Name.ToCharArray() | ? { $_ -notin $X.Allow } ).Count -gt 0 ) { Return "Invalid Characters" }   #//¯¯\\ 
                ElseIf ( ( $Name.ToCharArray() | ? { $_  -in $X.Invalid } ).Count -gt 0 ) { Return "Invalid Characters" }   #\\__// 
                                                                                                                            #//¯¯\\ 
                If ( ( $Domain ) -or ( $SiteName ) )                                                                        #\\__// 
                {                                                                                                           #//¯¯\\ 
                    If ( ( $Name[0] | ? { $_ -notin $AN } ).Count -gt 0 )                                                   #\\__// 
                        { Return "First character must be Alpha-Numeric" }                                                  #//¯¯\\ 
                    ElseIf (   $Name | % { $_.EndsWith( "." ) -or $_.EndsWith( "-" ) } )                                    #\\__// 
                        { Return "Last Character cannot be a period/hyphen" }                                               #//¯¯\\ 
                }                                                                                                           #\\__// 
                                                                                                                            #//¯¯\\ 
                If ( $Domain )                                                                                              #\\__// 
                {                                                                                                           #//¯¯\\ 
                    If ( $Name.Split('.').Count -le 1 )                                                                     #\\__// 
                        { Return "Not a valid domain name" }                                                                #//¯¯\\ 
                    ElseIf ( ( $Name.Split('.')[-1].ToCharArray() | ? { $_ -in @( $AL ; '-' , '.' ) } ).Count -eq 0 )       #\\__// 
                        { Return "Top Level Domain must contain a non-numeric character" }                                  #//¯¯\\ 
                    Else                                                                                                    #\\__// 
                        { Return $Name }                                                                                    #//¯¯\\ 
                }                                                                                                           #\\__// 
                                                                                                                            #//¯¯\\ 
                If ( $SiteName )                                                                                            #\\__// 
                {                                                                                                           #//¯¯\\ 
                    If ( $X -in $Reserved ) { Return "The selected name conflicts with a reservation" }                     #\\__// 
                    Else { Return $Name }                                                                                   #//¯¯\\ 
                }                                                                                                           #\\__// 
                                                                                                                            #//¯¯\\ 
                If ( $NetBIOS )                                                                                             #\\__// 
                {                                                                                                           #//¯¯\\ 
                    If ( $Name[0] -eq "." )                                                                                 #\\__// 
                    {                                                                                                       #//¯¯\\ 
                        Return "First Character must be Alpha-Numeric, or '.' "                                             #\\__// 
                    }                                                                                                       #//¯¯\\ 
                    Else { Return $Name.ToUpper() }                                                                         #\\__// 
                }                                                                                                           #//¯¯\\ 
            }                                                                                                               #\\__// 
                                                                                                                            #//¯¯\\ 
             # ____   ___________________________     ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
             #//¯¯\\__[____ Domain Type Init ___]____//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
             #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                Write-Theme -Action "Loading [~]" "Active Directory Configuration Utility" 11 12 15                         #//¯¯\\ 
                                                                                                                            #\\__// 
                $Code       = Get-DCPromoControl -DType 1                                                                   #//¯¯\\ 
                $Named      = $Code | GM | ? Membertype -eq NoteProperty | % { $_.Name }                                    #\\__// 
                $Face       = Generate-XAML -HybridDSCPromo                                                                 #//¯¯\\ 
                $Boxes      = Get-DCPromoBoxControls                                                                        #\\__// 
                                                                                                                            #//¯¯\\ 
                $WXGUI      = @{ Xaml = $Face ; Passthru = $True ; EA = 0                                                   #//¯¯\\ 
                                 NE   = @( $Named ; $Boxes ; "Start" , "Cancel" , "Confirm" , "CredentialButton" ) }        #\\__// 
                                                                                                                            #//¯¯\\ 
                $GUI        = Convert-XAMLToWindow @WXGUI                                                                   #\\__// 
                                                                                                                            #//¯¯\\ 
                $P          = $Code.Process                                                                                 #\\__// 
                                                                                                                            #//¯¯\\ 
                $ST         = Collect-FeaturesState -All                                                                    #\\__// 
                                                                                                                            #//¯¯\\ 
                Write-Theme -Action "Windows Server [+]" "Configuration Selected" 11 12 15                                  #\\__// 
                                                                                                                            #//¯¯\\ 
                $Code = Filter-DCPromoGUI -Type ( $Code.Process )                                                           #\\__// 
                                                                                                                            #//¯¯\\ 
             # ____   ___________________________     ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
             #//¯¯\\__[__ Domain Type Selector _]____//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
             #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                $Menu = "Forest" , "Tree" , "Child" , "Clone"

                ForEach ( $I in 0..3 )
                {
                    $GUI.$( $Menu[$I] ).Add_Click({ If ( $Code.Process -ne $I ) { $Code = Filter-DCPromoGUI -Type $I }})
                }
             # ____   ___________________________     ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
             #//¯¯\\__[_____ Role Selector _____]____//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
             #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                $Roles     = "InstallDNS" , "CreateDNSDelegation" , "NoGlobalCatalog" , "CriticalReplicationOnly"
                ForEach ( $I in 0..3 ) 
                { 
                    $Check = $GUI.$( $Roles[$I] )

                    If ( $Check.IsEnabled -eq $True ) 
                    {
                        $Check | % { $_.Add_Checked({   $Code.$( $Roles[$I] ) =  $True })
                                     $_.Add_UnChecked({ $Code.$( $Roles[$I] ) = $False })
                        }
                    }
                }
             # ____   ___________________________     ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
             #//¯¯\\__[___Service Selector _____]____//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
             #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                $Service = Get-FeatureList -Underscore
                ForEach ( $i in 0..( $Service.Count - 1 ) )
                {
                    $Check = $GUI.$( $Service[$I] )
                
                    If ( $Check.IsEnabled -eq $True )
                    {
                        $Check | % { $_.Add_Checked({   $Code.$( $Service[$I] ) = $True })
                                     $_.Add_UnChecked({ $Code.$( $Service[$I] ) = $True })  
                        }
                    }
                }
             # ____   ___________________________     ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
             #//¯¯\\__[_______ GUI Buttons _____]____//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
             #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                $GUI.CredentialButton.Add_Click({ 

                    $X = $( If ( $Code.Process -eq 1,2 ) { $GUI.ParentDomainName.Text } )
                            If ( $Code.Process -eq 3   ) { $GUI.DomainName.Text       }

                    $X | % {

                        If ( ( Validate-DomainName -Domain -Name $X ) -ne $X )
                        { 
                            [ System.Windows.MessageBox ]::Show( "$X in Parent Domain Name" , "Error" ) ; Break
                        }
                    
                        Else
                        {
                            Resolve-DNSName $_ -Type A | % { Resolve-DNSName $_.IPAddress } | % { $Y = $_.NameHost.Replace( ".$X" , '' ) }
                            If ( $Y -eq $Null ) { [ System.Windows.MessageBox ]::Show( "Failed to detect the domain controller" , "Error" ) ; Break }
                        }
                    }

                    $DCCred = Enter-ServiceAccount -DC $Y -Domain $X

                    If ( $DCCred -ne $Null ) 
                    { 
                        $GUI.Credential.Text = $DCCred.UserName
                        $Code.Credential     = $DCCred

                        If ( $Code.Process -in 1 , 2 ) 
                        {
                            $GUI.ParentDomainName.Text = $X
                            
                            $AD = "LDAP://$( $DC )/CN=Partitions,CN=Configuration,DC=$( $Domain.Split('.') -join ',DC=' )"

                            $Searcher = [ DirectorySearcher ]::New() | % {
                                $_.SearchRoot = [ DirectoryEntry ]::New( $AD , $DCCred.Username , $DCCred.GetNetworkCredential().Password )
                                $_.PageSize   = 1000
                                $_.PropertiesToLoad.Clear()
                            }

                            $EXE = $Searcher.FindAll()
                            0..( $EXE.Count - 1 ) | % { $EXE[$_].Properties } | ? { $_.netbiosname } | % { $NBIOS = $_.netbiosname }
                        }

                        Else {    $GUI.DomainName.Text = $X }
                    }
                })

            $GUI.Cancel.Add_Click({ $GUI.DialogResult = $False })

            $GUI.Ok.Add_Click({
                
                "Database" , "Sysvol" , "Log" | % { "$_`Path" } | % { 
                
                    If ( $GUI.$_.Text -eq "" ) { IEX "[ System.Windows.MessageBox ]::Show( '$( $_.Replace('P',' P') ) Missing' )" ; Break }
                }

                $SM = "No Password" , "Match" , "Confirmation" | % { "[ System.Windows.MessageBox ]::Show( '$_ Error' )" }

                $GUI.SafeModeAdministratorPassword.Password | % { $_ -ne $Null } | % { 
                    If ( $_ -eq "" )                          { IEX $SM[0] ; Break }
                    If ( $GUI.Confirm.Password -notmatch $_ ) { IEX $SM[1] ; Break }
                    If ( $GUI.Confirm.Password -eq "" )       { IEX $SM[2] ; Break }
                }
                    
                $Top   = @( "Forest" , "Domain" | % { "$_`Mode" } ; "ParentDomainName" )
                $Roles = "InstallDNS" , "CreateDNSDelegation" , "NoGlobalCatalog" , "CriticalReplicationOnly"
                $DMID  = @( @( "Domain" | % { $_ , "New$_" } | % { $_ , "$_`NetBIOS" } ; "Site" ) | % { "$_`Name" } ; "ReplicationSourceDC" , "Credential" ) | Sort 

                If ( $Code.Process -eq 0 ) # Install-ADDSForest
                {
                    # Top
                    $Top[0,1]   | % { $Code.$_ = $GUI.$_.SelectedIndex }

                    # Roles
                    $Roles[0,1] | ? { $GUI.$_.IsEnabled } | % { $Code.$_ = $GUI.$_.IsChecked }
                        
                    # Domain Info
                    $Items      = $DMID[1,2,6]
                    $Con        = $Items | % { $GUI.$_.Text }

                    # Special Rules
                    $Con[1]     = $Con[1].ToUpper()
                    
                    $ID         = "Domain" , "NetBIOS" , "Site" | % { "$_ Name Cannot Be Empty" }
                    $ID        += "Invalid Domain Name"
                    $MSG        = $ID | % { "[ System.Windows.Messagebox ]::Show( '$_' )" }
                    
                    # Commands
                    $Val        = 0..2
                    $Val[0]     = Validate-DomainName   -Domain -Name $Con[0]
                    $Val[1]     = Validate-DomainName  -NetBIOS -Name $Con[1]
                    $Val[2]     = Validate-DomainName -SiteName -Name $Con[2]

                    0..2        | ? { $Con[$_] -eq       "" } | % { IEX $MSG[$_] ; Break }
                    0..2        | ? { $Con[$_] -ne $Val[$_] } | % { [ System.Windows.MessageBox ]::Show( $Con[$_] ) ; Break }
                    0..2        | % { $Code.$( $Items[$_] ) = $Con[$_] }
                }

                If ( $Code.Process -in 1..2 )
                {
                    $GUI.ParentDomainName     | % { $_.Text -eq $Null  } | % { [ System.Windows.MessageBox ]::Show(    "Parent Domain Name Missing" ) ; Break }
                    $GUI.CredentialBox        | % { $_.Text -eq $Null  } | % { [ System.Windows.MessageBox ]::Show(     "Domain Credential Missing" ) ; Break }
                    $GUI.NewDomainNetBIOSName | % { $_.Text -eq $NBIOS } | % { [ System.Windows.MessageBox ]::Show(  "NetBIOS name is already used" ) ; Break }
                    
                    If ( $Code.Process -eq 1 )
                    {
                        $GUI.NewDomainName | % { $_.Text -like "*$( $GUI.ParentDomainName.Text )*" } | % { [ System.Windows.MessageBox ]::Show(  "Name is too similar" ) ; Break }
                    }
                }

                If ( $Code.Process -eq 1 ) # Install-ADDSDomain Tree
                {       
                    # Top
                    $Top[1]      | % { $Code.$_ = $GUI.$_.SelectedIndex }
                    $Top[2]      | % { $Code.$_ = $GUI.$_.Text }

                    # Roles
                    $Roles[0..2] | ? { $GUI.$_.IsEnabled } | % { $Code.$_ = $GUI.$_.IsChecked }
                    
                    # Domain Info
                    $Items       = $DMID[3,4,6,0]
                    $Con         = $Items | % { $GUI.$_.Text }

                    $ID          = "New Domain" | % { "$_" , "$_ NetBIOS" , "Site" } | % { "$_ Name" }
                    $ID         += "Credential Invalid"
                    $MSG         = $ID | % { "[ System.Windows.Messagebox ]::Show( '$_' )" }
                    
                    $Val         = 0..2
                    $Val[0]      = Validate-DomainName   -Domain -Name $Con[0]
                    $Val[1]      = Validate-DomainName  -NetBIOS -Name $Con[1]
                    $Val[2]      = Validate-DomainName -SiteName -Name $Con[2]
                    
                    0..2         | ? { $Con[$_] -eq       "" } | % { IEX $MSG[$_] ; Break }
                    0..2         | ? { $Con[$_] -ne $Val[$_] } | % { [ System.Windows.MessageBox ]::Show( $Con[$_] ) ; Break }   
                    0..2         | % { $Code.$( $Items[$_] ) = $Con[$_] }
                }

                If ( $Code.Process -eq 2 ) # Install-ADDSDomain Child
                {       
                    # Top
                    $Top[1]      | % { $Code.$_ = $GUI.$_.SelectedIndex }
                    $Top[2]      | % { $Code.$_ = $GUI.$_.Text }

                    # Roles
                    $Roles[0..2] | ? { $GUI.$_.IsEnabled } | % { $Code.$_ = $GUI.$_.IsChecked }
                    
                    # Domain Info
                    $Items       = $DMID[3,4,6,0]
                    $Con         = $Items | % { $GUI.$_.Text }

                    $ID          = "New Domain" | % { "$_" , "$_ NetBIOS" , "Site" } | % { "$_ Name" }
                    $ID         += "Credential Invalid"
                    $MSG         = $ID | % { "[ System.Windows.Messagebox ]::Show( '$_' )" }
                    $Code        | ? { $_.Credential -ne $DCCred.UserName } | % { [ System.Windows.MessageBox ]::Show( "Domain Credential Invalid" ) }
                    
                    $Val         = 0..2
                    $Val[0]      = Validate-DomainName -SiteName -Name $Con[0]
                    $Val[1]      = Validate-DomainName  -NetBIOS -Name $Con[1]
                    $Val[2]      = Validate-DomainName -SiteName -Name $Con[2]
                    
                    0..2         | ? { $Con[$_] -eq       "" } | % { IEX $MSG[$_] ; Break }
                    0..2         | ? { $Con[$_] -ne $Val[$_] } | % { [ System.Windows.MessageBox ]::Show( $Con[$_] ) ; Break }   
                    0..2         | % { $Code.$( $Items[$_] ) = $Con[$_] }
                }

                If ( $Code.Process -eq 3 ) # Install-ADDSDomainController
                {
                    # Roles
                    $Roles[0..3] | ? { $GUI.$_.IsEnabled } | % { $Code.$_ = $GUI.$_.IsChecked }
                    
                    # Domain Info
                    $Items       = $DMID[1,5,6,0]
                    $Con         = $Items | % { $GUI.$_.Text }

                    $ID          = "New Domain" | % { "$_" , "$_ NetBIOS" , "Site" } | % { "$_ Name" }
                    $ID         += "Credential Invalid"
                    $MSG         = $ID | % { "[ System.Windows.Messagebox ]::Show( '$_' )" }
                    $Code        | ? { $_.Credential -ne $DCCred.UserName } | % { [ System.Windows.MessageBox ]::Show( "Domain Credential Invalid" ) }

                    $Val         = 0..2
                    $Val[0]      = Validate-DomainName -DomainName -Name $Con[0]
                    $Val[1]      = Resolve-DnsName $Con[0] 
                    $Val[2]      = Validate-DomainName   -SiteName -Name $Con[2]
                    
                    0..2         | ? { $Con[$_] -eq       "" } | % { IEX $MSG[$_] ; Break }
                    0..2         | ? { $Con[$_] -ne $Val[$_] } | % { [ System.Windows.MessageBox ]::Show( $Con[$_] ) ; Break }   
                    0..2         | % { $Code.$( $Items[$_] ) = $Con[$_] }
                }
                    
            Else { $GUI.DialogResult = $True }
        })

        $GUI.DatabasePath | % { $_.Text = "C:\Windows\NTDS"   }
        $GUI.SysvolPath   | % { $_.Text = "C:\Windows\SYSVOL" }
        $GUI.LogPath      | % { $_.Text = "C:\Windows\SYSVOL" }

        $Null = $GUI.SafeModeAdministratorPassword.Focus()

        $OP   = Show-WPFWindow -GUI $GUI


        If ( $OP -eq $True )
        {
            
             $Out.SafeModeAdministratorPassword  = $GUI.DSRM_PW.SecurePassword
             $Out.ForestMode                     = $GUI.ForestMode.SelectedIndex + 1
             $Out.DomainMode                     = $GUI.DomainMode.SelectedIndex + 1
        If ( $Out.ForestMode -in 7..8 ) {          $Out.ForestMode = 7 }
        If ( $Out.DomainMode -in 7..8 ) {          $Out.DomainMode = 7 }
             $Out.Credential                     = $DCCred
             $Out.DatabasePath                   = $GUI.Database.Text
             $Out.SysvolPath                     = $GUI.Sysvol.Text 
             $Out.LogPath                        = $GUI.Log.Text
             $Out.SiteName                       = $GUI.SiteName.Text
             $Out.DomainName                     = $GUI.Domain.Text
             $Out.DomainNetBIOSName              = $GUI.NetBIOS.Text

             $Out | GM | ? { $_.MemberType -eq "NoteProperty" } | Select Name

             Echo $Out
             Read-Host "Correct?"
        }

        Else { Write-Theme -Action "[!] Exception" "Either the user cancelled, or the dialogue failed" }
        
    }
             $Names = $Out | GM | ? { $_.MemberType -eq "NoteProperty" } | % { $_.Name }

             #11,0,2,3,5,9,10,12,14,15,7,1 # Domain Controller

             $Out | Select SafeModeAdministratorPassword , CreateDNSDelegation , DatabasePath , DomainMode , DomainName , DomainNetBIOSName , ForestMode , InstallDNS , LogPath , NoRebootOnCompletion , SysvolPath , Force

             # ADDS New Forest / 13,0,3,4,5,6,8,9,10,12,15,7  # Forest

             $AD = @{   SafeModeAdministratorPassword = $Out.SafeModeAdministratorPassword
                                  CreateDnsDelegation = $Out.InstallDns
                                         DatabasePath = $Out.DatabasePath 
                                           DomainMode = $Out.DomainMode
                                           DomainName = $Out.DomainName
                                    DomainNetBIOSName = $Out.DomainNetBIOSName
                                           ForestMode = $Out.ForestMode
                                           InstallDns = $Out.InstallDNS
                                              LogPath = $Out.LogPath
                                 NoRebootOnCompletion = $Out.NoRebootUponCompletion
                                           SysvolPath = $Out.SysvolPath
                                                Force = $Out.Force
                    }

            $ADND = @{  
                        SafeModeAdministratorPassword = $Out.SafeModeAdministratorPassword
                                  CreateDNSDelegation = $Out.CreateDnsDelegation
                                         DatabasePath = $Out.DatabasePath
                                           DomainMode = $Out.DomainMode
                                           DomainName = $Out.DomainName
                                    DomainNetBIOSName = $Out.DomainNetBIOSName 
                                    
                     }

        #$ADDS = @( 'SkipPreChecks' , 'NewDomainName' , 'ParentDomainName' , 'SafeModeAdministratorPassword', 'ADPrepCredential' , 'AllowDomainReinstall' , 'CreateDnsDelegation'
        #'Credential' , 'DatabasePath' , 'DnsDelegationCredential' , 'NoDnsOnNetwork' , 'DomainMode' , 'DomainType' , 'NoGlobalCatalog' , 'InstallDns' , 'LogPath' ,
        #'NewDomainNetbiosName' , 'NoRebootOnCompletion' , 'ReplicationSourceDC' , 'SiteName' , 'SkipAutoConfigureDns' , 'SysvolPath' , 'Force' )

            # 11 , 0 , 2 , 3 , 5 , 9 , 10 , 12 , 14 , 15 , 7 , 1

            $ADDSC = @{               NoGlobalCatalog = $False 
                                  CreateDnsDelegation = $False 
                              CriticalReplicationOnly = $False 
                                         DatabasePath = “C:\Windows\NTDS”
                                           DomainName = $GUI.DomainName.Text 
                                           InstallDns = $True 
                                              LogPath = “C:\Windows\NTDS” 
                                 NoRebootOnCompletion = $False
                                             SiteName = $GUI.NetBIOS.Text
                                           SysvolPath = “C:\Windows\SYSVOL” 
                                                Force = $True 
                                           Credential = $Cred }

        }
