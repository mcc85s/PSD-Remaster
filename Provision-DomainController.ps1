#_____________________________________________________________________________________________________________________________________________________
#//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\   ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯   //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//  [ Secure Digits Plus LLC | Hybrid | Desired State Controller ]  \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯     __________________________________________________________     ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯ -=-=-=-=-=-=-=[ Dynamically Engineered Digital Security ]-=-=-=-=-=-=--=-= ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯                                           ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//   Application Development | Virtualization | Network and Hardware Magistration   \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\   ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯   //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//   https://www.securedigitsplus.com | Server-Client | Seedling-Spawning Script    \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\___¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ___//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\   [ Provisional Author : Michael C Cook Sr. | "The Buck Stops Here" ]    //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//   ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\
#\\  [ Provision-DomainController ] @: Orchestrates the process of provisioning server prerequisites in order to install Hybrid-DSC          //  \\__//
#//__________________________________________________________________________________________________________________________________________\\__//¯¯\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//

    Using Namespace System.Security.Principal
    Using Namespace System.Management.Automation
    
    $ENV:PSModulePath.Split( ';' ) | % { gci $_ -Recurse "Hybrid-DSC.psm1" } | % {
    
        IPMO $_.FullName
        If ( $? -eq $True ) 
        { 
            Write-Echo -Action "Hybrid-DSC" "[+] Loaded" -F 11 
        } 

        Else { Write-Error "Module Not Loaded/Found" }
        Sleep 1
    }

    Write-Echo -Free -Wrap -F 10 -B 0

# ____                                                                            ____________________________________________________________________ 
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
    Function Auth-Cred # Tests credential for AD/WG Authentication               #¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
    {                                                                                #¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯
        [ CmdLetBinding () ][ OutputType ( [ Int ] ) ] Param ( 
        
            [ Parameter ( ValueFromPipeLine = $True , ValueFromPipelineByPropertyName = $True ) ]
                [ Alias ( 'PSCredential' ) ] [ ValidateNotNull () ][ PSCredential ][ Credential () ] $Creds ,
            [ Parameter ( Position = 0 , ValueFromPipeLine = $True )][ Int ] $Port = 389 )

        Try   { $DC  = @( Get-DCName | ? { $_ -ne $Null } )
                $Dom = @( Get-Domain | ? { $_ -ne $Null } )
                $AD  = "LDAP://$( $DC ):$Port/DC=$( $Dom.Split('.') -join ',DC=' )"
                $DX  = [ DirectoryEntry ]::New( "$AD" , "$( $Creds.Username )" , "$( $Creds.GetNetworkCredential().Password )" ) }

        Catch { $_.Exception.Message ; Continue } 

        If ( ! $DX ) { Return 0 } ElseIf ( $DX.Name -ne $Null ) { Return 1 } Else { Return 0 }
    }

# ____                                                                            ____________________________________________________________________
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
    Function Determine-Domain # A switch that determines workgroup or domain      ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    {
        If ( ( GWMI Win32_ComputerSystem ).PartOfDomain -eq $True ) { $env:USERDOMAIN } Else { $ENV:ComputerName }
    }

# ____                                                                            ____________________________________________________________________
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
    Function Get-FeatureList # A switch that determines workgroup or domain       ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    {
        Return @( @( "AD-Domain-Services" , "DHCP" , "DNS" , "GPMC" ) ; 
        @( "" ; @( "-AdminCenter" , "-PowerShell" , "-Tools" | % { "-AD$_" } ) + 
        @( "" , "-Tools" | % { "-ADDS$_" } ) + "-DHCP" , "-DNS-Server" , "-Role-Tools" ) | % { "RSAT$_" } ;
        @( "" , "-Deployment" , "-Transport" , "-AdminPack" | % { "WDS$_" } ) )
    }

# ____                                                                                                                        _________________________
#//¯¯\\______________________________________________________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    Function Collect-FeaturesState # Pulls up a script login prompt                                                      \\__//¯¯\\__//¯¯\\__//  \\__//
    {
        [ CmdLetBinding () ] Param ( [ Parameter () ][ Switch ] $All )

        $Services = @( Get-FeatureList )
        $GWF      = @( Get-WindowsFeature )
        
        $Array = @( )
        $Table = [ Ordered ]@{ Installed = @( ) ; Available = @( ) }

        ForEach ( $I in $Services )
        {
            $X = $GWF | ? { $_.Name -eq $I } | % {

                If ( $_.InstallState -ne "Installed" ) { $Array += "$I [_]" ; $Table.Available += "$I [_]" }
                If ( $_.InstallState -eq "Installed" ) { $Array += "$I [X]" ; $Table.Installed += "$I [X]" }

            }
        }

        If ( !$All ) { Return $Table }
        If (  $All ) { Return $Array }
    }

# ____                                                                            ____________________________________________________________________
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
    Function Collect-Certificate # Pulls up a script login prompt                 ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    {
        [ CmdLetBinding () ] Param (

            [ Parameter ( Position = 0 , Mandatory = $True , ValueFromPipeline = $True ) ][ String ] $Company ,
            [ Parameter ( Position = 1 , ValueFromPipeline = $True ) ][ String ] $Domain )

        If ( !$Domain ) { $Domain = @( Get-NetworkInfo -DNS ) }

        IRM -URI "http://ipinfo.io/$( $External = ( IWR -URI 'http://ifconfig.me/ip' ).Content )" | % { 
    
            $Table = [ PSCustomObject ]@{
               IP = $_.IP
               ST = $_.Region
                O = $Company 
               CN = $Domain 
                L = $_.City
                C = $_.Country 
                Z = $_.Postal 
            }
        }
        Return $Table
    }

# ____                                                                                                                        _________________________
#//¯¯\\______________________________________________________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    Function Enter-ServiceAccount  # Pulls up a script login prompt                                                      \\__//¯¯\\__//¯¯\\__//  \\__//
    { 
        $XAML = @"
        <Window                       xmlns =                 "http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                                    xmlns:x =                              "http://schemas.microsoft.com/winfx/2006/xaml" 
                                      Title =                   "Secure Digits Plus LLC | Hybrid @ Enter Service Account" 
                                      Width =                                                                       "350" 
                                     Height =                                                                       "220" 
                                 ResizeMode =                                                                  "NoResize" 
                      WindowStartupLocation =                                                              "CenterScreen" 
                                    Topmost =                                                                      "True" >
            <GroupBox 
                                     Header =                           "Enter Directory Services Administration Account" 
                                      Width =                                                                       "330" 
                                     Height =                                                                       "180" >
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height = "3*" />
                        <RowDefinition Height =  "*" />
                        </Grid.RowDefinitions>
                    <Grid Grid.Row = "0" >
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width =    "*" />
                            <ColumnDefinition Width = "2.5*" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition   Height = "*" />
                            <RowDefinition   Height = "*" />
                            <RowDefinition   Height = "*" />
                        </Grid.RowDefinitions>
                            <TextBlock                     Grid.Column = "0" Grid.Row = "0" Margin = "10" TextAlignment = "Right" >Username:</TextBlock>
                            <TextBlock                     Grid.Column = "0" Grid.Row = "1" Margin = "10" TextAlignment = "Right" >Password:</TextBlock>
                            <TextBlock                     Grid.Column = "0" Grid.Row = "2" Margin = "10" TextAlignment = "Right" >Confirm:</TextBlock>
                            <TextBox     Name = "Username" Grid.Column = "1" Grid.Row = "0" Height = "24" Margin = "5" ></TextBox>
                            <PasswordBox Name = "Password" Grid.Column = "1" Grid.Row = "1" Height = "24" Margin = "5" PasswordChar = "*" ></PasswordBox>
                            <PasswordBox Name =  "Confirm" Grid.Column = "1" Grid.Row = "2" Height = "24" Margin = "5" PasswordChar = "*" ></PasswordBox>
                    </Grid>
                    <Grid Grid.Row = "1" >
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width = "*" />
                            <ColumnDefinition Width = "*" />
                        </Grid.ColumnDefinitions>
                            <Button      Name =      "Ok" Content =     "Ok" Grid.Column = "0" Margin = "10" ></Button>
                            <Button      Name =  "Cancel" Content = "Cancel" Grid.Column = "1" Margin = "10" ></Button>
                    </Grid>
                </Grid>
            </GroupBox>
        </Window>
"@
        $NamedElements = "Username" , "Password" , "Confirm" , "Ok" , "Cancel"

        $GUI = Convert-XAMLtoWindow -Xaml $Xaml -NE $NamedElements -PassThru

        $GUI.Cancel.Add_Click( { $GUI.DialogResult = $False } )

        $GUI.Ok.Add_Click( 
        {
            $0      = "Username" , "Password" , "Confirmation"
            $1      = $0 | % { "You must enter a $_" }
            $2      = $0 | % { "$_ Error" }
            
            $1[2]   = $1[2].Replace( "You must enter a" , "Password Must Match the" )
            $1     += "The provided account is either incorrect or invalid. Try again, or hit cancel to exit"
            $2     += "Authentication Failure"

            $MSG    = 0..3 | % { "[ System.Windows.MessageBox ]::Show( '$( $1[$_] )' , '$( $2[$_] )' )" }

                If     ( $GUI.Username.Text      -eq $Null )                                                                 { IEX $MSG[0] }
                ElseIf ( $GUI.Password.Password  -eq $Null )                                                                 { IEX $MSG[1] }
                ElseIf (  $GUI.Confirm.Password  -eq $Null )                                                                 { IEX $MSG[2] }
                ElseIf ( $GUI.Password.Password  -notmatch $GUI.Confirm.Password )                                           { IEX $MSG[2] }
                ElseIf ( ( [ PSCredential ]::New( $GUI.Username.Text , $GUI.Password.SecurePassword ) | Test-Creds ) -ne 1 ) { IEX $MSG[3] }
                Else { $GUI.DialogResult = $True }
            })

            $Null = $GUI.Username.Focus()

            $OP = Show-WPFWindow -GUI $GUI

            If ( $OP -eq $True ) { Return [ PSCredential ]::New( $GUI.Username.Text , $GUI.Password.SecurePassword ) }

            Else { Write-Echo -Action "Exception" "Either the user cancelled, or the dialogue failed" -F 12 }
    }

# ____                                                                            ____________________________________________________________________ 
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
    Function Provision-DomainController                                          #¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
    {                                                                                #¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯
        # - [ Glossary ] - #

        $Center = "VerticalContentAlignment = 'Center' HorizontalContentAlignment = 'Center'"
        $Schema = "http://schemas.microsoft.com/winfx/2006/xaml"
        $Author = "Secure Digits Plus LLC"
        $Select = "IsSelected = 'True"
        $Enable = "IsEnabled = 'False"

        $GC = 0..10 | % {    "Grid.Row = '$_'" }
        $GR = 0..10 | % { "Grid.Column = '$_'" }

        $CS     = ( GCIM Win32_OperatingSystem ).Caption
        
        # - [ Select the correct operating system ] - #

        $ED = @( )

        $On = 1

        "2003" , "2008" , "2008 R2" , "2012" , "2012 R2" , "2016"  | % {

            If ( $On -eq 0 )
            {
                $ED += "Server $_"
            }
            
            If ( $On -eq 1 )
            {
                If ( $_    -like "*R2*" ) 
                { 
                    If ( $CS -like "*$_*" ) { $ED += "Server $_' $Select" } Else { $ED += "Server $_' $Enable" } 
                }
               
                If ( $_ -notlike "*R2*" ) 
                { 
                    If ( ( $CS -like "*$_*" ) -and ( $CS -notlike "*R2*" ) ) { $ED += "Server $_' $Select" } Else { $ED += "Server $_' $Enable" } 
                }

                If ( ( $ED | ? { $_ -like "*IsSelected*" } ) -ne $Null ) { $On = 0 }
            }
        }

        # - [ If Default, set as selection ] - #

        $Default = $( If ( ( $ED | ? { $_ -like "*IsSelected*" } ) -eq $Null ) { "( Default )' $Select" } Else { "( Default )' $Enable" } )

        # - [ Load Installed/Available Services ] - #

        $List = @( Collect-FeaturesState -All ) | % { "
                        $_<LineBreak/>" }

        # - [ Set ComboBox Info ] - #

        $ID = ( "ForestMode" , 0 , 0 ) , ( "DomainMode" , 1 , 0 ) 

        $YZ = $ID | % { "    <ComboBox Name = '$( $_[0] )' Grid.Row = '$( $_[1] )' Grid.Column = '$( $_[2] )' Height = '24' >" }

        ForEach ( $x in 0..1 ) 
        {
            $Y = @( )

            $Items = @( $YZ[$X] , "$( $ID[$X][0] ) $Default" ; @( $ED | % { "$_" } ) )
            
            0..8 | % { 

                If ( $_ -eq    0 ) { $Y += "$( $Items[$_] )
                " }

                If ( $_ -in 1..7 ) { $Y += "                       <ComboBoxItem Content = '$( $Items[$_] )' ></ComboBoxItem>
                " }

                If ( $_ -eq    8 ) { $Y += "                   </ComboBox>" }
            }

            If ( $X -eq 0 ) { $T0 = $Y } If ( $X -eq 1 ) { $T1 = $Y } ; $Y = $Null
        }

        $Xaml = @"
        <Window                                           
                                                  xmlns = "$Schema/presentation"
                                                xmlns:x = "$Schema/2006/xaml" 
                                                  Title = "$Author | Hybrid - Desired State Controller Installation" 
                                                  Width = "800" 
                                                 Height = "600" 
                                    HorizontalAlignment = "Center" 
                                  WindowStartupLocation = "CenterScreen" 
                                                Topmost = "True" >
            <GroupBox                                    
                                                 Header = "[ Hybrid-DSC Initial Service Configuration ]" 
                                    HorizontalAlignment = "Center" 
                                      VerticalAlignment = "Center" 
                                                  Width = "760" 
                                                 Height = "540" 
                                                 Margin = "10" >
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width =    "*" />
                        <ColumnDefinition Width = "2.5*" />
                    </Grid.ColumnDefinitions>
                    <GroupBox Grid.Column = "0" Header = "Feature List" Margin = "10" >
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height = "9*" />
                                <RowDefinition Height =  "*" />
                            </Grid.RowDefinitions>
                            <TextBlock Grid.Column = "0" Margin = "5" FontSize = "14" TextAlignment = "Right" >$List
                            </TextBlock>
                            <Button Name =     "Ok" Content =  "Start" Grid.Row = "1" HorizontalAlignment = "Right" Margin = "10" Width = "60" Height = "20" />
                            <Button Name = "Cancel" Content = "Cancel" Grid.Row = "1" HorizontalAlignment =  "Left" Margin = "10" Width = "60" Height = "20" />
                        </Grid>
                    </GroupBox>
                    <Grid Grid.Column = "1" >
                        <Grid.RowDefinitions>
                            <RowDefinition Height = "*" />
                            <RowDefinition Height = "*" />
                            <RowDefinition Height = "*" />
                        </Grid.RowDefinitions>
                        <GroupBox Grid.Row = "0" Header = "Options" Margin = "10" >
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width = "*"  />
                                    <ColumnDefinition Width = "2*" />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height = "*" />
                                    <RowDefinition Height = "*" />
                                    <RowDefinition Height = "*" />
                                </Grid.RowDefinitions>
                                $T0
                                $T1
                                <Grid Grid.Row = "0" Grid.RowSpan = "3" Grid.Column = "1" >
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width = "*" />
                                        <ColumnDefinition Width = "2.5*" />
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height = "*" />
                                        <RowDefinition Height = "*" />
                                        <RowDefinition Height = "*" />
                                    </Grid.RowDefinitions>
                                    <Label   Content = "Database" Grid.Row = '0' Grid.Column = '0' $Center />
                                    <TextBox    Name = "Database" Grid.Row = '0' Grid.Column = '1' Height = "24" ></TextBox>
                                    <Label   Content =   "Sysvol" Grid.Row = "1" Grid.Column = "0" $Center />
                                    <TextBox    Name =   "Sysvol" Grid.Row = "1" Grid.Column = "1" Height = "24" ></TextBox>
                                    <Label   Content =      "Log" Grid.Row = "2" Grid.Column = "0" $Center />
                                    <TextBox    Name =      "Log" Grid.Row = "2" Grid.Column = "1" Height = "24" ></TextBox>
                                </Grid>
                            </Grid>
                        </GroupBox>
                        <GroupBox Grid.Row ="1" Header = "Network Information" Margin = "10">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height = "*" />
                                    <RowDefinition Height = "*" />
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width =   "1*" />
                                    <ColumnDefinition Width = "2.5*" />
                                </Grid.ColumnDefinitions>
                                <Label   Content =    "FQDN" Grid.Row = "0" Grid.Column = "0" $Center />
                                <TextBox    Name =    "FQDN" Grid.Row = "0" Grid.Column = "1" $Center Height = "24" Width = "250" />
                                <Label   Content = "NetBIOS" Grid.Row = "1" Grid.Column = "0" $Center />
                                <TextBox    Name = "NetBIOS" Grid.Row = "1" Grid.Column = "1" $Center Height = "24" Width = "250" />
                            </Grid>
                        </GroupBox>
                        <GroupBox Grid.Row = "2" Header = "Safe Mode Password" Margin = "10" >
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height = "*" />
                                    <RowDefinition Height = "*" />
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width = "1*" />
                                    <ColumnDefinition Width = "2.5*" />
                                </Grid.ColumnDefinitions>
                                <Label       Content = "Password" Grid.Row = "0" Grid.Column = "0" $Center />
                                <PasswordBox    Name = "Password" Grid.Row = "0" Grid.Column = "1" $Center Width = "250" Height = "24" PasswordChar = "*" />
                                <Label       Content =  "Confirm" Grid.Row = "1" Grid.Column = "0" $Center />
                                <PasswordBox    Name =  "Confirm" Grid.Row = "1" Grid.Column = "1" $Center Width = "250" Height = "24" PasswordChar = "*" />
                            </Grid>
                        </GroupBox>
                    </Grid>
                </Grid>
            </GroupBox>
        </Window>
"@.Replace( "'" , '"' )
        
        $NamedElements = "ForestMode" , "DomainMode" , "FQDN" , "NetBIOS" , "Database" , "Sysvol" , "Log" , "Password" , "Confirm" , "Ok" , "Cancel"

        $GUI = Convert-XAMLtoWindow -Xaml $Xaml -NE $NamedElements -PassThru
        $GUI.Cancel.Add_Click( { $GUI.DialogResult = $False } )
        $GUI.Ok.Add_Click( { 

        $0 = "Domain Name" , "NetBIOS" , "Password" , "Confirmation" , "Match"
        $1 =  $0 | % { "You must enter a $_" } ; $2 =  $0 | % { "$_ Error" }
        $1[4] = "$( $0[2] ) must $( $0[4..3] )"
        $MSG = 0..4 | % { "[ System.Windows.MessageBox ]::Show( '$( $1[$_] )' , '$( $2[$_] )' )" }

            If ( $GUI.Domain.Text -eq "" )                                { IEX $MSG[0] }
            ElseIf ( $GUI.NetBIOS.Text -eq "" )                           { IEX $MSG[1] }
            ElseIf ( $GUI.Password.Password -eq "" )                      { IEX $MSG[2] }
            ElseIf ( $GUI.Confirm.Password -eq "" )                       { IEX $MSG[3] }
            ElseIf ( $GUI.Password.Password -ne $GUI.Confirm.Password )   { IEX $MSG[4] }
            Else { $GUI.DialogResult = $True }
        } )
            
            If ( ( Get-NetworkInfo -DNS         ) -ne $Null ) { $GUI.FQDN.Text    = $_ } Else { $GUI.FQDN.Text    = "" }
            If ( ( Get-NetworkInfo -NetBIOS -DC ) -ne $Null ) { $GUI.NetBIOS.Text = $_ } Else { $GUI.NetBIOS.Text = "" }
            $GUI.Database.Text = "C:\Windows\NTDS"
            $GUI.Sysvol.Text   = "C:\Windows\SYSVOL"
            $GUI.Log.Text      = "C:\Windows\SYSVOL"
            $Null              = $GUI.Password.Focus()
        
        $OP = Show-WPFWindow -GUI $GUI
    
        If ( $OP -eq $True )
        { 
            $Services = @( Get-FeatureList    )
            $GWF      = @( Get-WindowsFeature )
                
            ForEach ( $i in $Services )
            {
                $GWF | % { 
        
                    If ( ( $_.Name -eq $i ) -and ( $_.InstallState -ne "Installed" ) )
                    {
                        Wrap-Action "Installing" "[~] $i"    
                        Install-WindowsFeature -Name $i -IncludeManagementTools
                    }
                }
            }

            Wrap-Action "Complete" "[+] Roles have been installed"

            $ADDS = [ Ordered ]@{  SafeModeAdministratorPassword = $GUI.Password.SecurePassword
                                             CreateDnsDelegation = $False
                                                    DatabasePath = "C:\Windows\NTDS"
                                                      DomainMode = 7
                                                      DomainName = $GUI.DomainName.Text
                                               DomainNetBIOSName = $GUI.NetBIOS.Text
                                                      ForestMode = 7
                                                      InstallDns = $True
                                                         LogPath = "C:\Windows\NTDS"
                                            NoRebootOnCompletion = $False
                                                      SysvolPath = "C:\Windows\SYSVOL"
                                                           Force = $True }

            $Keys , $Values = @( $ADDS ).Keys , @( $ADDS ).Values

            Wrap-Box -K $Keys -V $Values -F 10 -B 0 -Log $Home\Desktop\Testing.txt

            IPMO ADDSDeployment

            Wrap-Action "Installing" "[~] Active Directory Domain Services"

            Install-ADDSForest @ADDS -EA 0

            If ( $? -eq $True ) 
            { 
                Wrap-Action "Successful" "[+] Server has installed the required services, Rebooting"
            }
            
            Else 
            {

                $Cred = New-Object System.Management.Automation.PSCredential -Args "$( $GUI.NetBIOS.Text )\Administrator" , $GUI.Password.SecurePassword

                $ADDSC = [ Ordered ]@{          NoGlobalCatalog = $False 
                                            CreateDnsDelegation = $False 
                                        CriticalReplicationOnly = $False 
                                                   DatabasePath = “C:\Windows\NTDS”
                                                     DomainName = $GUI.DomainName.Text 
                                                     InstallDns = $True 
                                                        LogPath = “C:\Windows\NTDS” 
                                           NoRebootOnCompletion = $False
                                                       SiteName = $GUI.NetBIOS.Text
                                                     SysvolPath = “C:\Windows\SYSVOL” 
                                                          Force = $True 
                                                     Credential = $Cred }

                $Keys , $Values = @( $ADDSC ).Keys , @( $ADDSC ).Values

                Wrap-Box -K $Keys -V $Values -F 10 -B 0 -Log $Home\Desktop\Testing.txt

                Install-ADDSDomainController @ADDSC

            }
        }

        Else { Wrap-Action "Exception" "[!] The user cancelled or the dialogue failed" ; Read-Host "Press Enter to Exit" ; Exit }
    }

# ____                                                                            ____________________________________________________________________ 
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
    Function Determine-Process                                                   #¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
    {                                                                                #¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯
        $CS , $OS = "Computer" , "Operating" | % { GCIM Win32_$( $_ )System }
    
        If ( $CS.PartOfDomain -eq $True ) 
        { 
            Write-Echo -Action "Domain" "[+] Detected" -F 14
            IPMO ActiveDirectory -VB
        }

        Else 
        {
            Write-Echo -Action "Workgroup" "[~] Detected" -F 14
        
            $Admin = "Windows" | % { IEX "( [ $_`Principal ][ $_`Identity ]::GetCurrent() ).IsInRole( 'Administrator' )" } 
            
            $Admin | ? { $_ -eq $True } | % { Write-Echo -Action "Authenticated" "Local Administrator" -F 14 }

            $Admin | ? { $_ -ne $True } | % { 
        
                Write-Echo -Action "Attempting" "[~] Self Script Elevation" 
                If ( [ Int ] $OS.BuildNumber -ge 6000 )
                {
                    $MyInvocation | % { SAPS PowerShell -Verb Runas -Args "-File $( $_.MyCommand.Path ) $( $_.UnboundArguments )" }
                }

                Else 
                {
                    Write-Echo -Action "Exception" "[!] Account was unable to be authenticated"
                    Read-Host "Press Enter to Exit"
                    Exit
                }
            }



            Switch( $Host.UI.PromptForChoice( "Promote to Domain Controller?" , "Program has detected this machine is not connected to a domain" ,
            [ Host.ChoiceDescription [] ]@( '&Promote' , '&Bypass' ) , [ Int ] 0 ) )
            {
                0 { Write-Echo -Action "Provisioning" "Domain Controller" -F 11
                    Provision-DomainController
                
                  } 
                
                1 { 
                
                } 
                
            }
        }
    }

# ____                                                                            ____________________________________________________________________
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
            Provision-DomainController                          #//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\______________________________________________________________\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\   ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯   //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//  [ Secure Digits Plus LLC | Hybrid | Desired State Controller ]  \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯     __________________________________________________________     ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯ -=-=-=-=-=-=-=[ Dynamically Engineered Digital Security ]-=-=-=-=-=-=--=-= ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯                                           ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//   Application Development | Virtualization | Network and Hardware Magistration   \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\   ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯   //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//   https://www.securedigitsplus.com | Server-Client | Seedling-Spawning Script    \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\___¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ___//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\   [ Provisional Author : Michael C Cook Sr. | "The Buck Stops Here" ]    //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//   ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\
#¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯
