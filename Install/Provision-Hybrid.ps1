#_____________________________________________________________________________________________________________________________________________________
#//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\   ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯   //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//  [ Secure Digits Plus LLC | Hybrid | Desired State Controller ]  \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯     __________________________________________________________     ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯ -=-=-=-=-=-=-=[ Dynamically Engineered Digital Security ]-=-=-=-=-=-=--=-= ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯                                           ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//   Application Development | Virtualization | Network and Hardware Magistration   \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\   ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯   //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//   https://www.securedigitsplus.com | Server-Client | Seedling-Spawning Script    \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\___¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ___//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\   [ Provisional Author : Michael C Cook Sr. | "The Buck Stops Here" ]    //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//   ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\
#\\  [ Install-Hybrid ] @: Installs the base folder and application prerequisites for initializing a Hybrid Desired State Controller Server  //  \\__//
#//__________________________________________________________________________________________________________________________________________\\__//¯¯\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
                                                                                                                                     #\__//¯¯\\__//¯¯\\
    Using Namespace System.Security.Principal
    Using Namespace System.Security.AccessControl

# ____                                                                                                                        _________________________
#//¯¯\\______________________________________________________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    Function Wrap-Action # Ties this commandlet into Write-Output for styling strings    \\__//  \\__//  \\__//  \\__//  \\__//  \\__//  \\__//  \\__//
    {
        [ CmdletBinding () ] Param (

            [ Parameter ( Position = 0 , Mandatory , ValueFromPipeline = $True ) ][ String ] $Type ,

            [ Parameter ( Position = 1 , Mandatory , ValueFromPipeline = $True ) ][ String ] $Info )

            $fs = " // " ; $bs = " \\ " ; $x = " " * ( 25 - $Type.Length ) ; $y = " " * ( 80 - $Info.Length )

            Echo @( "" ; ( $fs + ( "¯-" * 54 ) + $bs ) ;
            "$( $bs + $x + $Type ) : $( $Info + $y + $fs )" ;
            ( $fs + ( "-_" * 54 ) + $bs ) ; "" ) 
    }

# ____                                                                                                                        _________________________
#//¯¯\\______________________________________________________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    Function Wrap-Title # Ties this commandlet into Write-Output for styling strings     \\__//  \\__//  \\__//  \\__//  \\__//  \\__//  \\__//  \\__//
    {
        [ CmdLetBinding () ] Param ( 

            [ Parameter ( Position = 0 , Mandatory , ValueFromPipeline = $True ) ]

                [ String ] $Title )

            $fs = " // " ; $bs = " \\ " ; $th = "[ $Title ]" ; $y  = $th.length ; $x  = 108 - $y
            If ( $x % 4 -ge 2 ) { $x  = $x - 2 ; $y  = $th.replace( "[" , " [ " ) ; $th = $y }
            If ( $x % 2 -ge 1 ) { $x  = $x - 1 ; $y  = $th.replace( "]" , " ]" )  ; $th = $y ; $z  = 0 }
            If ( $z = 1 ) { $z = " -" } Else { $z = "- " } $y = $z * ( $x / 4 ) ; $x = "- " * ( $x / 4 )
            Echo @( "" ; ( $fs + ( "¯-" * 54 ) + $bs )
                    "$( $bs + $x + $th + $y + $fs )" )
    }

# ____                                                                                                                        _________________________
#//¯¯\\______________________________________________________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    Function Wrap-Array # Ties this commandlet into Write-Output for styling a string array  //  \\__//  \\__//  \\__//  \\__//  \\__//  \\__//  \\__//
    {
        [ CmdletBinding () ] Param (

            [ Parameter ( Position = 0 , Mandatory , ValueFromPipeline = $True ) ] [ Array ] $Block )

                $fs = " // " ; $bs = " \\ "
                Echo @( " " * 112 ; $fs + "=-" * 54 + $bs ; $bs + "-=" * 54 + $fs )
                Echo $Block
                Echo @( $bs + "=-" * 54 + $fs ; $fs + "-=" * 54 + $bs ; " " * 112 ) 
    }

# ____                                                                                                                        _________________________
#//¯¯\\______________________________________________________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    Function Wrap-Section   #//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
    {
        [ CmdLetBinding () ] Param (

            [Parameter ( Position = 0 , Mandatory , ValueFromPipeline = $True ) ] [ String ] $Section )

            $fs = " // " ; $bs = " \\ " ; $z = $Section ; $x = " " * 10 ; $y = " " * ( 98 - $z.Length )
            ( $fs + "  " * 54 + $bs )
            Echo "$( $bs + $x + $z + $y + $fs )" 
            ( $fs + "  " * 54 + $bs )
    }

# ____                                                                                                                        _________________________
#//¯¯\\______________________________________________________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    Function Wrap-Item      #//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
    { 
        [ CmdLetBinding () ] Param (

            [ Parameter ( Position = 0 , Mandatory , ValueFromPipeline = $True ) ] [ String ] $Type ,
            [ Parameter ( Position = 1 , Mandatory , ValueFromPipeline = $True ) ] [ String ] $Info ,
            [ Switch ] $In , [ Switch ] $Out )
 
            If ( $In )  { $fs = " // " ; $bs = " \\ " }
            If ( $Out ) { $bs = " // " ; $fs = " \\ " }
            $x = " " * ( 25 - $Type.Length ) ; $y = " " * ( 80 - $Info.Length )
            Echo "$( $bs + $x + $Type ) : $( $Info + $y + $fs )" 
    }

# ____                                                                                                                        _________________________
#//¯¯\\______________________________________________________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    Function Wrap-Space     #//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
    {
        [ CmdLetBinding () ] Param (

            [ Switch ] $In ,
            [ Switch ] $Out )

            If ( $In  ) { $fs = " // " ; $bs = " \\ " }
            If ( $Out ) { $bs = " // " ; $fs = " \\ " }
            
            Echo @( $bs + ( " " * 108 ) + $fs )
    }

# ____                                                                                                                        _________________________
#//¯¯\\______________________________________________________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    Function Wrap-Foot      #//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
    {
        $fs = " // " ; $bs = " \\ " ; Echo @( ( $fs + ( "¯-" * 54 ) + $bs ) ; "" )
    }

# ____                                                                                                                        _________________________
#//¯¯\\______________________________________________________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    Function Display-TrueColors # Draws this static string array on the screen ( Will replace with Math at some point )  \\__//¯¯\\__//¯¯\\__//¯¯\\__//
    { #__________________________________________________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
                                                                                                                        #\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
        Wrap-Array -Block @(                                                                                                 #\__//¯¯\\__//¯¯\\__//¯¯\\
        " //                                                                                                              \\ " ; #\__//¯¯\\__//¯¯\\__//
        " \\         // -=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_ \\           // " ; #/¯¯\\__//¯¯\\__//¯¯\\
        " //         \\                                     ][                                               //           \\ " ; #\__//¯¯\\__//¯¯\\__//
        " \\         //   *     *     *     *     *     *   ][ -_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=- \\           // " ; #/¯¯\\__//¯¯\\__//¯¯\\
        " //         \\      *     *     *     *     *      ][                                               //           \\ " ; #\__//¯¯\\__//¯¯\\__//
        " \\         //   *     *     *     *     *     *   ][ =-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-= \\           // " ; #/¯¯\\__//¯¯\\__//¯¯\\
        " //         \\      *     *     *     *     *      ][    Dynamically Engineered Digital Security    //           \\ " ; #\__//¯¯\\__//¯¯\\__//
        " \\         //   *     *     *     *     *     *   ][ -=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_- \\           // " ; #/¯¯\\__//¯¯\\__//¯¯\\
        " //         \\      *     *     *     *     *      ][                                               //           \\ " ; #\__//¯¯\\__//¯¯\\__//
        " \\         //   *     *     *     *     *     *   ][ _-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_ \\           // " ; #/¯¯\\__//¯¯\\__//¯¯\\
        " //         \\      *     *     *     *     *      ][    Application Development - Virtualization   //           \\ " ; #\__//¯¯\\__//¯¯\\__//
        " \\         //   *     *     *     *     *     *   ][ -_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=- \\           // " ; #/¯¯\\__//¯¯\\__//¯¯\\
        " //         \\      *     *     *     *     *      ][        Network & Hardware Magistration        //           \\ " ; #\__//¯¯\\__//¯¯\\__//
        " \\         //   *     *     *     *     *     *   ][ =-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-= \\           // " ; #/¯¯\\__//¯¯\\__//¯¯\\
        " //         \\                                     ][                                               //           \\ " ; #\__//¯¯\\__//¯¯\\__//
        " \\         // -_-=-_-=_-=-_-=-_-=-_-=-_-=-_-=_-=-_][ -=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_- \\           // " ; #/¯¯\\__//¯¯\\__//¯¯\\
        " //         \\                                                                                      //           \\ " ; #\__//¯¯\\__//¯¯\\__//
        " \\         // -=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_[=]\_/[=]\_/[=]\_/[=]=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-_ \\           // " ; #/¯¯\\__//¯¯\\__//¯¯\\
        " //         \\                                 | |               | |                                //           \\ " ; #\__//¯¯\\__//¯¯\\__//
        " \\         // _-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=-[=]- H Y B R I D -[=]-=-_-=-_-=-_-=-_-=-_-=-_-=-_-=- \\           // " ; #/¯¯\\__//¯¯\\__//¯¯\\
        " //         \\                                 | |  ¯¯¯¯¯¯¯¯¯¯¯  | |                                //           \\ " ; #\__//¯¯\\__//¯¯\\__//
        " \\         // -_-=-_-=-_-=-_-=-[=]\_/[=]\_/[=]|=|-=-=- B Y -=-=-|=|[=]\_/[=]\_/[=]-_-=-_-=-_-=-_-= \\           // " ; #/¯¯\\__//¯¯\\__//¯¯\\
        " //         \\                  | |                    ¯¯¯¯¯                    | |                 //           \\ " ; #\__//¯¯\\__//¯¯\\__//
        " \\         // =-_-=-_-=-_-=-_-=[-] S E C U R E - D I G I T S - P L U S - L L C [-]=-_-=-_-=-_-=-_- \\           // " ; #/¯¯\\__//¯¯\\__//¯¯\\
        " //         \\                   \  ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯  /                  //           \\ " ; #\__//¯¯\\__//¯¯\\__//
        " \\         // -=-_-=-_-=[=]\_/[=]\_/[=]\_/[=]\_/[=]\__/[=]\__/[=]\_/[=]\_/[=]\_/[=]\_/[=]_-=-_-=-_ \\           // " ; #/¯¯\\__//¯¯\\__//¯¯\\
        " //         \\           [=]                                                           [=]          //           \\ " ; #\__//¯¯\\__//¯¯\\__//
        " \\         // _-=-_-=-_-[=]- 0 8 / 0 4 / 2 0 1 9  |  M I C H A E L  C  C O O K  S R  -[=]-_-=-_-=- \\           // " ; #/¯¯\\__//¯¯\\__//¯¯\\
        " //         \\           [=]  ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯  [=]          //           \\ " ; #\__//¯¯\\__//¯¯\\__//
        " \\         // _-=-_-=-_-[=]-=-_-=-_-=_-=-_-=-_-=-_-=-_-=-_-=_-=-_-=-_-=-_-=-_-=-_-=_-=[=]=-_-=-_-= \\           // " ; #/¯¯\\__//¯¯\\__//¯¯\\
        " //                                      __________________________________                                      \\ " ; #\__//¯¯\\__//¯¯\\__//
        " \\                                      [ A heightened sense of security ]                                      // " ; #¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯//¯¯\\
        " //                                      ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯                                      \\ " ) ; Sleep -S 2 }

# ____                                                                                                                        _________________________
#//¯¯\\______________________________________________________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    Function Display-Foot # Same as the above, just using this string array below at the end of the script                    ¯¯¯\\__//¯¯\\__//¯¯\\__//
    { #______________________________________________________________________________________________________\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
                                                                                                                        #\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
        Wrap-Array -Block @(                                                                                                 #\__//¯¯\\__//¯¯\\__//¯¯\\
        " // /¯¯\\__//¯¯\\__//¯¯\\    __________________________________________________________    //¯¯\\__//¯¯\\__//¯¯\ \\ " ; #\__//¯¯\\__//¯¯\\__//
        " \\ \__//¯¯\\__//¯¯\\__//    Secure Digits Plus LLC | Hybrid | Desired State Controller    \\__//¯¯\\__//¯¯\\__/ // " ; #/¯¯\\__//¯¯\\__//¯¯\\
        " // /¯¯\\__//¯¯\\__//¯¯      ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯      ¯¯\\__//¯¯\\__//¯¯\ \\ " ; #\__//¯¯\\__//¯¯\\__//
        " \\ \__//¯¯\\__//¯¯  -=-=-=-=-=-=-=[ Dynamically Engineered Digital Security ]-=-=-=-=-=-=--=-=  ¯¯\\__//¯¯\\__/ // " ; #/¯¯\\__//¯¯\\__//¯¯\\
        " // /¯¯\\__//¯¯\\    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯                                           ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    //¯¯\\__//¯¯\ \\ " ; #\__//¯¯\\__//¯¯\\__//
        " \\ \__//¯¯\\__//   Application Development | Virtualization | Network and Hardware Magistration   \\__//¯¯\\__/ // " ; #/¯¯\\__//¯¯\\__//¯¯\\
        " // /¯¯\\__//¯¯\\   ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯   //¯¯\\__//¯¯\ \\ " ; #\__//¯¯\\__//¯¯\\__//
        " \\ \__//¯¯\\__//   https://www.securedigitsplus.com | Server-Client | Seedling-Spawning Script    \\__//¯¯\\__/ // " ; #/¯¯\\__//¯¯\\__//¯¯\\
        " // /¯¯\\__//¯¯\\__ ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    //¯¯\\__//¯¯\ \\ " ; #\__//¯¯\\__//¯¯\\__//
        " \\ \__//¯¯\\__//¯¯\\__         You've just deployed a heightened sense of security          __//¯¯\\__//¯¯\\__/ // " ; #/¯¯\\__//¯¯\\__//¯¯\\
        " // /¯¯\\__//¯¯\\__//¯¯\\__________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\ \\ " ; #¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//
        " \\ \__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__/ // " ) ; Sleep -S 2 }

# ____                                                                                                                        _________________________
#//¯¯\\______________________________________________________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    Function Convert-XAMLToWindow # Overloads a block of XAML strings to convert into interactive content dynamically         ¯¯¯\\__//¯¯\\__//  \\__//
    {
        Param ( [ Parameter ( Mandatory ) ] [ String ]                    $XAML ,
                                            [ String [] ] $NamedElement = $Null ,
                                            [ Switch ]                $PassThru )

        @( "Framework" , "Core" | % { "Presentation$_" } ) + "WindowsBase" | % { Add-Type -AssemblyName $_ }

        $Reader       = [ XML.XMLReader ]::Create([ IO.StringReader ] $XAML )

        $Output       = [ Windows.Markup.XAMLReader ]::Load( $Reader )

        $NamedElement | % { $Output | Add-Member -MemberType NoteProperty -Name $_ -Value $Output.FindName( $_ ) -Force }

        If ( $PassThru )  { $Output }

        Else { $Null = $GUI.Dispatcher.InvokeAsync{ $Output = $GUI.ShowDialog() ;
        SV -Name Output -Value $Output -Scope 1 }.Wait() ; $Output } }

# ____                                                                            ____________________________________________________________________
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
    Function Show-WPFWindow # Displays the previously overloaded XAML string      ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    {
        Param ( [ Parameter ( Mandatory ) ] [ Windows.Window ] $GUI )

        $Output = $Null ; $Null = $GUI.Dispatcher.InvokeAsync{ $Output = $GUI.ShowDialog()
                                  SV -Name Output -Value $Output -Scope 1 }.Wait() ; $Output 
    }

# ____                                                                            ____________________________________________________________________
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
    Function Export-Ini # Extensively modified version found on TechNet           ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    { 
        [ CmdLetBinding () ] Param ( 

            [ Parameter ( Mandatory = $True , Position = 0 ) ][ String ] $Path , 

            [ ValidateNotNullOrEmpty () ][ ValidatePattern ( '^([a-zA-Z]\:)?.+\.ini$' ) ] 
            [ Parameter ( Mandatory = $True , Position = 1 ) ][ String ] $Name ,

            [ ValidateNotNullOrEmpty () ]
            [ Parameter ( Mandatory = $True , Position = 2 , ValueFromPipeline = $True ) ][ Hashtable ] $Value , 

            [ ValidateSet ( "Unicode" , "UTF7" , "UTF8" , "UTF32" , "ASCII" , "BigEndianUnicode" , "Default" , "OEM" ) ] 
            [ Parameter ( Mandatory = $True , Position = 3 ) ][ String ] $Encoding = "Unicode" ,

            [ Switch ] $Force , [ Switch ] $Append , [ Switch ] $UTF8NoBOM ) 

        Begin
        {
            ( $P , $E , $F , $O , $HT ) = ( $Path , $Encoding , "$Path\$Name" , $Value , "Hashtable" )
            If (  ! ( $O ) )           { Wrap-Action "Exception" "[!] Value is Null" ; Break }
            If (  ! ( Test-Path $P ) ) { Wrap-Action "Exception" "[!] Invalid Path" ; Break }
            If ( ( Test-Path $F ) -and ( ! $Force ) )
            { 
                If ( $Append )   { $OF = @( GC $F ) }
                If ( ! $Append ) { Wrap-Action "Exception" "[!] File exists @: Use -Force or -Append" ; Break }
            }

            Else { $OF = @( ) }
        }

        Process
        {
            Wrap-Action "Processing" "[~] Output"
            ForEach ( $i in $O.Keys )
            {
                If ( $( $O[$i].GetType().Name ) -ne $HT ) { $OF += "$i=$( $O[$i] )" } Else { $OF += "[$i]" }

                ForEach ( $j in $( $O[$i].Keys | Sort ) ) 
                {                                                                                          
                    If ( $j -Match "^Comment[\d]+" ) { $OF += "$( $O[$i][$j] )" }
                    Else { $OF += "$j=$( $O[$i][$j] )" }
                }
                SC -Path $F -Value @( $OF ) -Encoding $E
            }
            GI $F
            Wrap-Action "Completed" "[+] File Exported Successfully"
            Write-Host -F Cyan "$( $MyInvocation.MyCommand.Name ): $F"
        }

        End
        {
            If ( $UTF8NoBom ) 
            { [ System.IO.File ]::WriteAllLines( ( $F ), ( GC $F ) , ( New-Object System.Text.UTF8Encoding $False ) ) }
        }
    }

# ____                                                                            ____________________________________________________________________
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
    Function Add-ACL # Changes permissions of application pool/VHost              ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    {
       [ CmdletBinding () ] Param ( 

            [ String ] $Path , 

                [ FileSystemAccessRule ] $ACL ) 

            ( Get-ACL -Path $Path ) | % { $_.AddAccessRule( $ACL ) ; Set-ACL -Path $Path -AclObject $_ }
    }

# ____                                                                            ____________________________________________________________________
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
    Function New-ACLObject # Generates an ACL and edits its permissions           ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    {
        [ CmdletBinding () ] Param ( 

            [ String ] $SAM , 

                [ FileSystemRights  ]     $Rights , 
                [ AccessControlType ]     $Access = 'Allow' , 
                [ InheritanceFlags  ]    $Inherit =  'None' , 
                [ PropagationFlags  ]  $Propagate =  'None' ) 

            New-Object -TypeName System.Security.AccessControl.FileSystemAccessRule( 

                $SAM , $Rights , $Inherit , $Propagate , $Access ) 
    } 

# ____                                                                            ____________________________________________________________________
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
    Function Collect-Graphics # Collects the background and banner for XAML       ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    {
        $Author     = "Secure Digits Plus LLC"

        $GFX = @{ 
        Author      = $Author
        Title       = "[ $Author | Hybrid ] DSC"
        Path        = "$Env:Temp\$Author"
        Banner      = "banner.png"
        Background  = "background.jpg"
        Secure      = "https://securedigitsplus.com" }

        $GFX | % { 
            If ( ( Test-Path $_.Path ) -ne $True ) 
            {
                NI $_.Path -ItemType Directory -Force -VB
                [ Net.ServicePointManager ]::SecurityProtocol = [ Net.SecurityProtocolType ]::TLS12
                $Site    = "$( $GFX.Secure )/img" | % { "$_/$( $GFX.Banner )" , "$_/$( $GFX.Background )" }
                $Image   = $_.Banner , $_.Background
                $Out     = @( 0..1 | % { "$( $GFX.Path )\$( $Image[$_] )" } )
                Foreach ( $i in 0..1 ) { IWR -URI "$( $Site[$i] )" -OutFile "$( $Out[$i] )" }
            }
        }
        ( $GFX.Banner , $GFX.Background ) = ( $GFX.Banner , $GFX.Background ) | % { "$( $GFX.Path )\$_" }
        Return $GFX
    }

# ____                                                                            ____________________________________________________________________
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
    Function Collect-Registry # Collects installed applications from the registry ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    {
        Return "" , "\WOW6432Node" | % { gp "HKLM:\SOFTWARE$_\Microsoft\Windows\CurrentVersion\Uninstall\*" }
    }

# ____                                                                            ____________________________________________________________________
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
    Function Collect-DSCRoot # Collects Hybrid DSC Installation Path              ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    {
        "HKLM:\Software\Policies\Secure Digits Plus LLC" | % { 
            If ( ( Test-Path $_ ) -eq $True ) { Return @{ Root = $_ ; Tree = ( gp $_ ).'Hybrid-DSC' } }
            Else { Install-DSCRoot }
        }
    }

# ____                                                                            ____________________________________________________________________
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
    Function Install-DSCRoot # Provisions base folder for Hybrid-DSC to source files \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    {
        $GFX = @( Collect-Graphics )
        $Title = "$( $GFX.Title ) Root"
        [ System.Windows.MessageBox ]::Show( "This folder may be reused for multiple deployment shares" , 
        "Specify a Hybrid-DSC Root folder."  )

        $XAML = @"
        <Window
                        xmlns                 =       "http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                        xmlns:x               =                    "http://schemas.microsoft.com/winfx/2006/xaml"
                        Title                 =                                                          "$Title" 
                        Width                 =                                                             "640" 
                        Height                =                                                             "450" 
                        WindowStartupLocation =                                                    "CenterScreen"
                        Topmost               =                                                            "True" 
                        HorizontalAlignment   =                                                          "Center"
                        ResizeMode            =                                                        "NoResize" >
            <StackPanel>
                <StackPanel.Background>
                    <ImageBrush ImageSource   =                                            "$( $GFX.Background )" 
                                Stretch       =                                                   "UniformToFill" />
                </StackPanel.Background>
                <StackPanel
                        Height                =                                                             "250" >
                    <Image 
                        Width                 =                                                             "600" 
                        Height                =                                                             "250" 
                        Source                =                                                "$( $GFX.Banner )" 
                        HorizontalAlignment   =                                                          "Center" 
                        Margin                =                                                             "0,0" />
                </StackPanel>
                <StackPanel 
                        Height                =                                                             "120" >
                    <TextBlock
                        HorizontalAlignment   =                                                          "Center" 
                        FontSize              =                                                              "14"
                        FontWeight            =                                                            "Bold" 
                        Foreground            =                                                       "#FF84FF4A" 
                        FontFamily            =                                                        "Segoe UI" >
                        <TextBlock.Effect>
                            <DropShadowEffect
                                ShadowDepth   =                                                               "5"
                                Color         =                                                       "#FF5B5546" />
                        </TextBlock.Effect>
                            Enter an installation folder for Hybrid-DSC
                        </TextBlock>
                    <TextBox
                        Name                  =                                                         "Install"
                        Height                =                                                              "22" 
                        TextWrapping          =                                                            "Wrap" 
                        Width                 =                                                             "300" 
                        Margin                =                                                              "10" />
                </StackPanel>
                <StackPanel 
                    Orientation               =                                                      "Horizontal" 
                    FlowDirection             =                                                     "LeftToRight" 
                    VerticalAlignment         =                                                          "Bottom" 
                    HorizontalAlignment       =                                                          "Center" 
                    Height                    =                                                              "40" 
                    Margin                    =                                                     "145,0,145,0" >
                    <Button 
                        Name                  =                                                           "Start" 
                        Content               =                                                           "Start"  
                        HorizontalAlignment   =                                                            "Left" 
                        Height                =                                                              "20" 
                        Width                 =                                                             "170" />
                    <Button 
                        Name                  =                                                          "Cancel" 
                        Content               =                                                          "Cancel" 
                        HorizontalAlignment   =                                                           "Right" 
                        Height                =                                                              "20" 
                        Width                 =                                                             "170" />
                </StackPanel>
            </StackPanel>
        </Window>
"@

# ____                                                ___________________________________________________________________________#/¯¯\\__//¯¯\\__//¯¯\\
#//  \\______________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\____[ Converts the XAML into a Window ]_______//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//

        $GUI = Convert-XAMLtoWindow -Xaml $XAML -NamedElement "Install" , "Start" , "Cancel" -PassThru

        $GUI.Cancel.Add_Click( { $GUI.DialogResult = $False } )

        $GUI.Start.Add_Click( {

        "Installation Location" | % { $1 = "You must enter a $_" ; $2 = "$_ Missing" }

        If ( $GUI.Install.Text -eq "" ) { [ System.Windows.MessageBox ]::Show( $1 , $2 ) }

        Else { $GUI.DialogResult = $True } } )
# ____                                                _________________________________________________________________________________________________
#//  \\______________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\___[ Synchronizes WPF with Window Element ]___//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//

        $Output = Show-WPFWindow -GUI $GUI

        If ( $Output -eq $True )
        {
            ( $Base , $Vendor , $Registry ) = ( $GUI.Install.Text , "Secure Digits Plus LLC" , "HKLM:\SOFTWARE\Policies" )
            $BasePath = "$Registry\$Vendor"

            $Base | ? { ( Test-Path $_ ) -ne $True } | % {

                Wrap-Action "Creating" "[~] Installation Directory"

                NI $_ -ItemType Directory

                Start $_

                If ( $_ -eq $False )
                {
                    Wrap-Action "Exception" "[!] The directory could not be created"
                    Read-Host "Press Enter to Exit"
                    Exit
                }

                Wrap-Action "Created" "[+] Installation Directory"
            }

            Sleep -M 100

            $Base | ? { ( Test-Path $_ ) -eq $True } | % {

                $BasePath | ? { ( Test-Path $_ ) -eq $False } | % {

                    Wrap-Action "Creating" "[~] Registry Entry for Installation path"

                    NI -Path $Registry -Name $Vendor

                    If ( $? -ne $True )
                    {
                        Wrap-Action "Exception" "[!] Registry Entry Creation Failed"
                        Read-Host "Press Enter to Exit"
                        Exit
                    }
                    ( "Hybrid-DSC" , $Base ) , ( "Installation Date" , ( Get-Date ) ) | % {
                        SP -Path $BasePath -Name $_[0] -Value $_[1]
                        Wrap-Action "Created" "[+] $_"
                    }
                }
            }
            Collect-Dependencies

            "HKLM:\Software\Policies\Secure Digits Plus LLC" | % { Return @{ Root = $_ ; Tree = ( gp $_ ).'Hybrid-DSC' } }
        }
    
        Else
        {
            Wrap-Action "Exception" "[!] The exited or the dialogue failed"
            Read-Host "Press Enter to Exit"
            Exit
        }
    }

# ____                                                                            ____________________________________________________________________
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
    Function Install-Dependencies # Downloads dependency programs & files         ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    {
       [ CmdLetBinding () ] Param ( 

            [ Parameter ( Position =  0 , ValueFromPipeline = $True ) ][ String ]     $ID , 
            [ Parameter ( Position =  1 , ValueFromPipeline = $True ) ][ String ]   $Path , 
            [ Parameter ( Position =  2 , ValueFromPipeline = $True ) ][ String ]   $File , 
            [ Parameter ( Position =  3 , ValueFromPipeline = $True ) ][ String ]    $URL , 
            [ Parameter ( Position =  4 , ValueFromPipeline = $True ) ][ String ]   $Args ) 

        If ( ( Test-Path $Path ) -ne $True ) 
        { 
            NI $Path -ItemType Directory -Value $Path 
            Wrap-Action -Type "Created" -Info "[+] Directory @: $Path" } 

            IWR -URI $URL -OutFile "$Path\$File" 

            Wrap-Action "Installing" $ID 
            Wrap-Action "Processing" "This could take a while." 

            $Dependency = SAPS -FilePath $File -Args $Args -WorkingDirectory $Path -PassThru

            For ( $j = 0 ; $j -le 100 ; $j = ( $j + 1 ) % 100 ) 

            {   Write-Progress -Activity " [ Installing ] $ID" -PercentComplete $j -Status "$( $j )% Complete" 
                Sleep -M 250 

                If ( $Dependency.HasExited ) { Write-Progress -Activity "[ Installed ]" -Completed ; Return } } 
    } 

# ____                                                                            ____________________________________________________________________
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
    Function Extract-Archive # Downloads dependency programs & files              ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    {
        $Reg = @( Collect-Registry )
        $7z  = "$( ( $Reg | ? { $_.DisplayName -like "*7-zip*" } ).InstallLocation )7z.exe"
        Return $7Z 
    }

# ____                                                                            ____________________________________________________________________
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
    Function Load-MDTModule # Loads the module for MDT                            ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    {
        IPMO ( gci ( gp "HKLM:\Software\Microsoft\Deployment 4" ).Install_Dir -Filter "*Toolkit.psd1" -Recurse ).FullName
        If ( $? -eq $True ) { Wrap-Action "Successful" "[+] MDT Module Loaded" }
        Else                { Wrap-Action "Failed" "[!] MDT Module was not found" }
    }

# ____                                                                            ____________________________________________________________________
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
    Function Collect-Dependencies # Downloads dependency programs & files         ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    {

        Wrap-Action "Querying" "Registry for installed applications"
        $Reg     =                                                                       @( Collect-Registry )
        $Base    =                                                                       @( Collect-DSCRoot  ).Tree 
        $CPU     =                                                                 $env:PROCESSOR_ARCHITECTURE
        $SRV     =                                                                           $env:COMPUTERNAME
        $MDTFile =                                                             "MicrosoftDeployment`Toolkit_x"
        $MDTURL  =        "https://download.microsoft.com/download/3/3/9/339BE62D-B4B8-4956-B58D-73C4685FC492"
        $ADK     =                                                     "Windows Assessment and Deployment Kit"
        $MDT     =                                                              "Microsoft Deployment Toolkit"
        $7zu     =                                                                   "https://www.7-zip.org/a" 

        If ( $CPU -eq "x86" ) { $MDTFile = "$MDTFile`86.msi" ; $7zip = "7Z1900.exe"     } 
        Else                  { $MDTFile = "$MDTFile`64.msi" ; $7zip = "7z1900-x64.exe" } 

        $List = @{ 

        0 = # - [ Windows ADK ] - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - \\#
                                                                             "Deployment Kit - Windows 10" , # Regex String                         //#
                                                                                            "10.1.17763.1" , # Minimum Version                      \\#
                                                                                                  "WinADK" , # ID                                   //#
                                                                   "Windows Assessment and Deployment Kit" , # Title                                \\#
                                                                                            "$Base\WinADK" , # Target Path                          //#
                                                                                          "winadk1903.exe" , # Target File                          \\#
                                                         "https://go.microsoft.com/fwlink/?linkid=2086042" , # URL                                  //#
                                                "/quiet /norestart /log $env:temp\win_adk.log /features +"   # Silent Arguments                     \\#
        1 = # - [ Windows PE ]- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //#
                                                                                         "Preinstallation" , # Regex String                         \\#
                                                                                            "10.1.17763.1" , # Minimum Version                      //#
                                                                                                   "WinPE" , # ID                                   \\#
                                                                 "Windows ADK Preinstallation Environment" , # Title                                //#
                                                                                             "$Base\WinPE" , # Target Path                          \\#
                                                                                           "winpe1903.exe" , # Target File                          //#
                                                         "https://go.microsoft.com/fwlink/?linkid=2087112" , # URL                                  \\#
                                                "/quiet /norestart /log $env:temp\win_adk.log /features +"   # Silent Arguments                     //#
        2 = # - [ Microsoft Deployment Toolkit ]- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - \\#
                                                                                         "Deployment Tool" , # Regex String                         //#
                                                                                           "6.3.8450.0000" , # Minimum Version                      \\#
                                                                                                     "MDT" , # ID                                   //#
                                                                            "Microsoft Deployment Toolkit" , # Title                                \\#
                                                                                               "$Base\MDT" , # Target Path                          //#
                                                                                                "$MDTFile" , # Target File                          \\#
                                                                                        "$MDTURL/$MDTFile" , # URL                                  //#
                                                                                       "/quiet /norestart"   # Silent Arguments                     \\#
        3 = # - [ 7-Zip ] - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //#
                                                                                                   "7-Zip" , # Regex String                         \\#
                                                                                                   "19.00" , # Minimum Version                      //#
                                                                                                   "7-Zip" , # ID                                   \\#
                                                                                 "7-Zip Archiving Utility" , # Title                                //#
                                                                                             "$Base\7-Zip" , # Target Path                          \\#
                                                                                                   "$7zip" , # Target File                          //#
                                                                                              "$7zu/$7zip" , # URL                                  \\#
                                                                                                      "/S" } # Silent Arguments                     //#
        ForEach ( $i in 0..3 ) 
        {   
            $Item = $Reg | ? { $_.DisplayName -like "*$( $List[$i][0] )*" } | Select DisplayName , DisplayVersion

            If ( ( $Item -ne $Null ) -and ( $Item.DisplayVersion -ge $List[$i][1] ) )
            {
                Wrap-Action "Dependency"  "$( $List[$i][2] ) meets minimum requirements" 
            }

            ElseIf ( ( $Item -eq $Null ) -or ( $Item.DisplayVersion -lt $List[$i][1] ) )  
            {
                Wrap-Action "Dependency" "$( $List[$i][2] ) does not meet minimum requirements" 
                Wrap-Action "Downloading" "$( $List[$i][2] )" 
                Install-Dependencies -ID $List[$i][3] -Path $List[$i][4] -File $List[$i][5] -URL $List[$i][6] -Args $List[$i][7]

                If ( $? -eq $True ) { Wrap-Action "Successful" "[+] $( $List[$i][2] ) Updated" } 
                Else                { Wrap-Action "Exception" "[!] $( $List[$i][2] ) Failed to update"
                                      Read-Host "Press Enter to Exit"
                                      Exit }
            } 
        }
        
        Wrap-Action "Installed" "[+] All Dependencies" 

        Wrap-Action "Sourcing" "[+] Hybrid-DSC Root Structure"

        "Hybrid" , "Libraries" , "Scripts" , "Templates" , "Install" | % { If ( ( Test-Path "$Base\$_" ) -eq $True ) { RI $Base\$_ -Recurse -Force } }

        "$Base\Hybrid.7z" | % { If ( ( Test-Path $_ ) -eq $True ) { RI $_ -Force }
        IWR -URI "https://securedigitsplus.com/Hybrid-DSC/Hybrid.7z" -OutFile "$_"
        Set-Alias SZ "$( Extract-Archive )"
        SZ x $_ -o"$Base"
        RI $_ -Force }

        Return "HKLM:\Software\Policies\Secure Digits Plus LLC" | % { @{ Root = $_ ; Tree = ( gp $_ ).'Hybrid-DSC' } }
    }

# ____                                                                            ____________________________________________________________________
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
    Function Collect-DSCShare # Downloads dependency programs & files             ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    {
        $Root  = @( Collect-DSCRoot ).Root
        $Tree = "Hybrid\Desired State Controller"

        If ( ( gci $Root ) -eq $Null ) { Install-DSCShare }
        
        ElseIf ( ( gci $Root ) -ne $Null )
        {        
            $Trunk = ( gci "$( $Root )\$Tree" ).PSChildName

            If ( $Trunk.Count -gt 1 )
            {
                Wrap-Action "Selection" "[~] Multiple Company/Channels Found" 
                [ System.Windows.Messagebox ]::Show( "Multiple Provisionaries Found" , "Make Selection" )
                
                0..( $Trunk.Count - 1 ) | % { Echo "[$_] @: $( $Trunk[$_] )" } 
                $Trunk  = $( $Trunk[$( Read-Host "Select [#] Company/Channel" )] )
            }
            If ( $Trunk.Count -le 0 ) { Install-DSCShare }
           
            $Branch = ( gci "$( $Root )\$Tree\$Trunk" ).PSChildName

            If ( $Branch.Count -gt 1 )
            { 
                Wrap-Action "Selection" "[~] Multiple Drives Found" 
                [ System.Windows.Messagebox ]::Show( "Multiple Drives Found" , "Make Selection" )

                0..( $Branch.Count - 1 ) | % { Echo "[$_] $( $Branch[$_] )" } 
                $Branch = $( $Branch[$( Read-Host "Select [#] of SMBShare/PSDrive" )] ) 
            }
            If ( $Branch.Count -le 0 ) { RI "$Root\$Tree\$Trunk" ; Install-DSCShare }
        }
        
        Return gp "$( $Root )\$Tree\$Trunk\$Branch" | % { 
        
                $_.R00_Company ;   $_.R01_UNCRoot ;  $_.R02_Hostname ;    $_.R03_DC_User ;    $_.R04_DC_Pass ;   $_.R05_WWW_Site ; 
                  $_.R06_Phone ;     $_.R07_Hours ;      $_.R08_Logo ; $_.R09_Background ;     $_.R10_Branch ;     $_.R11_Domain ; 
                $_.R12_LM_User ;   $_.R13_LM_Pass ;     $_.R14_Proxy ;    $_.R15_NetBIOS ; $_.R16_DSC_Folder ;    $_.R17_PSDrive ;  
             $_.R18_PSDrive_ID ; $_.R19_BITS_Name ; $_.R20_BITS_Pool ;  $_.R21_BITS_Host ;  $_.R22_BITS_Root ;  $_.R23_BITS_Site }
    }

# ____                                                                            ____________________________________________________________________
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
    Function Install-DSCShare # Provisions a deployment server                       \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    {
        $GFX      = @( Collect-Graphics )
        $Named = @( 0..4 | % { "r$_"   } ; 0..2 | % { "iis$_" } ; 0..2 | % { "dc$_"  } ;
                    0..3 | % { "p$_"   } ; 0..1 | % { "img$_" } ; 0    | % { "n$_"   } )

        $Title    = "$( $GFX.Title ) - Deployment Share / BITS / IIS Setup"

        $FirstTags  = @( "" , "" , "System Root 'C:\'" ; @( "Secured" | % { "Deploy Folder '$_'" , "SMB Name '$_$'" , "PSDrive '$_`:'" } ) + ,
        "Description '[Dev]'" , "" , "" , "BITS / IIS Name 'Hybrid'" , "IIS App Pool 'SecureApp'" , "Virtual Host / Proxy" , 
        "" , "" , "NetBIOS Domain" ; @( "Child Admin" | % { "$_ User" , "$_ P/W" } ) )

        $FirstOffs  = @( "" ; "" ; @( $Named[0..4] ) + "" ; "" ; @( $Named[5..7] ) + "" ; "" ; @( $Named[8..10] ) )

        $FirstList  = @{    RowDef    = @( 0..16                 | % { 
        "                            <RowDefinition Height                    =                               '*' />
        "}) 
                            TextBlock = @( 2..6 + 9..11 + 14..16 | % { 
        "                      <TextBlock 
                                                Grid.Row             =                                '$_' 
                                                Grid.Column          =                                '0' 
                                                Margin               =                                '5' 
                                                FontSize             =                               '14' 
                                                HorizontalAlignment  =                           'Center'
                                                FontWeight           =                             'Bold' 
                                                Foreground           =                        '#FF84FF4A' 
                                                FontFamily           =                         'Segoe UI' >
                                                <TextBlock.Effect>
                                                    <DropShadowEffect
                                                        ShadowDepth  =                                '5'
                                                        Color        =                        '#FF5B5546' />
                                                </TextBlock.Effect>
                                                    $( $FirstTags[$_] )
                                </TextBlock>
        "})
                        TextBoxes = @( 2..6 + 9..11 + 14..15 | % { 
        "                       <TextBox  
                                                    Name                 =                               '$( $FirstOffs[$_] )' 
                                                    Grid.Row             =                               '$_' 
                                                    Grid.Column          =                                '1' 
                                                    Margin               =                                '5' 
                                                    Height               =                               '20' 
                                                    FontSize             =                               '10' />
        "}) + @( 16                          | % { 
        "                       <PasswordBox 
                                                    Name                 =                               '$( $FirstOffs[$_] )'
                                                    Grid.Row             =                               '$_' 
                                                    Grid.Column          =                                '1' 
                                                    Margin               =                                '5' 
                                                    Height               =                               '20' 
                                                    FontSize             =                               '10' 
                                                    PasswordChar         =                                '*' >
                                </PasswordBox>
        "})}

# ____                                _________________________________________________________________________________________________________________
#//  \\______________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\_____[ Second Tab Values ]________\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
                                                                                                                     #\__//__\\__//__\\__//¯¯\\__//¯¯\\

        $SecondTags  = @( "" ; "Company Name" ; @( "Website" , "Phone" , "Hours" | % { "Support $_" ; } ) + 
        ""; "Logo [ 120x120.bmp ]" ; "Background" ; "" ; "Branch" ) 

        $SecondOffs  = @( "" ; @( $Named[11..14] ) + "" ; @( $Named[15..16] ) + "" ; $( $Named[17] ) ) 

        $SecondList  = @{   RowDef    = @( 0..10 | % { 
        "                            <RowDefinition Height                    =                               '32' /> 
        "}) 
                            TextBlock = @( 1..4 + 6 , 7 , 9 | % { 
        "                      <TextBlock 
                                                    Grid.Row             =                                '$_' 
                                                    Grid.Column          =                                '0' 
                                                    Margin               =                                '5' 
                                                    FontSize             =                               '14' 
                                                    HorizontalAlignment  =                           'Center'
                                                    FontWeight           =                             'Bold' 
                                                    Foreground           =                        '#FF84FF4A' 
                                                    FontFamily           =                         'Segoe UI' >
                                                    <TextBlock.Effect>
                                                        <DropShadowEffect
                                                            ShadowDepth  =                                '5'
                                                            Color        =                        '#FF5B5546' />
                                                    </TextBlock.Effect>
                                                        $( $SecondTags[$_] )
                               </TextBlock>
        "})
                            TextBoxes = @( 1..4 + 6 , 7 , 9 | % { 
        "                       <TextBox 
                                                    Name                 =                               '$( $SecondOffs[$_] )'
                                                    Grid.Row             =                                '$_' 
                                                    Grid.Column          =                                '1' 
                                                    Height               =                               '20' 
                                                    FontSize             =                               '10' 
                                                    Margin               =                                '5' />
        "})}

# ____                                                ___________________________________________________________________________#/¯¯\\__//¯¯\\__//¯¯\\
#//  \\______________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\
#             Dynamic XAML Content Definitions        ¯¯¯\\__________________________[ Cannot Add Commentary to Static String ]______________________//
    
        $XAMLRoot = @"
        <Window
                        xmlns                 =       'http://schemas.microsoft.com/winfx/2006/xaml/presentation'
                        xmlns:x               =                    'http://schemas.microsoft.com/winfx/2006/xaml'
                        Title                 =    '[ Secure Digits Plus LLC | Hybrid ] Desired State Controller' 
                        Width                 =                                                             '640' 
                        Height                =                                                             '850' 
                        WindowStartupLocation =                                                    'CenterScreen'
                        Topmost               =                                                            'True' 
                        HorizontalAlignment   =                                                          'Center'
                        ResizeMode            =                                                        'NoResize'  >
            <StackPanel>
                <StackPanel.Background>
                    <ImageBrush ImageSource   =                                            '$( $GFX.Background )' 
                                Stretch       =                                                   'UniformToFill' />
                </StackPanel.Background>
                <StackPanel
                        Height                =                                                             '250'  >
                    <Image 
                        Width                 =                                                             '640' 
                        Height                =                                                             '240' 
                        Source                =                                                '$( $GFX.Banner )' 
                        HorizontalAlignment   =                                                          'Center' 
                        Margin                =                                                             '10' />
                </StackPanel>
                <StackPanel 
                        Height                =                                                             '515'  >
                    <TabControl 
                        Height                =                                                             '515' 
                        HorizontalContentAlignment =                                                     'Center' 
                        HorizontalAlignment   =                                                          'Center' 
                        VerticalAlignment     =                                                          'Center' 
                        Background            =                                                        '{x:Null}' 
                        BorderBrush           =                                                        '{x:Null}' 
                        Foreground            =                                                        '{x:Null}' 
                        Margin                =                                                            '10,0' >
                        <TabItem 
                            Header            =                                         'Stage Deployment Server' 
                            HorizontalAlignment =                                                        'Center' 
                            Width             =                                                             '240' 
                            BorderBrush       =                                                        '{x:Null}'  >
                            <TabItem.Effect>
                                <DropShadowEffect/>
                            </TabItem.Effect>
                            <Grid 
                                Height            =                                                         '480' 
                                VerticalAlignment =                                                         'Top'  >
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width =                                              '0.5*' />
                                    <ColumnDefinition Width =                                              '0.5*' />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    $( $FirstList.RowDef )
                                </Grid.RowDefinitions>
                                <TextBlock 
                                                        Grid.Row             =                                '0'
                                                        Grid.Column          =                                '0'
                                                        Grid.ColumnSpan      =                                '2'
                                                        Margin               =                                '5'  
                                                        HorizontalAlignment  =                           'Center'
                                                        TextAlignment        =                           'Center'
                                                        FontSize             =                               '14'
                                                        FontWeight           =                             'Bold' 
                                                        Foreground           =                        '#FF84FF4A' 
                                                        FontFamily           =                         'Segoe UI' >
                                    # - - - - - [ MDT Base Share Settings ] - - - - - #
                                                    <TextBlock.Effect>
                                                        <DropShadowEffect
                                                            ShadowDepth  =                                '5'
                                                            Color        =                        '#FF5B5546' />
                                                    </TextBlock.Effect>
                                </TextBlock>
                                <TextBlock 
                                                        Grid.Row             =                                '1'
                                                        Grid.Column          =                                '0'
                                                        Grid.ColumnSpan      =                                '2'
                                                        Margin               =                                '5' 
                                                        HorizontalAlignment  =                           'Center'
                                                        TextAlignment        =                           'Center'
                                                        FontSize             =                               '14'
                                                        FontWeight           =                             'Bold' 
                                                        Foreground           =                        '#FF84FF4A' 
                                                        FontFamily           =                         'Segoe UI' >
                                                    <TextBlock.Effect>
                                                        <DropShadowEffect
                                                            ShadowDepth      =                                '5'
                                                            Color            =                        '#FF5B5546' />
                                                    </TextBlock.Effect>
                                    These settings will generate a new MDT share
                                </TextBlock>
                                $( $FirstList.TextBlock[0..4] )
                                <RadioButton            x:Name              =                            'Legacy' 
                                                        Grid.Row            =                                 '7'
                                                        Grid.Column         =                                 '0' 
                                                        Margin              =                                 '5' 
                                                        Content             =                          'Disabled' 
                                                        HorizontalAlignment =                            'Center' 
                                                        VerticalAlignment   =                            'Center'
                                                        Foreground          =                              'Gray' 
                                                        IsEnabled           =                             'False' >
                                    <RadioButton.Effect>
                                        <DropShadowEffect/>
                                    </RadioButton.Effect>
                                </RadioButton>
                                <RadioButton            x:Name              =                        'PowerShell' 
                                                        Grid.Row            =                                 '7' 
                                                        Grid.Column         =                                 '1' 
                                                        Margin              =                                 '5' 
                                                        Content             =                          'Disabled' 
                                                        HorizontalAlignment =                            'Center' 
                                                        VerticalAlignment   =                            'Center' 
                                                        Foreground          =                              'Gray'
                                                        IsEnabled           =                             'False' >
                                    <RadioButton.Effect>
                                        <DropShadowEffect/>
                                    </RadioButton.Effect>
                                </RadioButton>
                                <!-- # - - - - [ BITS / IIS Config ] - - - - #  -->
                                <TextBlock 
                                                        Grid.Row             =                                '8'
                                                        Grid.Column          =                                '0'
                                                        Grid.ColumnSpan      =                                '2' 
                                                        Margin               =                                '5'  
                                                        HorizontalAlignment  =                           'Center'
                                                        TextAlignment        =                           'Center'
                                                        FontSize             =                               '14'
                                                        FontWeight           =                             'Bold' 
                                                        Foreground           =                        '#FF84FF4A' 
                                                        FontFamily           =                         'Segoe UI' >
                                                    <TextBlock.Effect>
                                                        <DropShadowEffect
                                                            ShadowDepth      =                                '5'
                                                            Color            =                        '#FF5B5546' />
                                                    </TextBlock.Effect>
                                # - - - - - - - - [ BITS / IIS Config ] - - - - - - - - #
                                </TextBlock>
                                $( $FirstList.TextBlock[5..7] )
                                <RadioButton 
                                                        x:Name               =                            'IIS_I'
                                                        Grid.Row             =                               '12'
                                                        Grid.Column          =                                '0'
                                                        Margin               =                                '5' 
                                                        Content              =                         'Disabled' 
                                                        HorizontalAlignment  =                           'Center'
                                                        VerticalAlignment    =                           'Center' 
                                                        Foreground           =                             'Gray' 
                                                        IsEnabled            =                            'False' >
                                    <RadioButton.Effect>
                                        <DropShadowEffect/>
                                    </RadioButton.Effect>
                                </RadioButton>
                                <RadioButton 
                                                        x:Name               =                            'IIS_X'
                                                        Grid.Row             =                               '12'
                                                        Grid.Column          =                                '1'
                                                        Margin               =                                '5'
                                                        Content              =                         'Disabled'
                                                        HorizontalAlignment  =                           'Center'
                                                        VerticalAlignment    =                           'Center'
                                                        Foreground           =                             'Gray'
                                                        IsEnabled            =                            'False' >
                                    <RadioButton.Effect>
                                        <DropShadowEffect/>
                                    </RadioButton.Effect>
                                </RadioButton>
                                <TextBlock 
                                                        Grid.Row             =                               '13'
                                                        Grid.Column          =                                '0' 
                                                        Grid.ColumnSpan      =                                '2' 
                                                        Margin               =                                '5'
                                                        HorizontalAlignment  =                           'Center'
                                                        TextAlignment        =                           'Center'
                                                        FontSize             =                               '14'
                                                        FontWeight           =                             'Bold' 
                                                        Foreground           =                        '#FF84FF4A' 
                                                        FontFamily           =                         'Segoe UI' >
                                                    <TextBlock.Effect>
                                                        <DropShadowEffect
                                                            ShadowDepth      =                                '5'
                                                            Color            =                        '#FF5B5546' />
                                                    </TextBlock.Effect>
                                # - - [ Network and Source Credentials ]  - - #
                                </TextBlock>
                                $( $FirstList.TextBlock[8..10] )
                                $( $FirstList.TextBoxes[0..10] )
                            </Grid>
                        </TabItem>
                        <TabItem 
                            Header                                           =                       'Image Info' 
                            HorizontalAlignment                              =                           'Center' 
                            Width                                            =                              '150' 
                            BorderBrush                                      =                         '{x:Null}' >
                            <TabItem.Effect>
                                <DropShadowEffect/>
                            </TabItem.Effect>
                            <Grid 
                                Height                                       =                              '400' 
                                VerticalAlignment                            =                              'Top' >
                            <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width                  =                             '0.5*' />
                                    <ColumnDefinition Width                  =                             '0.5*' />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                $( $SecondList.RowDef )
                                </Grid.RowDefinitions>
                                <TextBlock 
                                                        Grid.Row             =                                '0'
                                                        Grid.Column          =                                '0' 
                                                        Grid.ColumnSpan      =                                '2' 
                                                        Margin               =                                '5'
                                                        HorizontalAlignment  =                           'Center'
                                                        TextAlignment        =                           'Center'
                                                        FontSize             =                               '14'
                                                        FontWeight           =                             'Bold' 
                                                        Foreground           =                        '#FF84FF4A' 
                                                        FontFamily           =                         'Segoe UI' >
                                                    <TextBlock.Effect>
                                                        <DropShadowEffect
                                                            ShadowDepth      =                                '5'
                                                            Color            =                        '#FF5B5546' />
                                                    </TextBlock.Effect>
                                # - - [ Company Information ]  - - #
                                </TextBlock>
                                $( $SecondList.TextBlock[0..3] )
                                <TextBlock 
                                                        Grid.Row             =                                '5'
                                                        Grid.Column          =                                '0' 
                                                        Grid.ColumnSpan      =                                '2' 
                                                        Margin               =                                '5'
                                                        HorizontalAlignment  =                           'Center'
                                                        TextAlignment        =                           'Center'
                                                        FontSize             =                               '14'
                                                        FontWeight           =                             'Bold' 
                                                        Foreground           =                        '#FF84FF4A' 
                                                        FontFamily           =                         'Segoe UI' >
                                                    <TextBlock.Effect>
                                                        <DropShadowEffect
                                                            ShadowDepth      =                                '5'
                                                            Color            =                        '#FF5B5546' />
                                                    </TextBlock.Effect>
                                # - - [ Custom Graphics ]  - - #
                                </TextBlock>
                                $( $SecondList.TextBlock[ 4..5 ] )
                                <TextBlock 
                                                        Grid.Row             =                                '8'
                                                        Grid.Column          =                                '0' 
                                                        Grid.ColumnSpan      =                                '2' 
                                                        Margin               =                                '5'
                                                        HorizontalAlignment  =                           'Center'
                                                        TextAlignment        =                           'Center'
                                                        FontSize             =                               '14'
                                                        FontWeight           =                             'Bold' 
                                                        Foreground           =                        '#FF84FF4A' 
                                                        FontFamily           =                         'Segoe UI' >
                                                    <TextBlock.Effect>
                                                        <DropShadowEffect
                                                            ShadowDepth      =                                '5'
                                                            Color            =                        '#FF5B5546' />
                                                    </TextBlock.Effect>
                                # - - [ Network Definitions ]  - - #
                                </TextBlock>
                                $( $SecondList.TextBlock[ 6 ] )
                                $( $SecondList.TextBoxes )
                            </Grid>
                        </TabItem>
                    </TabControl>
                </StackPanel>
                <StackPanel 
                        Orientation                                          =                       'Horizontal' 
                        FlowDirection                                        =                      'LeftToRight' 
                        VerticalAlignment                                    =                           'Bottom' 
                        HorizontalAlignment                                  =                           'Center' 
                        Height                                               =                               '40' 
                        Margin                                               =                      '150,0,150,0' >
                    <Button 
                        Name                                                 =                            'Start'  
                        Content                                              =                            'Start'  
                        HorizontalAlignment                                  =                             'Left'  
                        Height                                               =                               '20' 
                        Width                                                =                              '170' />
                    <Button 
                        Name                                                 =                           'Cancel' 
                        Content                                              =                           'Cancel' 
                        HorizontalAlignment                                  =                            'Right' 
                        Height                                               =                               '20' 
                        Width                                                =                              '170' />
                </StackPanel>
            </StackPanel>
        </Window>
"@

        $GUI = Convert-XAMLtoWindow -Xaml $XAMLRoot -NamedElement @( $Named ; "Start" ; "Cancel" ) -PassThru 

        $GUI.Cancel.Add_Click({ $GUI.DialogResult = $False }) 

        $GUI.Start.Add_Click({ 

        $0 = @( "File System/Drive" ;          "Root Folder" ;    "Network Share Name" ;      "PSDrive Name" ; 
                "Share Description" ;            "Site Name" ; "Application Pool Name" ; "Virtual Directory" ; 
                     "NetBIOS Name" ; "Target/LM Admin User" ;  "Target/LM Admin Pass" ;      "Company Name" ; 
                     @( "Website" , "Phone" , "Hours" | % { "Support $_" ; } ) + "Logo " ; "Background" ; "Branch" ) 

        $1 = $0 | % { "You must enter a $_" } ; $2 = $0 | % { "$_ Missing" } ; 
        $MSG = 0..17 | % { "[ System.Windows.MessageBox ]::Show( '$( $1[$_] )' , '$( $2[$_] )' )" } 

        If     (      $GUI.r0.Text -eq "" ) { IEX $MSG[ 0] } 
        ElseIf (      $GUI.r1.Text -eq "" ) { IEX $MSG[ 1] } 
        ElseIf (      $GUI.r2.Text -eq "" ) { IEX $MSG[ 2] } 
        ElseIf (      $GUI.r3.Text -eq "" ) { IEX $MSG[ 3] } 
        ElseIf (      $GUI.r4.Text -eq "" ) { IEX $MSG[ 4] } 
        ElseIf (    $GUI.iis0.Text -eq "" ) { IEX $MSG[ 5] } 
        ElseIf (    $GUI.iis1.Text -eq "" ) { IEX $MSG[ 6] } 
        ElseIf (    $GUI.iis2.Text -eq "" ) { IEX $MSG[ 7] } 
        ElseIf (     $GUI.dc0.Text -eq "" ) { IEX $MSG[ 8] } 
        ElseIf (     $GUI.dc1.Text -eq "" ) { IEX $MSG[ 9] } 
        ElseIf ( $GUI.dc2.Password -eq "" ) { IEX $MSG[10] } 
        ElseIf (      $GUI.p0.Text -eq "" ) { IEX $MSG[11] } 
        ElseIf (      $GUI.p1.Text -eq "" ) { IEX $MSG[12] } 
        ElseIf (      $GUI.p2.Text -eq "" ) { IEX $MSG[13] } 
        ElseIf (      $GUI.p3.Text -eq "" ) { IEX $MSG[14] } 
        ElseIf (    $GUI.img0.Text -eq "" ) { IEX $MSG[15] } 
        ElseIf (    $GUI.img1.Text -eq "" ) { IEX $MSG[16] } 
        ElseIf (      $GUI.n0.Text -eq "" ) { IEX $MSG[17] } 
        Else { $GUI.DialogResult = $True }})

        $Output = Show-WPFWindow -GUI $GUI 

        If ( $Output -eq $True ) 

        {   $SP       = $GUI.dc2.SecurePassword 
            $LMCRED   = New-Object -TypeName System.Management.Automation.PSCredential -Args $GUI.dc1.Text , $SP
            $SRV      = $Env:ComputerName
            $DOMAIN   = Determine-Domain
            
            $DSCShare = [ Ordered ]@{
                        R00_Company     =                                                      "$( $GUI.p0.Text )" 
                        R01_UNCRoot     =                  "\\$Env:ComputerName\$( $GUI.r2.Text.TrimEnd( '$' ) )$" 
                        R02_Hostname    =                                                      "$ENV:ComputerName" 
                        R03_DC_User     =                                                  "$( $DCCred.Username )" 
                        R04_DC_Pass     =                                           "System.Security.SecureString" 
                        R05_WWW_Site    =                                                      "$( $GUI.p1.Text )" 
                        R06_Phone       =                                                      "$( $GUI.p2.Text )" 
                        R07_Hours       =                                                      "$( $GUI.p3.Text )" 
                        R08_Logo        =                                                    "$( $GUI.img0.Text )" 
                        R09_Background  =                                                    "$( $GUI.img1.Text )" 
                        R10_Branch      =                                                      "$( $GUI.n0.Text )" 
                        R11_Domain      =                                                                "$DOMAIN" 
                        R12_LM_User     =                                                  "$( $LMCRED.Username )" 
                        R13_LM_Pass     =                           "$( $LMCRED.GetNetworkCredential().Password )" 
                        R14_Proxy       =                                                 "$( $Env:ComputerName )" 
                        R15_NetBIOS     =                                                   "$( $Env:UserDomain )" 
                        R16_DSC_Folder  =                 "$( $GUI.r0.Text.TrimEnd( '\' ) )\$( ( $GUI.r1.Text ) )" 
                        R17_PSDrive     =                                       "$( $GUI.r3.Text.TrimEnd( ':' ) )" 
                        R18_PSDrive_ID  =                                                      "$( $GUI.r4.Text )" 
                        R19_BITS_Name   =                                                    "$( $GUI.iis0.Text )" 
                        R20_BITS_Pool   =                                                    "$( $GUI.iis1.Text )" 
                        R21_BITS_Host   =                                                    "$( $GUI.iis2.Text )" 
                        R22_BITS_Root   =       "$( $GUI.r0.Text.TrimEnd( '\' ) )\inetsrv\$( ( $GUI.iis2.Text ) )"
                        R23_BITS_Site   =                                   "$( $_.iis0.Text ).$env:USERDNSDOMAIN" }

            $PName          = $DSCShare.R00_Company
            $NRoot          = $DSCShare.R01_UNCRoot
            $URI            = $DSCShare.R16_DSC_Folder
            $SMB            = "$( $GUI.r2.Text.TrimEnd( '$' ) )$"
            $PSD            = $DSCShare.R17_PSDrive
            $TAG            = $DSCShare.R18_PSDrive_ID

# ____                                                ___________________________________________________________________________#/¯¯\\__//¯¯\\__//¯¯\\
#//  \\______________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\______[ Generate the deployment share ]_______//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
                                                                                                                     #\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
            Load-MDTModule

            $URI | % { If ( ( Test-Path $_ ) -eq $False ) { NI $_ -ItemType Directory } Else { GI $_ } }

            If ( ( GSMBS | ? { $_.Path -eq $URI } -EA 0 ) -eq $Null ) { NSMBS -Name $SMB -Path $URI -Description $TAG -FullAccess Administrators   }
            Else { GSMBS -Name $SMB }

            If ( ( GDR | ? { $_.Name -eq $PSD } -EA 0 ) -eq $Null )
            { NDR -Name $PSD -PSProvider MDTProvider -Root $URI -Description $TAG -NetworkPath $NRoot | Add-MDTPersistentDrive }
            Else { GDR -Name $PSD }
            
            $Tree = "Secure Digits Plus LLC\Hybrid\Desired State Controller\$PName\$PSD"
            $Root = "HKLM:\SOFTWARE\Policies"
            $Rec  =  $Tree.Split( '\' ) 

            0    | % { If ( ( Test-Path "$Root\$( $Rec[ 0] )" ) -ne $True ) { NI -Path $Root -Name $Rec[ 0] } ; $Path = "$Root\$( $Rec[ 0] )" }
            1..4 | % { If ( ( Test-Path "$Path\$( $Rec[$_] )" ) -ne $True ) { NI -Path $Path -Name $Rec[$_] } ; $Path = "$Path\$( $Rec[$_] )" }
                        
            $Full = "$Root\$Full" 

            If ( ( Test-Path $Full ) -eq $True ) 
            { 
                $Name = @( $DSCShare ).Keys ; $Value = @( $DSCShare ).Values
                0..23 | % { SP -Path "$Full" -Name "$( $Name[$_] )" -Value "$( $Value[$_] )" -Force }
            }

# ____                                                ___________________________________________________________________________#/¯¯\\__//¯¯\\__//¯¯\\
#//  \\______________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\____[ Select Legacy MDT or PSD-Remaster ]_____//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
                                                                                                                     #\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
            Switch ( $host.UI.PromptForChoice( 'PowerShell Deployment' , 'Use Legacy Share or PSD-Remaster ?' , 

            [ System.Management.Automation.Host.ChoiceDescription [] ]@( '&Legacy MDT' , '&PSD-Remaster' ) , [ Int ] 1 ) ) 
            {   
                0   
                {   Wrap-Action "Selected" "[+] MDT [Deployment] Share created" }

                1   
                {   Wrap-Action "Creating" "[+] PowerShell [Deployment/Development] Share"
                    
                    $Base   = @( Collect-DSCRoot ).Tree

# ____                                                ___________________________________________________________________________#/¯¯\\__//¯¯\\__//¯¯\\
#//  \\______________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\___________[ Scripts / Templates ]____________//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
                                
                    $Obj = $Scripts , $Templates = "Scripts" , "Templates"
            
                    $Obj | % { $S , $D = "$Base\$_" , "$URI\$_" ; ( gci $S ).Name | % { 
                    Robocopy $S $D $_ ; Dir "$D\$_" | Unblock-File ; Write-Host -F Cyan "$_ copied successfully" } }

# ____                                                ___________________________________________________________________________#/¯¯\\__//¯¯\\__//¯¯\\
#//  \\______________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\_________________[ Modules ]__________________//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
                                                                                                                     #\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
                    $Modules = "Tools\Modules"

                    "PSDGather", "PSDDeploymentShare", "PSDUtility", "PSDWizard" | % {
                    $ModPath  = "$URI\$Modules\$_"

                    If ( ( Test-Path "$ModPath" ) -eq $False ) 
                    { NI "$ModPath" -ItemType Directory ; Wrap-Action "Created" "[+] Directory $_" }

                        Wrap-Action "Copying" "Module $_ to $ModPath"
                        Robocopy "$Base\$Scripts" "$ModPath" "$_.psm1"
                        Dir                          "$ModPath" | Unblock-File
                        Write-Host -F Cyan "$_ copied successfully" }

# ____                                                ___________________________________________________________________________#/¯¯\\__//¯¯\\__//¯¯\\
#//  \\______________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\________________[ SnapIns ]___________________//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
                                                                                                                     #\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
                    $BDD = "Microsoft.BDD"

                    Wrap-Action "Copying" "[+] $URI\$Modules"
                    If ( ( Test-Path "$URI\$Modules\$BDD.PSSnapin" ) -ne $True ) 
                    { NI "$URI\$Modules\$BDD.PSSnapIn" -ItemType Directory ; Wrap-Action "Created" "[+] Directory" } 

                    $PSSnapIn = ( ( "" , ".config" , "-help.xml" | % { ".dll$_" } ) + 
                    ( ".Format" , ".Types" | % { "$_.ps1xml" } ) | % { "PSSnapIn$_" } ) + 
                    ( "" , ".config" | % { "Core.dll$_" } ) + "ConfigManager.dll" | % { 
                        
                    CP "$MDTDir\Bin\$BDD.$_" "$URI\$Modules\$BDD.PSSnapIn" }
                
# ____                                                ___________________________________________________________________________#/¯¯\\__//¯¯\\__//¯¯\\
#//  \\______________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\_______________[ Templates ]__________________//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
                                                                                                                     #\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
                    Wrap-Action "Copying" "[+] $URI\$Templates" 
                    If ( ( Test-Path "$URI\$Templates" ) -eq $False ) { NI "$URI\$Templates" } 

                    "Groups" , "Medias" , "OperatingSystems" , "Packages" , "SelectionProfiles" , "TaskSequences" , 
                    "Applications" , "Drivers" , "LinkedDeploymentShares" | % { "$_.xsd" } | % { 

                    CP "$MDTDir\$Templates\$_" "$URI\$Templates"
                    Wrap-Action "Copying" "[+] $URI\$Templates" } 

# ____                                                ___________________________________________________________________________#/¯¯\\__//¯¯\\__//¯¯\\
#//  \\______________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\_______________[ Zero-Touch ]_________________//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
                                                                                                                     #\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
                    Wrap-Action "Sending" "[+] ZTIGather.XML to correct folder" 

                    ( gci "$MDTDir\Templates\Distribution\Scripts" "*Gather.xml" -EA 0 ) | % { 
                    CP $_.FullName "$URI\$Modules\PSDGather" }

# ____                                                ___________________________________________________________________________#/¯¯\\__//¯¯\\__//¯¯\\
#//  \\______________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\_____________[ Random Stuff ]_________________//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
                                                                                                                     #\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
 
                    $Msg  = "Logs" , "Dynamics Logs Sub" , "DriverSources" , "DriverPackages" | % { "$_ Folder" }
                    $Dir  = "Logs" ,          "Logs\Dyn" , "DriverSources" , "DriverPackages" 

                    0..3 | % { Wrap-Action "Creating" "$( $Msg[$_] ) in $URI\$( $Dir[$_] )" 
                    NI -ItemType Directory -Path "$URI\$( $Dir[$_] )" -Force } 
                } 
            }
# ____                                                _________________________________________________________________________________________________
#//  \\______________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\____________[ Share Permissions ]_____________//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//

            Wrap-Action "Reducing" "[~] Permissions Hardening on $SMB" 

            "Users" , "Administrators" , "SYSTEM" | % { "$_`:(OI)(CI)(RX)" } | % { $Null = ICACLS $URI /Grant "$_" } 

            GRSMBA -Name $SMB -AccountName "EVERYONE" -AccessRight Change -Force
            RKSMBA -Name $SMB -AccountName "CREATOR OWNER" -Force 

# ____                                                _________________________________________________________________________________________________
#//  \\______________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\___[ Building Linked Hybrid-DSC Tool Set ]____//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//

            $DR = $URI
            $DS = "$DR\$( $DSCShare.R00_Company )" | % { If ( ( Test-Path $_ ) -ne $True ) { NI $_ -ItemType Directory } Else { GI $_ } }

            $Base = @( Collect-DSCRoot ).Tree
            $Root = ( gci "$Base\Hybrid" ).FullName

            Robocopy "$Base\Hybrid" "$DS" /E
# ____                                                _________________________________________________________________________________________________
#//  \\______________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\___[ Building Linked Hybrid-DSC Tool Set ]____//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//       
            
            Wrap-Action "Building" "[+] Tools"

            ( 0 , "Drivers" ) , ( 1 , "DISM++" ) , ( 2 , "VM" ) | % { 
            
            "$DS\(1)Tools\($( $_[0] ))$( $_[1] )" | % { If ( ( Test-Path $_ ) -ne $True ) { NI $_ -ItemType Directory } Else { GI $_ } } 
            
            }
            
            $Tools = @( gci "$DS\(1)Tools" ).FullName

# ____                                                _________________________________________________________________________________________________
#//  \\______________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\_____[ Loading Snappy Driver Installer ]______//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//

            Wrap-Action "Sourcing" "[~] Snappy Driver Installer"
            Wrap-Action "Excluded" "[!] Snappy Driver Installer will be available soon"

# ____                                                _________________________________________________________________________________________________
#//  \\______________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\_[ Loading DISM++ The Most Powerful Utility ]_//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//

            $Path = $Tools[1]
            $Name = "DISM++"
            Wrap-Action "Sourcing" "DISM++ ( The most powerful utility )"

            $DISM = @{  
                URI     = "http://cdn.chuyu.me/Dism++10.1.1000.100_2d2bf466baca088c4b35248f5a7316f4e00cac0b.zip"
                Outfile = "$Path\$Name.zip" 
                Hash    = "3C5887911ABB2A3C47AC7F2D8B9E375583D1742BEAC57EBC3C64E6315218B6A5" }

            $DISM | % { IWR -URI $_.URI -Outfile $_.OutFile
                If ( ( Get-FileHash -Path $_.OutFile ).Hash -eq $_.Hash ) 
                { Wrap-Action "Checksum" "[+] $Name Validated" ; SZ x $_.OutFile -o"$Path" }
                Else
                { Wrap-Action "Checksum" "[!] Not Valid, aborting $Name installation" }
                RI $_.OutFile -Force 
            }

# ____                                                _________________________________________________________________________________________________
#//  \\______________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\______[ Loading Virtual Machine Tools ]_______//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
        
            $Path = $Tools[2]
            $Name = "VMWare-Tools"
            $File = "VMware-tools-10.3.10-12406962"

            $VMWare_x86 = @{ 
                URI     = "i386" | % { 
                "https://packages.vmware.com/tools/releases/10.3.10/windows/x86/$File-$_.exe" }
                OutFile = "i386" | % { "$Path\$Name-$_.exe" }
                Hash    = "59A498CC1641A04C10D08709AC6DC6AA95CAFC7B56E6D613D3630E89083F0F4C" }

            $VMWare_x64 = @{
                URI     = "x86_64" | % { 
                "https://packages.vmware.com/tools/releases/10.3.10/windows/x64/$File-$_.exe" }
                OutFile = "x86_64" | % { "$Path\$Name-$_.exe" }
                Hash    = "65D5CC22D2FAE73F104E985BAA7885A1544ADCEB0774CC302522C03541E5DD82" }

            ( $VMWare_x86 , $VMWare_x64 ) | % { 
                
                Start-BitsTransfer -Source $_.URI -Destination $_.OutFile
                If ( ( Get-FileHash -Path $_.OutFile ).Hash -eq $_.Hash ) 
                { Wrap-Action "Checksum" "[+] $Name x86/x64 Validated" }
                Else 
                { Wrap-Action "Checksum" "[!] Not Valid, removing file" ; RI $_.OutFile -Force }
            }

            $Name = "VirtualBox Guest Additions"
            $File = "VBoxGuestAdditions_6.0.10.iso"

            $Oracle = @{
                URI     = "https://download.virtualbox.org/virtualbox/6.0.10/$File"
                OutFile = "$Path\$File"
                Hash    = "c8a686f8c7ad9ca8375961ab19815cec6b1f0d2496900a356a38ce86fe8a1325" }

            $Oracle | % {
                
                Start-BitsTransfer -Source $_.URI -Destination $_.OutFile
                If ( ( Get-FileHash -Path $_.OutFile ).Hash -eq $_.Hash )
                { Wrap-Action "Checksum" "[+] $Name Validated" }
                Else
                { Wrap-Action "Checksum" "[!] Not Valid, removing file" ; RI $_.OutFile -Force }
            }

# ____                                                _________________________________________________________________________________________________
#//  \\______________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\________[ Loading Windows Images ]____________//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//

            Wrap-Action "Windows" "[+] Images"

            $Images = @( gci "$DS\(2)Tools" ).FullName

            Wrap-Action "Windows" "[!] Images will be available for download soon"

# ____                                                                            ____________________________________________________________________
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#    \\_____[ Application Names ]_# Collects Application_Information ________________\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\

            $Apps = @( gci $DS -Filter "*Applications" ).FullName
            $Path = "chrome" , "silverlight" , "jre" , "libre" , "mwb" , "flash" , "air" , "reader" , "ccleaner" , "klite" ,  "tv"
            0..10 | % { "$Apps\($_)$($Path[$_])" | % { If ( ( Test-Path $_ ) -ne $True ) { NI "$_" -ItemType Directory } } }

# ____                                _________________________________________________________________________________________________________________
#//  \\______________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\_____[ Application Names ]________\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//

            $N = @( @( "Google Chrome" , "Microsoft Silverlight" , "Java Runtime Environment" , "Libre Office Fresh" | % { 
            "$_ (x86)" , "$_ (x64)" } ) ; @( "Malwarebytes" ; 
            @( "Flash" , "Air" + @( "Reader DC" | % { "$_" ; "$_ MUI" } ) | % { "Adobe $_" } ) +
            "CCleaner" , "K-Lite Codec Pack Full" , "Teamviewer 14" ) | % { "$_ (x22)" } )

# ____                                _________________________________________________________________________________________________________________
#//  \\______________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\____[ Application Versions ]______\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//

            $V = @( 0..1 | % { "76.0.3809.87" } ; 0..1 | % { "5.1.50907.0" } ; 0..1 | % { "8.0.211" } ;
            0..1 | % { "6.2.5" } ; "3.8.3.296511804" ; "32.0.0.223" ; "32.0.0.125" ; "2019.012.20064" ; "2019.012.20035" ;
            "5.60.7307" ; "15.0.4" ; "14.4.2669" )
# ____                                _________________________________________________________________________________________________________________
#//  \\______________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\____[ Application URLs ]__________\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//

            $U = @(
            @( "" , "64" | % {
                "https://dl.google.com/tag/s/dl/chrome/install/googlechromestandaloneenterprise$_.msi" } ) + 
            @( "" , "_x64" | % { 
            "https://download.microsoft.com/download/F/D/0/FD0B0093-DE8A-4C4E-BDC4-F0C56D72018C/50907.00/Silverlight$_.exe" } ) + 
            @( 7 , 9 | % { 
            "https://javadl.oracle.com/webapps/download/AutoDL?BundleId=23872$_`_478a62b7d4e34b78b671c754eaaf38ab" } ) + 
            @( ( "" , 86 ) , ( "_64" , 64 ) | % { 
            "https://download.documentfoundation.org/libreoffice/stable/6.2.5/win/x86$( $_[0] )/LibreOffice_6.2.5_Win_x$( $_[1] ).msi" } ) + 
            "https://downloads.malwarebytes.com/file/mb3/" , 
            "https://download.macromedia.com/get/flashplayer/pdc/32.0.0.223/install_flash_player_32_plugin.msi" , 
            "http://airdownload.adobe.com/air/win/download/32.0/AdobeAIRInstaller.exe" , 
            "http://ardownload.adobe.com/pub/adobe/reader/win/AcrobatDC/1901020064/AcroRdrDC1901020064_MUI.exe" , 
            "http://ftp.adobe.com/pub/adobe/reader/win/AcrobatDC/1901220035/AcroRdrDCUpd1901220035_MUI.msp" , 
            "https://download.ccleaner.com/ccsetup560.exe" , 
            "https://files3.codecguide.com/K-Lite_Codec_Pack_1504_Full.exe" , 
            "https://download.teamviewer.com/download/version_14x/TeamViewer_Setup.exe" )

# ____                                _________________________________________________________________________________________________________________
#//  \\______________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\___[ Application File Names ]_____\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//

            $F = @( @( "chrome" , "silverlight" , "jre" , "libre" | % { "$_(x86)" , "$_(x64)" } ) ;
            @( "mwb" ; @( "flash" , "air" + @( "reader" | % { "$_" ; "$_`mui" } ) ) + "ccleaner" , "klite" , "tv" ) | % { "$_(x22)" } )

            $X = @( "msi" , "exe" , "msp" )[0,0,1,1,1,1,0,0,1,1,1,1,2,1,1,1]

            $P = @( ( gci $Apps ).FullName )[0,0,1,1,3,3,4,4,5,6,7,8,8,9,10,2]

# ____                                _________________________________________________________________________________________________________________
#//  \\______________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\__[ Application Hash Values ]_____\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
                                                                                                                     #\__//__\\__//__\\__//¯¯\\__//¯¯\\
            $S =        "d8d5c5bab68e4c12fa7b6df631ffd6f6c362f3c67accc81ed31f4dfec257b864" ,  #                 [ Google Chrome x86 ]//¯¯\\__//¯¯\\__//
                        "4814efd0dbc0a31f00b2ea7eae9d3816260c8bd38611250c83f11ee8cf3f10ec" ,  #                 [ Google Chrome x64 ]\\__//¯¯\\__//¯¯\\
                        "88e1b76bdf799478a72fa27db0bfe7bc5d02cc7e53675967399300448f0e266f" ,  #                   [ Silverlight x86 ]//¯¯\\__//¯¯\\__//
                        "8d263a6f42a378073b6f057f242a42076f9f4082340153c2e27ecc959c5036aa" ,  #                   [ Silverlight x64 ]\\__//¯¯\\__//¯¯\\
                        "47DE97325B8EA90EA9F93E1595CC7F843DA0C9C6E4C9532ABEA3A194CFB621D9" ,  #                          [ Java x86 ]//¯¯\\__//¯¯\\__//
                        "C18CF8F2776B69DC838440AADFAAE36F50717636F38EEC5F1E4A27A8CB4F20FB" ,  #                          [ Java x64 ]\\__//¯¯\\__//¯¯\\
                        "717fb9e17a3feb8af1662e668b919db86fab343303b78f88c7859003056ee010" ,  #                         [ Libre x86 ]//¯¯\\__//¯¯\\__//
                        "9b01f6f382dbb31367e12cfb0ad4c684546f00edb20054eeac121e7e036a5389" ,  #                         [ Libre x64 ]\\__//¯¯\\__//¯¯\\
                        "301dcaad2fc3f521c71ec2ade476a835d6e4ec2860d905b434900d56dc4c1b37" ,  #                  [ Malwarebytes x22 ]//¯¯\\__//¯¯\\__//
                        "ee34f7a2ecd40039738861fd331ff9d9c5320a33d61b62ae71e108b78f999892" ,  #                   [ Adobe Flash x22 ]\\__//¯¯\\__//¯¯\\
                        "6718308E10A45176155D0ECC8458BD3606308925B91F26A7D08C148CF52C9DB3" ,  #                     [ Adobe Air x22 ]//¯¯\\__//¯¯\\__//
                        "81953f3cf426cbe9e6702d1af7f727c59514c012d8d90bacfb012079c7da6d23" ,  #               [ Adobe Reader DC x22 ]\\__//¯¯\\__//¯¯\\
                        "67AAB19943FA63393F15E1354FACCE65BED476D1C2BB5D311DB8450614A33200" ,  #    [ Adobe Reader DC MUI/Update x22 ]//¯¯\\__//¯¯\\__//
                        "00be05f95e08eb4f181ccde15403e782150a616cb93fd74525c99920f53a2cea" ,  #                      [ CCleaner x22 ]\\__//¯¯\\__//¯¯\\
                        "1F6BDE89E752811FDC04492D0F73216720B625E54966B3E350659BABD9AD7A83" ,  #             [ K-Lite Codec Pack x22 ]//¯¯\\__//¯¯\\__//
                        "df26627cc29716b65a3ed72f78d59808244f9bc4ad2624657ddbee79d2baa422"    #                 [ Teamviewer 14 x22 ]\\__//¯¯\\__//¯¯\\
                                                                                                                               
            $Item = @( 0..15 )                                                                                                       
            0..15 | % { $Item[$_] = @{     Name = "$( $N[$_] ) v$( $V[$_] )"
                                           File = "$( $P[$_] )\$( $F[$_] ).$( $X[$_] )"                     
                                            URL = "$( $U[$_] )" 
                                            Sum = "$( $S[$_] )" } }

# ____                                _________________________________________________________________________________________________________________
#//  \\______________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\_____[ Application Review ]_______\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//

            Wrap-Action "Applications" "[~] Make Selection"

            Switch( $Host.UI.PromptForChoice( "Application Template Review" , "Review Designated Application Template ?" ,
            [ System.Management.Automation.Host.ChoiceDescription [] ]@( '&Yes' , '&No' ) , [ Int ] 0 ) )
            {   
        
                0 { Wrap-Action "Reviewing" "[~] Application Template"
                
                    $j = 0

                    $Item | % {
                        
                    "  ____                                                                                                                          ____  "
                    " //¯¯\\________________________________________________________________________________________________________________________//¯¯\\ "
                    " \\__//                                                                                                                        \\__// "
                    "  ¯¯¯\\____[ Program # $( If ( $j -lt 10 ) { "$J " } Else { "$J" } ) ]$( "____" * 25 )//¯¯\\"
                    ""
                    "     [ $(               $_.Name ) ]"
                    ""
                    "  Download String : $(      $_.URL )"
                    "          OutFile : $(     $_.File )"
                    "    Hash Checksum : $(      $_.Sum )"
                    ""
        
                    $Null = ( $j = $j + 1 ) }
                
                    Read-Host "Press Enter to Continue" }

                1 { Wrap-Action "Skipping" "[~] Application Template Review" } 
            }

# ____                                                                                                        _________________________________________
#//  \\______________________________________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\_____[ Download-Applications ] Downloads Applications like a fricken boss or somethin' ¯\_(ツ)_/¯ _____//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//

            $Apps  = @( gci $Base -Filter "*Applications" ).FullName                         

            Wrap-Action "Downloading" "[+] Application Template"
            IPMO BITSTransfer
            [ Net.ServicePointManager ]::SecurityProtocol = [ Net.SecurityProtocolType ]::TLS12
            $Total = [ System.Diagnostics.Stopwatch ]::StartNew()

            $Time  = @( 0..15 )
        
            0..15 | % { 

                If ( ( Test-Path $Item[$_].File ) -ne $True )
                {
                    Wrap-Action "Downloading" "$( $Item[$_].Name )"
                    $Time[$_] = [ System.Diagnostics.Stopwatch ]::StartNew()
                
                    $Item[$_] | % { Start-BitsTransfer -Source $_.URL -Destination  $_.File -Description $_.Name 
                    If ( $? -eq $False ) { IWR -Uri $_.URL -OutFile $_.File } }

                    $Time[$_].Stop()

                    If ( ( Test-Path $Item[$_].File ) -ne $True ) { Wrap-Action "Exception" "[!] $( $Item[$_].Name ) Failed" ; $Check = "No" } 
                    Else 
                    { 
                        If ( ( Get-FileHash -Path $Item[$_].File -Algorithm SHA256 ).Hash -eq $Item[$_].Sum ) { $Check = "Yes" }
                        Else { Wrap-Action "Checksum" "[!] $( $Item[$_].Name ) Failed" ; RI $Item[$_].File -Force -VB ; $Check = "No"  } 
                    } 

                    If ( $Check -eq "Yes" )
                    {
                        $ITime   = $Time[$_].Elapsed
                        $ILength = ( gp $Item[$_].File ).Length
                        $ISize   = "$( $ILength / 1MB | % { "{0:n1}" -f $_ } )"
                        $IRate   = ( $ILength / ( $ITime | % { ( $_.Minutes * 60 ) + ( $_.Seconds ) } ) / 1MB ) | % { "{0:n1}" -f $_ }
                    }

                    If ( $Check -eq "No" )
                    {
                        $ITime , $ILength , $ISize , $IRate = 0..3 | % { "N/A" }
                    }

                    Wrap-Title   "Item #$( $_ + 1 ) Download Statistics" 
                    Wrap-Section "[ $( $Item[$_].Name ) ]"
                    Wrap-Item      "Time" "$ITime"             -In
                    Wrap-Item     "Size" "$ISize MB"           -Out
                    Wrap-Item     "Rate" "$IRate MB/S"         -In
                    Wrap-Item     "Hash" "Passed? ( $Check )"  -Out
                    Wrap-Space                                 -In
                    Wrap-Foot
                }
            }

            $Total | % { $_.Stop() ; $T = $_.Elapsed }
            $Size    = @( gci $Apps -Recurse -File | Select Length | % { $_.Length } | Measure -Sum ).Sum
            $Rate    = ( ( $Size / 1MB ) / ( ( $T.Minutes * 60 ) + ( $T.Seconds ) )  | % { "{0:n3}" -f $_ } )

            Wrap-Action "Downloads Complete" "[+] Time: $( $T ) / Size: $( $Size/1GB | % { "{0:n3}" -f $_ } ) GB / AVG-Rate @: $Rate MB/S ]"

            Wrap-Action "BITS/IIS" "[~] Make Selection"
            Switch( $Host.UI.PromptForChoice( "Deploy BITS/IIS Website" , "Deploy BITS Auto-Configuration / Website ?" ,
            [ System.Management.Automation.Host.ChoiceDescription [] ]@( '&Yes' , '&No' ) , [ Int ] 0 ) )
            {   0 { Install-DSCSite } 1 { } }
        
            Return @( $DSCShare ).Values        
        }

        Else { Wrap-Action "Either the user cancelled or the dialogue failed" }
    }

# ____                                                                            ____________________________________________________________________
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
    Function Install-DSCSite # Deploys/Autoconfigures BITS/IIS for deployment share  \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    {
        Wrap-Action "Initializing" "[~] Deployment Server Website"
        $SD , $Sys32 , $SRV = $ENV:SystemDrive , "$ENV:SystemRoot\System32" , $ENV:ComputerName
        $R    = @( Get-Provisionary )
        $Root = "$SD\inetpub\$( $R[19] )"
        $Full = "IIS:\Sites\$( $R[19] )\$( $R[21] )"

        $IS = [ Ordered ]@{    
                    System = [ Ordered ]@{ 
                                Drive     = $ENV:SystemDrive
                                Name      = $ENV:ComputerName }
                    Site   = [ Ordered ]@{ 
                                Name      = $R[19]
                                Pool      = $R[20]
                                VHost     = $R[21]
                                Root      = $Root
                                AppData   = "$Root\AppData"
                                PSPath    = $Full }
                    Config = [ Ordered ]@{ 
                                AppHost   = "Machine/Webroot/AppHost"
                                WebServer = "system.webServer"
                                SecAuth   = "security/authentication"
                                AutoStart = "ServerAutoStart"
                                Static    = "StaticContent" }
                    Format = [ Ordered ]@{ 
                                Date      = ( Get-Date -UFormat "%m-%d-%Y" )
                                Log       = "$Home\Desktop\ACL" } 
        }

        $IIS = @( $IS | % { $_.System , $_.Site , $_.Config , $_.Format } ).Values
        
        $IIS[5,6] | % { If ( ( Test-Path $_ ) -eq $True ) { RI $_ -Recurse } ; NI $_ -ItemType Directory }

# ____                                                ___________________________________________________________________________#/¯¯\\__//¯¯\\__//¯¯\\
#//  \\______________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\________________[ Services ]__________________//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
                                                                                                                     #\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
                                                                                                                         #\__//¯¯\\__//¯¯\\__//¯¯\\__//
        $Web = @(                   "Web-Server" ; # Installs the base 'Web Server functions ... ( $SE = Self Explanatory )                          \\
                                   "DSC-Service" ; # Installs the Desired State Configuration Service                                                //
                                      "FS-SMBBW" ; # Updates the file system to allow for Samba Bandwidth to be differentially allocated             \\
                               "ManagementOData" ; # Creates an ASP.NET Web Service end point that exposes your management data ( Raw Doggin' it )   //
                    "WindowsPowerShellWebAccess" ; # Allows for access to PS API over the web. Falls under $SE                                       \\
                             "WebDAV-Redirector" ; # Allows for Web Server to use reverse/forward proxies, useful for security AND trolling people   //
        @( "BITS" | % {                     "$_" ; # Background Intelligent Transfer Service - Sends/Receives files without being annoying           \\
                                    "$_-IIS-Ext" ; # Extension for BITS to be used in Internet Information Services                                  //
                                "RSAT-$_-Server" } ) ; # Allows for the remote administration of BITS, but in a less cool way than RDP               \\
        @(  "Net" | % { "$_-Framework-45-ASPNET" ; # It's what you need to run any ASP.Net webpage in IIS                                            //
                      "$_-WCF-HTTP-Activation45" } ) ; # It's the Windows Communication Foundation's way of attempting to be important               \\
        @(                         @(  "App-Dev" ; # Application Development Module for IIS/Web                                                      //
                                       "AppInit" ; # Initializes any WPF/C#/ASP applications for instance, MVC, or what have you.                    \\
                                     "Asp-Net45" ; # Another Module for ASP                                                                          //
                                    "Basic-Auth" ; # Allows for authentication that could be considered 'Basic'                                      \\
                                   "Common-Http" ; # A bunch of functions that the 'machine/operating system' converts into 'visual objects'         //
                                "Custom-Logging" ; # Allows for customized logging of whatever happens on your web server                            \\
                                "DAV-Publishing" ; # Publishes WebDAV modules to use/distribute to other machines/systems                            //
                                   "Default-Doc" ; # Falls under $SE                                                                                 \\
                                   "Digest-Auth" ; # More advanced than Basic authentication, but still pretty fkin basic...                         //
                                  "Dir-Browsing" ; # Allows any authenticated user to browse the contents of the web directory                       \\
                                     "Filtering" ; # Mime Types and things of that nature                                                            //
                                        "Health" ; # If you don't understand how $SE this is..? Go outside. Stop trying to program or read scripts.  \\
                    @( "HTTP" | % {  "$_-Errors" ; # Falls under the above entry                                                                     //
                                    "$_-Logging" ; # Also falls under that same entry                                                                \\
                                   "$_-Redirect" ; # Works with WebDAV to keep people on the outside guessing what the hell is happening             //
                                    "$_-Tracing" } ) ; # Like tracert but for 'tracking the IP addresses attempting to access the site'              \\
                                      "Includes" ; # It allows static content to be more dynamic, without messing up the content                     //
                   @( "ISAPI" | % {     "$_-Ext" ; # APPCMD.EXE ... and WebConfig, basically.                                                        \\
                                     "$_-Filter" } ) ; # Allows 'Shell or VBScript to look through the content of WebConfig data. Similar to XML.    //
                                 "Log-Libraries" ; # Pretty $SE if you ask me                                                                        \\
                                      "Metabase" ; # Like a database, but for business or server side analytics... It's like CEIP without the OS     //
                                  "Mgmt-Console" ; # Also rather $SE                                                                                 \\
                                     "Net-Ext45" ; # Yet another extension for ASP.Net to work with your website. Probably for turning C# into html  //
                                   "Performance" ; # $SE continued                                                                                   \\
                               "Request-Monitor" ; # An analytical logbook that specifically logs SSI requests, pretty sure anyway                   //
                                      "Security" ; # What every website should use, but, may not unless you've studied how to use it.                \\
                              "Stat-Compression" ; # Takes statistics and zips em up                                                                 //
                                "Static-Content" ; # Works with Web-Includes                                                                         \\
                                      "Url-Auth" ; # Similar to when you log into Gmail                                                              //
                                     "WebServer" ; # The service that is nearly an exact replica of Apache                                           \\
                                  "Windows-Auth" ) | % { "Web-$_" } ) ; # Allows the WebSite to use NTLM/Kerberos authentication ( Most Secure )     //
        @( "WAS" | % {                      "$_" ; # Series of services that takes HTTP and says "You don't need HTTP. You can use whatever we tell  \\
                              "$_-Process-Model" ; # you to use, cause that's what Windows Process Activation Services means, it's just turning      //
                                "$_-Config-APIs" } ) ) # HTML into XML and vice versa. Like $Magic = "David" | % { "$_ Blaine" ; "$_ Copperfield" }  \\
                                                                                                                                 #____    ____    ___//
# ____                                                ___________________________________________________________________________#/¯¯\\__//¯¯\\__//¯¯\\
#//  \\______________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\___________[ Install Features ]_______________//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//

        Wrap-Action "Checking" "[~] Windows Features"
        Get-WindowsFeature | ? { $_.Name -in $Web } | Select Name , InstallState | ? { $_.InstallState -ne "Installed" } | % { 
            Wrap-Action "Missing Feature" "[~] Installing $( $_.Name )"
            Install-WindowsFeature -Name $_.Name 
        }

# ____                                                _________________________________________________________________________________________________
#//  \\______________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\___________[ Generate Website ]_______________//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//

        Wrap-Action "Loading" "[~] WebAdministration Module"
        IPMO WebAdministration
        Get-Website -Name "Default Web Site" -EA 0 | ? { $_.Name -ne $Null -and $_.State -eq 'Started' } | % {
        Stop-Website | SP IIS:\Sites\$( $_.Name ) ServerAutoStart False }

# ____                                                _________________________________________________________________________________________________
#//  \\______________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\___________[ Enable Services ]________________//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//

        "MRxDAV" , "WebClient" | % { Get-Service -Name $_ -EA 0 } | % { If ( $_.Status -ne "Running" ) 
        { Set-Service -StartupType Automatic -EA 4 -Status Start -Name $_  ; Wrap-Action $_.Name "[+] Service is now Active / Running" }
        Else { Wrap-Action $_.Name "[+] Service was found Active / Running" } }  

# ____                                                _________________________________________________________________________________________________
#//  \\______________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\____________[ Create SitePool ]_______________//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//

        If ( ( Get-IISAppPool -Name $IIS[3] ) -ne $Null ) { Wrap-Action "Removing" "[!] Prior Application Pool" ; Remove-WebAppPool -Name $IIS[3] }
        New-WebAppPool -Name $IIS[3] -Force
        Wrap-Action "Configuring" "[~] Application Pool Settings"
        $SP = ( "Enable32BitAppOnWin64" , "True" ) , ( "ManagedRuntimeVersion" , "v4.0" ) , ( "ManagedPipelineMode" , "Integrated" )
        $SP | % { SP -Path "IIS:\AppPools\$( $IIS[3] )" -Name $_[0] -Value $_[1] }
        Restart-WebAppPool -Name $IIS[3]

# ____                                                _________________________________________________________________________________________________
#//  \\______________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\____________[ Start-Website ]_________________//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
                                                                                                                     
        If ( ( Get-WebSite -Name $IIS[2] ) -ne $Null ) { Wrap-Action "Removing" "[!] Prior Website" ; Remove-Website -Name $IIS[2] }
        
        New-Website -Name $IIS[2] -ApplicationPool $IIS[3] -PhysicalPath $IIS[5] -Force
        Wrap-Action "Generated" "[+] IIS Web Site $( $IIS[2] )"
        
        Start-Website -Name $IIS[2]
        Wrap-Action "Started" "[+] IIS Web Site $( $IIS[2] )"

        Set-WebBinding -Name $IIS[2] -HostHeader "" -PropertyName "HostHeader" -Value "$( $R[23] )"
        Wrap-Action "HostHeader" "[+] $( $R[23] )"

        New-WebVirtualDirectory -Site $IIS[2] -Name $IIS[4] -PhysicalPath $R[16] -Force
        Wrap-Action "Virtual Directory" "[+] 'http://$( $R[23] )/$( $IIS[4] )'"
         
# ____                                                _________________________________________________________________________________________________
#//  \\______________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\___________[ Configure Website ]______________//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//

        
        Wrap-Action "Configuring" "[~] WebDAV Authoring"
        $SP = $IIS[8] , $IIS[2] , "$( $IIS[9] )/webdav/authoring" , "Enabled" , "True"
        Set-WebConfigurationProperty -PSPath $SP[0] -Location $SP[1] -Filter $SP[2] -Name $SP[3] -Value $SP[4]

        Wrap-Action "Generating" "[~] WebDAV Authoring Rules"
        "Set Config '$( $IIS[2] )/$( $IIS[4] )'" , "/Section:$( $IIS[9] )/webdav/authoringRules" , 
        "/+[Users='*',Path='*',Access='Read,Source']" , "/Commit:AppHost" -join ' ' | % { 
            SAPS ( gci "$Sys32\inetsrv" "*appcmd.exe" ).FullName -Args $_ -NoNewWindow -PassThru | Out-Null } 

        $STC  = $IIS[9,12] -join '/' ; $GWCP = ( Get-WebConfigurationProperty -PSPath $Full -Filter $STC -Name "." ).Collection
        If ( ! ( $GWCP | ? { $_.fileExtension -eq ".*" } ) ) 
        {   Add-WebConfigurationProperty -PSPath $Full -Filter $STC -Name "." -Value @{ fileExtension = '.*' ; mimeType = 'Text/Plain' } 
            Wrap-Action "Web Config" "[+] [ fileExtension: '.*' ] / [ mimeType: 'Text/Plain' ]" }

        Wrap-Action "Enabling" "[+] Directory Browsing"
        $SP = "/$( $IIS[9] )/DirectoryBrowse" , "Enabled" , $Full , $True  
        Set-WebConfigurationProperty -Filter $SP[0] -Name $SP[1] -PSPath $SP[2] -Value $SP[3]

        $Path   = @(    @( $IIS[9,10] -join "/" ) * 2 ; 
                        @( $IIS[9] , "webdav/authoring" -join '/' ) * 3 ; 
                        @( $IIS[9] , "security/requestFiltering" -join '/' ) * 4 ) 
    
        $Leaf   = @( "anonymous" , "windows" | % { "/$_`Authentication" } ; "Rules" ; 
                        @( "/properties" ) * 2 ; 
                        @( "/fileExtensions" ) * 2 ; 
                         @( "/verbs" ) * 2 )
        $SP = @{
        PSPath   = @( $IIS[8] ) * 9 
        Location = @( "$( $IIS[2] )" | % { "$_/" , "$_/$( $IIS[4] )" , "$( $IIS[2] )" } )[1,1,0,1,2,1,0,1,0]
        Filter   = 0..8 | % { "$( $Path[$_] )$( $Leaf[$_] )" }
        Name     = @( @( "enabled" ) * 2 ; "defaultMimeType" ; @( "allowInfinitePropfindDepth" ) * 2 ; @( "applyToWebDAV" ) * 4 )
        Value    =  @( "False" ; "True" ; "Text/XML" ; @( "True" ) * 2 ; @( "False" ) * 4 ) }

        0..8 | % { $IX = @{ PSPath   =      $SP.PSPath[$_]
                            Location =    $SP.Location[$_]
                            Filter   =      $SP.Filter[$_]
                            Name     =        $SP.Name[$_]
                            Value    =       $SP.Value[$_] }

                    Wrap-Title   "Setting WebConfiguration #$( $_ + 1 )"
                    Wrap-Space                                -Out
                    Wrap-Item  "Location" "$( $IX.Location )" -In 
                    Wrap-Item  "Filter"   "$( $IX.Filter )"   -Out
                    Wrap-Item  "Name"     "$( $IX.Name )"     -In
                    Wrap-Item  "Value"    "$( $IX.Value )"    -Out
                    Wrap-Space                                -In
                    Wrap-Foot
                    Set-WebConfigurationProperty @ix
        }

        #Wrap-Action "Restarting" "[~] IIS Service"
        #IISRESET /Stop

        #Wrap-Action "Configuring" "[~] Security Request Filtering for WebDAV"
        #$SP = "$( $IIS[9] )/security/requestFiltering" ; $HS = "hiddenSegments" ; $ATWD = "applytoWebDAV"
        #( Get-IISConfigSection | ? { $_.SectionPath -like "*$SP*" } | Get-IISConfigElement -ChildElementName $HS ) | % { 
        #Set-IISConfigAttributeValue -ConfigElement $_ -AttributeName "applytoWebDAV" -AttributeValue $False }

        #IISRESET /Start
                                                                                                                                     #/¯¯\\__//¯¯\\__//
# ____                                                ___________________________________________________________________________#/¯¯\\__//¯¯\\__//¯¯\\
#//  \\______________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\_________[ Configure Access Control ]_________//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//

        Wrap-Action "Access Control" "[~] Configuring SAM / Access Control Permissions"

        'IIS_IUSRS', 'IUSR', "IIS APPPOOL\$( $IIS[3] )" | % { 
            $ACL = New-AclObject -SAM $_ -Rights 'ReadAndExecute' -Inherit 'ContainerInherit' , 'ObjectInherit' 
            Add-Acl -Path $IIS[5] -ACL $ACL } 

        'IIS_IUSRS', "IIS APPPOOL\$( $IIS[3] )"         | % { 
            $ACL = New-AclObject -SAM $_ -Rights 'Modify' -Inherit 'ContainerInherit' , 'ObjectInherit' 
            Add-Acl -Path $IIS[6] -ACL $ACL } 

# ____                                                ___________________________________________________________________________#/¯¯\\__//¯¯\\__//¯¯\\
#//  \\______________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\_____________[ SSL/TLS Rules ]________________//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//

        Wrap-Action "Configuring" "[~] Registry Settings for [ SSL 2.0 / 3.0 ] & [ TLS 1.0 / 1.1 / 1.2 ]"
        $SSLTLS    = "HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols"
        $Types     = "Client" , "Server" 

        $Value     = @( @( "0" ) * 8 ; @( "1" ) * 2 )
        $Protocols = @( 2..3 | % { "SSL $_.0" } ) + @( 0..2 | % { "TLS 1.$_" } ) 

        $Protocols | % { 
            $Path  = "$SSLTLS\$_" ; If ( ( Test-Path $Path ) -ne $True ) { NI "$SSLTLS" "$_" }
            $Types | % { If ( ( Test-Path "$Path\$_" ) -ne $True ) { NI "$Path" "$_" } } 
        } 

        $Path      = @( $Protocols | % { "$SSLTLS\$_\Client" ; "$SSLTLS\$_\Server" } ) 

        0..( $Path.Count - 1 ) | % { 
            If ( ( gci $Path ) -eq $Null ) 
            { 
                SP -Path $Path[$_] -Name "DisabledByDefault" -Type DWORD -Value 0 
                SP -Path $Path[$_] -Name           "Enabled" -Type DWORD -Value $Value[$_] 
            } 
        }

# ____                                                ___________________________________________________________________________#/¯¯\\__//¯¯\\__//¯¯\\
#//  \\______________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\________[ .Net Framework TLS Rules ]__________//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//

        Wrap-Action "Configuring" "[~] .Net Framework [ v2.0.50727 ] & [ v4.0.30319 ] SCHANNEL Policies"
        $NetFW  = "" , "\WOW6432NODE" | % { "HKLM:\SOFTWARE$_\Microsoft\.NETFramework" }
        ForEach ( $i in $NetFW ) 
        { 
            "v2.0.50727" , "v4.0.30319" | % { 
            
                If ( ( Test-Path $i ) -ne $True )
                { NI -Path $i -Name "$_" }
                  SP -Path $i -Name "SystemDefaultTlsVersions" -Type DWORD -Value 1
            }
        }

# ____                                                ___________________________________________________________________________#/¯¯\\__//¯¯\\__//¯¯\\
#//  \\______________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\________[ Create DNS CName Record ]___________//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//

        Wrap-Action "Pausing" "[~] Website to Add DNS CName Resource Record"
        Stop-Website $IIS[2]
        
        $DNS = "$ENV:Computername.$ENV:UserDNSDomain" , $IIS[2] , $ENV:UserDNSDomain
        ( Get-DNSServerResourceRecord -ZoneName $DNS[2] | ? { $_.HostName -eq $IIS[2] -and $_.RecordType -eq "CNAME" } ) | Select HostName | % {
        Remove-DNSServerResourceRecord -ZoneName $DNS[2] -Name $_.HostName -RRType CNAME -Force }

        Add-DnsServerResourceRecordCName -HostNameAlias $DNS[0] -Name $DNS[1] -ZoneName $DNS[2]

        Wrap-Action "Resuming" "[+] Website $( $IIS[2] )"
        Start-Website $IIS[2]

        Wrap-Action "Complete" "[+] Your Web Server should now be available to the internet"
        Read-Host "Test the current configuration, and then press enter to continue"

        Wrap-Action "Warning" "[!] You may want to configure SSL Certificates for this server"
        Read-Host "Automatic Certificate Chain creation and distribution will be an added feature in the future"
    }

# ____                                                                            ____________________________________________________________________
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
    Function Get-Provisionary
    {
        $DSCRoot  = @( Collect-DSCRoot )
        Return @( Collect-DSCShare )
    }

# ____                                                                            _______________________________________________#\__//¯¯\\__//¯¯\\__//
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
    Function Get-WIMName # Retrieves the name of a given Windows Image File       ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    { #______________________________________________________________________________//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
                                                                                                                     #\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
        [ CmdLetBinding () ] Param ( 

            [ Parameter ( Position = 0 , ValueFromPipeline = $True ) ][ String ]    $IP , 
            [ Parameter ( Position = 1 , ValueFromPipeline = $True ) ][ String ]    $ID ) 

        ( Get-WindowsImage -ImagePath $IP ).ImageName } 
# ____                                                                            _______________________________________________#\__//¯¯\\__//¯¯\\__//
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
    Function Get-WIMBuild  # Retrieves the build version number from said WIM     ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    { #______________________________________________________________________________//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
                                                                                                                     #\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
        [ CmdLetBinding () ] Param ( 

            [ Parameter ( Position = 0 , ValueFromPipeline = $True ) ][ String ]    $IP , 
            [ Parameter ( Position = 1 , ValueFromPipeline = $True ) ][ String ]    $ID ) 

        ( Get-WindowsImage -ImagePath $IP -Index $ID ).Version } 

# ____                                                                            _______________________________________________#\__//¯¯\\__//¯¯\\__//
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
    Function Import-NewOSImage  # Imports an WIM/Operating System into MDT        ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    { #______________________________________________________________________________//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
                                                                                                                     #\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
        [ CmdLetBinding () ] Param ( 

            [ Parameter ( Position = 0 , ValueFromPipeline = $True ) ][ String ] $IP , 
            [ Parameter ( Position = 1 , ValueFromPipeline = $True ) ][ String ] $SF , 
            [ Parameter ( Position = 2 , ValueFromPipeline = $True ) ][ String ] $DF ) 

        Import-MDTOperatingSystem -Path $IP -SourceFile $SF -DestinationFolder $DF -Move -VB }

# ____                                                                            _______________________________________________#\__//¯¯\\__//¯¯\\__//
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
    Function Import-NewTask   # Imports a dynamic task sequence                   ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    { #______________________________________________________________________________//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
                                                                                                                     #\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
        [ CmdLetBinding () ] Param ( 

            [ Parameter ( Position =  0 , ValueFromPipeline = $True ) ][ String ]    $PSP ,
            [ Parameter ( Position =  1 , ValueFromPipeline = $True ) ][ String ] $Formal , 
            [ Parameter ( Position =  2 , ValueFromPipeline = $True ) ][ String ]    $XML , 
            [ Parameter ( Position =  3 , ValueFromPipeline = $True ) ][ String ]   $Info , 
            [ Parameter ( Position =  4 , ValueFromPipeline = $True ) ][ String ]     $ID , 
            [ Parameter ( Position =  5 , ValueFromPipeline = $True ) ][ String ]    $Ver , 
            [ Parameter ( Position =  6 , ValueFromPipeline = $True ) ][ String ]    $SIP , 
            [ Parameter ( Position =  7 , ValueFromPipeline = $True ) ][ String ] $TSName , 
            [ Parameter ( Position =  8 , ValueFromPipeline = $True ) ][ String ]    $Org , 
            [ Parameter ( Position =  9 , ValueFromPipeline = $True ) ][ String ]    $WWW , 
            [ Parameter ( Position = 10 , ValueFromPipeline = $True ) ][ String ] $LMCred ) 

        Import-MDTTaskSequence -Path $PSP -Name $Formal -Template $XML -Comments $Info -ID $ID -Version $Ver ` 
            -OperatingSystemPath $SIP -FullName $TSName -OrgName $Org -HomePage $WWW -AdminPassword $LMCred -VB
    } 

# ____                                                                            _______________________________________________________#\__//¯¯\\__//
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
    Function Provision-Imaging # Retrieves DSC Info and completely recycles all WIM files and Task Sequences     //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    { #\_________________________________________________________________________________________________________\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//
       
        Wrap-Action "[ Provision-Imaging ]" "[+] Retrieves DSC Info and Recycles Images and Task Sequences"
        
        $R = @( Get-Provisionary ) 

        $LM = $Env:ComputerName , $Env:Processor_Architecture , "$Env:SystemDrive\" ,
        @( $Env:SystemRoot | % { "$_" ; "$_\System32" } ) + , $Env:ProgramData , $Env:ProgramFiles
        
        $Tree = "Resources" , "Tools" , "Images" , "Profiles" , "Certificates" , "Applications" 

# ____                                                ___________________________________________________________________________#/¯¯\\__//¯¯\\__//¯¯\\
#//  \\______________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\_____[ BITS Check & Variable Allocation ]_____//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//

        $Drive = ( $R[17] )

        If ( $LM[0] -eq $R[2] ) { $DR , $SRV = $R[16] , "[ Yes ]" } Else { $DR , $SRV = $R[1] , "[ No ]" }

        $DS = "$DR\$( $R[0] )"

        $D = @( gci $DS -EA 0 ).FullName
        
        $L = @( 0..5 | % { "$( $LM[2] + $R[0] )\($_)$( $Tree[$_] )" } )

# ____                                                ___________________________________________________________________________#/¯¯\\__//¯¯\\__//¯¯\\
#//  \\______________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\___________[ Stage MDT Variables ]____________//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
                                                                                                                     #\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
                                                                                                                         #\__//¯¯\\__//¯¯\\__//¯¯\\__//                
        Load-MDTModule 

        $Types = "Server" , "Client"
        $MDT = @( "MDTProvider" ; $Drive ; "Administrators" ; 
        @( $Types | % { "$( $Drive ):\Operating Systems\$_" } ) +
        @( $Types | % { "$( $Drive ):\Task Sequences\$_" } ) + 
        "$( $R[16] )" ; "$( $R[1].Split('\')[-1] )" ; "$( $R[1] )" ; 
               @( "Boot" ; ( $Types | % { "Operating Systems\$_" } ) + "Scripts" ; "Control" ) | % { "$DR\$_" } ; "$( $R[0] ) $( $R[18] )" )

# ____                                                ___________________________________________________________________________#/¯¯\\__//¯¯\\__//¯¯\\
#//  \\______________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\___________[ Stage MDT Variables ]____________//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
                                                                                                                     #\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
                                                                                                                         #\__//¯¯\\__//¯¯\\__//¯¯\\__//
        Wrap-Title -Title "Provisional-Root" ; 
        Wrap-Section -Section "( Domain State Controller @ Source )" 
        $Type = @( "Provisionary" ; "( DSC ) Share" ; "( DSC ) Controller" ; @( $Tree[0..5] ) ) 
        $Info = @( $R[0..2] ; $D[0..5] ) 

        Wrap-ItemIn $Type[0] $Info[0] 
        Wrap-ItemIn  $Type[1] $Info[1] 
        Wrap-ItemOut $Type[2] $Info[2] 
        Wrap-ItemIn  $Type[3] $Info[3] 
        Wrap-ItemOut $Type[4] $Info[4] 
        Wrap-ItemIn  $Type[5] $Info[5] 
        Wrap-ItemOut $Type[6] $Info[6] 
        Wrap-ItemIn  $Type[7] $Info[7] 
        Wrap-ItemOut $Type[8] $Info[8] 
        
        Wrap-Section -Section "( Current Machine @ Variables )" ;
        $Type = @( "Server" ; "Hostname" ; "Architecture" ; "System Drive" ; "Windows Root" ; "System32" ; "Program Data" )
        $Info = @( $SRV ; $R[2] ; $LM[1..5] )

        Wrap-ItemOut $Type[0] $Info[0] 
        Wrap-ItemIn  $Type[1] $Info[1] 
        Wrap-ItemOut $Type[2] $Info[2] 
        Wrap-ItemIn  $Type[3] $Info[3] 
        Wrap-ItemOut $Type[4] $Info[4] 
        Wrap-ItemIn  $Type[5] $Info[5] 
        Wrap-ItemOut $Type[6] $Info[6] 

        Wrap-Section -Section "( Provision Index @ Bridge Control )"
        $Type = @( "( DSC ) Target" ; @( $Tree[0..5] ) + "Logo" ; "Background" ) 
        $Info = @( $LM[0] ; $L[0..5] ) 
        
        Wrap-ItemOut $Type[0] $Info[0] 
        Wrap-ItemIn  $Type[1] $Info[1] 
        Wrap-ItemOut $Type[2] $Info[2] 
        Wrap-ItemIn  $Type[3] $Info[3] 
        Wrap-ItemOut $Type[4] $Info[4] 
        Wrap-ItemIn  $Type[5] $Info[5] 
        Wrap-ItemOut $Type[6] $Info[6] 

        Wrap-Space -In
        Wrap-Space -Out
        Wrap-Foot
        Read-Host "Press Enter to Continue" 

# ____                                                ___________________________________________________________________________#/¯¯\\__//¯¯\\__//¯¯\\
#//  \\______________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#    \\_________[ Stage MDT Variables ]______________//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
                                                                                                                     #\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
                                                                                                                         #\__//¯¯\\__//¯¯\\__//¯¯\\__//
        # Begins the image provisioning process
        Wrap-Action -ID "Provision-Images"

        #__________________________
        # Determines the default variables to name images and folders for MDT

        $di = $d[2] 
        $dt = "Server" , "Client" | % { "$dr\Operating Systems\$_" } | ? { ( Test-Path $_ ) -eq $False } | % { NI $_ -ItemType Directory }

        $Date = "$( Get-Date -UFormat "%Y%m%d" )" , "( $( Get-Date -UFormat "%m-%d-%Y" ) MC-SDP )" 
        
        $NA = "Not Detected" 

        #__________________________
        # Filters and stamps DISM information
        $Wim  = @{ 
           
                Name = @(        @( "Server 2016 Datacenter (x64)" ; 
                          @( "Education" , "Home" , "Professional" | % {
                                         "$_ (x64)" ; "$_ (x86)" } | % { 
                                                     "10 $_" } ) ) | % { "Windows $_" } ) 
            
                Tag  = @( "DC2016" ; @( "E" , "H" , "P" | % { "$_`64" ; "$_`86" } | % { "10$_" } ) ) 
            
                Sign = @( 0..6 | % {                "$( $Date[1] ) [ $( $Tag[$_] ) ]" } ) 
                  
               Build = @(    0 | % { "10.0.14393.693" } ; 1..6 | % { "10.0.18362.207" } ) 
                  
               Major = @(    0 | % {           "1607" } ; 1..6 | % {           "1903" } ) 
                  
               Minor = @(    0 | % {          "(693)" } ; 1..6 | % {          "(207)" } ) 
        }

        $Stamp = @( 0..6 | % {    "$( $wim.Build[$_] ) [ $( $wim.Major[$_] ) ]" } ) 

        $DISM  = @( 0..6 )
        ForEach ( $i in 0..6 ) { $DISM[$i] = $Wim | % { $_.Tag[$i] , $_.Name[$i] , $_.Sign[$i] , $Stamp[$i] , $r[0] } } 
        
        #__________________________
        # Checks the DSC folder for backend WIM files that are updated
        Wrap-Action "DISM" "[+] WIM Store" 

        $DI | ? { ( Test-Path $DI ) -ne $True } | % { NI -Path $_ -ItemType Directory }

        $OnDeck    = @( GCI $DI -EA 0 )
        $OnDeckWIM = @( $OnDeck.FullName | % { GCI $_ -Filter "*.wim" -EA 0 } ) 
        
        If ( $OnDeckWIM.Count -eq 0 ) 
        { 
            $Store = @{ Name = $NA ; File = $NA ; Tag = $NA ; Path = $NA ; Date = $NA ; Full = $NA ; Build = $NA }
        } 
        
        Else 
        {  
            $Store   = @( $OnDeckWim | Select @{ Name =  "Name" ; Expression = { Get-WIMName  -IP $_.FullName       } } , 
                                              @{ Name =  "File" ; Expression = {                  $_.Name           } } , 
                                              @{ Name =   "Tag" ; Expression = {                  $_.BaseName       } } , 
                                              @{ Name =  "Path" ; Expression = {             $_.DirectoryName       } } , 
                                              @{ Name =  "Date" ; Expression = {             $_.LastWriteTime       } } , 
                                              @{ Name =  "Full" ; Expression = {                  $_.FullName       } } , 
                                              @{ Name = "Build" ; Expression = { Get-WIMBuild -IP $_.FullName -ID 1 } } ) 
        }

        #__________________________
        # Displays any WIM files that were found
        Wrap-Title -Title "Stored-WIM(S)" 
        0..( $Store.Count - 1 ) | % { 
        Wrap-Section -Section    $Store.Name[$_] 
        Wrap-ItemOut "[+] Path " $Store.Path[$_] 
        Wrap-ItemIn  "[+] File " $Store.File[$_] 
        Wrap-ItemOut "[+] Date " $Store.Date[$_] 
        Wrap-ItemIn  "[+] Build" $Store.Build[$_] 
        Wrap-Out }
        Wrap-Bot 
        Read-Host "Verify list. Press Enter to Continue" 

        #__________________________
        # Checks the default MDT folder for currently served SERVER images
        Wrap-Action "MDT" "[+] Server WIM" 

        $DT[0] | ? { ( Test-Path $_ ) -ne $True } | % { NI -Path $_ -ItemType Directory } 

        $OnBaseS    = @( GCI $DT[0] -EA 0 )
        $OnBaseSWIM = @( $OnBaseS.FullName | % { GCI $_ -Filter "*.wim" -EA 0 } ) 

        If ( $OnBaseSWIM.Count -eq 0 ) 
        {       
            $CServer = [ Ordered ]@{  Name = $NA ; File = $NA ; Tag = $NA ; Path = $NA ; Date = $NA ; Full = $NA ; Build = $NA }
        }
         
        Else 
        {
            $CServer = @( $OnBaseSWIM | Select @{ Name =  "Name" ; Expression = { "Windows Server 2016 Datacenter (x64)" } } , 
                                               @{ Name =  "File" ; Expression = {                    $_.Name             } } , 
                                               @{ Name =   "Tag" ; Expression = {                    $_.BaseName         } } , 
                                               @{ Name =  "Path" ; Expression = {               $_.DirectoryName         } } , 
                                               @{ Name =  "Date" ; Expression = {               $_.LastWriteTime         } } , 
                                               @{ Name =  "Full" ; Expression = {                    $_.FullName         } } , 
                                               @{ Name = "Build" ; Expression = {   Get-WIMBuild -IP $_.FullName -ID 1   } } ) 
        }
        
        #__________________________
        # Checks the default MDT folder for currently served CLIENT images
        Wrap-Action "MDT" "[+] Client WIM"

        $OnBaseClient    = @( GCI $DT[1] -EA 0 )
        $OnBaseClientWIM = @( $OnBaseClient.FullName | % { GCI $_ -Filter "*.wim" -EA 0 } ) 

        If ( $OnBaseClientWIM.Count -eq 0 ) 
        {       $CClient = [ Ordered ]@{  Name = $NA ; File = $NA ; Tag = $NA ; Path = $NA ; Date = $NA ; Full = $NA ; Build = $NA  } } 
        Else {  $CClient = @( $OnBaseClientWim | Select @{ Name =  "Name" ; Expression = { "Windows 10 Home/Education/Pro (x86/64)" } } , 
                                                        @{ Name =  "File" ; Expression = {                    $_.Name               } } , 
                                                        @{ Name =   "Tag" ; Expression = {                    $_.BaseName           } } , 
                                                        @{ Name =  "Path" ; Expression = {               $_.DirectoryName           } } , 
                                                        @{ Name =  "Date" ; Expression = {               $_.LastWriteTime           } } , 
                                                        @{ Name =  "Full" ; Expression = {                    $_.FullName           } } , 
                                                        @{ Name = "Build" ; Expression = {   Get-WIMBuild -IP $_.FullName -ID 1     } } ) } 
        #__________________________
        # Displays the Server and Client Images w/ Build Number and dates
        Wrap-Title  -Title "Current-WIM(S)"
        $Current = $CServer , $CClient 
        $Current | % { 
        Wrap-Section -Section    $_.Name 
        Wrap-ItemOut "[+] Path " $_.Path 
        Wrap-ItemIn  "[+] File " $_.File 
        Wrap-ItemOut "[+] Date " $_.Date 
        Wrap-ItemIn  "[+] Build" $_.Build 
        Wrap-Out } 
        Wrap-Bot
        Read-Host "Press Enter to Continue" 

        #__________________________
        # Collects the information for image files that are about to exist
        Wrap-Action "Transfer / Update" "[+] DISM -> MDT WIM Information" 
                $Update   = [ Ordered ]@{ Name  = ( "Server 2016 Datacenter (x64)" , "10 Home/Education/Pro (x86/64)" | % { "Windows $_" } ) 
                                          File  = ( 0..1 | % {               "$( $Date[0] )_$( $WIM.Major[$_] )_$( $WIM.Minor[$_] ).wim" } ) 
                                          Tag   = ( 0..6 | % {                                                           "$( $Tag[$_] )" } ) 
                                          Path  =                                                                                  "$di" 
                                          Date  =                                                                        "$( $Date[0] )" 
                                          Full  = ( 0..1 | % {           "$di\$( $Date[0] )_$( $WIM.Major[$_] )_$( $WIM.Minor[$_] ).wim" } ) 
                                          Build = ( 0..1 | % {                                                     "$( $WIM.Build[$_] )" } ) } 

        #__________________________
        # Displays the information for image files that are about to exist
        Wrap-Title -Title "Update-WIM(S)"
        0..( $Update.File.Count - 1 ) | % { 
        Wrap-Section -Section    $Update.Name[$_] 
        Wrap-Itemout "[+] Path " $Update.Path 
        Wrap-ItemIn  "[+] File " $Update.File[$_] 
        Wrap-ItemOut "[+] Date " $Update.Date 
        Wrap-ItemIn  "[+] Build" $Update.Build[$_] 
        Wrap-Out } 
        Wrap-Bot
        
        #__________________________
        # Asks the user if they would like to continue
        Read-Host "Press Enter to Continue" 
 
        #__________________________
        # Begins the process of sending the server image
        $Update.Full[0] | ? { ( Test-Path $_ ) -eq $True } | % { RI $_ } 

        0..( $Store.Count - 1 ) | ? { $Store[$_].Name -like "*Serv*" } | % { 
        
            Wrap-Action "Process" $Store[$_].Name 
            Echo "[ Current Image Info ]" , $DISM[$_] 

            Robocopy $Store.Path[0] $di $Store.File[0] ; RI "$di\$( $Store.File[0] )" -NewName $Update.Full[0] ; 
            If ( $? -eq $True ) { Wrap-Action "Successful" "[+] Server Image Updated"     } 
            Else                { Wrap-Action     "Failed" "[!] Server Image not updated" } 

        #__________________________
        # Begins the process of concatenating the client images
        $Update.Full[1] | ? { ( Test-Path $_ ) -eq $True } | % { RI $_ }

        0..( $Store.Count - 1 ) | ? { $Store[$_].Name -like "*10*" } | % { 
        
            Wrap-Action "Process" $Store[$_].Name ; 
            Wrap-Action    "DISM" $Store.Name[$_] 

            Echo "[ Current Image Info ]" , $DISM[$_] 

            Export-WindowsImage -SIP $Store.Full[$_] -SN $Store.Name[$_] -DIP $Update.Full[1] -DN $Store.Name[$_] -VB
            If ( $? -eq $True ) { Wrap-Action "Success"   "[+] Image $( $Store.Name[$_] ) Updated"     } 
            Else                { Wrap-Action "Exception" "[!] Image $( $Store.Name[$_] ) Not Updated" } } 

        Wrap-Function -ID "Recycle-MDT"
        $PSD  = @( $MDT[3..6] ) + @( $MDT[11..12] )
        $Name = @( ( "Server" , "Client" | % { $_ } ) * 3 ) 

        0..3 | ? { 
            
            If ( ( Test-Path $PSD[$_] ) -eq $True ) 
            { 
                Wrap-Action "Path Found" "[+] $( $PSD[$_] )" 
            }

            Else   
            { 
                NI -Path $Path[$_] -Enable "True" -Name $Name[$_] -Comments "$( $Date[1] )" -ItemType "Folder" -VB 
                If ( $? -eq $True )     { Wrap-Action "Path Created" "[+] $( $PSD[$_] )" } 
                Else                    { Wrap-Action "Path Failure" "[-] $( $PSD[$_] )" }
            } 
        } 

        4..5 | % { 
        
            If ( ( Test-Path $PSD[$_] ) -eq $True ) 
            { 
                Wrap-Action "Path Found" "[+] $( $PSD[$_] )"
            }

            Else
            { 
                NI -Path $PSD[$_] -ItemType Directory -Value $PSD[$_] 
                If ( $? -eq $True ) { Wrap-Action "Directory Created" "[+] $( $PSD[$_] )" } 
                Else                { Wrap-Action "Directory Failure" "[!] $( $PSD[$_] )" } 
            } 
        }

        0..5 | % { 
        
            $Name = @( GCI ( $PSD[$_] ) -EA 0 ) 
            If ( $Name.Count -eq 1 )
            { 
                If ( $Name  -ne $null ) 
                { 
                    RI "$( $PSD[$_] )\$( $Name.Name )" -Recurse -VB -EA 0 
                } 
            }
            
            Else
            {  
                ForEach ( $Names in $Name ) 
                { 
                    If ( $Names -ne $Null ) 
                    { 
                        RI "$( $PSD[$_] )\$( $Names.Name )" -Recurse -VB -EA 0 
                    } 
                } 
            } 
            
            If ( $? -eq $True ) { Wrap-Action "Removed"   "[+] $( $PSD[$_] ) Child Items"  } 
            Else                { Wrap-Action "Exception" "[-] $( $PSD[$_] ) Child Items"  }
        } 
 
        0..1 | % {  
        
            If ( ( Test-Path $Update.Full[$_] ) -ne $True ) 
            { 
                Wrap-Action "Image Missing" "[!] $( $Update.Full[$_] )" 
            } 
            
            Else
            { 
                Wrap-Action "Image Found" "[+] $( $Update.Full[$_] )" 
                If ( $_ -eq 0 ) { $Folder = "Server" } 
                Else            { $Folder = "Client" } 
            } 
                    Import-NewOSImage -IP $PSD[$_] -SF $Update.Full[$_] -DF "$Folder\$( $WIM.Build[$_])" 
                    If ( $? -eq $True ) { Wrap-Action "Import Successful" "[+] $( $Update.Full[$_] )" } 
                    Else                { Wrap-Action         "Exception" "[!] Import Failed"         } 
        } 

        $TemplateXML = @( $SC | % { "MDT$_`Mod.xml" } ) 
        $PSDCheck    = @( gci "$dr\Tools\Modules" -Filter "*PSD*" -EA 0 )
        
        $PSDCheck | ? { $_.Count -gt 0 } | % { 
            $TemplateXML = @( $SC | % { "PSD$_`Mod.xml" } ) 
        } 
        
        $ServerXML = $TemplateXML[0]
        $ClientXML = $TemplateXML[1] } 
                    
        $Server    = @{ List   = @( GCI $PSD[0] -EA 0 )
                        Temp   = @( "$di\Control\$ServerXML" ) } 
        
        $Client    = @{ List   = @( GCI $PSD[1] -EA 0 ) 
                        Temp   = @( "$di\Control\$ClientXML" ) } 
        
        0..6 | % { 
            
            If ( $_ -eq 0 ) 
            { 
                $XML  = @( GC $Server.Temp ) 
                $PSP  = $MDT[5]
                $SIP  = "$( $MDT[3] )\$( $Server.List.Name )" ; 
                $GUID = $Server.List.GUID 
            }
              
            Else 
            { 
                $XML  = @( GC $Client.Temp ) 
                $PSP  = $MDT[6]
                $SIP  = "$( $MDT[4] )\$( $Client.List.Name[ ( $_ - 1 ) ] )" 
                $GUID = $Client.List.GUID[ ( $_ - 1 ) ] 
            }

        $XMLArray = @() 
        0..$XML.Count | % { If ( $XML[$_] -like "*OSGUID*" ) { $XMLArray += $_ } } 

        ForEach ( $i in $XMLArray ) { $XML[$i] = $XML[$i].Split('{')[0] + $GUID + $XML[$i].Split('}')[1] } 

        $XML_Path  = "$( $Store.Path[$_] )\$( $Tag[$_] ).xml"
        
        SC -Path $XML_Path -Value $XML -Force 

        Wrap-Action "Import-NewTask" "[+] $( $DISM[$_][0] ) / $( $DISM[$_][1] )" 
        
        Import-NewTask -PSP $PSP -Formal $DISM[$_][1] -XML $XML_Path -Info $NT.Info $Date[1] -ID $DISM[$_][0] -Ver $Date[0] -SIP $SIP ` 
            -TSName $DISM[$_][1] -Org $R[0] -WWW $R[5] -LMCred $lmcred.GetNetworkCredential().Password } 

        Wrap-Action "[ MDT ]" "Updating PSDrive $( $MDT[1] ) Properties" 

        $Array  = @( ".GenerateLiteTouchISO" ; @( "WIMDescription" , "ISOName" | % { ".LiteTouch$_" } ) ; ".BackgroundFile" ) 
        $DSC    = @( "$( $MDT[1] ):" ; @( $Array | % { "Boot.x64$_" } ) + @( $Array | % { "Boot.x86$_" } ) ) 
        $Name   = @( "Comments" , "MonitorHost" + $DSC ) 
        $Value  = @( $Date[1] ; $r[2] ; 
        64 , 86 | % { "True" ; @( " (x$_)" | % { "$_" , "$_.iso" } | % { "$( $r[0] )$($_)" } ) + "$( $d[0] )\$( $r[9] )" } )
        
        0..$Name.Count | % { 
    
            SP -Path $DSC[0] -Name $Name[$_] -Value $Value[$_]
            Wrap-Action "Drive Property" "$( $Name[$_] ) set to . . ."
            Echo $Value[$_]     
        } 
        
        If ( $? -eq $True ) 
        { 
            Wrap-Action "[ MDT ]" "PSDrive $( $MDT[1] ) Properties updated Successfully"     
        }
         
        Else 
        { 
            Wrap-Action "[ MDT ]" "PSDrive $( $MDT[1] ) Properties failed to update" 
            Break 
        } 

        $BootStrap = @{ 

                        Settings = @{   Priority           = "Default" } 
                        Default  = @{   DeployRoot         = "\\$( $r[2] )" 
                                        UserID             = "$( $r[3] )" 
                                        UserPassword       = "$( $dccred.GetNetworkCredential().Password )" 
                                        UserDomain         = "$( $r[15] )" 
                                        SkipBDDWelcome     = "YES" } 
        }

        Export-Ini -Path $( $MDT[14] ) -Name "Bootstrap.ini" -Value $Bootstrap -Encoding UTF8 -Force -UTF8NoBOM

        $CustomSettings = @{

                        Settings   = @{ Priority           = "Default" 
                                        Properties         = "MyCustomProperty" } 
                        Default    = @{ _SMSTSOrgName      = "$( $r[0] )" 
                                        OSInstall          = "Y" 
                                        SkipCapture        = "NO" 
                                        SkipAdminPassword  = "YES" 
                                        SkipProductKey     = "YES" 
                                        SkipComputerBackup = "NO" 
                                        SkipBitLocker      = "YES" 
                                        KeyboardLocale     = "en-US" 
                                        TimeZoneName       = "$( ( Get-TimeZone ).ID )" 
                                        EventService       = "http://$( $r[2] ):9800" }
        }

        Export-Ini -Path $( $MDT[14] ) -Name "CustomSettings.ini" -Value $CustomSettings -Encoding UTF8 -Force -UTF8NoBOM

        $Graphics = "*computer.png" , "*header-image.png" | % { ( gci "$DI\Control" -Filter $_ -EA 0 ) } 
        $Graphics | ? { $_.Exists } | % { CP $_.FullName "$( $MDT[13] )\$( $_.Name )" }

$Script = @"
#_____________________________________________________________________________________________________________________________________________________
#//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\   ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯   //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//  [ Secure Digits Plus LLC | Hybrid | Desired State Controller ]  \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯     __________________________________________________________     ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯ -=-=-=-=-=-=-=[ Dynamically Engineered Digital Security ]-=-=-=-=-=-=--=-= ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯                                           ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//   Application Development | Virtualization | Network and Hardware Magistration   \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\   ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯   //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//   https://www.securedigitsplus.com | Server-Client | Seedling-Spawning Script    \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\___¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ___//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\   [ Provisional Author : Michael C Cook Sr. | "The Buck Stops Here" ]    //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//   ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\
#\\  [ Install-Hybrid ] @: Installs the base folder and application prerequisites for initializing a Hybrid Desired State Controller Server  //  \\__//
#//__________________________________________________________________________________________________________________________________________\\__//  \\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#¯      Declare Namespaces    ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#       ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯        ¯¯¯¯    ¯¯¯¯   //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    Using Namespace System.Security.Principal   #\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
# ____                                           //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#//  \\                                          \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\__//  \\
    Function Elevate-Script # If the user is an administrator, and the window is not, this will elevate the window. Non-Admins get booted here.  \\__//
    { #__________________________________________________________________________________________________________________________________________//  \\
                                                                                                                                 #\__//¯¯\\__//¯¯\\__//
        ( GWMI Win32_ComputerSystem ) | % { If ( `$_.PartOfDomain -eq `$True ) { `$DC = 1 } Else { `$DC = 0 } `$Gate = 0 ; `$Key = 0 }     #\__//¯¯\\__//¯¯\\
                                                                                                                                         #\__//¯¯\\__//
        If ( `$DC = 1 ) { IPMO ActiveDirectory ;                                                                                          #/¯¯\\__//¯¯\\
                         `$I = @( Get-ADPrincipalGroupMembership -Identity `$Env:Username | % { `$_.Name -like "*Admin*" } )                #\__//¯¯\\__//
                         If ( `$I -contains `$True ) { `$Gate = 1 } }                                                                       #/¯¯\\__//¯¯\\
                                                                                                                                         #\__//¯¯\\__//
        If ( `$DC = 0 ) { `$I = ( [ WindowsPrincipal ] [ WindowsIdentity ]::GetCurrent() ).IsInRole( "Administrator" )                     #/¯¯\\__//¯¯\\
                         If ( `$I -eq `$True )       { `$Gate = 1 } Else {  `$Key = 1 } }                                                    #\__//¯¯\\__//
                                                                                                                                         #/¯¯\\__//¯¯\\
        If ( ( `$Key = 1 ) -and ( [ Int ] ( gcim Win32_OperatingSystem ).BuildNumber -ge 6000 ) )                                         #\__//¯¯\\__//
        {                                                                                                                                #/¯¯\\__//¯¯\\
            Echo "Attempting [~] Script Elevation" ;                                                                                     #\__//¯¯\\__//
            `$MyInvocation | % { SAPS -FilePath PowerShell.exe -Verb Runas -Args "-File `$( `$_.MyCommand.Path ) `$( `$_.UnboundArguments )" }#/¯¯\\__//¯¯\\
                         If ( `$? -eq `$True ) { `$Gate = 1 } Else { `$Gate = 0 } }                                                          #\__//¯¯\\__//
                                                                                                                                         #/¯¯\\__//¯¯\\
        If ( `$Gate = 1 ) { Echo "Access [+] Granted" ; Set-ExecutionPolicy Bypass -Scope CurrentUser -Force -VB }                        #\__//¯¯\\__//
                                                                                                                                         #/¯¯\\__//¯¯\\
        Else { "Access [!] Denied" ; Sleep -S 2 ; Read-Host "Press Enter to Exit" ; Exit } }                                             #\__//¯¯\\__//
# ____                                                                                                                        ___________#/¯¯\\__//¯¯\\
#//¯¯\\______________________________________________________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    Function Bridge-Script # Ties this commandlet into Write-Output for styling strings  \\__//  \\__//  \\__//  \\__//  \\__//  \\__//  \\__//  \\__//
    { #__________________________________________________________________________________//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\
                                                                                                                                 #\__//¯¯\\__//¯¯\\__//
        CMDKEY /add:$( $r[2] ) /user:$( $r[3] ) /pass:`$( `$dccred.GetNetworkCredential().Password )                                   #\__//¯¯\\__//¯¯\\
                                                                                                                                     #/¯¯\\__//¯¯\\__//
        `$Type = "Client"                                                                                                             #\__//¯¯\\__//¯¯\\
                                                                                                                                     #/¯¯\\__//¯¯\\__//
        ( gcim Win32_OperatingSystem ).Caption | ? { `$_ -like "*Server*" } | % { `$Type = "Server" }                                  #\__//¯¯\\__//¯¯\\
                                                                                                                                     #/¯¯\\__//¯¯\\__//
        CP -Path "$( $r[1] )\$( $r[0] )\(0)Resources\`$Hybrid`$Type.ps1" -Destination "`$home\Desktop" -Force                           #\__//¯¯\\__//¯¯\\
                                                                                                                                     #/¯¯\\__//¯¯\\__//
        SC -Path "`$home\Desktop\RootVar.ini" -Value (                                                                                #\__//¯¯\\__//¯¯\\
        "$(  $r[0] )" ,                                                                                                              #/¯¯\\__//¯¯\\__//
        "$(  $r[1] )" ,                                                                                                              #\__//¯¯\\__//¯¯\\
        "$(  $r[2] )" ,                                                                                                              #/¯¯\\__//¯¯\\__//
        "$(  $r[3] )" ,                                                                                                              #\__//¯¯\\__//¯¯\\
        "`$( `$dccred.GetNetworkCredential().Password )" ,                                                                             #/¯¯\\__//¯¯\\__//
        "$(  $r[5] )" ,                                                                                                              #\__//¯¯\\__//¯¯\\
        "$(  $r[6] )" ,                                                                                                              #/¯¯\\__//¯¯\\__//
        "$(  $r[7] )" ,                                                                                                              #\__//¯¯\\__//¯¯\\
        "$(  $r[8] )" ,                                                                                                              #/¯¯\\__//¯¯\\__//
        "$(  $r[9] )" ,                                                                                                              #\__//¯¯\\__//¯¯\\
        "$( $r[10] )" ,                                                                                                              #/¯¯\\__//¯¯\\__//
        "$( $r[11] )" ,                                                                                                              #\__//¯¯\\__//¯¯\\
        "$( $r[12] )" ,                                                                                                              #/¯¯\\__//¯¯\\__//
        "$( $lmcred.GetNetworkCredential().Password )" ,                                                                             #\__//¯¯\\__//¯¯\\
        "$( $r[14] )" ,                                                                                                              #/¯¯\\__//¯¯\\__//
        "$( $r[15] )" ,                                                                                                              #\__//¯¯\\__//¯¯\\
        "$( $r[16] )" )                                                                                                              #/¯¯\\__//¯¯\\__//
                                                                                                                                     #\__//¯¯\\__//¯¯\\
        "`$home\Desktop\`$Hybrid.ps1" | ? { ( Test-Path `$_ ) -eq `$True } | % { RI `$_ -Force }                                          #/¯¯\\__//¯¯\\__//
        `$SEP = "Set-ExecutionPolicy Bypass -Scope CurrentUser -Force"                                                                #\__//¯¯\\__//¯¯\\
        SAPS -FilePath PowerShell.EXE -Verb RunAs -Args "-File '`$Home\Desktop\`$Hybrid`$Type.ps1' `$SEP" }                              #/¯¯\\__//¯¯\\__//
                                                                                                                                     #\__//¯¯\\__//¯¯\\
                                                                                                                                     #/¯¯\\__//¯¯\\__//
# ____                                                                                                                        _______#\__//¯¯\\__//¯¯\\
#//¯¯\\______________________________________________________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    Function Bridge-Script # Ties this commandlet into Write-Output for styling strings  \\__//  \\__//  \\__//  \\__//  \\__//  \\__//  \\__//  \\__//
    { #__________________________________________________________________________________//__\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\
                                                                                                                                 #\__//¯¯\\__//¯¯\\__//  
        [ CmdLetBinding () ][ OutputType ( [ String ] ) ] Param (                                                                    #\__//¯¯\\__//¯¯\\
                                                                                                                                     #/¯¯\\__//¯¯\\__//
            [ Parameter ( ValueFromPipeLine = `$True , ValueFromPipelineByPropertyName = `$True ) ]                                    #\__//¯¯\\__//¯¯\\
                                                                                                                                     #/¯¯\\__//¯¯\\__//
                [ Alias ( 'PSCredential' ) ] [ ValidateNotNull () ][ System.Management.Automation.PSCredential ]                     #\__//¯¯\\__//¯¯\\
                                                                                                                                     #/¯¯\\__//¯¯\\__//
                [ System.Management.Automation.Credential () ] `$Credentials )                                                        #\__//¯¯\\__//¯¯\\
                                                                                                                                     #/¯¯\\__//¯¯\\__//
        ( `$Domain , `$Root , `$Username , `$Password ) = @( 0..3 | % { `$Null } )                                                        #\__//¯¯\\__//¯¯\\
                                                                                                                                     #/¯¯\\__//¯¯\\__//
        If ( `$Credentials -eq `$null ) {                                                                                              #\__//¯¯\\__//¯¯\\
                                                                                                                                     #/¯¯\\__//¯¯\\__//
                Try   { `$Credentials = Get-Credential "domain\`$env:username" -EA 4 }                                                 #\__//¯¯\\__//¯¯\\
                Catch { `$ErrorMsg    = `$_.Exception.Message                                                                          #/¯¯\\__//¯¯\\__//
                        Echo "Failure [!] Account Validation"                                                                        #\__//¯¯\\__//¯¯\\
                        Read-Host "Press Enter to Exit"                                                                              #/¯¯\\__//¯¯\\__//
                        Exit }                                                                                                       #\__//¯¯\\__//¯¯\\
        }                                                                                                                            #/¯¯\\__//¯¯\\__//
                                                                                                                                     #\__//¯¯\\__//¯¯\\
        Try       { `$Domain   = New-Object System.DirectoryServices.DirectoryEntry(                                                  #/¯¯\\__//¯¯\\__//
                                      "LDAP://`$( ( [ ADSI ]'').distinguishedName )" ,                                                #\__//¯¯\\__//¯¯\\
                                                       "`$( `$Credentials.Username )" ,                                                #/¯¯\\__//¯¯\\__//
                                "`$( `$Credentials.GetNetworkCredential().Password )" ) }                                              #\__//¯¯\\__//¯¯\\
                                                                                                                                     #/¯¯\\__//¯¯\\__//
        Catch     { `$_.Exception.Message ; Continue }                                                                                #\__//¯¯\\__//¯¯\\
                                                                                                                                     #/¯¯\\__//¯¯\\__//
        If ( ! `$Domain ) {   Echo "Exception [!] Domain does not exist"                                                              #\__//¯¯\\__//¯¯\\
                             Echo "Install [!] Active Directory Domain Services"                                                     #/¯¯\\__//¯¯\\__//
                             Read-Host "Press Enter to Exit" ; Exit                                                                  #\__//¯¯\\__//¯¯\\
        }                                                                                                                            #/¯¯\\__//¯¯\\__//
                                                                                                                                     #\__//¯¯\\__//¯¯\\
        Else {  If ( `$Domain.Name -ne `$Null ) { Return "Authenticated" ; Elevate-Script }                                            #/¯¯\\__//¯¯\\__//
                Else { Echo "Authentication [!] Failure" ; Sleep -S 2 }                                                              #\__//¯¯\\__//¯¯\\
        }                                                                                                                            #/¯¯\\__//¯¯\\__//
    }                                                                                                                                #\__//¯¯\\__//¯¯\\
                                                                                                                                     #/¯¯\\__//¯¯\\__//
    [ System.Windows.MessageBox ]::Show( "Enter Service Account Credentials to Continue" )                                           #\__//¯¯\\__//¯¯\\
                                                                                                                                     #/¯¯\\__//¯¯\\__//
    `$DCCRED = Get-Credential                                                                                                         #\__//¯¯\\__//¯¯\\
    If ( ( `$DCCRED | Test-Credential ) -ne "Authenticated" ) { Exit }                                                                #/¯¯\\__//¯¯\\__//
    Else { Elevate-Script }                                                                                                          #\__//¯¯\\__//¯¯\\
# ____                                                                            ___________________________________________________#/¯¯\\__//¯¯\\__//
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
"@
        SC -Path "$( $MDT[13] )\Initialize-Hybrid.ps1" -Value $Script -Force

        $Drive = $DSC[0] 
        Switch( $host.UI.PromptForChoice( 'Recycle-MDT' , 'Select MDT Update Method' , 
        [ System.Management.Automation.Host.ChoiceDescription[] ]@( '&Full' , '&Fast' , '&Compress' ) , 
        [ Int ] 0 )  ) {    0 { Update-MDTDeploymentShare -Path $Drive    -Force -VB } 
                            1 { Update-MDTDeploymentShare -Path $Drive           -VB } 
                            2 { Update-MDTDeploymentShare -Path $Drive -Compress -VB } }

        $OEM       = "$( $R[0].Replace( ' ' , '_' ) )"
        
        $Types = 64 , 86
        GCI $MDT[10] -Filter "*$( $OEM )*" -EA 0 | RI -Force 
        $Types | % { Remove-WDSBootImage -Architecture "x$_" -ImageName "$( $R[0] ) (x$_)" -EA 0 -VB } 

        GCI $MDT[10] -Filter "*LiteTouch*" -EA 0 | RNI -NewName { $_.Name.Replace( "LiteTouchPE" , "$OEM" ) } 
        $Boot  = $Types | % { GCI $MDT[10] -Filter "*_$_.wim" -EA 0 }
        
        0..1 | % { Import-WDSBootImage -Path $Boot[$_].FullName -NewDescription "$( $R[0] +' ('+ $Types[$_] +')')" -SkipVerify -VB } 
        Wrap-Function -ID "Restart-WDS"
        
        Restart-Service -Name WDSServer
        If ( $? -eq $True ) { Wrap-Action -Type "WDS Image" -Info "[+] Successfully updated!" ; Display-Foot ; Exit } 
        Else                { Wrap-Action -Type "WDS Image" -Info "[-] Update failed"         ; Display-Foot ; Exit } 
    }

# ____                                                                            _______________________________________________________#\__//¯¯\\__//
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
    Function Make-Decision # Checks for an existing installation path, and selects the corresponding workflow    //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    { #\_________________________________________________________________________________________________________\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//
                                                                                                                             #\__//¯¯\\__//¯¯\\__//¯¯\\
        $BasePath = "HKLM:\Software\Policies\Secure Digits Plus LLC"                                                             #\__//¯¯\\__//¯¯\\__//
                                                                                                                                     #\__//¯¯\\__//¯¯\\
        If ( ( GP $BasePath -ea 0 ) -ne $Null )                                                                                      #/¯¯\\__//¯¯\\__//
                                                                                                                                     #\__//¯¯\\__//¯¯\\
        { ( $Base , $InstallDate ) = ( GP $BasePath -EA 0 | % { $_.'Hybrid-DSC' , $_."Installation Date" } )                         #/¯¯\\__//¯¯\\__//
                                                                                                                                     #\__//¯¯\\__//¯¯\\
            If ( ( ( $Base , $InstallDate ) -ne $Null ) -and ( Test-Path $Base ) -eq $True ) { Switch( $Host.UI.PromptForChoice(     #/¯¯\\__//¯¯\\__//
"Change / Refresh / Remove" ,                                                                                                        #\__//__\\__//__\\
" An existing installation was detected        
                                               
    [ Hybrid-DSC Location ]                    
    = = = = = = = = = = =                      
        $Base                                      
                                               
    [ Installation Date ]                      
    = = = = = = = = =                          
        $InstallDate                               
                                            " ,
                [ System.Management.Automation.Host.ChoiceDescription [] ]@( '&Change' , '&Refresh' , '&Remove' ) , [ Int ] 0 ) )    #\__//¯¯\\__//¯¯\\
                {                                                                                                                    #/¯¯\\__//¯¯\\__//
                    0 { Wrap-Action "Change" "[+] Selected"                                                                          #\__//¯¯\\__//¯¯\\
                        RI $BasePath ; RI $Base -Recurse -Force                                                                      #/¯¯\\__//¯¯\\__//
                        ( $Base , $BasePath , $InstallDate ) = $Null                                                                 #\__//¯¯\\__//¯¯\\
                        Install-Hybrid ; Populate-DSCRoot ; Review-Applications ; Download-Applications                              #/¯¯\\__//¯¯\\__//
                        Display-Foot ; Wrap-Action "Installation" "[+] Complete"                                                     #\__//¯¯\\__//¯¯\\
                        Read-Host "Press Enter to Exit" ; Exit }                                                                     #/¯¯\\__//¯¯\\__//
                                                                                                                                     #\__//¯¯\\__//¯¯\\
                    1 { Wrap-Action "Refresh" "[+] Selected"                                                                         #/¯¯\\__//¯¯\\__//
                        RI $Base -Recurse -Force ; NI $Base -ItemType Directory                                                      #\__//¯¯\\__//¯¯\\
                        Populate-DSCRoot ; Review-Applications ; Download-Applications                                               #/¯¯\\__//¯¯\\__//
                        Display-Foot ; Wrap-Action "Installation" "[+] Complete"                                                     #\__//¯¯\\__//¯¯\\
                        Read-Host "Press Enter to Exit" ; Exit }                                                                     #/¯¯\\__//¯¯\\__//
                                                                                                                                     #\__//¯¯\\__//¯¯\\
                    2 { Wrap-Action "Remove" "[+] Selected"                                                                          #/¯¯\\__//¯¯\\__//
                        RI $BasePath ; RI $Base -Recurse -Force                                                                      #\__//¯¯\\__//¯¯\\
                        Display-Foot ; Wrap-Action "Uninstallation" "[+] Complete"                                                   #/¯¯\\__//¯¯\\__//
                        Read-Host "Press Enter to Exit" ; Exit }                                                                     #\__//¯¯\\__//¯¯\\
                }                                                                                                                    #/¯¯\\__//¯¯\\__//
            }                                                                                                                        #\__//¯¯\\__//¯¯\\
                                                                                                                                     #/¯¯\\__//¯¯\\__//
            If ( $Base -ne $Null -and ( ( Test-Path $Base -EA 0 ) -eq $True ) -and ( ( GCI $Base ).Count -eq 0 ) )                   #\__//¯¯\\__//¯¯\\
            {                                                                                                                        #/¯¯\\__//¯¯\\__//
                Populate-DSCRoot ; Review-Applications ; Download-Applications ; Display-Foot ;                                      #\__//¯¯\\__//¯¯\\
                Read-Host "[+] Installation Complete" ; Exit }                                                                       #/¯¯\\__//¯¯\\__//
        }                                                                                                                            #\__//¯¯\\__//¯¯\\
                                                                                                                                     #/¯¯\\__//¯¯\\__//
        Else {  Install-Hybrid ; Populate-DSCRoot ; Review-Applications ; Download-Applications ; Display-Foot                       #\__//¯¯\\__//¯¯\\
                Read-Host "[+] Installation Complete" ; Exit } }                                                                     #/¯¯\\__//¯¯\\__//

# ____                                                                            ___________________________________________________#/¯¯\\__//¯¯\\__//
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
    Function Test-Credential # Tests an input credential for AD authentication    ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    { #______________________________________________________________________________//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
                                                                                                                     #\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
        [ CmdLetBinding () ][ OutputType ( [ String ] ) ] Param ( 
        
            [ Parameter ( ValueFromPipeLine = $True , ValueFromPipelineByPropertyName = $True ) ]
        
                [ Alias ( 'PSCredential' ) ] [ ValidateNotNull () ][ System.Management.Automation.PSCredential ]
        
                [ System.Management.Automation.Credential () ] $Creds )

        ( $Domain , $Root , $Username , $Password ) = @( 0..3 | % { $Null } )
     
        Try       
        {
            $AD      = "LDAP://$( ( [ ADSI ]'').distinguishedName )"
            $Creds   | % { $UN = $_.Username ; $PW = $_.GetNetworkCredential().Password } 
            $Domain  = New-Object System.DirectoryServices.DirectoryEntry( "$AD" , "$UN" , "$PW" ) }

        Catch     { $_.Exception.Message ; Continue } 

        If ( ! $Domain ) 
        {
            ( [ WindowsPrincipal ] [ WindowsIdentity ]::GetCurrent() ).IsInRole( "Administrator" )
            If ( $? -eq $True ) { Return "Authenticated" } Else { Return "Authentication [!] Failure" } }

        Else 
        {
            If ( $Domain.Name -ne $Null ) { Return "Authenticated" }
            Else { Return "Authentication [!] Failure" } 
        } 
    }

# ____                                                                            _______________________________________________#\__//¯¯\\__//¯¯\\__//
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
    Function Determine-Domain # A switch that determines workgroup or domain      ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    { #______________________________________________________________________________//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
                                                                                                                     #\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
        If ( ( GWMI Win32_ComputerSystem ).PartOfDomain -eq $True ) { $env:USERDOMAIN } Else { $ENV:ComputerName }
    }

# ____                                                                                                                        ___//¯¯\\__//¯¯\\__//¯¯\\
#//¯¯\\______________________________________________________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    Function Enter-ServiceAccount  # Pulls up a script login prompt                                                      \\__//¯¯\\__//¯¯\\__//  \\__//
    { #\\________________________________________________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
        
        $GridC = 25 , 75 , 34 , 75 , 25 | % { 
                        "<ColumnDefinition Width='$_*' />"
        }
        
        $GridR = "" , "" + @( 0..3 | % { "1.5" } ) | % { 
                        "<RowDefinition Height = '$_*' />"
        }

        $XAML = @"
        <Window                      xmlns =                 "http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                                   xmlns:x =                              "http://schemas.microsoft.com/winfx/2006/xaml" 
                                     Title =             "Secure Digits Plus LLC | Hybrid @ Service Account Designation" 
                                     Width =                                                                       "480" 
                                    Height =                                                                       "300" 
                       HorizontalAlignment =                                                                    "Center" 
                                ResizeMode =                                                                  "NoResize" 
                     WindowStartupLocation =                                                              "CenterScreen" 
                                   Topmost =                                                                      "True" >
            <GroupBox 
                                    Header =                                               "Enter Username and Password" 
                       HorizontalAlignment =                                                                    "Center" 
                         VerticalAlignment =                                                                    "Center" 
                                    Height =                                                                       "250" 
                                    Margin =                                                               "10,10,10,10" 
                                     Width =                                                                       "460" >
                <Grid 
                                    Height =                                                                       "200" >
                    <Grid.ColumnDefinitions>
                        $( $GridC )
                    </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                        $( $GridR )
                </Grid.RowDefinitions>
            <TextBlock Grid.ColumnSpan="3" Grid.Row="0" FontSize="12" HorizontalAlignment="Center" Width="350" Grid.Column="1">Enter the credentials you would like to designate to your user.</TextBlock>
            <TextBlock Grid.ColumnSpan="3" Grid.Row="1" FontSize="12" HorizontalAlignment="Center" Width="350" Grid.Column="1">A password is required, but may be changed after logging in.</TextBlock>
            <TextBlock Grid.Row="2" FontSize="12" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,0,25,0" Height="20" Width="120" TextAlignment="Right" Grid.Column="1">Username:</TextBlock>
            <TextBlock Grid.Row="3" FontSize="12" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,0,25,0" Height="20" Width="120" TextAlignment="Right" Grid.Column="1">Password:</TextBlock>
            <TextBlock Grid.Row="4" FontSize="12" HorizontalAlignment="Right" VerticalAlignment="Center" Height="20" Width="120" Text="Confirm:" Margin="0,0,25,0" Grid.Column="1" TextAlignment="Right"/>
            <TextBox Name="Username" Grid.Row="2" Grid.Column="2" Height="24" Width="180" VerticalAlignment="Center" HorizontalAlignment="Left" Margin="40,0,0,0" Grid.ColumnSpan="3"></TextBox>
            <PasswordBox Name="Password" PasswordChar="*" Grid.Row="3" Grid.Column="2" Height="24" Width="180" VerticalAlignment="Center" HorizontalAlignment="Left" Margin="40,0,0,0" Grid.ColumnSpan="3"></PasswordBox>
            <PasswordBox Name="Confirm" PasswordChar="*" Grid.Row="4" Grid.Column="2" Height="24" Width="180" VerticalAlignment="Center" HorizontalAlignment="Left" Margin="40,0,0,0" Grid.ColumnSpan="3"></PasswordBox>
            <Button Grid.Row="5" Grid.Column="1" Name="Ok" Content="OK" Width="140" HorizontalAlignment="Right" Margin="0,15,0,0"/>
            <Button Grid.Row="5" Grid.Column="3" Name="Cancel" Content="Cancel" Width="140" HorizontalAlignment="Center" Margin="0,15,0,0"/>
        </Grid>
    </GroupBox>
</Window>
"@
        If ( Determine-Domain -eq $ENV:UserDomain ) { $Test = 0 } Else { $Test = 1 }

        $GUI = Convert-XAMLtoWindow -Xaml $xaml -NamedElement 'Username', 'Password', 'Confirm', 'Ok', 'Cancel' -PassThru

        $GUI.Cancel.add_Click( { $GUI.DialogResult = $False } )

        $GUI.Ok.add_Click( 
        {
            $0      = "Username" , "Password" , "Confirmation" ; $1 = $0 | % { "You must enter a $_" } ; $2 = $0 | % { "$_ Error" }
            $1[2]   | % { $_ = $_.Replace( "You must enter a" , "Password Must Match the" ) }
            $1     += "This account could not be authenticated. Try again or hit cancel to exit." ; $2 += "Authentication Failure"
            $MSG    = 0..3 | % { "[ System.Windows.MessageBox ]::Show( '$( $1[$_] )' , '$( $2[$_] )' )" }

            $Test = New-Object System.Management.Automation.PSCredential -Args $GUI.Username.Text , $GUI.Password.SecurePassword

                If     ( $U -eq "" )                                              { IEX $MSG[0] }
                ElseIf ( $P -eq "" )                                              { IEX $MSG[1] }
                ElseIf ( $GUI.Password.Password -notmatch $GUI.Confirm.Password ) { IEX $MSG[2] }
                ElseIf ( ( $Test | Test-Credential ) -ne "Authenticated" )        { IEX $MSG[3] }
                Else 
                {
                    $GUI.DialogResult = $True 
                }
            })

            $Null = $GUI.Username.Focus()

            $Output = Show-WPFWindow -GUI $GUI

            If ( $Output -eq $True )
            {
                $DCCred = New-Object System.Management.Automation.PSCredential -Args $GUI.Username.Text , $GUI.Password.SecurePassword
                Return $DCCred
            }

            Else
            {
                Echo "Either the user cancelled, or the dialogue failed"
            }
        }
# ____                                                                                                                        _________________________
#//¯¯\\______________________________________________________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    Function Start-Script                                                                                               #\\__//¯¯\\__//¯¯\\__//  \\__//
    {
        gcim Win32_OperatingSystem | % { 
    
            If ( $_.Caption -notlike "*Server*" ) { Wrap-Action "Invalid System" "[!] Server OS Required" ; Exit }
            
            Else { 
                    Wrap-Action "Initializing" "[+] Service Account Login"
                    $DCCred = @( Enter-ServiceAccount )
                    Display-TrueColors
                    Wrap-Action "Loading" "[+] Provisionary Information / Installer"
                    $R = @( Get-Provisionary ) 
            }
        }
    }

# ____                                                                            ____________________________________________________________________
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
        #Elevate-Script ; Display-TrueColors ; Make-Decision     //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\______________________________________________________________\\__//__\\__//__\\__//__\\__//__\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\   ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯   //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//  [ Secure Digits Plus LLC | Hybrid | Desired State Controller ]  \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯     __________________________________________________________     ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯ -=-=-=-=-=-=-=[ Dynamically Engineered Digital Security ]-=-=-=-=-=-=--=-= ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯                                           ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//   Application Development | Virtualization | Network and Hardware Magistration   \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\   ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯   //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//   https://www.securedigitsplus.com | Server-Client | Seedling-Spawning Script    \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\___¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ___//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\   [ Provisional Author : Michael C Cook Sr. | "The Buck Stops Here" ]    //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//   ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
#//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\--//--\\
#¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯
