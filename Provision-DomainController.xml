# ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____  
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\   ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯   //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//  [ Secure Digits Plus LLC | Hybrid | Desired State Controller ]  \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯       _____________________________________________________        ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯        __/¯¯\__[ Dynamically Engineered Digital Security ]__/¯¯\__         ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\  _________________________ ________________ ___________________________________  //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯\\__//¯¯\\__//¯¯\\__// | Application Development | Virtualization | Network and Hardware Magistration | \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\  ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯  //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//   https://www.securedigitsplus.com | Server-Client | Seedling-Spawning Script    \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\___¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯   ¯¯¯¯¯¯¯¯¯¯¯¯¯   ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ___//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\   [ Provisional Author : Michael C Cook Sr. | "The Buck Stops Here" ]    //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//   ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
#//¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯  
#\\  [ Provision-DomainController ] @: Orchestrates the process of provisioning server prerequisites in order to install Hybrid-DSC 
#//   ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____      
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\___  
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
# ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯  
    
    "Security.Principal" , "Management.Automation" , "DirectoryServices" | % { IEX "Using Namespace System.$_" } 

    #Using Namespace System.Security.Principal
    #Using Namespace System.Management.Automation
    #Using Namespace System.DirectoryServices
    
    $ENV:PSModulePath.Split( ';' ) | % { GCI $_ -Recurse "Hybrid-DSC.psm1" } | % {
        
        IPMO $_.FullName
        
        If ( $? -ne $True ) { Write-Error "Module Not Loaded/Found" ; Read-Host "Press Enter to Exit" ; Exit }
        
        Sleep 1
                                                                                     #____    ____    ____    ____    ____    ____    ____              
}#____                                                                            ___//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\___          
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
    Function Get-FeatureList # Collects all server features that pertain to DSC   ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    {#)______________________________________________________________________________/¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯      
        
        Return @( "AD-Domain-Services" , "DHCP" , "DNS" , "GPMC" ; @( "" ; "-AdminCenter" , "-PowerShell" , "-Tools" | % { "-AD$_" } ; 
        "" , "-Tools" | % { "-ADDS$_" } ; "-DHCP" , "-DNS-Server" , "-Role-Tools" ) | % { "RSAT$_" } ;
        "" , "-AdminPack" , "-Deployment" , "-Transport"  | % { "WDS$_" } )
                                                                                     #____    ____    ____    ____    ____    ____    ____              
}#____                                                                            ___//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\___          
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
    Function Collect-FeaturesState # Determines Installation Loadout              ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    {#)______________________________________________________________________________/¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯      

        [ CmdLetBinding () ] Param ( [ Parameter () ][ Switch ] $All )

        $Services = Get-FeatureList ; $GWF = Get-WindowsFeature ; $Array = @( ) ; $Table = [ Ordered ]@{ Installed = @( ) ; Available = @( ) }

        ForEach ( $I in $Services ) { $X = $GWF | ? { $_.Name -eq $I } | % { 
            If ( $_.InstallState -ne "Installed" ) { $Array += "$I [_]" ; $Table.Available += "$I [_]" }
            If ( $_.InstallState -eq "Installed" ) { $Array += "$I [X]" ; $Table.Installed += "$I [X]" } } }

        Return $( If ( !$All ) { $Table } If ( $All ) { $Array } )

                                                                                     #____    ____    ____    ____    ____    ____    ____              
}#____                                                                            ___//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\___          
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
    Function Enter-ServiceAccount # Allows entry / use of an AD service account   ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    {#)______________________________________________________________________________//¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯      

        [ CmdLetBinding () ] Param (

            [ Parameter ( Position = 0 , ValueFromPipeline = $True ) ] [ String ] $DC      ,
            [ Parameter ( Position = 1 , ValueFromPipeline = $True ) ] [ String ] $Domain  ,
            [ Parameter ( Position = 2 , ValueFromPipeline = $True ) ] [ String ] $NetBIOS )

        $XAML = @"
<Window                               xmlns =                 "http://schemas.microsoft.com/winfx/2006/xaml/presentation" 
                                    xmlns:x =                              "http://schemas.microsoft.com/winfx/2006/xaml" 
                                      Title =                         "Secure Digits Plus LLC | Hybrid-DSC Service Login" 
                                      Width =                                                                       "350" 
                                     Height =                                                                       "250" 
                                 ResizeMode =                                                                  "NoResize" 
                      WindowStartupLocation =                                                              "CenterScreen"
                                    Topmost =                                                                      "True" >
    <GroupBox 
                                     Header =                           "Enter Directory Services Administration Account" 
                                      Width =                                                                       "330" 
                                     Height =                                                                       "220" 
                          VerticalAlignment =                                                                       "Top">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height = "2*" />
                <RowDefinition Height =  "1.25*" />
            </Grid.RowDefinitions>
            <Grid Grid.Row = "0" >
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width =    "*" />
                    <ColumnDefinition Width = "2.5*" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition   Height = "*" />
                    <RowDefinition   Height = "*" />
                    <RowDefinition   Height = "*" />
                </Grid.RowDefinitions>
                <TextBlock                     Grid.Column = "0" Grid.Row = "0" Margin = "10" TextAlignment = "Right" >Username:</TextBlock>
                <TextBox     Name = "Username" Grid.Column = "1" Grid.Row = "0" Height = "24" Margin = "5" ></TextBox>
                <TextBlock                     Grid.Column = "0" Grid.Row = "1" Margin = "10" TextAlignment = "Right" >Password:</TextBlock>
                <PasswordBox Name = "Password" Grid.Column = "1" Grid.Row = "1" Height = "24" Margin = "5" PasswordChar = "*" ></PasswordBox>
                <TextBlock                     Grid.Column = "0" Grid.Row = "2" Margin = "10" TextAlignment = "Right" >Confirm:</TextBlock>
                <PasswordBox Name =  "Confirm" Grid.Column = "1" Grid.Row = "2" Height = "24" Margin = "5" PasswordChar = "*" ></PasswordBox>
            </Grid>
            <Grid Grid.Row = "1" >
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width = "*" />
                    <ColumnDefinition Width = "*" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <RadioButton Name = "Port_Toggle" Grid.Row = "0" Grid.Column = "0" Content = "Alternate Port / SSL" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                <TextBox     Name =  "Port_Entry" Grid.Row = "0" Grid.Column = "1" HorizontalAlignment="Center" VerticalAlignment="Center" Width="120" IsEnabled="False">389</TextBox>
                <Button      Name =          "Ok" Content =     "Ok" Grid.Column = "0" Grid.Row = "1" Margin = "5" ></Button>
                <Button      Name =      "Cancel" Content = "Cancel" Grid.Column = "1" Grid.Row = "1" Margin = "5" ></Button>
            </Grid>
        </Grid>
    </GroupBox>
</Window>
"@
        $NamedElements = "Username" , "Password" , "Confirm" , "Port_Toggle" , "Port_Entry" , "Ok" , "Cancel"

        $0 = "Username" , "Password" , "Confirmation" ; $1 = $0 | % { "You must enter a $_" } ; $2 = $0 | % { "$_ Error" }
        $1[2] = $1[2].Replace( "You must enter a" , "Password Must Match the" ) 
        $1   += "Invalid information. All fields must be correct and valid." ; $2 += "Authentication Failure"

        $MSG  = 0..3 | % { "[ System.Windows.MessageBox ]::Show( '$( $1[$_] )' , '$( $2[$_] )' )" }

        $GUIX = Convert-XAMLtoWindow -Xaml $Xaml -NE $NamedElements -PassThru

        $GUIX.Port_Toggle.Add_Click({ $GUIX.Port_Entry.IsEnabled = $True })
        $GUIX.Cancel.Add_Click({ $GUIX.DialogResult = $False })
        $GUIX.Ok.Add_Click({

            $Port = $( If ( $GUIX.Port_Entry.IsEnabled -eq $True ) { $GUIX.Port_Entry.Text } Else { 389 } )
            $Cred = [ PSCredential ]::New( $GUIX.Username.Text , $GUIX.Password.SecurePassword )
            $AD   = "LDAP://$( $DC ):$Port/DC=$( $Domain.Split('.') -join ',DC=' )"
            $DX   = [ DirectoryEntry ]::New( "$AD" , $Cred.Username , $Cred.GetNetworkCredential().Password )

            If     ( $GUIX.Username.Text     -eq       $Null )                 { IEX $MSG[0] }
            ElseIf ( $GUIX.Password.Password -eq       $Null )                 { IEX $MSG[1] }
            ElseIf (  $GUIX.Confirm.Password -eq       $Null )                 { IEX $MSG[2] } 
            ElseIf ( $GUIX.Password.Password -notmatch $GUIX.Confirm.Password ) { IEX $MSG[2] }
            ElseIf ( $DX.Name -eq $Null )                                     { IEX $MSG[3] }

            Else { $GUIX.DialogResult = $True }
        })

        $Null = $GUIX.Username.Focus()

        $OP = Show-WPFWindow -GUI $GUIX

        If ( $OP -eq $True )
        { 
            Write-Theme -Action "Login [+]" "Successful" -Font 11
            Return [ PSCredential ]::New( $GUIX.Username.Text , $GUIX.Password.SecurePassword )
        }

        Else 
        { 
            Write-Theme -Action "Login [!]" "Failed"
        }
                                                                                     #____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____    ____      
}#____                                                                             __//¯¯\\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//¯¯\\___  
#//¯¯\\___________________________________________________________________________/¯¯¯    ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯        ____    ____ __ ____ __ ____ __ ____ __ ____ __ ____    ___// 
    Function Convert-ArrayToHereString   #_______________________________________________//¯¯\\__//¯¯\\==//¯¯\----/¯¯\\==//¯¯\----/¯¯\\==//¯¯\\__//¯¯¯  
    {#]__________________________________//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ -- ¯¯¯¯ -- ¯¯¯¯ -- ¯¯¯¯ -- ¯¯¯¯ -- ¯¯¯¯ -- ¯¯¯¯ -- ¯¯¯¯      
        [ CmdLetBinding () ] [ OutputType ( "String" ) ] Param (
            
            [ Parameter ( Position = 0 , Mandatory = $True ) ] [ Array ] $Input )

        $Return = ""
        0..( $Launch.Count - 1 ) | % { $Return += "$( $Launch[$_] )`n" }
        Return $Return
                                                                                     #____    ____    ____    ____    ____    ____    ____              
}#____                                                                            ___//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\___          
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
    Function Convert-XAMLToWindow # Modified, originally by Dr. Tobias Weltner    ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    {#]______________________________________________________________________________/¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯      

        Param ( [ Parameter ( Mandatory ) ] [ String ] $XAML , [ String [] ] $NE = $Null , [ Switch ] $PassThru )

        If ( $XAML.Count -gt 1 ) { $XAML = Convert-ArrayToHereString -Input $XAML }

        @( "Framework" , "Core" | % { "Presentation$_" } ) + "WindowsBase" | % { Add-Type -AssemblyName $_ }
 
        $NR = [ XML.XMLReader ]::Create( [ IO.StringReader ] $XAML ) ; $OP = [ Windows.Markup.XAMLReader ]::Load( $NR )
        
        $NE | % { $OP | Add-Member -MemberType NoteProperty -Name $_ -Value $OP.FindName( $_ ) -Force }
 
        If ( $PassThru ) { $OP } Else { $Null = $GUI.Dispatcher.InvokeAsync( { $OP = $GUI.ShowDialog() ; SV -Name OP -Value $OP -Scope 1 } ).Wait() ; $OP }

                                                                                     #____    ____    ____    ____    ____    ____    ____              
}#____                                                                            ___//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\___          
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
    Function Show-WPFWindow # Modified, originally by Dr. Tobias Weltner          ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    {#)______________________________________________________________________________//¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯      
        
        Param ( [ Parameter ( Mandatory ) ] [ Windows.Window ] $GUI )

        $OP = $Null ; $Null = $GUI.Dispatcher.InvokeAsync( { $OP = $GUI.ShowDialog() ; SV -Name OP -Value $OP -Scope 1 } ).Wait() ; $OP 
                                                                                     #____    ____    ____    ____    ____    ____    ____              
}#____                                                                            ___//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\___          
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
    #Function Provision-DomainController                                          #¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    #{#)______________________________________________________________________________/¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯             
        
        $Schema    = "http://schemas.microsoft.com/winfx/2006/xaml"
        $Author    = "Secure Digits Plus LLC"

        $CS        = ( GCIM Win32_OperatingSystem ).Caption
        $B         = $False , $True 
        $YZ        = "[X]" , "[_]"

    #  ____                                                                        ____    ____    ____    ____    ____  
    # //¯¯\\______________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
    # \\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
    #  ¯¯¯\\__[ WPF Glossary / Index ]____________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    #      ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯      

            $Glossary  = 
            "   `$W = 'Width'             " , "   `$H = 'Height'            " , "  `$MA = 'Margin'          " , 
            "  `$MN = 'Menu'              " , " `$MNI = 'MenuItem'          " , "  `$HD = 'Header'          " , 
            "  `$GB = 'GroupBox'          " , " `$GBI = 'GroupBoxItem'      " , "  `$CB = 'ComboBox'        " , 
            " `$CBI = 'ComboBoxItem'      " , " `$CHK = 'CheckBox'          " , "  `$TB = 'TextBox'         " , 
            " `$TBL = 'TextBlock'         " , "   `$G = 'Grid'              " , "  `$RD = 'RowDefinition'   " , 
            "  `$CD = 'ColumnDefinition'  " , "  `$GC = 'Grid.Column'       " , " `$GCS = 'Grid.ColumnSpan' " , 
            "  `$GR = 'Grid.Row'          " , " `$GRS = 'Grid.RowSpan'      " , "  `$SI = 'SelectedIndex'   " , 
            "  `$LA = 'Label'             " , "  `$BU = 'Button'            " , "  `$CO = 'Content'         " , 
            "   `$Q = 'Name'              "
            
            $Glossary | % { IEX $_ } ; $GRD , $GCD = $RD , $CD | % { "$G.$_`s" }
            $Glossary += " `$GRD = '$GRD'" , " `$GCD = '$GCD'" 

            # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

            #$Section  =  0..1
            #$Subtable =  0..1


            #$Names  , $Values = @( ) , @( )
            #$Glossary | % { $Names += $_.Split('=')[0] ; $Values += $_.Split('=')[1] }


            #$Section[0]  = "WPF/XAML Shortcut Glossary"
            #$Subtable[0] = New-SubTable -Items $Names -Values $Values

            #$Names  , $Values = @( ) , @( )

            $HAL , $HCAL , $VAL , $VCAL , $SP = 0..4 | % { [ Ordered ]@{ } }

            0..13 | % { $SP.Add( $_ , ( "    " * $_ ) ) }
                    
            $I =       "Left" ,   "Center" ,  "Right"
            $J =        "Top" ,   "Center" , "Bottom"
            $K = "Horizontal" , "Vertical" | % { $_ , "$_`Content" } | % { "$_`Alignment" }
            $L =     " `$HAL" ,   "`$HCAL" , " `$VAL" , "`$VCAL"

            0..2  | % {  $HAL.Add( $_ , "$( $K[0] ) = '$( $I[$_] )'" )
                        $HCAL.Add( $_ , "$( $K[1] ) = '$( $I[$_] )'" )
                         $VAL.Add( $_ , "$( $K[2] ) = '$( $J[$_] )'" )
                        $VCAL.Add( $_ , "$( $K[3] ) = '$( $J[$_] )'" ) }

            #    $C = 0
            #    $HAL , $HCAL , $VAL , $VCAL | % { 
            #   
            #    $N = $L[$C]
            #    ForEach ( $I in 0..2 ) 
            #    { 
            #        $Names    += "$N[$I]"
            #        $Values   += ( $( $_[$I] ) )
            #        $Glossary += "$N[$I] = ( $( $_[$I] ) )" 
            #    } 
            #    $C ++ 
            #}

            #$Section[1]  = "Alignment/Positional Attributes"
            #$Subtable[1] = New-SubTable -Items $Names -Values $Values

            #$Table = New-Table -Title "XAML / Glossary" -Depth 2 -ID $Section -Table $Subtable

            #Write-Theme -Table $Table
            Write-Theme -Action "Loaded [+]" "WPF/XAML Glossary Definitions" 11 12 15


            # To clear, these: 
            # $W , $H , $MA , $MN , $MNI , $HD , $CHK , $CO , $BU , $Q , $GB , $GBI , $CB , $CBI , 
            # $TB , $TBL , $LA , $G , $RD , $CD , $SI , $GC , $GCS , $GR , $GRS = $Null

            $FT        = Collect-FeaturesState -All

    #//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
    #\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
        Function Initialize-DCPromoControl # Makes developing GUI lil less miserable #¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
        {#)______________________________________________________________________________/¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯              

            # ____   _________________________       ____    ____    ____    ____    ____    ____    ____    ____    ____    ____  
            #//¯¯\\__[  Declare Common Vars  ]______//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
            #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                                                                                                                           #//¯¯\\ 
                $Out     = [ PSCustomObject ]@{                                                                            #\\__// 
                                                                                                                           #//¯¯\\ 
                # ______________________________________________________________________________ #                         #\\__// 
                # [ Services ] # - Entries for [ Windows Server @: Desired State Configuration ] #                         #//¯¯\\ 
                # ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ #                         #\\__// 
                                                                                                                           #//¯¯\\ 
                AD_Domain_Services      = "" ; DHCP                     = "" ; DNS                     = "" ;              #\\__// 
                GPMC                    = "" ; RSAT                     = "" ; RSAT_AD_AdminCenter     = "" ;              #//¯¯\\ 
                RSAT_AD_PowerShell      = "" ; RSAT_AD_Tools            = "" ; RSAT_ADDS               = "" ;              #\\__// 
                RSAT_ADDS_Tools         = "" ; RSAT_DHCP                = "" ; RSAT_DNS_Server         = "" ;              #//¯¯\\ 
                RSAT_Role_Tools         = "" ; WDS                      = "" ; WDS_AdminPack           = "" ;              #\\__// 
                WDS_Deployment          = "" ; WDS_Transport            = "" ;                                             #//¯¯\\ 
                                                                                                                           #\\__// 
                # ________________________________________________________________________________ #                       #//¯¯\\ 
                # [ ADDS-Deployment ] # - Entries for [ Active Directory @: Deployment / DCPromo ] #                       #\\__// 
                # ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ #                       #//¯¯\\ 
                                                                                                                           #\\__// 
                Forest                  = "" ; Tree                    = "" ; Child                   = "" ;               #//¯¯\\ 
                Clone                   = "" ; DomainType              = "" ; ForestMode              = "" ;               #\\__// 
                DomainMode              = "" ; ParentDomainName        = "" ; DatabasePath            = "" ;               #//¯¯\\ 
                SysvolPath              = "" ; LogPath                 = "" ; Credential              = "" ;               #\\__// 
                DomainName              = "" ; DomainNetBIOSName       = "" ; NewDomainName           = "" ;               #//¯¯\\ 
                NewDomainNetBIOSName    = "" ; SiteName                = "" ; ReplicationSourceDC     = "" ;               #\\__//
                InstallDns              =  0 ; CreateDnsDelegation     =  0 ; NoGlobalCatalog         =  0 ;               #//¯¯\\ 
                CriticalReplicationOnly =  0 ; NoRebootUponCompletion  = "" ; Force                   = "" ;               #\\__// 
                                                                                                                           #//¯¯\\ 
                SafeModeAdministratorPassword = "" }                                                                       #\\__// 
                #^¯¯¯[   DSRM   ]¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯^#                                                                       #//¯¯\\ 
                #    [ password ]                                                                                          #\\__// 
                # This ¯¯¯¯¯¯¯¯  will allow you to get the almanac back from that entropy-ass, son of a bitch known as...  #//¯¯\\ 
                #                                          ¯¯¯¯¯¯¯                ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯  #\\__// 
                # Biff "One Real Top Shelf Douchebag" Tannen. No one likes you Biff. And, since he *definitely qualifies*  #//¯¯\\ 
                # ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯  ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯                 ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯  #\\__// 
                # as being one of the most well known "One Real Top Shelf Douchebag"'s out there..? It happens to be his   #//¯¯\\ 
                #                                      ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯                 ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯   #\\__// 
                # middle name. Now, I know what you're thinking. "That's one hell of a middle name Michael..." I'm not his #//¯¯\\ 
                # ¯¯¯¯¯¯¯¯¯¯¯       ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯   ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯              #\\__// 
                # mother and I didn't name him. Anyway, He screws things up because it's what he lives for. He's dick like #//¯¯\\ 
                #            ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯         ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯  ¯¯¯¯¯¯¯¯¯¯¯¯¯¯ #\\__// 
                # that. Anyway, yeah. If Biff happens to screw up your domain...? Well, DSRM is like Marty McFly. As in... #//¯¯\\ 
                # ¯¯¯¯¯                  ¯¯¯¯            ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯           ¯¯¯¯         ¯¯¯¯¯¯¯¯¯¯¯           #\\__// 
                # He'll be your only hope to fix everything. So, if you don't want to 'restart your domain from scratch?   #//¯¯\\ 
                # ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯      ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    #\\__// 
                # Write this password down on a piece of paper, and store it in a *SAFE* place that is *NOT A DEVICE.*     #//¯¯\\ 
                # ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯     ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯     #\\__// 
                                                                                                                           #//¯¯\\ 
                ForEach ( $i in ( 0..( $FT.Count - 1 ) ) )                                                                 #\\__// 
                {                                                                                                          #//¯¯\\ 
                    $X = $FT[$I].Split( ' ' )                                                                              #\\__// 
                    $Out.$( $X[0].Replace( '-' , '_' ) ) = $B[(0..1| ? { $YZ[$_] -eq $X[1] })]                             #//¯¯\\ 
                }                                                                                                          #\\__// 
                                                                                                                           #//¯¯\\ 
                Return $Out                                                                                                #\\__//
        }                                                                                                                  #//¯¯\\ 
            # ____   _________________________       ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
            #//¯¯\\__[___ Parts Done Bro ____]______//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
            #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__//

    # ____    ____                                   ____    ____    ____    ____    ____    ____    ____    ____    ____    ____  
    #//¯¯\\__//¯¯\\_________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
    #\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//
        Function Show-DCPromoGUI # It tells the window to stop being such a sissy   #¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\
        {#)_______________________________________[ It might not listen though ]________/¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
                                                                                                                           #//¯¯\\ 
            [ CmdLetBinding () ] Param (                                                                                   #\\__// 
                                                                                                                           #//¯¯\\ 
                [ ValidateSet( 0,1,2,3 ) ][ Parameter ( Position = 0 , Mandatory = $True ) ][    Int ] $Profile = 0 ,      #\\__// 
                [ Parameter  ( Position = 1 , HelpMessage = "Return As Hashtable" ) ]       [ Switch ] $HashTable   )      #//¯¯\\ 
                                                                                                                           #\\__// 
                                                                                                                           #//¯¯\\ 
            # ____   _________________________       ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
            #//¯¯\\__[_ Declare Common Vars _]______//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
            #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                                                                                                                           #//¯¯\\ 
                $P   = $Profile ; $X = 0..3 | % { If ( $_ -eq $P ) { 1 } Else { 0 } } ; $XML = [ Ordered ]@{ }             #\\__// 
                                                                                                                           #//¯¯\\ 
                $Out | % { $_.Forest , $_.Tree , $_.Child , $_.Clone = @( $X ) }                                           #\\__// 
                                                                                                                           #//¯¯\\ 
                $Type   = @{ 0 = "N/A" ; 1 = "TreeDomain" ; 2 = "ChildDomain" ; 3 = "N/A" }                                #\\__// 
                                                                                                                           #//¯¯\\ 
                $Out.DomainType = $Type[$P]                                                                                #\\__// 
                                                                                                                           #//¯¯\\ 
            # ____   _________________________       ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
            #//¯¯\\__[_______ Header ________]______//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
            #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                                                                                                                           #//¯¯\\ 
                $X      = @( 2 ; 0..4 | % { 13 } ; 10 , 9 , 13 ) | % { $SP[$_] }                                           #\\__// 
                $Y      = "<Window" , "  xmlns = '$Schema/presentation'" , "xmlns:x = '$Schema'" ,                         #//¯¯\\ 
                "  Title = '$Author | Hybrid - Desired State Controller Installation'" , "  $W = '800'" , " $H = '800'" ,  #\\__// 
                "$( $HAL[1] )" , "  WindowStartupLocation = 'CenterScreen'" , "Topmost = 'True' >"                         #//¯¯\\ 
                                                                                                                           #\\__// 
                $XML.Add( "00" , @( 0..8 | % { $X[$_] + $Y[$_] } ) )                                                       #//¯¯\\ 
                                                                                                                           #\\__// 
                                                                                                                           #//¯¯\\ 
            # ____   _________________________       ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
            #//¯¯\\__[_______ Framing _______]______//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
            #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                                                                                                                           #//¯¯\\ 
                $X      = @( 2..4 ; 4 , 3 ) | % { $SP[$_] }                                                                #\\__// 
                $Y      = @( "<$G>" , "<$GRD>" ; '20' , '*' | % { "<$RD $H = '$_' />" } ; "</$GRD>" )                      #//¯¯\\ 
                                                                                                                           #\\__// 
                $XML.Add( "01" , @( 0..4 | % { $X[$_] + $Y[$_] } ) )                                                       #//¯¯\\ 
                                                                                                                           #\\__// 
                                                                                                                           #//¯¯\\ 
            # ____   _________________________       ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
            #//¯¯\\__[________ Menu _________]______//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
            #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                                                                                                                           #//¯¯\\ 
                $Menu   = 'Forest' , 'Tree' , 'Child' , 'Clone'                                                            #\\__// 
                $Action = @( 'Forest¯[_New_Root_]' ; 'Tree' , 'Child' | % { 'Domain¯[_New_$_`_Sub-Domain_]' } ;            #//¯¯\\ 
                          'DomainController¯[_Add_DC_]' ) | % { "Install-ADDS$_" }                                         #\\__// 
                                                                                                                           #//¯¯\\ 
                $X      = @( 3..5 ; 5 , 5 ; 5..3 ) | % { $SP[$_] }                                                         #\\__// 
                $Y      = @( "<$MN $GR = '0' $H = '20' >" , "<$MNI $HD = 'New' >" ;                                        #//¯¯\\ 
                          0..3 | % { "<$MNI $Q = '$( $Menu[$_] )' $HD = '$( $Action[$_] )' />"} ; "</$MNI>" , "</$MN>" )   #\\__// 
                                                                                                                           #//¯¯\\ 
                $XML.Add( "02" , @( 0..7 | % { $X[$_] + $Y[$_] } ) )                                                       #\\__// 
                                                                                                                           #//¯¯\\ 
            # ____   _________________________       ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
            #//¯¯\\__[______ Open Body ______]______//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
            #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                                                                                                                           #//¯¯\\ 
                $X      = 3 , 12 , 13 , 10 , 10 , 13 , 13 | % { $SP[$_] }                                                  #\\__// 
                $Y      = "<$GB" , "   $GR = '1'" , " $HD = '[ Hybrid-DSC Domain Service Configuration ]'" ,               #//¯¯\\ 
                          "$( $HAL[1] )" , "  $( $VAL[1] )" , "  $W = '760'" , " $H = '740' >"                             #\\__// 
                                                                                                                           #//¯¯\\ 
                $XML.Add( "03" , @( 0..6 | % { $X[$_] + $Y[$_] } ) )                                                       #\\__// 
                                                                                                                           #//¯¯\\ 
            # ____   _________________________       ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
            #//¯¯\\__[_______ Framing _______]______//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
            #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                                                                                                                           #//¯¯\\ 
                $X      = @( 4..7 ; 7 , 6 ; 6..8 ; 8 , 7 ) | % { $SP[$_] }                                                 #\\__// 
                $Y      = @( "<$G>" , "<$G $GR = '1' $MA = '10' >" , "<$GRD>" ; '' , '10' | % { "<$RD $H = '$_*' />" } ;   #//¯¯\\ 
                           "</$GRD>" , "<$G $GR = '0' >" , "<$GCD>" ; 0..1 | % { "<$CD $W = '*' />" } ; "</$GCD>" )        #\\__// 
                                                                                                                           #//¯¯\\ 
                $XML.Add( "04" , @( 0..10 | % { $X[$_] + $Y[$_] } ) )                                                      #\\__// 
                                                                                                                           #//¯¯\\ 
            # ____   _________________________       ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
            #//¯¯\\__[_____ Domain Mode _____]______//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
            #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                                                                                                                           #//¯¯\\ 
                $LI , $ED = @( ) , @( "00" , "03" ; @( "08" , 12 | % { $_ , "$_ R2" } ) ; 16 , 19 )                        #\\__// 
                $R2       = $( If ( $CS -like "*R2*" ) { 1 } Else { 0 } )                                                  #//¯¯\\ 
                                                                                                                           #\\__// 
                0..7 | % { $I , $J = $ED[$_] , "False"                                                                     #//¯¯\\ 
                           If ( $CS -like "*$I*" ) { If ( $R2 -eq 1 -and $_ -in    3,5 ) { $J = "True" }                   #\\__// 
                                                     If ( $R2 -eq 0 -and $_ -notin 3,5 ) { $J = "True" } }                 #//¯¯\\ 
                    $LI += "<$CBI $CO = 'Windows Server 20$I' IsSelected = '$J' />"                                        #\\__// 
                }                                                                                                          #//¯¯\\ 
                                                                                                                           #\\__// 
                $LI[0] = $LI[0].Replace( "2000" ,"2000 ( Default )" )                                                      #//¯¯\\ 
                                                                                                                           #\\__// 
                0..1 | % { $J = ( "Forest" , "Domain" )[$_]                                                                #//¯¯\\ 
                    $X = @( 7 , 8 ; 0..7 | % { 9 } ; 8 , 7 ) | % { $SP[$_] }                                               #\\__// 
                    $Y = @( "<$GB $HD = '$J Mode' $GC = '$_' $MA = '5' >" , "<$CB $Q = '$J`Mode' $H = '24' $SI = '0' >" ;  #//¯¯\\ 
                         @( $LI ) ; "</$CB>" , "</$GB>" )                                                                  #\\__// 
                    $Z = 0..11 | % { $X[$_] + $Y[$_] }                                                                     #//¯¯\\ 
                    If ( $_ -eq 0 ) { $ForID = $Z } Else { $DomID = $Z } }                                                 #\\__// 
                                                                                                                           #//¯¯\\ 
                $ParID = "Parent" | % {                                                                                    #\\__// 
                           $X = @( 6 , 7 , 6 ) | % { $SP[$_] } ;                                                           #//¯¯\\ 
                           $Y = "<$GB $HD = '$_ Domain' $GC = '0' $MA = '5' >" ,                                           #\\__// 
                           "<$TB $Q = '$_`DomainName' Text = '&lt;Domain Name&gt;' $H = '20' $MA = '5' />" , "</$GB>"      #//¯¯\\ 
                    Return 0..2 | % { $X[$_] + $Y[$_] } }                                                                  #\\__// 
                                                                                                                           #//¯¯\\ 
                $Neither = $SP[6] + "<$GB $HD = 'Clone Domain Controller' $MA = '5' $GCS = '2' />"                         #\\__// 
                                                                                                                           #//¯¯\\ 
                $Top = @{ 0 = @( $ForID ; $DomID ) ; 1 = @( $ParID ; $DomID ) ; 2 = @( $ParID ; $DomID ) ; 3 = $Neither }  #\\__// 
                                                                                                                           #//¯¯\\ 
                If ( $P -eq   0 ) { $Out | % { $_.ParentDomainName , $_.Credential = 0..1 | % { "N/A" } } }                #\\__// 
                If ( $P -in 1,2 ) { $Out.ForestMode = "N/A" }                                                              #//¯¯\\ 
                If ( $P -eq   3 ) { $Out | % { $_.ForestMode , $_.DomainMode , $_.ParentDomainName = 0..2 | % { "N/A" } } }#\\__// 
                                                                                                                           #//¯¯\\ 
                $XML.Add( "05" , @( $Top[$P] ) )                                                                           #\\__// 
                                                                                                                           #//¯¯\\ 
            # ____   _________________________       ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
            #//¯¯\\__[_______ Framing _______]______//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
            #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                                                                                                                           #//¯¯\\ 
                $X  = @( 6 , 6 , 7 , 8 , 8 , 7 , 7 , 8 , 8 , 7 ) | % { $SP[$_] }                                           #\\__// 
                                                                                                                           #//¯¯\\ 
                $Y  = @( "</$G>" , "<$G $GR = '1' >" , "<$GCD>" ; '' , '2.5' | % { "<$CD $W = '$_*' />" } ;"</$GCD>" ,     #\\__// 
                         "<$GRD>" ; '3.5' , '' | % { "<$RD $H = '$_*' />" } ; "</$GRD>" )                                  #//¯¯\\ 
                                                                                                                           #\\__// 
                $XML.Add( "06" , @( 0..9 | % { $X[$_] + $Y[$_] } ) )                                                       #//¯¯\\ 
                                                                                                                           #\\__// 
                                                                                                                           #//¯¯\\ 
            # ____   _________________________       ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
            #//¯¯\\__[__ Services Selection _]______//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
            #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                                                                                                                           #//¯¯\\ 
                $SVC = 0..( $FT.Count - 1 ) | % {                                                                          #\\__// 
                    $X0 = $FT[$_].Split( ' ' )[0] ; $X1 = $X0.Replace( '-' , '_' ) ; $X2 = $Out.$X1                        #//¯¯\\ 
                    "<$TBL $GC = '0' $GR = '$_' $MA = '5' TextAlignment = 'Right' >$X0`:</$TBL>" ,                         #\\__// 
                    "<$CHK $GC = '1' $GR = '$_' $MA = '5' $Q = '$X1' IsEnabled = '$X2' IsChecked = 'True' />" }            #//¯¯\\ 
                                                                                                                           #\\__// 
                $X = @( 6..9 ; 9 , 8 , 8 ; 0..16 | % { 9 } ; 0..34 | % { 8 } ; 7 , 6 ) | % { $SP[$_] }                     #//¯¯\\ 
                                                                                                                           #\\__// 
                $Y = @( "<$GB $HD = 'Service Options' $GR = '0' $GC = '0' $MA = '5' >" ,                                   #//¯¯\\ 
                "<$G $GR = '0' $GC = '0' >" , "<$GCD>" ; '5' , '' | % { "<$CD $W = '$_*' />" } ; "</$GCD>" ,               #\\__// 
                "<$GRD>" ; 0..16 | % { "<$RD $H =  '*' />" } ; "</$GRD>" ; @( $SVC ) ; "</$G>" , "</$GB>" )                #//¯¯\\ 
                                                                                                                           #\\__// 
                $XML.Add( "07" , @( 0..60 | % { $X[$_] + $Y[$_] } ) )                                                      #//¯¯\\ 
                                                                                                                           #\\__// 
                                                                                                                           #//¯¯\\ 
            # ____   _________________________       ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
            #//¯¯\\__[_______ Framing _______]______//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
            #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                                                                                                                           #//¯¯\\ 
                $X = @( 6..8 ; 8 , 8 , 7 ) | % { $SP[$_] }                                                                 #\\__// 
                $Y = @( "<$G $GR = '0' $GC = '1'>" , "<$GRD>" ; '','.65','2'| % { "<$RD $H = '$_*' />" } ; "</$GRD>" )     #//¯¯\\ 
                                                                                                                           #\\__// 
                $XML.Add( "08" , @( 0..5 | % { $X[$_] + $Y[$_] } ) )                                                       #//¯¯\\ 
                                                                                                                           #\\__// 
                                                                                                                           #//¯¯\\ 
            # ____   _________________________       ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
            #//¯¯\\__[___ Paths Section _____]______//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
            #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                                                                                                                           #//¯¯\\ 
                $Paths = ( 'Database' , 0 ) , ( 'Sysvol' , 1 ) , ( 'Log' , 2 ) | % {                                       #\\__// 
                                                                                                                           #//¯¯\\ 
                    "<$LA $GR = '$($_[1])' $GC = '0' $($HAL[2]) $($VAL[1]) $CO = '$($_[0])' />" ,                          #\\__// 
                    "<$TB $GR = '$($_[1])' $GC = '1' $H = '20' $MA = '5' $Q = '$($_[0])Path' />"                           #//¯¯\\ 
                }                                                                                                          #\\__// 
                                                                                                                           #//¯¯\\ 
                $X = @( 7..10 ; 10 , 9 , 9 , 10 , 10 , 10 ; 0..6 | % { 9 } ; 8 , 7 ) | % { $SP[$_] }                       #\\__// 
                $Y = @( "<$GB $GR = '0' $HD = 'Paths' $MA = '5' >" , "<$G>" , "<$GCD>" ;                                   #//¯¯\\ 
                        '','2' | % { "<$CD $W = '$_*' />" } ; "</$GCD>" , "<$GRD>" ;                                       #\\__// 
                         0..2  | % { "<$RD $H = '*' />" } ; "</$GRD>" ; @( $Paths ) ; "</$G>" , "</$GB>" )                 #//¯¯\\ 
                                                                                                                           #\\__// 
                $XML.Add( "09" , @( 0..18 | % { $X[$_] + $Y[$_] } ) )                                                      #//¯¯\\ 
                                                                                                                           #\\__// 
                                                                                                                           #//¯¯\\ 
            # ____   _________________________       ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
            #//¯¯\\__[____ Credentials ______]______//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
            #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                                                                                                                           #//¯¯\\ 
                $Cred  = @{ 0 = 0 ; 1 = 1 ; 2 = 1 ; 3 = 1 }                                                                #\\__// 
                $Login = "Visibility = '$( If ( $Cred[$P] -eq 0 ) { 'Collapsed' } Else { 'Visible' } )'"                   #//¯¯\\ 
                                                                                                                           #\\__// 
                $X = @( 7..10 ; 10 , 9 , 9 , 9 , 8 , 7 ) | % { $SP[$_] }                                                   #//¯¯\\ 
                $Y = @( "<$GB $Q = 'DCCred' $GR = '1' $HD = 'Credentials' $MA = '5' $Login >" , "<$G>" , "<$GCD>" ;        #\\__// 
                '' , '2' | % { "<$CD $W = '*' />" } ; "</$GCD>" , "<$TB $Q = 'Admin' $GC = '1' $H = '20' $MA = '10' />",   #//¯¯\\ 
                "<$BU $Q = 'Enter' $GC = '0' $CO = 'Update' $($HAL[1]) $($VAL[1]) $MA = '10' $W = '60' $H = '20'/>" ,      #\\__// 
                "</$G>" , "</$GB>" )                                                                                       #//¯¯\\ 
                                                                                                                           #\\__// 
                $XML.Add( "10" , @( 0..9 | % { $X[$_] + $Y[$_] } ) )                                                       #//¯¯\\ 
                                                                                                                           #\\__// 
                                                                                                                           #//¯¯\\ 
            # ____   ___________________________     ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
            #//¯¯\\__[_ DomainName Info/Etc. __]____//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
            #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                                                                                                                           #//¯¯\\ 
                $DomIn   = @( "Domain" | % { $_ , "New$_" } | % { $_ , "$_`NetBIOS" } ; "Site" ) | % { "$_`Name" }         #\\__// 
                $DomIn  += "ReplicationSourceDC"                                                                           #//¯¯\\ 
                $DomFl   = @{ 0 = 1,1,0,0,1,0 ; 1 = 0,0,1,1,1,0 ; 2 = 0,0,1,1,1,0 ; 3 = 1,0,0,0,1,1 }                      #\\__// 
                                                                                                                           #//¯¯\\ 
                $Coll_   = "Collapsed" , "Visible" | % { "Visibility = '$_" }                                              #\\__// 
                                                                                                                           #//¯¯\\ 
                $DomIX = 0..5 | % { $J = "$( $DomIn[$_] )' $( $Coll_[$DomFL[$P]][$_] )"                                    #\\__// 
                    "<$LA $GR = '$_' $GC = '0' $( $HAL[2] ) $( $VAL[1] ) $CO = '$J' />" ,                                  #//¯¯\\ 
                    "<$TB $GR = '$_' $GC = '1' $H = '20' $MA = '5' $Q = '$J' />"                                           #\\__// 
                }                                                                                                          #//¯¯\\ 
                                                                                                                           #\\__// 
                $X = @( 7..10 ; 10 , 9 , 9 ; 0..5 | % { 10 } ; 0..12 | % { 9 } ; 8..6 ) | % { $SP[$_] }                    #//¯¯\\ 
                $Y = @( "<$GB $GR = '2' $HD = 'Domain Options' $MA = '5' >" , "<$G>" , "<$GCD>" ; '' , '2' | % {           #\\__// 
                "<$CD $W = '$_*' />" } ; "</$GCD>" , "<$GRD>" ; 0..5 | % { "<$RD $H = '*' />" } ;"</$GRD>" ;               #//¯¯\\ 
                @( $DomIX ) ; "</$G>" , "</$GB>" , "</$G>" )                                                               #\\__// 
                                                                                                                           #//¯¯\\ 
                $XML.Add( "11" , @( 0..28 | % { $X[$_] + $Y[$_] } ) )                                                      #\\__// 
                                                                                                                           #//¯¯\\ 
            # ____   ___________________________     ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
            #//¯¯\\__[___ Role Designations ___]____//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
            #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                                                                                                                           #//¯¯\\ 
                $RoleCN = "Install DNS" , "Create DNS Delegation" , "No Global Catalog" , "Critical Replication Only"      #\\__// 
                $RoleID = $RoleCN | % { $_.Replace( " " , "" ) }                                                           #//¯¯\\ 
                $RoleSw = @{ 0 = 1 , 1 , 0 , 0 ; 1 = 1 , 1 , 1 , 0 ; 2 = 1 , 1 , 1 , 0 ; 3 = 1 , 1 , 1 , 1 }               #\\__// 
                $RoleFL = @{ 0 = 1 , 0 , 0 , 0 ; 1 = 1 , 0 , 0 , 0 ; 2 = 1 , 0 , 0 , 1 ; 3 = 1 , 0 , 0 , 0 }               #//¯¯\\ 
                                                                                                                           #\\__// 
                $RX = $RoleSW[1] | % { $B[$_] } ; $RY = $RoleFL[1] | % { $B[$_] }                                          #//¯¯\\ 
                If ( $FT[2] -like "*[X]*" ) { $RX[0] , $RY[0] = $B[0..1] }                                                 #\\__// 
                                                                                                                           #//¯¯\\ 
                $Roles = 0..3 | % { $X0 , $X1 , $X2 , $X3 = $RX[$_] , $RY[$_] , $RoleCN[$_] , $RoleID[$_]                  #\\__// 
                    "<$TBL $GR = '$_' TextAlignment = 'Right' $MA = '5' IsEnabled = '$X0' >$X2`:</$TBL>" ,                 #//¯¯\\ 
                    "<$CHK $Q = '$X3' $GR = '$_' $GC = '1' $MA = '5' IsEnabled = '$X0' IsChecked = '$X1' />" }             #\\__// 
                                                                                                                           #//¯¯\\ 
                $X = @( 6..9 ; 9 , 9 , 9 , 8 , 8 , 9 , 9 ; 0..8 | % { 8 } ; 7 , 6 ) | % { $SP[$_] }                        #\\__// 
                $Y = @( "<$GB $GR = '1' $HD = 'Role Designation' $MA = '5' >" , "<$G>" , "<$GRD>" ;                        #//¯¯\\ 
                      0..3 | % { "<$RD $H = '*' />" } ; "</$GRD>" , "<$GCD>" ; '5' , '' | % { "<$CD $W = '$_*' />" } ;     #\\__// 
                        "</$GCD>" ; @( $Roles ) ; "</$G>" , "</$GB>" )                                                     #//¯¯\\ 
                                                                                                                           #\\__// 
                $XML.Add( "12" , @( 0..21 | % { $X[$_] + $Y[$_] } ) )                                                      #//¯¯\\ 
                                                                                                                           #\\__// 
                                                                                                                           #//¯¯\\ 
            # ____   ___________________________     ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
            #//¯¯\\__[__ DSRM/Initialization __]____//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
            #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                                                                                                                           #//¯¯\\ 
                $CF,$OK,$CA = "Confirm","Start","Cancel" ; $PW,$PWB,$PWC = "Password" | % { $_,"$_`Box","$_`Char" }        #\\__// 
                                                                                                                           #//¯¯\\ 
                $X = @( 6..9 ; 9 , 8 , 8 , 9 , 9 , 8 , 8 , 9 , 8 , 8 , 9 , 8 , 8 ; 8..6 ) | % { $SP[$_] }                  #\\__// 
                $Y = @( "<$GB $GR = '1' $GC = '1' $HD = 'Initialization' $MA = '5' >" , "<$G>" , "<$GRD>" ;                #//¯¯\\ 
                0..1 | % { "<$RD $H = '*' />" } ; "</$GRD>" , "<$GCD>" ; 0..1 | % { "<$CD $W = '*' />" } ; "</$GCD>" )     #\\__// 
                $C = 0 ; $Y += $PW , $CF | % { "<$GB $GR = '0' $GC = '$C' $HD = 'DSRM $_' >",                              #//¯¯\\ 
                "<$PWB $Q = '$_' $H = '20' $MA = '5' $PWC = '*' />" , "</$GB>" ; [ Void ]$C ++ }                           #\\__// 
                $C = 0 ; $Y += $OK , $CA | % { "<$BU $Q = '$_' $GR = '1' $GC = '$C' $CO = '$_' $MA = '5'",                 #//¯¯\\ 
                " $W = '100' $H = '20' />" -join '' ; [ Void ]$C ++ } ; $Y += "</$G>" , "</$GB>"                           #\\__// 
                                                                                                                           #//¯¯\\ 
                $XML.Add( "13" , @( 0..19 | % { $X[$_] + $Y[$_] } ) )                                                      #\\__// 
                                                                                                                           #//¯¯\\ 
            # ____   ___________________________     ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
            #//¯¯\\__[_______ Framing _________]____//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
            #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                                                                                                                           #//¯¯\\ 
                $X = @( 5..0 ) | % { $SP[$_] }                                                                             #\\__// 
                $Y = @( "</$G>" , "</$G>" , "</$G>" , "</$GB>" , "</$G>" , "</Window>" )                                   #//¯¯\\ 
                                                                                                                           #\\__// 
                $XML.Add( "14" , @( 0..5 | % { $X[$_] + $Y[$_] } ) )                                                       #//¯¯\\ 
                                                                                                                           #\\__// 
                                                                                                                           #//¯¯\\ 
            # ____   ___________________________     ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
            #//¯¯\\__[_____ Return XAML _______]____//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
            #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                                                                                                                           #//¯¯\\ 
                If ( $Debug ) { $Return = $XML }                                                                           #\\__// 
                Else { $Return = @( )                                                                                      #//¯¯\\ 
                ForEach ( $i in 0..14 ) { 0..( $XML[$I].Count - 1 ) | % { $Return += $XML[$I][$_] } } }                    #\\__// 
                Return $Return                                                                                             #//¯¯\\ 
            }                                                                                                              #\\__// 
                                                                                                                           #//¯¯\\ 
            # ____   _________________________       ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
            #//¯¯\\__[___ Parts Done Bro ____]______//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
            #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                                                                                                                            #¯¯¯¯  
    
            $Out           = Initialize-DCPromoControl                                         # Control Template
            $NamedElements = $Out | GM | ? Membertype -eq NoteProperty | % { $_.Name }         # Named Elements
            $Launch        = Show-DCPromoGUI -Profile 0                                        # XAML Collection
    
            If ( $Launch.Count -gt 1 ) { $Launch = Convert-ArrayToHereString -Input $Launch }

            $GUI           = Convert-XAMLtoWindow -Xaml $Launch -NE $NamedElements -PassThru
            $Status        = "[_]" , 1 ; $Toggle = $Out , $GUI

            # Services Filter

            $Items = $( $NamedElements[  ( $Out | % { If (            $_.Forest -eq 1 ) { 4,5,12,19,20,21,23,24 } 
                                                      If ( $_.Tree -or $_.Child -eq 1 ) { 5,10,11,15,24         }
                                                      If (             $_.Clone -eq 1 ) { 9,11,12,15,19,20,23   } } ) ] )

            ForEach ( $i in 0..1 ) { $Items | % { $Toggle[$I].$( $_ ) = $Status[$I] } }

            $Active = @( )
            $GFL    = Get-FeatureList | % { $_.Replace( '-' , '_' ) }

            If ( ( $Out.Forest -ne 1 ) -and ( $GUI.Forest.IsPressed ) )
            {            
                ForEach ( $F in 0..( $GFL.Count - 1 ) )
                {
                    $GUI.$( $GFL[$F] ) | ? { $_.IsEnabled } | % { $Active += $_.Name }
                }
            }
        
        $Active | % { $GUI.$_.Add_Checked( { $Out.$_ = $B[0] } ) ; $GUI.$_.Add_UnChecked( { $Out.$_ = $B[1] } ) }

        $Roles = $NamedElements[3,5,17,21]
        $RoleZ = @( )


        ForEach ( $I in                         @( "InstallDNS" , "CreateDNSDelegation" , "NoGlobalCatalog" , "CriticalReplicationOnly" ) | Sort )
            {
                0..( $NamedElements.Count - 1 ) | ? { $I -eq $NamedElements[$_] } | % { Echo "[$_] $( $NamedElements[$_] )" }
            }

        ForEach ( $F in 0..( $Roles.Count - 1 ) )
        {
            $GUI.$( $Roles[$F] ) | ? { $_.IsEnabled } | % { $RoleZ += $_.Name }
        }

        If ( $Out.DNS -eq $False ) { $GUI.InstallDns.IsEnabled = $False }

        $GUI.Install_DNS  | % { $_.Add_Checked( { $Out.InstallDns              = $True  } ) ; $_.Add_UnChecked( { $Out.InstallDns              = $False } ) }
        $GUI.Delegate_DNS | % { $_.Add_Checked( { $Out.CreateDnsDelegation     = $True  } ) ; $_.Add_UnChecked( { $Out.CreateDnsDelegation     = $False } ) }
        $GUI.Install_GC   | % { $_.Add_Checked( { $Out.NoGlobalCatalog         = $False } ) ; $_.Add_UnChecked( { $Out.NoGlobalCatalog         = $True  } ) }
        $GUI.Install_CR   | % { $_.Add_Checked( { $Out.CriticalReplicationOnly = $True  } ) ; $_.Add_UnChecked( { $Out.CriticalReplicationOnly = $False } ) }

    #  ____                                                                        ____    ____    ____    ____    ____  
    # //¯¯\\______________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
    # \\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
    #  ¯¯¯\\__[ Controls/Functions ]______________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    #      ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯       

        $GUI.Process.Add_SelectionChanged({ ProcessSelection })

        $GUI.DCEntry.Add_Click({
            
            If ( $Report -ne $Null ) 
            { 
                $Report | % { 
                    
                    $ServiceAccount = @{ DC = $_.NetBIOS.Host ; Domain = $_.DNS ; NetBIOS = $_.NetBIOS.Name } 
                } 
            }

            Else
            { 
                $ServiceAccount = @{ DC = $DC ; Domain = $Domain ; NetBIOS = $NetBIOS } 
            }

            $DCCred             = @( Enter-ServiceAccount @ServiceAccount )
            $GUI.DCAdmin.Text   = $DCCred.Username
        
        })

        $GUI.Forest.Add_Click( { If ( $Out.Forest -ne 1 ) { $GUI.DialogResult = $False | Out-Null ; 

        $GUI.Cancel.Add_Click( { $GUI.DialogResult = $False } )

        $GUI.Ok.Add_Click({
                
                If ( $Process -eq 0 )
                {
                    "DomainName" ,
                    "DomainNetBIOSName" ,
                    "SiteName"

                If ( $Process -eq 1 )
                { 
                    If ( $GUI.Branch.Text -like "*$Domain*" )
                    {
                        [ System.Windows.MessageBox ]::Show( "Entry is too similar to main domain" , "Similar Domain Name Error" )
                    }

                    If ( $GUI.Branch.Text -like "*$NetBIOS*" )
                    {
                        [ System.Windows.MessageBox ]::Show( "Entry is too similar to main domain" , "Similar NetBIOS Name Error" )

                    }

                    Else
                    {
                        #$Out.DomainType          = "TreeDomain"
                        "DomainType"              = "TreeDomain"
                        "NewDomainName"           = "sideways.com"
                        "NewDomainNetBIOS"        = "SIDEWAYS"
                        "SiteName"		          = "Default-First-Site-Name"
                        $Out.DomainName           = ""
                        $Out.DomainNetBIOSName    = $GUI.NetBIOS
                        $Out.NewDomainName        = $GUI.Branch
                        $Out.NewDomainNetBIOSName = ""
                        $Out.ParentDomainName     = $GUI.Domain
                    }
                }

                If ( $Process -eq 2 )
                {
                    If ( $GUI.Branch.Text -like "" )
                    {
                        
                    }
                }

            ElseIf ( $GUI.DSRM_PW.Password -eq       $Null )                 { IEX $MSG[1] }
            ElseIf ( $GUI.DSRM_CF.Password -eq       $Null )                 { IEX $MSG[2] }
            ElseIf ( $GUI.DSRM_PW.Password -eq       $Null )                 { IEX $MSG[1] }
            ElseIf ( $GUI.DSRM_CF.Password -eq       $Null )                 { IEX $MSG[2] }
            ElseIf ( $GUI.DSRM_PW.Password -notmatch $GUI.DSRM_CF.Password ) { IEX $MSG[2] }
            Else { $GUI.DialogResult = $True }
        })


        $GUI.Process.SelectedIndex = 0 ; $Process                   = 0 ; $GUI.Branch.IsEnabled      = $False

        $GUI.DCAdmin  | % { $_.Text = $( If ( $DCCred.UserName -ne $Null ) { $DCCred.UserName } Else { "" } ) }
        $GUI.Database | % { $_.Text = "C:\Windows\NTDS"   }
        $GUI.Sysvol   | % { $_.Text = "C:\Windows\SYSVOL" }
        $GUI.Log      | % { $_.Text = "C:\Windows\SYSVOL" }
        $GUI.SiteName | % { $_.Text = $( If ( $Sitelink ) { $Sitelink } Else { "Default-First-Site-Name" } ) }
        $GUI.Domain   | % { $_.Text = $( If ( $Domain   ) { $Domain   } Else {   "Enter new Domain Name" } ) }
        $GUI.NetBIOS  | % { $_.Text = $( If ( $NetBIOS  ) { $NetBIOS  } Else {  "Enter new NetBIOS Name" } ) }

        $Null = $GUI.DSRM_PW.Focus()

        $OP   = Show-WPFWindow -GUI $GUI


        If ( $OP -eq $True )
        {
             Echo $Combo

             $Out.SafeModeAdministratorPassword  = $GUI.DSRM_PW.SecurePassword
             $Out.ForestMode                     = $GUI.ForestMode.SelectedIndex + 1
             $Out.DomainMode                     = $GUI.DomainMode.SelectedIndex + 1
        If ( $Out.ForestMode -in 7..8 ) {          $Out.ForestMode = 7 }
        If ( $Out.DomainMode -in 7..8 ) {          $Out.DomainMode = 7 }
             $Out.Credential                     = $DCCred
             $Out.DatabasePath                   = $GUI.Database.Text
             $Out.SysvolPath                     = $GUI.Sysvol.Text 
             $Out.LogPath                        = $GUI.Log.Text
             $Out.SiteName                       = $GUI.SiteName.Text
             $Out.DomainName                     = $GUI.Domain.Text
             $Out.DomainNetBIOSName              = $GUI.NetBIOS.Text

             $Out | GM | ? { $_.MemberType -eq "NoteProperty" } | Select Name

             Echo $Out
             Read-Host "Correct?"
        }

        Else { Write-Theme -Action "[!] Exception" "Either the user cancelled, or the dialogue failed" }
        
    }
             $Names = $Out | GM | ? { $_.MemberType -eq "NoteProperty" } | % { $_.Name }

             #11,0,2,3,5,9,10,12,14,15,7,1 # Domain Controller

             $Out | Select SafeModeAdministratorPassword , CreateDNSDelegation , DatabasePath , DomainMode , DomainName , DomainNetBIOSName , ForestMode , InstallDNS , LogPath , NoRebootOnCompletion , SysvolPath , Force

             # ADDS New Forest / 13,0,3,4,5,6,8,9,10,12,15,7  # Forest

             $AD = @{   SafeModeAdministratorPassword = $Out.SafeModeAdministratorPassword
                                  CreateDnsDelegation = $Out.InstallDns
                                         DatabasePath = $Out.DatabasePath 
                                           DomainMode = $Out.DomainMode
                                           DomainName = $Out.DomainName
                                    DomainNetBIOSName = $Out.DomainNetBIOSName
                                           ForestMode = $Out.ForestMode
                                           InstallDns = $Out.InstallDNS
                                              LogPath = $Out.LogPath
                                 NoRebootOnCompletion = $Out.NoRebootUponCompletion
                                           SysvolPath = $Out.SysvolPath
                                                Force = $Out.Force
                    }

            $ADND = @{  
                        SafeModeAdministratorPassword = $Out.SafeModeAdministratorPassword
                                  CreateDNSDelegation = $Out.CreateDnsDelegation
                                         DatabasePath = $Out.DatabasePath
                                           DomainMode = $Out.DomainMode
                                           DomainName = $Out.DomainName
                                    DomainNetBIOSName = $Out.DomainNetBIOSName 
                                    
                     }

        #$ADDS = @( 'SkipPreChecks' , 'NewDomainName' , 'ParentDomainName' , 'SafeModeAdministratorPassword', 'ADPrepCredential' , 'AllowDomainReinstall' , 'CreateDnsDelegation'
        #'Credential' , 'DatabasePath' , 'DnsDelegationCredential' , 'NoDnsOnNetwork' , 'DomainMode' , 'DomainType' , 'NoGlobalCatalog' , 'InstallDns' , 'LogPath' ,
        #'NewDomainNetbiosName' , 'NoRebootOnCompletion' , 'ReplicationSourceDC' , 'SiteName' , 'SkipAutoConfigureDns' , 'SysvolPath' , 'Force' )

            # 11 , 0 , 2 , 3 , 5 , 9 , 10 , 12 , 14 , 15 , 7 , 1

            $ADDSC = @{               NoGlobalCatalog = $False 
                                  CreateDnsDelegation = $False 
                              CriticalReplicationOnly = $False 
                                         DatabasePath = “C:\Windows\NTDS”
                                           DomainName = $GUI.DomainName.Text 
                                           InstallDns = $True 
                                              LogPath = “C:\Windows\NTDS” 
                                 NoRebootOnCompletion = $False
                                             SiteName = $GUI.NetBIOS.Text
                                           SysvolPath = “C:\Windows\SYSVOL” 
                                                Force = $True 
                                           Credential = $Cred }

        }
