# ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____  
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\   ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯   //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//  [ Secure Digits Plus LLC | Hybrid | Desired State Controller ]  \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯       _____________________________________________________        ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯        __/¯¯\__[ Dynamically Engineered Digital Security ]__/¯¯\__         ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\  _________________________ ________________ ___________________________________  //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯\\__//¯¯\\__//¯¯\\__// | Application Development | Virtualization | Network and Hardware Magistration | \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\  ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯  //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//   https://www.securedigitsplus.com | Server-Client | Seedling-Spawning Script    \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\___¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯   ¯¯¯¯¯¯¯¯¯¯¯¯¯   ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ___//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\   [ Provisional Author : Michael C Cook Sr. | "The Buck Stops Here" ]    //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
#//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//   ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__/====\__/----\__/====\__/----\__/====\__/----\__/====\__/----\__/====\__/----\__/====\__/----\__/====\__/----\__/====\__/----\__/====\__/----\__// 
#//¯¯¯    
#\\  [ Provision-DomainController ] @: Orchestrates the process of provisioning server prerequisites in order to install Hybrid-DSC                     
#//   ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____      
#\\__/----\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//==\\___  
#//¯¯\\¯¯ ¯¯¯¯ -- ¯¯¯¯ ¯¯ ¯¯¯¯ -- ¯¯¯¯ ¯¯ ¯¯¯¯ -- ¯¯¯¯ ¯¯ ¯¯¯¯ -- ¯¯¯¯ ¯¯ ¯¯¯¯ -- ¯¯¯¯ ¯¯ ¯¯¯¯ -- ¯¯¯¯ ¯¯ ¯¯¯¯ -- ¯¯¯¯ ¯¯ ¯¯¯¯ -- ¯¯¯¯ ¯¯ ¯¯¯¯ -- ¯¯¯\\ 
#\\__//                                                                                   ____ __ ____ -- ____ __ ____ -- ____ __ ____ -- ____ __ ___// 
# ¯¯¯¯   [ Declare Namespaces & Load Modules ]                                        ___//¯¯\----/¯¯\\==//¯¯\----/¯¯\\==//¯¯\----/¯¯\\==//¯¯\----/¯¯¯  
     #]______________________________________________________________________________/¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯      
       
    "Security.Principal" , "Management.Automation" , "DirectoryServices" | % { IEX "Using Namespace System.$_" } 

    #Using Namespace System.Security.Principal
    #Using Namespace System.Management.Automation
    #Using Namespace System.DirectoryServices
    
    $ENV:PSModulePath.Split( ';' ) | % { GCI $_ -Recurse "Hybrid-DSC.psm1" } | % {
        
        IPMO $_.FullName
        
        If ( $? -ne $True ) { Write-Error "Module Not Loaded/Found" ; Read-Host "Press Enter to Exit" ; Exit }
        
        Sleep 1
                                                                                     #____ -- ____    ____ -- ____    ____ -- ____    ____ -- ____      
}#____                                                                             __//¯¯\\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//¯¯\\___  
#//¯¯\\___________________________________________________________________________/¯¯¯    ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯        ____    ____ __ ____ __ ____ __ ____ __ ____ __ ____    ___// 
    Function Get-FeatureList # Collects all server features that pertain to DSC       ___//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    {#]______________________________________________________________________________/¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯      
        
        [ CmdLetBinding () ] Param ( [ Parameter ( Position = 0 ) ] [ Switch ] $Underscore )
                        
        $Return = @( "AD-Domain-Services" , "DHCP" , "DNS" , "GPMC" ; @( "" ; "-AdminCenter" , "-PowerShell" , "-Tools" | % { "-AD$_" } ; 
        "" , "-Tools" | % { "-ADDS$_" } ; "-DHCP" , "-DNS-Server" , "-Role-Tools" ) | % { "RSAT$_" } ;
        "" , "-AdminPack" , "-Deployment" , "-Transport"  | % { "WDS$_" } )

        If ( $Underscore ) { $Return = $Return.Replace( '-' , '_' ) }

        Return $Return
                                                                                     #____ -- ____    ____ -- ____    ____ -- ____    ____ -- ____      
}#____                                                                             __//¯¯\\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//¯¯\\___  
#//¯¯\\___________________________________________________________________________/¯¯¯    ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯        ____    ____ __ ____ __ ____ __ ____ __ ____ __ ____    ___// 
    Function Collect-FeaturesState # Determines Installation Loadout                  ___//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    {#]______________________________________________________________________________/¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯      

        [ CmdLetBinding () ] Param ( [ Parameter () ][ Switch ] $All )

        $Services = Get-FeatureList ; $GWF = Get-WindowsFeature ; $Array = @( ) ; $Table = [ Ordered ]@{ Installed = @( ) ; Available = @( ) }

        ForEach ( $I in $Services ) { $X = $GWF | ? { $_.Name -eq $I } | % { 
            If ( $_.InstallState -ne "Installed" ) { $Array += "$I [_]" ; $Table.Available += "$I [_]" }
            If ( $_.InstallState -eq "Installed" ) { $Array += "$I [X]" ; $Table.Installed += "$I [X]" } } }

        Return $( If ( !$All ) { $Table } If ( $All ) { $Array } )
                                                                                     #____ -- ____    ____ -- ____    ____ -- ____    ____ -- ____      
}#____                                                                             __//¯¯\\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//¯¯\\___  
#//¯¯\\___________________________________________________________________________/¯¯¯    ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯        ____    ____ __ ____ __ ____ __ ____    ____    ____    ___// 
    Function Enter-ServiceAccount # Allows entry / use of an AD service account       ___//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    {#]______________________________________________________________________________//¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯  #//¯¯\\__//¯¯\\__//¯¯\\ 
        [ CmdLetBinding () ] Param (                                                                                        #\\__//¯¯\\__//¯¯\\__//  
                                                                                                                            #//¯¯\\__//¯¯\\__//¯¯\\ 
            [ Parameter ( Position = 0 , ValueFromPipeline = $True ) ] [ String ] $DC      ,                                #\\__//¯¯\\__//¯¯\\__//  
            [ Parameter ( Position = 1 , ValueFromPipeline = $True ) ] [ String ] $Domain  )                                #//¯¯\\__//¯¯\\__//¯¯¯
            #[ Parameter ( Position = 2 , ValueFromPipeline = $True ) ] [ String ] $NetBIOS )                               #\\__//¯¯\\__//¯¯\\
                                                                                                                            #//¯¯\\__//¯¯\\__// 
        $Schema = "http://schemas.microsoft.com/winfx/2006/xaml"                                                            #\\__//¯¯\\__//¯¯¯
        $Author = "Secure Digits Plus LLC"                                                                                  #//¯¯\\__//¯¯\\
                                                                                                                            #\\__//¯¯\\__// 
        $CF ,  $OK ,  $CA = "Confirm" , "Start" , "Cancel"                                                                  #//¯¯\\__//¯¯¯
        $PW , $PWB , $PWC = "Password" | % { "$_" , "$_`Box" , "$_`Char" }                                                  #\\__//¯¯¯ 
                                                                                                                            #//¯¯\\ 
        $XML    = [ Ordered ]@{ }                                                                                           #\\__// 
                                                                                                                            #//¯¯\\ 
             # ____   _________________________       ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
             #//¯¯\\__[_______ Header ________]______//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
             #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                                                                                                                            #//¯¯\\ 
                $X      = @( 2 ; 0..4 | % { 13 } ; 10 , 13 , 9 ) | % { $SP[$_] }                                            #\\__// 
                                                                                                                            #//¯¯\\ 
                $Y      = "<Window" , "  xmlns = '$Schema/presentation'" , "xmlns:x = '$Schema'" ,                          #\\__// 
                          "  Title = '$Author | Hybrid - AD Login'" , "  $W = '350'" , " $H = '250'" ,                      #//¯¯\\ 
                           "$( $HAL[1] )" , "Topmost = 'True' " , "  WindowStartupLocation = 'CenterScreen' >"              #\\__// 
                                                                                                                            #//¯¯\\ 
                                                                                                                            #\\__// 
                $XML.Add( "00" , @( 0..8 | % { $X[$_] + $Y[$_] } ) )                                                        #//¯¯\\ 
                                                                                                                            #\\__// 
                                                                                                                            #//¯¯\\ 
             # ____   _________________________       ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
             #//¯¯\\__[_______ Framing _______]______//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
             #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                                                                                                                            #//¯¯\\ 
                                                                                                                            #\\__// 
                $X     = @( 3,9,9,9,6,4,5,6,6,5,5,6,7,7,6,6,7,7,7,6 ) | % { $SP[$_] }                                       #//¯¯\\ 
                                                                                                                            #\\__// 
                $Y     = @( "<$GB" , " $HD = 'Enter Directory Services Administration Account'" , "  $W = '330'" ,          #//¯¯\\ 
                         " $H = '220'" , "  $( $VAL[0] )>" , "<$G>" , "<$GRD>" ; "2" , "1.25" | % { "<$RD $H = '$_*' />" } ;#\\__// 
                         "</$GRD>" , "<$G $GR = '0' >" , "<$GCD>" ; "" , "2.5" | % { "<$CD $W = '$_*' />" } ; "</$GCD>" ;   #//¯¯\\ 
                         "<$GRD>" ; 0..2 | % { "<$RD $H = '*' />" } ; "</$GRD>" )                                           #\\__// 
                                                                                                                            #//¯¯\\ 
                $XML.Add( "01" , @( 0..( $X.Count - 1 ) | % { $X[$_] + $Y[$_] } ) )                                         #\\__// 
                                                                                                                            #//¯¯\\ 
             # ____   _________________________       ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
             #//¯¯\\__[_____ User Input ______]______//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
             #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                                                                                                                            #//¯¯\\ 
                                                                                                                            #\\__// 
                $X     = @( 0..5 | % { 6 , 7 } ) | % { $SP[$_] }                                                            #//¯¯\\ 
                                                                                                                            #\\__// 
                $Y     = @( "<$TBL $GC = '0' $GR = '0' $MA = '10' TextAlignment = 'Right' >" , "Username:</$TBL>" ,         #//¯¯\\ 
                        "<$TB $Q = 'Username' $GC = '1' $GR = '0' $H = '24' $MA = '5' >" , "</$TB>" ,                       #\\__// 
                        "<$TBL $GC = '0' $GR = '1' $MA = '10' TextAlignment = 'Right' >" , "Password:</$TBL>" ,             #//¯¯\\ 
                        "<$PWB $Q = 'Password' $GC = '1' $GR = '1' $H = '24' $MA = '5' $PWC = '*' >" , "</$PWB>" ,          #\\__// 
                        "<$TBL $GC = '0' $GR = '2' $MA = '10' TextAlignment = 'Right' >" , "Confirm:</$TBL>" ,              #//¯¯\\ 
                        "<$PWB $Q =  'Confirm' $GC = '1' $GR = '2' $H = '24' $MA = '5' $PWC = '*' >" , "</$PWB>" )          #\\__// 
                                                                                                                            #//¯¯\\ 
                $XML.Add( "02" , @( 0..( $X.Count - 1 ) | % { $X[$_] + $Y[$_] } ) )                                         #\\__// 
                                                                                                                            #//¯¯\\ 
             # ____   _________________________       ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
             #//¯¯\\__[_______ Framing _______]______//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
             #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                                                                                                                            #//¯¯\\ 
                                                                                                                            #\\__// 
                $X    = @( 5,5,6,7,7,6,6,7,7,6 ) | % { $SP[$_] }                                                            #//¯¯\\ 
                                                                                                                            #\\__// 
                $Y    = @( "</$G>" , "<$G $GR = '1' >" , "<$GCD>" ; 0..1 | % { "<$CD $W = '*' />" } ; "</$GCD>" , "<$GRD>" ;#//¯¯\\ 
                           0..1 | % { "<$RD $H = '*'/>" } ; "</$GRD>" )                                                     #\\__// 
                                                                                                                            #//¯¯\\ 
                $XML.Add( "03" , @( 0..( $X.Count - 1 ) | % { $X[$_] + $Y[$_] } ) )                                         #\\__// 
                                                                                                                            #//¯¯\\ 
             # ____   _________________________       ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
             #//¯¯\\__[_______ Controls ______]______//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
             #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                                                                                                                            #//¯¯\\ 
                $X    = @( 6,6,7,6,7,6,7,6,5,4,3,2 ) | % { $SP[$_] }                                                        #\\__// 
                                                                                                                            #//¯¯\\ 
                $Y    = @( "<RadioButton $Q = 'Switch' $GR = '0' $GC = '0' $CO = 'Change' $( $VAL[1] ) $( $HAL[1] )/>" ,    #\\__// 
                        "<$TB $Q = 'Port' $GR = '0' $GC = '1' $( $VAL[1] ) $( $HAL[1] ) $W = '120' IsEnabled = 'False'>" ,  #//¯¯\\ 
                        "389</TextBox>" , "<$BU $Q = 'Ok' $CO = 'Ok' $GC = '0' $GR = '1' $MA = '5' >" , "</$BU>" ,          #\\__// 
                        "<$BU $Q = 'Cancel' $CO = 'Cancel' $GC = '1' $GR = '1' $MA = '5' >" , "</$BU>" , "</$G>" ,          #//¯¯\\ 
                        "</$G>" , "</$GB>" ,"</Window>" )                                                                   #\\__// 
                                                                                                                            #//¯¯\\ 
                 $XML.Add( "04" , @( 0..( $X.Count - 1 ) | % { $X[$_] + $Y[$_] } ) )                                        #\\__// 
                                                                                                                            #//¯¯\\ 
             # ____   ___________________________     ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
             #//¯¯\\__[_____ Return XAML _______]____//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
             #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                                                                                                                            #//¯¯\\ 
                    $Item = ForEach ( $i in 0..( $XML.Count - 1 ) )                                                         #\\__// 
                    {                                                                                                       #//¯¯\\ 
                        0..( $XML[$I].Count - 1 ) | % { $XML[$I][$_] }                                                      #\\__// 
                    }                                                                                                       #//¯¯\\ 
                    $Return = ""                                                                                            #\\__// 
                                                                                                                            #//¯¯\\ 
                    0..( $Item.Count - 1 ) | % { $Return += "$( $Item[$_] )`n" }                                            #\\__// 
                                                                                                                            #//¯¯\\ 
             # ____   _________________________       ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
             #//¯¯\\__[___ Parts Done Bro ____]______//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
             #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                                                                                                                            #//¯¯\\ 
        $NamedElements = "Username" , "Password" , "Confirm" , "Switch" , "Port" , "Ok" , "Cancel"                          #\\__// 
                                                                                                                            #//¯¯\\ 
        $0 = "Username" , "Password" , "Confirmation" ; $1 = $0 | % { "You must enter a $_" } ; $2 = $0 | % { "$_ Error" }  #\\__// 
        $1[2] = $1[2].Replace( "You must enter a" , "Password Must Match the" )                                             #//¯¯\\ 
        $1   += "Invalid information. All fields must be correct and valid." ; $2 += "Authentication Failure"               #\\__// 
                                                                                                                            #//¯¯\\ 
        $MSG  = 0..3 | % { "[ System.Windows.MessageBox ]::Show( '$( $1[$_] )' , '$( $2[$_] )' )" }                         #\\__// 
                                                                                                                            #//¯¯\\ 
        $GUIX = Convert-XAMLtoWindow -Xaml $Return -NE $NamedElements -PassThru                                             #\\__// 
                                                                                                                            #//¯¯\\ 
        $GUIX.Switch.Add_Click({ $GUIX.Port.IsEnabled = $True })                                                            #\\__// 
        $GUIX.Cancel.Add_Click({ $GUIX.DialogResult = $False })                                                             #//¯¯\\ 
        $GUIX.Ok.Add_Click({                                                                                                #\\__// 
                                                                                                                            #//¯¯\\ 
            $Port = $( If ( $GUIX.Port.IsEnabled -eq $True ) { $GUIX.Port.Text } Else { 389 } )                             #\\__// 
            $Cred = [ PSCredential ]::New( $GUIX.Username.Text , $GUIX.Password.SecurePassword )                            #//¯¯\\ 
            $AD   = "LDAP://$( $DC ):$Port/DC=$( $Domain.Split('.') -join ',DC=' )"                                         #\\__// 
            $DX   = [ DirectoryEntry ]::New( "$AD" , $Cred.Username , $Cred.GetNetworkCredential().Password )               #//¯¯\\ 
                                                                                                                            #\\__// 
            If     ( $GUIX.Username.Text     -eq       $Null )                  { IEX $MSG[0] }                             #//¯¯\\ 
            ElseIf ( $GUIX.Password.Password -eq       $Null )                  { IEX $MSG[1] }                             #\\__// 
            ElseIf (  $GUIX.Confirm.Password -eq       $Null )                  { IEX $MSG[2] }                             #//¯¯\\ 
            ElseIf ( $GUIX.Password.Password -notmatch $GUIX.Confirm.Password ) { IEX $MSG[2] }                             #\\__// 
            ElseIf ( $DX.Name -eq $Null )                                       { IEX $MSG[3] }                             #//¯¯\\ 
                                                                                                                            #\\__// 
            Else { $GUIX.DialogResult = $True }                                                                             #//¯¯\\ 
        })                                                                                                                  #\\__// 
                                                                                                                            #//¯¯\\ 
        $Null = $GUIX.Username.Focus()                                                                                      #\\__// 
                                                                                                                            #//¯¯\\ 
        $OP = Show-WPFWindow -GUI $GUIX                                                                                     #\\__// 
                                                                                                                            #//¯¯\\ 
        If ( $OP -eq $True )                                                                                                #\\__// 
        {                                                                                                                   #//¯¯\\ 
            Write-Theme -Action "Login [+]" "Successful" 11 12 15                                                           #\\__// 
            Return [ PSCredential ]::New( $GUIX.Username.Text , $GUIX.Password.SecurePassword )                             #//¯¯\\ 
        }                                                                                                                   #\\__// 
                                                                                                                            #//¯¯\\ 
        Else                                                                                                                #\\__// 
        {                                                                                                                   #//¯¯\\ 
            Write-Theme -Action "Login [!]" "Failed"                                                                        #\\__// 
        }                                                                                                                   #//¯¯\\ 
                                                                                     #____ -- ____ -- ____ -- ____ -- ____ --\\__//-- ____    ____      
}#____                                                                             __//¯¯\\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//¯¯\\___  
#//¯¯\\___________________________________________________________________________/¯¯¯    ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯        ____    ____ __ ____ __ ____ __ ____ __ ____ __ ____    ___// 
    Function Convert-ArrayToHereString   #_______________________________________________//¯¯\\__//¯¯\\==//¯¯\----/¯¯\\==//¯¯\----/¯¯\\==//¯¯\\__//¯¯¯  
    {#]__________________________________//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ -- ¯¯¯¯ -- ¯¯¯¯ -- ¯¯¯¯ -- ¯¯¯¯ -- ¯¯¯¯ -- ¯¯¯¯ -- ¯¯¯¯      
        
        [ CmdLetBinding () ] [ OutputType ( "String" ) ] Param ( [ Parameter ( Position = 0 , Mandatory = $True ) ] [ Array ] $Input )

        $Return = "" ; 0..( $Launch.Count - 1 ) | % { $Return += "$( $Launch[$_] )`n" } ; Return $Return

                                                                                     #____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____    ____      
}#____                                                                             __//¯¯\\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//¯¯\\___  
#//¯¯\\___________________________________________________________________________/¯¯¯    ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯        ____    ____ __ ____ __ ____ __ ____ __ ____ __ ____    ___// 
    Function Convert-XAMLToWindow # Modified, originally by Dr. Tobias Weltner___________//¯¯\\__//¯¯\\==//¯¯\----/¯¯\\==//¯¯\----/¯¯\\==//¯¯\\__//¯¯¯  
    {#]______________________________________________________________________________//¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯ -- ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯      
    
        Param ( [ Parameter ( Mandatory ) ] [ String ] $XAML , [ String [] ] $NE = $Null , [ Switch ] $PassThru )

        If ( $XAML.Count -gt 1 ) { $XAML = Convert-ArrayToHereString -Input $XAML }

        @( "Framework" , "Core" | % { "Presentation$_" } ) + "WindowsBase" | % { Add-Type -AssemblyName $_ }
 
        $NR = [ XML.XMLReader ]::Create( [ IO.StringReader ] $XAML ) ; $OP = [ Windows.Markup.XAMLReader ]::Load( $NR )
        
        $NE | % { $OP | Add-Member -MemberType NoteProperty -Name $_ -Value $OP.FindName( $_ ) -Force }
 
        If ( $PassThru ) { $OP } Else { $Null = $GUI.Dispatcher.InvokeAsync( { $OP = $GUI.ShowDialog() ; SV -Name OP -Value $OP -Scope 1 } ).Wait() ; $OP }

                                                                                     #____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____    ____      
}#____                                                                             __//¯¯\\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//¯¯\\___  
#//¯¯\\___________________________________________________________________________/¯¯¯    ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯        ____    ____ __ ____ __ ____ __ ____ __ ____ __ ____    ___// 
    Function Show-WPFWindow # Modified, originally by Dr. Tobias Weltner ________________//¯¯\\__//¯¯\\==//¯¯\----/¯¯\\==//¯¯\----/¯¯\\==//¯¯\\__//¯¯¯  
    {#]______________________________________________________________________________//¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯ -- ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯      
        
        Param ( [ Parameter ( Mandatory ) ] [ Windows.Window ] $GUI )

        $OP = $Null ; $Null = $GUI.Dispatcher.InvokeAsync( { $OP = $GUI.ShowDialog() ; SV -Name OP -Value $OP -Scope 1 } ).Wait() ; $OP 

                                                                                     #____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____    ____      
}#____                                                                             __//¯¯\\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//¯¯\\___  
#//¯¯\\___________________________________________________________________________/¯¯¯    ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯        ____    ____ __ ____ __ ____ __ ____ __ ____ __ ____    ___// 
    #Function Provision-DomainController                                              ___//¯¯\\__//¯¯\\==//¯¯\----/¯¯\\==//¯¯\----/¯¯\\==//¯¯\\__//¯¯¯  
    {#]______________________________________________________________________________//¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯       
        
        $Schema    = "http://schemas.microsoft.com/winfx/2006/xaml"
        $Author    = "Secure Digits Plus LLC"

        $CS        = ( GCIM Win32_OperatingSystem ).Caption
        $B         = $False , $True 
        $YZ        = "[X]" , "[_]"

        $Glossary  = 
            "   `$W = 'Width'             " , "   `$H = 'Height'            " , "  `$MA = 'Margin'          " , 
            "  `$MN = 'Menu'              " , " `$MNI = 'MenuItem'          " , "  `$HD = 'Header'          " , 
            "  `$GB = 'GroupBox'          " , " `$GBI = 'GroupBoxItem'      " , "  `$CB = 'ComboBox'        " , 
            " `$CBI = 'ComboBoxItem'      " , " `$CHK = 'CheckBox'          " , "  `$TB = 'TextBox'         " , 
            " `$TBL = 'TextBlock'         " , "   `$G = 'Grid'              " , "  `$RD = 'RowDefinition'   " , 
            "  `$CD = 'ColumnDefinition'  " , "  `$GC = 'Grid.Column'       " , " `$GCS = 'Grid.ColumnSpan' " , 
            "  `$GR = 'Grid.Row'          " , " `$GRS = 'Grid.RowSpan'      " , "  `$SI = 'SelectedIndex'   " , 
            "  `$LA = 'Label'             " , "  `$BU = 'Button'            " , "  `$CO = 'Content'         " , 
            "   `$Q = 'Name'              "
            
        $Glossary | % { IEX $_ } ; $GRD , $GCD = $RD , $CD | % { "$G.$_`s" }
        $Glossary += " `$GRD = '$GRD'" , " `$GCD = '$GCD'" 

        $HAL , $HCAL , $VAL , $VCAL , $SP = 0..4 | % { [ Ordered ]@{ } }

        0..13 | % { $SP.Add( $_ , ( "    " * $_ ) ) }
                    
        $I =       "Left" ,   "Center" ,  "Right"
        $J =        "Top" ,   "Center" , "Bottom"
        $K = "Horizontal" , "Vertical" | % { $_ , "$_`Content" } | % { "$_`Alignment" }
        $L =     " `$HAL" ,   "`$HCAL" , " `$VAL" , "`$VCAL"

        0..2  | % {  $HAL.Add( $_ , "$( $K[0] ) = '$( $I[$_] )'" )
                    $HCAL.Add( $_ , "$( $K[1] ) = '$( $I[$_] )'" )
                     $VAL.Add( $_ , "$( $K[2] ) = '$( $J[$_] )'" )
                    $VCAL.Add( $_ , "$( $K[3] ) = '$( $J[$_] )'" ) }

        $VC , $VV = "Collapsed" , "Visible" | % { "Visibility = '$_'" }

        Write-Theme -Action "Loaded [+]" "WPF/XAML Glossary Definitions" 11 12 15

            # To clear, these: 
            # $W , $H , $MA , $MN , $MNI , $HD , $CHK , $CO , $BU , $Q , $GB , $GBI , $CB , $CBI , 
            # $TB , $TBL , $LA , $G , $RD , $CD , $SI , $GC , $GCS , $GR , $GRS = $Null

    # ____            ____            ____            ____            ____            ____    ____    ____    ____    ____   \\__// 
    #//¯¯\\__________//¯¯\\__________//¯¯\\__________//¯¯\\__________//¯¯\\__________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
    #\\__//¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
        Function Get-DomainType # Collects the DomainType ___________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
        {#/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
            Return @( "N/A" , "TreeDomain" , "ChildDomain" , "ChildDomain" , "N/A" ) }                                      #//¯¯\\  
    # ____            ____            ____            ____            ____            ____    ____    ____    ____    ____   \\__// 
    #//¯¯\\__________//¯¯\\__________//¯¯\\__________//¯¯\\__________//¯¯\\__________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
    #\\__//¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
        Function Get-DCPromoBoxControls # Collects the names for Box Controls________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
        {#/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
            Return @( "Database" , "Sysvol" , "Log" | % { "$_`Path" } ; "Credential" ;                                      #\\__// 
            @( "Domain" | % { $_ , "New$_" } | % { $_ , "$_`NetBIOS" } ; "Site" ) | % { "$_`Name" } ;                       #//¯¯\\ 
            "ReplicationSourceDC" , "Forest" , "Domain" , "Child" , "Clone" ) | % { "$_`Box" }                              #\\__// 
        }                                                                                                                   #//¯¯\\ 
    # ____            ____            ____            ____            ____            ____    ____    ____    ____    ____   \\__// 
    #//¯¯\\__________//¯¯\\__________//¯¯\\__________//¯¯\\__________//¯¯\\__________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
    #\\__//¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
        Function Get-DCPromoControl # Provides backend for reliable XAML Control  ___//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
        {#/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                 [ CmdLetBinding () ] Param (                                                                               #//¯¯\\ 
                                                                                                                            #\\__// 
                    [ ValidateSet ( 0 , 1 , 2 , 3 ) ][ Parameter ( Mandatory = $True ) ][ Int ] $DType = 0 )                #//¯¯\\ 
                                                                                                                            #\\__// 
                 $T = ( Get-DomainType )[ $DType ]                                                                          #//¯¯\\ 
                 Return [ PSCustomObject ]@{                                                                                #\\__// 
                                                                                                                            #//¯¯\\ 
                 # ______________________________________________________________________________ #                         #\\__// 
                 # [ Services ] # - Entries for [ Windows Server @: Desired State Configuration ] #                         #//¯¯\\ 
                 # ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ #                         #\\__// 
                                                                                                                            #//¯¯\\ 
                 AD_Domain_Services      = "" ; DHCP                     = "" ; DNS                     = "" ;              #\\__// 
                 GPMC                    = "" ; RSAT                     = "" ; RSAT_AD_AdminCenter     = "" ;              #//¯¯\\ 
                 RSAT_AD_PowerShell      = "" ; RSAT_AD_Tools            = "" ; RSAT_ADDS               = "" ;              #\\__// 
                 RSAT_ADDS_Tools         = "" ; RSAT_DHCP                = "" ; RSAT_DNS_Server         = "" ;              #//¯¯\\ 
                 RSAT_Role_Tools         = "" ; WDS                      = "" ; WDS_AdminPack           = "" ;              #\\__// 
                 WDS_Deployment          = "" ; WDS_Transport            = "" ;                                             #//¯¯\\ 
                                                                                                                            #\\__// 
                 # ______________________________________________________________________________ #                         #//¯¯\\ 
                 # [ Menu Items ] # Entries for [ Windows Server @: Desired State Configuration ] #                         #\\__// 
                 # ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ #                         #//¯¯\\ 
                                                                                                                            #\\__// 
                 Forest = "" ; Tree = "" ; Child = "" ; Clone = "" ; Process = $DType ;                                     #//¯¯\\ 
                                                                                                                            #\\__// 
                 # ________________________________________________________________________________ #                       #//¯¯\\ 
                 # [ ADDS-Deployment ] # - Entries for [ Active Directory @: Deployment / DCPromo ] #                       #\\__// 
                 # ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ #                       #//¯¯\\ 
                                                                                                                            #\\__// 
                 DomainType              = $T ; ForestMode              = "" ; DomainMode              = "" ;               #//¯¯\\ 
                 ParentDomainName        = "" ; DatabasePath            = "" ; SysvolPath              = "" ;               #\\__// 
                 LogPath                 = "" ; Credential              = "" ; DomainName              = "" ;               #//¯¯\\ 
                 DomainNetBIOSName       = "" ; NewDomainName           = "" ; NewDomainNetBIOSName    = "" ;               #\\__// 
                 SiteName                = "" ; ReplicationSourceDC     = "" ; InstallDNS              = "" ;               #//¯¯\\ 
                 CreateDNSDelegation     = "" ; NoGlobalCatalog         = "" ; CriticalReplicationOnly = "" ;               #\\__// 
                 Force      = $True ; NoRebootUponCompletion  = $False ; SafeModeAdministratorPassword = "" } }             #//¯¯\\ 
    # ____            ____            ____            ____            ____            ____    ____    ____    ____    ____   \\__// 
    #//¯¯\\__________//¯¯\\__________//¯¯\\__________//¯¯\\__________//¯¯\\__________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
    #\\__//¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
        Function Get-DCPromoXAML # Produces XAML dynamically ________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
        {#/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//  
            [ CmdLetBinding () ] Param (                                                                                    #\\__// 
                [ Parameter ( Mandatory = $True , ParameterSetName = "0" ) ][ Switch ] $Split ,                             #//¯¯\\ 
                [ Parameter ( Mandatory = $True , ParameterSetName = "1" ) ][ Switch ] $HereString  )                       #\\__// 
                                                                                                                            #//¯¯\\ 
                $XML    = [ Ordered ]@{ }                                                                                   #\\__//  
             # ____   _________________________       ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
             #//¯¯\\__[_______ Header ________]______//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
             #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                $X      = @( 2 ; 0..4 | % { 13 } ; 10 , 13 , 9 ) | % { $SP[$_] }                                            #\\__// 
                                                                                                                            #//¯¯\\ 
                $Y      = "<Window" , "  xmlns = '$Schema/presentation'" , "xmlns:x = '$Schema'" ,                          #\\__// 
                          "  Title = '$Author | Hybrid - Desired State Controller Installation'" ,                          #//¯¯\\ 
                          "  $W = '800'" , " $H = '800'" , "$( $HAL[1] )" , "Topmost = 'True' " ,                           #\\__// 
                          "  WindowStartupLocation = 'CenterScreen' >"                                                      #//¯¯\\ 
                                                                                                                            #\\__// 
                $XML.Add( "00" , @( 0..8 | % { $X[$_] + $Y[$_] } ) )                                                        #//¯¯\\ 
             # ____   _________________________       ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
             #//¯¯\\__[_______ Framing _______]______//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
             #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                $X      = @( 2..4 ; 4 , 3 ) | % { $SP[$_] }                                                                 #\\__// 
                                                                                                                            #//¯¯\\ 
                $Y      = @( "<$G>" , "<$GRD>" ; '20' , '*' | % { "<$RD $H = '$_' />" } ; "</$GRD>" )                       #\\__// 
                                                                                                                            #//¯¯\\ 
                $XML.Add( "01" , @( 0..4 | % { $X[$_] + $Y[$_] } ) )                                                        #\\__// 
             # ____   _________________________       ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
             #//¯¯\\__[________ Menu _________]______//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
             #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                $Menu   = 'Forest' , 'Tree' , 'Child' , 'Clone'                                                             #\\__// 
                                                                                                                            #//¯¯\\ 
                $Action = "Domain" | % { "Forest" , "$_ Tree" , "$_ Child" , "$_`Controller" } | % { "Install-ADDS$_" }     #\\__// 
                                                                                                                            #//¯¯\\ 
                $X      = @( 3..5 ; 5 , 5 ; 5..3 ) | % { $SP[$_] }                                                          #\\__// 
                                                                                                                            #//¯¯\\ 
                $Y      = @( "<$MN $GR = '0' $H = '20' >" , "<$MNI $HD = 'New' >" ;                                         #\\__// 
                          0..3 | % { "<$MNI $Q = '$( $Menu[$_] )' $HD = '$( $Action[$_] )' />"} ; "</$MNI>" , "</$MN>" )    #//¯¯\\ 
                                                                                                                            #\\__// 
                $XML.Add( "02" , @( 0..7 | % { $X[$_] + $Y[$_] } ) )                                                        #//¯¯\\ 
             # ____   _________________________       ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
             #//¯¯\\__[______ Open Body ______]______//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
             #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                $X      = 3 , 12 , 13 , 10 , 10 , 13 , 13 | % { $SP[$_] }                                                   #\\__// 
                                                                                                                            #//¯¯\\ 
                $Y      = "<$GB" , "   $GR = '1'" , " $HD = '[ Hybrid-DSC Domain Service Configuration ]'" ,                #\\__// 
                          "$( $HAL[1] )" , "  $( $VAL[1] )" , "  $W = '760'" , " $H = '740' >"                              #//¯¯\\ 
                                                                                                                            #\\__// 
                $XML.Add( "03" , @( 0..6 | % { $X[$_] + $Y[$_] } ) )                                                        #//¯¯\\ 
             # ____   _________________________       ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
             #//¯¯\\__[_______ Framing _______]______//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
             #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                $X      = @( 4..7 ; 7 , 6 ; 6..8 ; 8 , 7 ) | % { $SP[$_] }                                                  #\\__// 
                                                                                                                            #//¯¯\\ 
                $Y      = @( "<$G>" , "<$G $GR = '1' $MA = '10' >" , "<$GRD>" ; '' , '10' | % { "<$RD $H = '$_*' />" } ;    #\\__// 
                           "</$GRD>" , "<$G $GR = '0' >" , "<$GCD>" ; 0..1 | % { "<$CD $W = '*' />" } ; "</$GCD>" )         #//¯¯\\ 
                                                                                                                            #\\__// 
                $XML.Add( "04" , @( 0..10 | % { $X[$_] + $Y[$_] } ) )                                                       #//¯¯\\ 
             # ____   _________________________       ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
             #//¯¯\\__[_____ Domain Mode _____]______//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
             #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                $LI     = @( )                                                                                              #\\__// 
                $ED     = @( "00" , "03" ; "08" , 12 | % { $_ , "$_ R2" } ; 16 , 19 )                                       #\\__// 
                $R2     = $( If ( $CS -like "*R2*" ) { 1 } Else { 0 } )                                                     #\\__// 
                0..7    | % {                                                                                               #\\__// 
                                                                                                                            #//¯¯\\ 
                    $I  = $ED[$_]                                                                                           #\\__// 
                                                                                                                            #//¯¯\\ 
                    $J  = "False"                                                                                           #\\__// 
                                                                                                                            #//¯¯\\ 
                        If ( $CS -like "*$I*" ) { If ( $R2 -eq 1 -and $_ -in    3 , 5 ) { $J = "True" }                     #\\__// 
                                                  If ( $R2 -eq 0 -and $_ -notin 3 , 5 ) { $J = "True" } }                   #//¯¯\\ 
                                                                                                                            #\\__// 
                   $LI += "<$CBI $CO = 'Windows Server 20$I' IsSelected = '$J' />"                                          #//¯¯\\ 
                }                                                                                                           #\\__// 
                                                                                                                            #//¯¯\\ 
                $LI[0]  = $LI[0].Replace( "2000" ,"2000 ( Default )" )                                                      #\\__// 
                                                                                                                            #//¯¯\\ 
                ForEach ( $i in 0..( $LI.Count - 1 ) )                                                                      #\\__// 
                {                                                                                                           #//¯¯\\ 
                    $SX = 0..( $LI.Count - 1 ) | ? { $LI[$_] -like "*IsSelected = 'True'*" }                                #\\__// 
                }                                                                                                           #//¯¯\\ 
                                                                                                                            #\\__// 
                0..1 | % {                                                                                                  #//¯¯\\ 
                                                                                                                            #\\__// 
                    $J  = ( "Forest" , "Domain" )[$_]                                                                       #//¯¯\\ 
                                                                                                                            #\\__// 
                    $X  = @( 7 , 8 ; 0..7 | % { 9 } ; 8 , 7 ) | % { $SP[$_] }                                               #//¯¯\\ 
                                                                                                                            #\\__// 
                    $Y  = @( "<$GB $Q = '$J`Box' $HD = '$J Mode' $GC = '$_' $MA = '5' $VC >" ,                              #//¯¯\\ 
                          "<$CB $Q = '$J`Mode' $H = '24' $SI = '$SX' >" ; @( $LI ) ; "</$CB>" , "</$GB>" )                  #\\__// 
                                                                                                                            #//¯¯\\ 
                    $Z  = 0..11 | % { $X[$_] + $Y[$_] }                                                                     #\\__// 
                                                                                                                            #//¯¯\\ 
                    If ( $_ -eq 0 ) { $ForID = $Z } Else { $DomID = $Z } }                                                  #\\__// 
                                                                                                                            #//¯¯\\ 
                $ParID  = "Child" | % {                                                                                     #\\__// 
                                                                                                                            #//¯¯\\ 
                    $X  = @( 6 , 7 , 6 ) | % { $SP[$_] } ;                                                                  #\\__// 
                                                                                                                            #//¯¯\\ 
                    $Y  = "<$GB $Q = '$_`Box' $HD = '$_ Domain' $GC = '0' $MA = '5' $VC >" ,                                #\\__// 
                          "<$TB $Q = 'ParentDomainName' Text = '&lt;Domain Name&gt;' $H = '20' $MA = '5' />" , "</$GB>"     #//¯¯\\ 
                                                                                                                            #\\__// 
                    Return 0..2 | % { $X[$_] + $Y[$_] } }                                                                   #//¯¯\\ 
                                                                                                                            #\\__// 
                  $None = $SP[6] + "<$GB $Q = 'CloneBox' $HD = 'Clone Domain Controller' $MA = '5' $GCS = '2' $VC />"       #//¯¯\\ 
                                                                                                                            #\\__// 
                $XML.Add( "05" , @( $ForID ; $DomID ; $ParID ; $None ) )                                                    #//¯¯\\ 
             # ____   _________________________       ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
             #//¯¯\\__[_______ Framing _______]______//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
             #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                    $X  = @( 6 , 6 , 7 , 8 , 8 , 7 , 7 , 8 , 8 , 7 ) | % { $SP[$_] }                                        #\\__// 
                                                                                                                            #//¯¯\\ 
                    $Y  = @( "</$G>" , "<$G $GR = '1' >" , "<$GCD>" ; '' , '2.5' | % { "<$CD $W = '$_*' />" } ;"</$GCD>" ,  #\\__// 
                             "<$GRD>" ; '3.5' , '' | % { "<$RD $H = '$_*' />" } ; "</$GRD>" )                               #//¯¯\\ 
                                                                                                                            #\\__// 
                $XML.Add( "06" , @( 0..9 | % { $X[$_] + $Y[$_] } ) )                                                        #//¯¯\\ 
             # ____   _________________________       ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
             #//¯¯\\__[__ Services Selection _]______//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
             #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                                                                                                                            #//¯¯\\ 
                    $FT = Get-FeatureList ; $FTL = Get-FeatureList -Underscore                                              #\\__// 
                                                                                                                            #//¯¯\\ 
                   $SVC = 0..16 | % {                                                                                       #\\__// 
                                                                                                                            #//¯¯\\ 
                    "<$TBL $GC = '0' $GR = '$_' $MA = '5' TextAlignment = 'Right' >$( $FT[$_] ):</$TBL>" ,                  #\\__// 
                    "<$CHK $GC = '1' $GR = '$_' $MA = '5' $Q = '$( $FTL[$_] )' IsEnabled = 'True' IsChecked = 'False' />" } #//¯¯\\ 
                                                                                                                            #\\__// 
                    $X  = @( 6..9 ; 9 , 8 , 8 ; 0..16 | % { 9 } ; 0..34 | % { 8 } ; 7 , 6 ) | % { $SP[$_] }                 #//¯¯\\ 
                                                                                                                            #\\__// 
                    $Y  = @( "<$GB $HD = 'Service Options' $GR = '0' $GC = '0' $MA = '5' >" , "<$G $GR = '0' $GC = '0' >" , #//¯¯\\ 
                             "<$GCD>" ; '5' , '' | % { "<$CD $W = '$_*' />" } ; "</$GCD>" , "<$GRD>" ;                      #\\__// 
                             0..16 | % { "<$RD $H =  '*' />" } ; "</$GRD>" ; @( $SVC ) ; "</$G>" , "</$GB>" )               #//¯¯\\ 
                                                                                                                            #\\__// 
                $XML.Add( "07" , @( 0..60 | % { $X[$_] + $Y[$_] } ) )                                                       #//¯¯\\ 
             # ____   _________________________________       ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
             #//¯¯\\__[_ Paths / Credentials / Names _]______//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
             #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                                                                                                                            #//¯¯\\ 
                    $VA = '10 , 0 , 10 , 0'                                                                                 #\\__// 
                                                                                                                            #//¯¯\\ 
                    $BB = "BorderBrush = '{x:Null}'"                                                                        #\\__// 
                                                                                                                            #//¯¯\\ 
                    $VX = @( "Database" , "Sysvol" , "Log" | % { "$_`Path" } ; "Credential" ;                               #\\__// 
                          @( "Domain" | % { $_ , "New$_" } | % { $_ , "$_`NetBIOS" } ; "Site" ) | % { "$_`Name" } ;         #//¯¯\\ 
                          "ReplicationSourceDC" )                                                                           #\\__// 
                                                                                                                            #//¯¯\\ 
                $DomID  = ForEach ( $k in 0..9 )                                                                            #\\__// 
                {                                                                                                           #//¯¯\\ 
                    $WX = $VX[$K]                                                                                           #\\__// 
                    If ( $K -eq 3 )                                                                                         #//¯¯\\ 
                    {                                                                                                       #\\__// 
                        "<$GB $GR = '3' $HD = '$WX' Name = '$WX`Box' $VV $BB >" , "<$G>" , "<$GCD>" ;                       #//¯¯\\ 
                        "" , "3" | % { "<$CD $W = '$_*' />" } ; "</$GCD>" ,                                                 #\\__// 
                        "<$BU $CO = '$WX' $Q = '$WX`Button' $GC = '0' />" ,                                                 #//¯¯\\ 
                        "<$TB $H = '20' $MA = '$VA' Name = '$WX' $GC = '1' />" , "</$G>" , "</$GB>"                         #\\__// 
                    }                                                                                                       #//¯¯\\ 
                    Else                                                                                                    #\\__// 
                    {                                                                                                       #//¯¯\\ 
                        "<$GB $GR = '$K' $HD = '$WX`' $Q = '$WX`Box' $VV $BB >" ,                                           #\\__// 
                        "<$TB $H = '20' $MA = '$VA' $Q = '$WX' />" , "</$GB>"                                               #//¯¯\\ 
                    }                                                                                                       #\\__// 
                }                                                                                                           #//¯¯\\ 
                                                                                                                            #\\__// 
                    $X  = @(6,7;0..9|%{8};7;0..2|%{7,8,7};7..10;10,9,9,9,8,7;0..5|%{7,8,7};6) | % { $SP[$_] }               #//¯¯\\ 
                                                                                                                            #\\__// 
                    $Y  = @( "<$G $GR = '0' $GC = '1' $MA = '$VA' >" , "<$GRD>" ; 0..9 | % { "<$RD $H = '*' />" } ;         #//¯¯\\ 
                             "</$GRD>" ; @( $DomID ) ; "</$G>" )                                                            #\\__// 
                                                                                                                            #//¯¯\\ 
                $XML.Add( "08" , @( 0..50 | % { $X[$_] + $Y[$_] } ) )                                                       #\\__// 
                                                                                                                            #//¯¯\\ 
             # ____   ___________________________     ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
             #//¯¯\\__[___ Role Designations ___]____//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
             #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                                                                                                                            #//¯¯\\ 
                   $RCN = "Install DNS" , "Create DNS Delegation" , "No Global Catalog" , "Critical Replication Only"       #\\__// 
                   $RID = $RCN | % { $_.Replace( " " , "" ) }                                                               #//¯¯\\ 
                                                                                                                            #\\__// 
                 $Roles = 0..3 | % {                                                                                        #//¯¯\\ 
                    "<$TBL $GR = '$_' TextAlignment = 'Right' $MA = '5' IsEnabled = 'True' >$( $RCN[$_] ):</$TBL>" ,        #\\__// 
                    "<$CHK $Q = '$( $RID[$_] )' $GR = '$_' $GC = '1' $MA = '5' IsEnabled = 'True' IsChecked = 'False' />"   #//¯¯\\ 
                    }                                                                                                       #\\__// 
                                                                                                                            #//¯¯\\ 
                    $X  = @( 6..9 ; 9 , 9 , 9 , 8 , 8 , 9 , 9 ; 0..8 | % { 8 } ; 7 , 6 ) | % { $SP[$_] }                    #\\__// 
                                                                                                                            #//¯¯\\ 
                    $Y  = @( "<$GB $GR = '1' $HD = 'Roles' $MA = '5' >" , "<$G>" , "<$GRD>" ;                               #\\__// 
                          0..3 | % { "<$RD $H = '*' />" } ; "</$GRD>" , "<$GCD>" ; '5' , '' | % { "<$CD $W = '$_*' />" } ;  #//¯¯\\ 
                          "</$GCD>" ; @( $Roles ) ; "</$G>" ,  "</$GB>" )                                                   #\\__// 
                                                                                                                            #//¯¯\\ 
                $XML.Add( "09" , @( 0..21 | % { $X[$_] + $Y[$_] } ) )                                                       #\\__// 
                                                                                                                            #//¯¯\\ 
             # ____   ___________________________     ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
             #//¯¯\\__[__ DSRM/Initialization __]____//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
             #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                $CF ,  $OK ,  $CA = "Confirm" , "Start" , "Cancel"                                                          #\\__// 
                $PW , $PWB , $PWC = "Password" | % { "SafeModeAdministrator$_" , "$_`Box" , "$_`Char" }                     #//¯¯\\ 
                                                                                                                            #\\__// 
                    $X  = @( 6..9 ; 9 , 8 , 8 , 9 , 9 , 8 , 8 , 9 , 8 , 8 , 9 , 8 , 8 ; 8..6 ) | % { $SP[$_] }              #//¯¯\\ 
                                                                                                                            #\\__// 
                    $Y  = @( "<$GB $GR = '1' $GC = '1' $HD = 'Initialization' $MA = '5' >" , "<$G>" , "<$GRD>" ;            #//¯¯\\ 
                          0..1 | % { "<$RD $H = '*' />" } ; "</$GRD>" , "<$GCD>" ; 0..1 | % { "<$CD $W = '*' />" } ;        #\\__// 
                          "</$GCD>" )                                                                                       #//¯¯\\ 
                                                                                                                            #\\__// 
                    $C  = 0                                                                                                 #//¯¯\\ 
                    $Y += $PW , $CF | % { "<$GB $GR = '0' $GC = '$C' $HD = '$_' >" ,                                        #\\__// 
                                          "<$PWB $Q = '$_' $H = '20' $MA = '5' $PWC = '*' />" , "</$GB>" ; [ Void ]$C ++ }  #//¯¯\\ 
                                                                                                                            #\\__// 
                    $C  = 0                                                                                                 #//¯¯\\ 
                    $Y += $OK , $CA | % { "<$BU $Q = '$_' $GR = '1' $GC = '$C' $CO = '$_' $MA = '5'" ,                      #\\__// 
                                          " $W = '100' $H = '20' />" -join '' ; [ Void ]$C ++ } ;                           #//¯¯\\ 
                                                                                                                            #\\__// 
                    $Y += "</$G>" , "</$GB>"                                                                                #//¯¯\\ 
                                                                                                                            #\\__// 
                $XML.Add( "10" , @( 0..19 | % { $X[$_] + $Y[$_] } ) )                                                       #//¯¯\\  
             # ____   ___________________________     ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
             #//¯¯\\__[_______ Framing _________]____//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
             #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                                                                                                                            #//¯¯\\ 
                    $X  = @( 5..0 ) | % { $SP[$_] }                                                                         #\\__// 
                                                                                                                            #//¯¯\\ 
                    $Y  = "</$G>" , "</$G>" , "</$G>" , "</$GB>" , "</$G>" , "</Window>"                                    #\\__// 
                                                                                                                            #//¯¯\\ 
                $XML.Add( "11" , @( 0..5 | % { $X[$_] + $Y[$_] } ) )                                                        #\\__// 
                                                                                                                            #//¯¯\\ 
             # ____   ___________________________     ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
             #//¯¯\\__[_____ Return XAML _______]____//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
             #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                                                                                                                            #//¯¯\\ 
                If ( $Split ) { $Return = $XML }                                                                            #\\__// 
                                                                                                                            #//¯¯\\ 
                If ( $HereString )                                                                                          #\\__// 
                {                                                                                                           #//¯¯\\ 
                    $Item = ForEach ( $i in 0..( $XML.Count - 1 ) )                                                         #\\__// 
                    {                                                                                                       #//¯¯\\ 
                        0..( $XML[$I].Count - 1 ) | % { $XML[$I][$_] }                                                      #\\__// 
                    }                                                                                                       #//¯¯\\ 
                    $Return = ""                                                                                            #\\__// 
                                                                                                                            #//¯¯\\ 
                    0..( $Item.Count - 1 ) | % { $Return += "$( $Item[$_] )`n" }                                            #\\__// 
                }                                                                                                           #//¯¯\\ 
                Return $Return                                                                                              #\\__// 
            }                                                                                                               #//¯¯\\ 
                                                                                                                            #\\__// 
                                                                                                                            #//¯¯\\ 
             # ____   _________________________       ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
             #//¯¯\\__[___ Parts Done Bro ____]______//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
             #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                                                                                                                            #\\__// 
        Write-Theme -Action "Loading [~]" "Active Directory Configuration Utility" 11 12 15                                 #\\__// 
                                                                                                                            #\\__// 
        $Code          = Get-DCPromoControl -DType 1                                                                        #\\__// 
        $Named         = $Code | GM | ? Membertype -eq NoteProperty | % { $_.Name }                                         #\\__// 
        $Face          = Get-DCPromoXAML -HereString                                                                        #\\__// 
        $Boxes         = Get-DCPromoBoxControls                                                                             #\\__// 
                                                                                                                            #\\__// 
        $XamlWindow    = @{ XAML = $Face                                                                                    #\\__// 
                            NE   = @( $Named ; $Boxes ; "Start" , "Cancel" , "Confirm" , "CredentialButton" )               #\\__// 
                            EA   = 0 }                                                                                      #\\__// 
                                                                                                                            #\\__// 
        $CTRL          = Convert-XAMLtoWindow @XamlWindow                                                                   #\\__// 
        $P             = $Code.Process                                                                                      #\\__// 
                                                                                                                            #\\__// 
        $ST            = Collect-FeaturesState -All                                                                         #\\__// 
                                                                                                                            #\\__//  
        Write-Theme -Action "Windows Server [+]" "Configuration Selected" 11 12 15                                          #\\__// 
                                                                                                                            #\\__// 
    # ____            ____            ____            ____            ____            ____    ____    ____    ____    ____   \\__// 
    #//¯¯\\__________//¯¯\\__________//¯¯\\__________//¯¯\\__________//¯¯\\__________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
    #\\__//¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
        Function Filter-DCPromoGUI # Clears and sets items in the GUI _______________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
        {#/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                [ CmdLetBinding ( ) ] Param (                                                                               #//¯¯\\ 
                                                                                                                            #\\__// 
                    [ ValidateSet ( 0 , 1 , 2 , 3 ) ][ Parameter ( Mandatory = $True ) ][ Int ] $Type = 0 )                 #//¯¯\\ 
                                                                                                                            #\\__// 
                $P         = $Type                                                                                          #//¯¯\\ 
                $Code      = Get-DCPromoControl -DType $P                                                                   #\\__// 
                                                                                                                            #//¯¯\\ 
                $DType     = "Forest" , "Tree" , "Child" , "Clone"                                                          #\\__// 
                                                                                                                            #//¯¯\\ 
                $DType     | % { $Code.$_ = "N/A" }                                                                         #\\__// 
                $DType[$P] | % { $Code.$_ = "Selected" }                                                                    #//¯¯\\ 
             # ____   ___________________________     ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
             #//¯¯\\__[_ Hides all boxed items _]____//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
             #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                $Boxes     = Get-DCPromoBoxControls                                                                         #\\__// 
                $Boxes     | % { $CTRL.$_.Visibility = "Hidden" }                                                           #\\__// 
             # ____   ___________________________     ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
             #//¯¯\\__[__ Domain Mode Toggler __]____//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
             #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                $Modes     = "Forest" , "Domain" , "Child" , "Clone" | % { "$_`Box" }                                       #\\__// 
                $Top       = @{ 0 = 0 , 1 ; 1 = 2 , 1 ; 2 = 2 , 1 ; 3 = 3 }                                                 #\\__// 
                $Top[$P]   | % { $Modes[$_] } | % { $CTRL.$_.Visibility = "Visible" }                                       #\\__// 
                                                                                                                            #\\__// 
                $DMCode    = "ForestMode" , "DomainMode" , "ParentDomainName"                                               #\\__// 
                $DMID      = @{ 0 = 1,1,0 ; 1 = 0,1,1 ; 2 = 0,1,1 ; 3 = 0,0,0 }                                             #\\__// 
                                                                                                                            #\\__// 
                ForEach ( $I in 0..2 )                                                                                      #\\__// 
                {                                                                                                           #\\__// 
                    If ( $DMID[$P][$I] -eq 0 ) { $Code.$( $DMCode[$I] ) = "N/A" }                                           #\\__// 
                }                                                                                                           #\\__// 
             # ____   ___________________________     ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
             #//¯¯\\__[______ Role Toggler _____]____//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
             #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                $Roles     = "InstallDNS" , "CreateDNSDelegation" , "NoGlobalCatalog" , "CriticalReplicationOnly"           #\\__// 
                $Roles     | % { $CTRL.$_ | % { $_.IsEnabled = $True ; $_.IsChecked = $False } }                            #\\__// 
                                                                                                                            #\\__// 
                $Enabled   = @{ 0 = 1 , 1 , 0 , 0 ; 1 = 1 , 1 , 1 , 0 ; 2 = 1 , 1 , 1 , 0 ; 3 = 1 , 1 , 1 , 1 }             #\\__// 
                $Checked   = @{ 0 = 1 , 0 , 0 , 0 ; 1 = 1 , 0 , 0 , 0 ; 2 = 1 , 1 , 0 , 0 ; 3 = 1 , 0 , 0 , 0 }             #\\__// 
                                                                                                                            #\\__// 
                ForEach ( $i in 0..( $Roles.Count - 1 ) )                                                                   #\\__// 
                {                                                                                                           #\\__// 
                    $X = $Enabled[$P][$I]                                                                                   #\\__// 
                    $Y = $Checked[$P][$I]                                                                                   #\\__// 
                    $Z = $Roles[$I]                                                                                         #\\__// 
                    $CTRL.$Z | % { $_.IsEnabled = $X ; $_.IsChecked = $Y }                                                  #\\__// 
                    $Code.$Z = $( If ( $X -eq 0 ) { "N/A" } Else { $Y } )                                                   #\\__// 
                }                                                                                                           #\\__// 
                                                                                                                            #\\__// 
                $DomaInfo  = @( @( "Domain" | % { $_ , "New$_" } | % { $_ , "$_`NetBIOS" } ; "Site" ) | % { "$_`Name" } ;   #\\__// 
                                "ReplicationSourceDC" , "Credential" ) | Sort                                               #\\__// 
                $Enabled   = @{ 0 = 0,1,1,0,0,0,1 ; 1 = 1,0,0,1,1,0,1 ; 2 = 1,0,0,1,1,0,1 ; 3 = 1,1,0,0,0,1,1 }             #\\__// 
                                                                                                                            #\\__// 
                ForEach ( $i in 0..( $DomaInfo.Count - 1 ) )                                                                #\\__// 
                {                                                                                                           #\\__// 
                    $X = $Enabled[$P][$I]                                                                                   #\\__// 
                    $Y = $DomaInfo[$I]                                                                                      #\\__// 
                    $CTRL."$Y`Box" | % { $_.Visibility = $X }                                                               #\\__// 
                    If ( $X -eq 0 ) { $Code.$Y = "N/A" }                                                                    #\\__// 
                }                                                                                                           #\\__// 
                                                                                                                            #\\__// 
                $SVC  = Get-FeatureList -Underscore                                                                         #\\__// 
                                                                                                                            #\\__// 
                ForEach ( $i in 0..16 )                                                                                     #\\__// 
                {                                                                                                           #\\__// 
                    $X = $ST[$I].Split( ' ' )[1]                                                                            #\\__// 
                    $Y = $SVC[$I]                                                                                           #\\__// 
                    If ( $X -like "*[X]*" )                                                                                 #\\__// 
                    {                                                                                                       #\\__// 
                        $CTRL.$Y | % { $_.IsEnabled = $False ; $_.IsChecked =  $True }                                      #\\__// 
                        $Code.$Y = "Installed"                                                                              #\\__// 
                    }                                                                                                       #\\__// 
                    If ( $X -like "*[_]*" )                                                                                 #\\__// 
                    {                                                                                                       #\\__// 
                        $CTRL.$Y | % { $_.IsEnabled =  $True ; $_.IsChecked =  $True }                                      #\\__// 
                        $Code.$Y = "Available"                                                                              #\\__// 
                    }                                                                                                       #\\__// 
                }                                                                                                           #\\__// 
                                                                                                                            #\\__// 
            Return $Code                                                                                                    #\\__// 
        }                                                                                                                   #\\__// 
    # ____            ____            ____            ____            ____            ____    ____    ____    ____    ____   \\__// 
    #//¯¯\\__________//¯¯\\__________//¯¯\\__________//¯¯\\__________//¯¯\\__________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
    #\\__//¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
        Function Validate-DomainName # Verfies that text entries are valid __________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
        {#/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 
                [ CmdLetBinding () ] [ OutputType ( "String" ) ] Param (                                                    #\\__// 
                                                                                                                            #\\__// 
                    [ Parameter ( Mandatory = $True , ParameterSetName = "0" ) ][ Switch ] $Domain ,                        #\\__// 
                    [ Parameter ( Mandatory = $True , ParameterSetName = "1" ) ][ Switch ] $NetBIOS ,                       #\\__// 
                    [ Parameter ( Mandatory = $True , ParameterSetName = "2" ) ][ Switch ] $SiteName ,                      #\\__// 
                    [ Parameter ( Mandatory = $True , ParameterSetName = "0" ) ]                                            #\\__// 
                    [ Parameter ( Mandatory = $True , ParameterSetName = "1" ) ]                                            #\\__// 
                    [ Parameter ( Mandatory = $True , ParameterSetName = "2" ) ][ String ] $Name )                          #\\__// 
                                                                                                                            #\\__// 
                $Char = "abcdefghijklmnopqrstuvwxyz0123456789.-\/:*?$( '"' )<>|,~:!@#$%^&'(){}_ "                           #\\__// 
                $Char | % { $AL = $_[0..25] ; $NU = $_[26..35] ; $SP = $_[38..64] ;                                         #\\__// 
                $AN = $Char[0..35] ; $NN = $Char[0..25] }                                                                   #\\__// 
                $DNS  = @{ Min = 2 ; Max = 255 ; Allow = $Char[ 0..37] ; Invalid = $SP }                                    #\\__// 
                $NBT  = @{ Min = 1 ; Max =  15 ; Allow = $Char[ 0..37] ; Invalid = $SP }                                    #\\__// 
                $SN   = @{ Min = 1 ; Max =  63 ; Allow = $Char[ 0..37] ; Invalid = $SP }                                    #\\__// 
                                                                                                                            #\\__// 
                $Reserved = @( "ANONYMOUS" , "AUTHENTICATED USER" , "BATCH" , "BUILTIN" ;                                   #\\__// 
                "GROUP" , "OWNER" | % { $_ , "$_ SERVER" } | % { "CREATOR $_" } ;                                           #\\__// 
                "DIALUP" , "DIGEST AUTH" , "INTERACTIVE" , "INTERNET" ;                                                     #\\__// 
                "LOCAL" | % { $_ , "$_ SYSTEM" } ; "NETWORK" | % { $_ , "$_ SERVICE" } ;                                    #\\__// 
                "NT AUTHORITY" , "NT DOMAIN" , "NTLM AUTH" , "NULL" , "PROXY" , "REMOTE INTERACTIVE"                        #\\__// 
                "RESTRICTED" , "SCHANNEL AUTH" , "SELF" , "SERVER" , "SERVICE" , "SYSTEM"                                   #\\__// 
                "TERMINAL SERVER" , "THIS ORGANIZATION" , "USERS" , "WORLD" )                                               #\\__// 
                                                                                                                            #\\__// 
                If ( $Domain   ) { $X = $DNS }                                                                              #\\__// 
                If ( $NetBIOS  ) { $X = $NBT }                                                                              #\\__// 
                If ( $SiteName ) { $X = $SN }                                                                               #\\__// 
                                                                                                                            #\\__// 
                    If ( $Name.Length -lt $X.Min ) { Return "Short of minimum length" }                                     #\\__// 
                ElseIf ( $Name.Length -gt $X.Max ) { Return "Exceeds maximum length" }                                      #\\__// 
                ElseIf ( ( $Name.ToCharArray() | ? { $_ -notin $X.Allow } ).Count -gt 0 ) { Return "Invalid Characters" }   #\\__// 
                ElseIf ( ( $Name.ToCharArray() | ? { $_  -in $X.Invalid } ).Count -gt 0 ) { Return "Invalid Characters" }   #\\__// 
                                                                                                                            #\\__// 
                If ( ( $Domain ) -or ( $SiteName ) )                                                                        #\\__// 
                {                                                                                                           #\\__// 
                    If ( ( $Name[0] | ? { $_ -notin $AN } ).Count -gt 0 )                                                   #\\__// 
                        { Return "First character must be Alpha-Numeric" }                                                  #\\__// 
                    ElseIf (   $Name | % { $_.EndsWith( "." ) -or $_.EndsWith( "-" ) } )                                    #\\__// 
                        { Return "Last Character cannot be a period/hyphen" }                                               #\\__// 
                }                                                                                                           #\\__// 
                                                                                                                            #\\__// 
                If ( $Domain )                                                                                              #\\__// 
                {                                                                                                           #\\__// 
                    If ( $Name.Split('.').Count -le 1 )                                                                     #\\__// 
                        { Return "Not a valid domain name" }                                                                #\\__// 
                    ElseIf ( ( $Name.Split('.')[-1].ToCharArray() | ? { $_ -in @( $AL ; '-' , '.' ) } ).Count -eq 0 )       #\\__// 
                        { Return "Top Level Domain must contain a non-numeric character" }                                  #\\__// 
                    Else                                                                                                    #\\__// 
                        { Return $Name }                                                                                    #\\__// 
                }                                                                                                           #\\__// 
                                                                                                                            #\\__// 
                If ( $SiteName )                                                                                            #\\__// 
                {                                                                                                           #\\__// 
                    If ( $X -in $Reserved ) { Return "The selected name conflicts with a reservation" }                     #\\__// 
                    Else { Return $Name }                                                                                   #\\__// 
                }                                                                                                           #\\__// 
                                                                                                                            #\\__// 
                If ( $NetBIOS )                                                                                             #\\__// 
                {                                                                                                           #\\__// 
                        If ( $Name[0] -eq "." )                                                                             #\\__// 
                        {                                                                                                   #\\__// 
                          Return "First Character must be Alpha-Numeric, or '.' "                                           #\\__// 
                        }                                                                                                   #\\__// 
                        Else { Return $Name.ToUpper() }                                                                     #\\__// 
                }                                                                                                           #\\__// 
            }                                                                                                               #\\__// 
             # ____   ___________________________     ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__// 
             #//¯¯\\__[__ Domain Mode Toggler __]____//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
             #¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯\\__// 

            $Code = Filter-DCPromoGUI -Type ( 2 )

            $Roles     = "InstallDNS" , "CreateDNSDelegation" , "NoGlobalCatalog" , "CriticalReplicationOnly"

            ForEach ( $I in 0..3 ) 
            { 
                $Check = $CTRL.$( $Roles[$I] )

                If ( $Check.IsEnabled -eq $True ) 
                {
                    $Check | % { $_.Add_Checked({   $Code.$( $Roles[$I] ) =  $True })
                                 $_.Add_UnChecked({ $Code.$( $Roles[$I] ) = $False })
                    }
                }
            }

            $Menu = "Forest" , "Tree" , "Child" , "Clone"

            ForEach ( $I in 0..3 )
            {
                $CTRL.$( $Menu[$I] ).Add_Click({ If ( $Code.Process -ne $I ) { $Code = Filter-DCPromoGUI -Type $I }})
            }

            If ( $Code.Process -eq 1 ) 
            {
                $CTRL.CredentialButton.Add_Click({ 

                $X = $CTRL.ParentDomainName.Text 
                $Y = Validate-DomainName -Domain -Name $X 
                If ( $X -ne $Y ) { [ System.Windows.MessageBox ]::Show( "$Y in Parent Domain Name" , "Error" ) }
                Else             
                { 
                    $Y  = Resolve-DnsName $X -Type A | ? { $_ -ne $Null } | % { $_.IPAddress }
                    
                    ARP -A | ? { $_ -like "*$( $Y )*" } | % {

                        $NB = $( If ( $_ -like "*Interface: $_*" )
                        {
                            NBTStat -N    | ? { $_ -like "*<1C>*" } # Checks current machine, that's what came up
                        }
                        ElseIf ( $_ -notlike "*Interface: $_*" )
                        {
                            NBTStat -A $Y | ? { $_ -like "*<1C>*" }
                        }
                        Else
                        {
                            Write-Theme "Exception [!]" "Domain NetBIOS name could not be determined."
                            Break
                        }) }

                        If ( $NB.Count -gt 1 ) { $NB = $NB | Select -First 1 }
                        $NB = ( $NB[0..18] | ? { $_ -ne " " } ) -join ''

                        $Y  = $( If ( $Y.Count -gt 1 ) { $Y[0] } ) 
                        {
                            $Y  = Resolve-DNSName $Y.IPAddress | % { $_.NameHost }
                            $C  = $X , $Y | % { $_.Split('.').Count }
                            $C[1] - $C[0] | % { If ( $_ -eq 1 ) { $LZ = 0 } Else { $LZ = 0..$_ } }
                            
                            $Credentials = @{ DC      = $Y.Split('.')[$LZ] 
                                              Domain  = $X 
                                              NetBIOS = $NB | ? { $_ -ne $Null } }

                            $DCCred = Enter-ServiceAccount @Credentials
                        }
                    }
                }
            })



            $CTRL.Cancel.Add_Click( { $CTRL.DialogResult = $False } )

            $CTRL.Ok.Add_Click({
                
                $Top   = @( "Forest" , "Domain" | % { "$_`Mode" } ; "ParentDomainName" )
                $Roles = "InstallDNS" , "CreateDNSDelegation" , "NoGlobalCatalog" , "CriticalReplicationOnly"
                $DMID  = @( @( "Domain" | % { $_ , "New$_" } | % { $_ , "$_`NetBIOS" } ; "Site" ) | % { "$_`Name" } ; "ReplicationSourceDC" , "Credential" ) | Sort 

                If ( $Code.Process -eq 0 ) # Install-ADDSForest
                {
                    # Top
                    $Top[0,1] | % { $Code.$_ = $CTRL.$_.SelectedIndex }

                    # Roles
                    $Roles[0,1] | ? { $CTRL.$_.IsEnabled } | % { $Code.$_ = $CTRL.$_.IsChecked }
                        
                    # Domain Info
                    $Items  = $DMID[1,2,6]
                    $Con    = $Items | % { $CTRL.$_.Text }

                    $Con[1] = $Con[1].ToUpper()
                    
                    $ID     = "Domain" , "NetBIOS" , "Site" | % { "$_ Name Cannot Be Empty" }
                    $ID    += "Invalid Domain Name"
                    $MSG    = $ID | % { "[ System.Windows.Messagebox ]::Show( '$_' )" }
                    $Val    = 0..2
                    $Val[0] = Validate-DomainName   -Domain -Name $Con[0]
                    $Val[1] = Validate-DomainName  -NetBIOS -Name $Con[1]
                    $Val[2] = Validate-DomainName -SiteName -Name $Con[2]

                        If ( $Con[0] -eq        "" ) { IEX $MSG[0] }
                    ElseIf ( $Con[0] -ne   $Val[0] ) { [ System.Windows.MessageBox ]::Show( $Con[0] ) }
                    ElseIf ( $Con[1] -eq        "" ) { IEX $MSG[1] }
                    ElseIf ( $Con[1] -ne   $Val[1] ) { [ System.Windows.MessageBox ]::Show( $Con[1] ) }
                    ElseIf ( $Con[2] -eq        "" ) { IEX $MSG[2] }
                    ElseIf ( $Con[2] -ne   $Val[2] ) { [ System.Windows.MessageBox ]::Show( $Con[2] ) }

                    Else { 0..2 | % { $Code.$( $Items[$_] ) = $Con[$_] } }
                }

                If ( $Code.Process -eq 1 ) # Install-ADDSDomain Tree
                {       
                    # Top
                    $Top[1] | % { $Code.$_ = $CTRL.$_.SelectedIndex }
                    $Top[2] | % { $Code.$_ = $CTRL.$_.Text }


                        




                If ( $Process -eq 0 )
                {
                    "DomainName" ,
                    "DomainNetBIOSName" ,
                    "SiteName"

                If ( $Process -eq 1 )
                { 
                    If ( $GUI.Branch.Text -like "*$Domain*" )
                    {
                        [ System.Windows.MessageBox ]::Show( "Entry is too similar to main domain" , "Similar Domain Name Error" )
                    }

                    If ( $GUI.Branch.Text -like "*$NetBIOS*" )
                    {
                        [ System.Windows.MessageBox ]::Show( "Entry is too similar to main domain" , "Similar NetBIOS Name Error" )

                    }

                    Else
                    {
                        #$Out.DomainType          = "TreeDomain"
                        "DomainType"              = "TreeDomain"
                        "NewDomainName"           = "sideways.com"
                        "NewDomainNetBIOS"        = "SIDEWAYS"
                        "SiteName"		          = "Default-First-Site-Name"
                        $Out.DomainName           = ""
                        $Out.DomainNetBIOSName    = $GUI.NetBIOS
                        $Out.NewDomainName        = $GUI.Branch
                        $Out.NewDomainNetBIOSName = ""
                        $Out.ParentDomainName     = $GUI.Domain
                    }
                }

                If ( $Process -eq 2 )
                {
                    If ( $GUI.Branch.Text -like "" )
                    {
                        
                    }
                }


            ElseIf ( $GUI.DSRM_PW.Password -eq       $Null )                 { IEX $MSG[1] }
            ElseIf ( $GUI.DSRM_CF.Password -eq       $Null )                 { IEX $MSG[2] }
            ElseIf ( $GUI.DSRM_PW.Password -eq       $Null )                 { IEX $MSG[1] }
            ElseIf ( $GUI.DSRM_CF.Password -eq       $Null )                 { IEX $MSG[2] }
            ElseIf ( $GUI.DSRM_PW.Password -notmatch $GUI.DSRM_CF.Password ) { IEX $MSG[2] }
            Else { $GUI.DialogResult = $True }
        })


        $GUI.Process.SelectedIndex = 0 ; $Process                   = 0 ; $GUI.Branch.IsEnabled      = $False

        $GUI.DCAdmin  | % { $_.Text = $( If ( $DCCred.UserName -ne $Null ) { $DCCred.UserName } Else { "" } ) }
        $GUI.Database | % { $_.Text = "C:\Windows\NTDS"   }
        $GUI.Sysvol   | % { $_.Text = "C:\Windows\SYSVOL" }
        $GUI.Log      | % { $_.Text = "C:\Windows\SYSVOL" }
        $GUI.SiteName | % { $_.Text = $( If ( $Sitelink ) { $Sitelink } Else { "Default-First-Site-Name" } ) }
        $GUI.Domain   | % { $_.Text = $( If ( $Domain   ) { $Domain   } Else {   "Enter new Domain Name" } ) }
        $GUI.NetBIOS  | % { $_.Text = $( If ( $NetBIOS  ) { $NetBIOS  } Else {  "Enter new NetBIOS Name" } ) }

        $Null = $GUI.DSRM_PW.Focus()

        $OP   = Show-WPFWindow -GUI $GUI


        If ( $OP -eq $True )
        {
             Echo $Combo

             $Out.SafeModeAdministratorPassword  = $GUI.DSRM_PW.SecurePassword
             $Out.ForestMode                     = $GUI.ForestMode.SelectedIndex + 1
             $Out.DomainMode                     = $GUI.DomainMode.SelectedIndex + 1
        If ( $Out.ForestMode -in 7..8 ) {          $Out.ForestMode = 7 }
        If ( $Out.DomainMode -in 7..8 ) {          $Out.DomainMode = 7 }
             $Out.Credential                     = $DCCred
             $Out.DatabasePath                   = $GUI.Database.Text
             $Out.SysvolPath                     = $GUI.Sysvol.Text 
             $Out.LogPath                        = $GUI.Log.Text
             $Out.SiteName                       = $GUI.SiteName.Text
             $Out.DomainName                     = $GUI.Domain.Text
             $Out.DomainNetBIOSName              = $GUI.NetBIOS.Text

             $Out | GM | ? { $_.MemberType -eq "NoteProperty" } | Select Name

             Echo $Out
             Read-Host "Correct?"
        }

        Else { Write-Theme -Action "[!] Exception" "Either the user cancelled, or the dialogue failed" }
        
    }
             $Names = $Out | GM | ? { $_.MemberType -eq "NoteProperty" } | % { $_.Name }

             #11,0,2,3,5,9,10,12,14,15,7,1 # Domain Controller

             $Out | Select SafeModeAdministratorPassword , CreateDNSDelegation , DatabasePath , DomainMode , DomainName , DomainNetBIOSName , ForestMode , InstallDNS , LogPath , NoRebootOnCompletion , SysvolPath , Force

             # ADDS New Forest / 13,0,3,4,5,6,8,9,10,12,15,7  # Forest

             $AD = @{   SafeModeAdministratorPassword = $Out.SafeModeAdministratorPassword
                                  CreateDnsDelegation = $Out.InstallDns
                                         DatabasePath = $Out.DatabasePath 
                                           DomainMode = $Out.DomainMode
                                           DomainName = $Out.DomainName
                                    DomainNetBIOSName = $Out.DomainNetBIOSName
                                           ForestMode = $Out.ForestMode
                                           InstallDns = $Out.InstallDNS
                                              LogPath = $Out.LogPath
                                 NoRebootOnCompletion = $Out.NoRebootUponCompletion
                                           SysvolPath = $Out.SysvolPath
                                                Force = $Out.Force
                    }

            $ADND = @{  
                        SafeModeAdministratorPassword = $Out.SafeModeAdministratorPassword
                                  CreateDNSDelegation = $Out.CreateDnsDelegation
                                         DatabasePath = $Out.DatabasePath
                                           DomainMode = $Out.DomainMode
                                           DomainName = $Out.DomainName
                                    DomainNetBIOSName = $Out.DomainNetBIOSName 
                                    
                     }

        #$ADDS = @( 'SkipPreChecks' , 'NewDomainName' , 'ParentDomainName' , 'SafeModeAdministratorPassword', 'ADPrepCredential' , 'AllowDomainReinstall' , 'CreateDnsDelegation'
        #'Credential' , 'DatabasePath' , 'DnsDelegationCredential' , 'NoDnsOnNetwork' , 'DomainMode' , 'DomainType' , 'NoGlobalCatalog' , 'InstallDns' , 'LogPath' ,
        #'NewDomainNetbiosName' , 'NoRebootOnCompletion' , 'ReplicationSourceDC' , 'SiteName' , 'SkipAutoConfigureDns' , 'SysvolPath' , 'Force' )

            # 11 , 0 , 2 , 3 , 5 , 9 , 10 , 12 , 14 , 15 , 7 , 1

            $ADDSC = @{               NoGlobalCatalog = $False 
                                  CreateDnsDelegation = $False 
                              CriticalReplicationOnly = $False 
                                         DatabasePath = “C:\Windows\NTDS”
                                           DomainName = $GUI.DomainName.Text 
                                           InstallDns = $True 
                                              LogPath = “C:\Windows\NTDS” 
                                 NoRebootOnCompletion = $False
                                             SiteName = $GUI.NetBIOS.Text
                                           SysvolPath = “C:\Windows\SYSVOL” 
                                                Force = $True 
                                           Credential = $Cred }

        }
