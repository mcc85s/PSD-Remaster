<#___ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____  
//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\   ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯   //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//  [ Secure Digits Plus LLC | Hybrid | Desired State Controller ]  \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯       _____________________________________________________        ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯        __/¯¯\__[ Dynamically Engineered Digital Security ]__/¯¯\__         ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\  _________________________ ________________ ___________________________________  //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
\\__//¯¯\\__//¯¯\\__//¯¯\\__// | Application Development | Virtualization | Network and Hardware Magistration | \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\  ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯  //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
\\__//¯¯\\__//¯¯\\__//¯¯\\__//   https://www.securedigitsplus.com | Server-Client | Seedling-Spawning Script    \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\___¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯   ¯¯¯¯¯¯¯¯¯¯¯¯¯   ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ___//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\   [ Provisional Author : Michael C Cook Sr. | "The Buck Stops Here" ]    //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//   ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
\\__/====\__/----\__/====\__/----\__/====\__/----\__/====\__/----\__/====\__/----\__/====\__/----\__/====\__/----\__/====\__/----\__/====\__/----\__// 
//¯¯    
\\  [ Use-ViperBombServices ] @: Services & Group Policy Template Generator [ Extensively Modified version of "MadBomb122" & Charles Spark's scripts ]
//   ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____      
\\__/----\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//==\\__/---\\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//==\\___  
//¯¯\\___________________________________________________________________________________¯¯¯¯ -- ¯¯¯¯ ¯¯ ¯¯¯¯ -- ¯¯¯¯ ¯¯ ¯¯¯¯ -- ¯¯¯¯ ¯¯ ¯¯¯¯ -- ¯¯¯\\ 
\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\___ __ ____ -- ____ __ ____ -- ____ __ ____ -- ____ __ ___// 
 ¯¯¯\\__[ Initial Script Prerequisite Declarations ]____________________________________//¯¯\----/¯¯\\==//¯¯\----/¯¯\\==//¯¯\----/¯¯\\==//¯¯\----/¯¯¯  
     ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯      

      Foreword: This script has been extensively modified/completely revamped, however I still make every effort to credit the original authors.
      ¯¯¯¯¯¯¯¯                       ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯          ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯
                Revisions include, the 'code-behind' PowerShell script, as well as the XAML GUI.

                MadBomb122 has a real name and in respect to him, I have chosen to leave that information outside of this script.
                I have collaborated with MadBomb122 over the course of the last 6-7 months, tentatively, in helping to teach him some refinement
                techniques on my journey to advance my Application Development experience.

                The desired end result of working with this script, is to easily implement government grade STIG templates for end users, which 
                you can find some of those technical details/documents here -> @ https://github.com/nsacyber/Windows-Secure-Host-Baseline
                
              - MCC / SDP
                ¯¯¯¯¯¯¯¯¯
    _________________________
    [ Original Script & GUI ]
    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯
         Author: Madbomb122
        Website: https://GitHub.com/Madbomb122/BlackViperScript/
    _________________________
    [ Service Configuration ]
    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯
         Author: Charles "Black Viper" Sparks
        Website: http://www.BlackViper.com/
    _________________________
    [_ Comment Based Help __]
    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯
        <#--------------------------------------------------------------------------------

        .Prerequisite to run script
	        System*: Windows 10 x64 (64-bit)
	        Edition*: Home or Pro
	        Min Build*: Creator's Update
	        Max Build*: April 2018 Update
	        Files: This script and 'BlackViper.csv' (Service Configurations)
          *Can run on x32/32-bit or other Edition, Build AT YOUR OWN RISK)

        .DESCRIPTION
	        Script that can set services based on Black Viper's Service Configurations
	        or your own custom services, or backup services (created by this script)

        .AT YOUR OWN RISK YOU CAN
	        1. Run the script on x86 (32-bit) w/o changing settings (But shows a warning)
	        2. Skip the check for
		        A. Home/Pro ($EditionCheck variable bottom of script or use -sec switch)
		        B. Creator's Update ($BuildCheck variable bottom of script or use -sbc switch)

        .BASIC USAGE
	        1. Run script with (Next Line)
        powershell.exe -NoProfile -ExecutionPolicy Bypass -File BlackViper-Win10.ps1
	        2. Use bat file provided

	        Use Gui to Select the desired Choices and click Run

        .ADVANCED USAGE
            Details within global control hash table below
	        One of the following Methods...
	        1. Edit values at bottom of the script then run script
	        2. Edit bat file and run
	        3. Run the script with one of these switches (space between multiple)
	        4. Run the script and pick options in GUI



        ------------------------------------------------------------------------------#>

    $Control = [ PSCustomObject ]@{

        PassedArgs          = $( If ( ! $Args ) { "N/A" } Else { $Args } )

        <#  Switch          Description of Switch
            ¯¯¯¯¯¯          ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯
            Basic Switches
            ¯¯¯¯¯¯¯¯¯¯¯¯¯¯
            -atos           Accepts ToS
            -auto           Implies -atos...Runs the script to be Automated.. Closes on - User Input, Errors, or End of Script

            Service Configuration Switches
            ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯
            -default        Runs the script with Services to Default Configuration
            -safe           Runs the script with Services to Black Viper's Safe Configuration
            -tweaked        Runs the script with Services to Black Viper's Tweaked Configuration
            -lcsc File.csv  Loads Custom Service Configuration, File.csv = Name of your backup/custom file

            Service Choice Switches
            ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯
            -all            Every windows services will change
            -min            Just the services different from the default to safe/tweaked list
            -sxb            Skips changes to all XBox Services

            Update Switches
            ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯
            -usc            Checks for Update to Script file before running
            -use            Checks for Update to Service file before running
            -sic            Skips Internet Check, if you can't ping GitHub.com for some reason

            Log Switches
            ¯¯¯¯¯¯¯¯¯¯¯¯
            -log            Makes a log file using default name Script.log
            -log File.log   Makes a log file named File.log
            -baf            Log File of Services Configuration Before and After the script

            Backup Service Configuration
            ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯
            -bscc           Backup Current Service Configuration, Csv File
            -bscr           Backup Current Service Configuration, Reg File
            -bscb           Backup Current Service Configuration, Csv and Reg File

            Display Switches
            ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯
            -sas            Show Already Set Services
            -snis           Show Not Installed Services
            -sss            Show Skipped Services

            Misc Switches
            ¯¯¯¯¯¯¯¯¯¯¯¯¯
            -dry            Runs the Script and Shows what services will be changed
            -css            Change State of Service
            -sds            Stop Disabled Service

            AT YOUR OWN RISK Switches
            ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯
            -secp           Skips Edition Check by Setting Edition as Pro
            -sech           Skips Edition Check by Setting Edition as Home
            -sbc            Skips Build Check

            Dev Switches
            ¯¯¯¯¯¯¯¯¯¯¯¯
            -devl           Makes a log file with various Diagnostic information, Nothing is Changed
            -diag           Shows diagnostic information, Stops -auto
            -diagf          Forced diagnostic information, Script does nothing else

            Help
            ¯¯¯¯
            -help           Shows list of switches, then exits script.. alt -h
            -copy           Shows Copyright/License Information, then exits script #>

        #AcceptTOS           = 0
        TermsOfService       = 0

            # 0 = See ToS
            # Anything Else = Accept ToS

        # ShowActiveServices = 1
        DisplayActive        = 1

            # 0 = Don't Show Already set Services
            # 1 = Show Already set Services

        # ShowNonInstalled   = 0
        DisplayInactive      = 0

            # 0 = Don't Show Services not present
            # 1 = Show Services not present

        # ShowSkipped        = 0
        DisplaySkipped       = 0

            # 0 = Don't Show Skipped Services
            # 1 = Show Skipped Services

        # DryRun             = 0
        MiscSimulate         = 0

            # 0 = Runs script normally
            # 1 = Runs script but shows what will be changed

        # XboxService        = 0
        MiscXbox             = 0

            # 0 = Change Xbox Services
            # 1 = Skip Change Xbox Services

        #ChangeState         = 0
        MiscChange           = 0

            # 0 = Dont Change State of service to specified/loaded
            # 1 = Change State of service to specified/loaded

        #StopDisabled        = 0
        MiscStopDisabled     = 0

            # 0 = Dont change running status
            # 1 = Stop services that are disabled

        # Diagnostic         = 0
        DevelDiagErrors      = 0

            # 0 = Doesn't output diagnostic errors
            # 1 = Output diagnostic errors

        # DevLog             = 0
        DevelLog             = 0

            # 0 = Doesn't make a Dev Log
            # 1 = Makes a log files
            # Devlog Contains -> Service Change, Before & After for Services, and Diagnostic Info --Runs as Dryrun

        # ShowConsole        = 0
        DevelConsole         = 0

            # 0 = Hides console window (Only on stable release)
            # 1 = Shows console window -Forced in Testing release

        # Not Enabled
        DevelDiagReport      = 0

            # 0 = Does not load Diagnostic panel
            # 1 = Loads Diagnostic Panel

        #BuildCheck          = 0
        BypassBuild          = 0

            # 0 = Check Build (Creator's Update Minimum)
            # 1 = Skips this check

        #EditionCheck        = 0
        BypassEdition        = 0

            # 0 = Check if Home or Pro Edition
            # 'Pro' = Set Edition as Pro (Needs 's)
            # 'Home' = Set Edition as Home (Needs 's)

        #Laptop
        BypassLaptop         = 0

            # 0 = Does not bypass/load laptop override settings
            # 1 = Overrides potential laptop settings

        #ScriptLog           = 0
        LoggingService       = 0

            # 0 = No Services Logging
            # 1 = Services Logging

        LoggingServiceFile   = "Service.log"

            # Path to Service Log File

        LoggingScript        = 0

            # 0 = No Transcript
            # 1 = Enable Transcript

        LoggingScriptFile    = "Script.log"

            # Path to Transcript Log File

        BackupRegistry       = 0

            # 0 = Does not back up the current service/registry settings
            # 1 = Enables path to backup current service registry

        BackupRegistryFile   = "Backup.reg"

            # Path to Current Service Registry Output

        BackupTemplate       = 0

            # 0 = Does not back up the current service/template settings
            # 1 = Enables path to backup current service template

        BackupTemplateFile   = "Backup.csv"

            # Path to Current Service Template Output
        
            # 0 = Don't make a log file
            # 1 = Make a log file
            # Will be script's directory named `Script.log` (default)

        ServiceConfig        = "Black Viper (Sparks v1.0)"
        ServiceProfile       = "Default"

        ScriptConfig         = "DevOPS (MD/SDP v1.0)"
        ScriptProfile        = "Default"

    }
                                                                                    #____ -- ____    ____ -- ____    ____ -- ____    ____ -- ____      
# ____                                                                            __//¯¯\\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//¯¯\\___  
#//¯¯\\__________________________________________________________________________/¯¯¯    ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯        ____    ____ __ ____ __ ____ __ ____ __ ____ __ ____    ___// 
    Function Resolve-Script # Provides Global Script Definitions _______________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    {#/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯      
        [ CmdLetBinding () ] Param (

            [ Parameter ( ParameterSetName =   "Version" ) ] [ Switch ] $Version   ,
            [ Parameter ( ParameterSetName =      "Path" ) ] [ Switch ] $Path      ,
            [ Parameter ( ParameterSetName = "Copyright" ) ] [ Switch ] $Copyright ,
            [ Parameter ( ParameterSetName =      "Help" ) ] [ Switch ] $Help      )

        If ( $Version )
        {
            $I = "https://GitHub.com/madbomb122/BlackViperScript" | % { $_ ; "$_/master".Replace( '//' , '//raw.' ) }
            
            [ PSCustomObject ]@{ 
    
                Version        = '6.2.0' 
                Date           = 'Nov-13-2019'
                Release        = "Stable"
                Site           = $I[0]
                URLBase        = $I[1]
                URLVersion     = "$( $I[1] )/Version/Version.CSV"
                URLService     = "$( $I[1] )/BlackViper.CSV"
                URLDonate      = "https://www.amazon.com/gp/registry/wishlist/YBAYWBJES5DE/"
            }
        }

        If ( $Path )
        {
            ( $PSCommandPath , $PSISE.CurrentFile.FullPath )[ $PSISE -ne $Null ] | % {
            
                [ PSCustomObject ]@{ 
            
                    Parent = Split-Path $_ -Parent
                    Leaf   = Split-Path $_ -Leaf 
                }
            }
        }

        If ( $Copyright )
        {   
            "   " ,
            "Copyright (c) 2019 Zero Rights Reserved " ,
            "Services Configuration by Charles 'Black Viper' Sparks " ,
            "   " ,
            "------------------------------------------------------------------------" ,
            "   " , 
            "The MIT License (MIT) + an added Condition " ,
            "   " ,
            "Copyright (c) 2017-2019 Madbomb122 " ,
            "[ Black Viper Service Script ] " ,
            "   " , 
            "     Permission is hereby granted, free of charge, to any person obtaining a copy of this software and    " , 
            "associated documentation files (the 'Software'), to deal in the Software without restriction, including   " ,
            "without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell   " , 
            "copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the  " , 
            "following conditions:                                                                                     " ,
            "   " , 
            "   The above copyright notice(s), this permission notice and ANY original donation link shall be included "
            "in all copies or substantial portions of the Software.                                                    " ,
            "   " ,
            "   THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT  " ,
            "LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO " , 
            "EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER " , 
            "IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR   " ,
            "THE USE OR OTHER DEALINGS IN THE SOFTWARE.                                                                "
        }

        If ( $Help )
        {
            "List of Switches                                                                                          " , 
            "$( "-" * 108 )" , 
            "   " ,
            " Switch            Description of Switch                                                                  " , 
            "   " , 
            " -- Basic Switches --                                                                                     " , 
            "  -atos            Accepts ToS                                                                            " , 
            "  -auto            Implies -atos ... Runs the script to be Automated..                                    " , 
            "                   Closes on - User Input, Errors, or End of Script                                       " , 
            "   " , 
	        " -- Service Configuration Switches --                                                                     " , 
	        "  -default         Runs the script with Services to Default Configuration                                 " , 
            "  -safe            Runs the script with Services to Black Viper's Safe Configuration                      " , 
            "  -tweaked         Runs the script with Services to Black Viper's Tweaked Configuration                   " , 
            "  -lcsc File.csv   Loads Custom Service Configuration, File.csv = Name of your backup/custom file         " , 
            "   " ,
            " --Service Choice Switches--                                                                              " , 
            "  -all             Every windows services will change                                                     " , 
            "  -min             Just the services different from the default to safe/tweaked list                      " , 
            "  -sxb             Skips changes to all XBox Services                                                     " , 
            "   " ,
            " --Update Switches--                                                                                      " , 
	        "  -usc             Checks for Update to Script file before running                                        " , 
            "  -use             Checks for Update to Service file before running                                       " , 
            "  -sic             Skips Internet Check, if you can't ping GitHub.com for some reason                     " , 
            "   " ,
            " --Log Switches--                                                                                         " , 
            "  -log             Makes a log file named using default name Script.log                                   " , 
            "  -log File.log    Makes a log file named File.log                                                        " , 
            "  -baf             Log File of Services Configuration Before and After the script                         " , 
            "   " ,
            " --Backup Service Configuration--                                                                         " , 
            "  -bscc            Backup Current Service Configuration, Csv File                                         " , 
            "  -bscr            Backup Current Service Configuration, Reg File                                         " , 
            "  -bscb            Backup Current Service Configuration, Csv and Reg File                                 " , 
            "   " ,
            " --Display Switches--                                                                                     " , 
            "  -sas             Show Already Set Services                                                              " , 
            "  -snis            Show Not Installed Services                                                            " , 
            "  -sss             Show Skipped Services                                                                  " , 
            "   " ,
            " --Misc Switches--                                                                                        " , 
            "  -dry             Runs the Script and Shows what services will be changed                                " , 
            "  -css             Change State of Service                                                                " , 
            "  -sds             Stop Disabled Service                                                                  " , 
            "   " ,
            " --AT YOUR OWN RISK Switches--                                                                            " , 
            "  -secp            Skips Edition Check by Setting Edition as Pro                                          " , 
            "  -sech            Skips Edition Check by Setting Edition as Home                                         " , 
            "  -sbc             Skips Build Check                                                                      " , 
            "   " ,
            " --Dev Switches--                                                                                         " ,
            "  -devl            Makes a log file with various Diagnostic information, Nothing is Changed               " , 
            "  -diag            Shows diagnostic information, Stops -auto                                              " , 
            "  -diagf           Forced diagnostic information, Script does nothing else                                " , 
            "   " ,
            " --Help--                                                                                                 " ,
            "  -help            Shows list of switches, then exits script.. alt -h                                     " , 
            "  -copy            Shows Copyright/License Information, then exits script                                 "
        }
                                                                                    #____ -- ____    ____ -- ____    ____ -- ____    ____ -- ____      
}#____                                                                            __//¯¯\\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//¯¯\\___  
#//¯¯\\__________________________________________________________________________/¯¯¯    ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯        ____    ____ __ ____ __ ____ __ ____ __ ____ __ ____    ___// 
    Function Return-ViperBombGUI #______________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    {#/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯      
        [ CmdLetBinding () ] Param (

            [ Parameter ( Mandatory , ParameterSetName =   'Main' ) ][ Switch ] $Main  ,
            [ Parameter ( Mandatory , ParameterSetName = 'Alaert' ) ][ Switch ] $Alert )

    $GWF  = Resolve-HybridDSC -Graphics

    If ( $Main )
    {
        $Xaml = @"
        <Window 
                               xmlns = 'http://schemas.microsoft.com/winfx/2006/xaml/presentation'
                             xmlns:x = 'http://schemas.microsoft.com/winfx/2006/xaml'
                               Title = 'Secure Digits Plus LLC | Hybrid @ ViperBomb Service Configuration Utility'
                              Height = '540'
                               Width = '720'
                                Icon = '$( $GWF.Icon )'
                             Topmost = 'True'
                         BorderBrush = 'Black'
                          ResizeMode = 'NoResize'
                 HorizontalAlignment = 'Center'
               WindowStartupLocation = 'CenterScreen'>
            <Window.Resources>
                <Style x:Key         = 'SeparatorStyle1' 
                       TargetType    = '{x:Type Separator}'>
                    <Setter Property = 'SnapsToDevicePixels' 
                            Value    = 'True'/>
                    <Setter Property = 'Margin' 
                            Value    = '0,0,0,0'/>
                    <Setter Property = 'Template'>
                        <Setter.Value>
                            <ControlTemplate TargetType     = '{x:Type Separator}'>
                                <Border Height              = '24' 
                                        SnapsToDevicePixels = 'True' 
                                        Background          = '#FF4D4D4D' 
                                        BorderBrush         = 'Azure' 
                                        BorderThickness     = '1,1,1,1' 
                                        CornerRadius        = '5,5,5,5'/>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
                <Style TargetType    = '{x:Type ToolTip}'>
                    <Setter Property = 'Background' 
                            Value    = '#FFFFFFBF'/>
                </Style>
            </Window.Resources>
            <Window.Effect>
                <DropShadowEffect/>
            </Window.Effect>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height        = '24'/>
                    <RowDefinition Height        = '*'/>
                    <RowDefinition Height        = '48'/>
                </Grid.RowDefinitions>
                <Menu Grid.Row                   = '0'
                      IsMainMenu                 = 'True'
                      Padding                    = '5'
                      FontFamily                 = 'Lucida Console'>
                    <MenuItem     Header         = 'Configuration'>
                        <MenuItem Header         = 'Home'>
                            <MenuItem Name       = 'Menu_Config_Home_Default_Max'
                                      Header     = 'Default Maximum'/>
                            <MenuItem Name       = 'Menu_Config_Home_Default_Min'
                                      Header     = 'Default Minimum'/>
                        </MenuItem>
                        <MenuItem Header         = 'Pro'>
                            <MenuItem Name       = 'Menu_Config_Pro_Default_Max' 
                                      Header     = 'Default Maximum'/>
                            <MenuItem Name       = 'Menu_Config_Pro_Default_Min' 
                                      Header     = 'Default Minimum'/>
                        </MenuItem>
                        <MenuItem     Header     = 'Desktop'>
                            <MenuItem Name       = 'Menu_Config_Desktop_Safe_Max' 
                                      Header     = 'Safe Maximum'/>
                            <MenuItem Name       = 'Menu_Config_Desktop_Safe_Min' 
                                      Header     = 'Safe Minimum'/>
                            <MenuItem Name       = 'Menu_Config_Desktop_Tweaked_Max' 
                                      Header     = 'Tweaked Maximum'/>
                            <MenuItem Name       = 'Menu_Config_Desktop_Tweaked_Min' 
                                      Header     = 'Tweaked Minimum'/>
                        </MenuItem>
                        <MenuItem     Header     = 'Laptop'>
                            <MenuItem Name       = 'Menu_Config_Laptop_Safe_Max' 
                                      Header     = 'Safe Maximum'/>
                            <MenuItem Name       = 'Menu_Config_Laptop_Safe_Min' 
                                      Header     = 'Safe Minimum'/>
                        </MenuItem>
                    </MenuItem>
                    <MenuItem     Header         = 'Info'>
                        <MenuItem Name           = 'Menu_Info_Feedback'
                                  Header         = 'Feedback'/>
                        <MenuItem Name           = 'Menu_Info_FAQ'
                                  Header         = 'FAQ'/>
                        <MenuItem Name           = 'Menu_Info_About'
                                  Header         = 'About'/>
                        <MenuItem Name           = 'Menu_Info_Copyright'
                                  Header         = 'Copyright'/>
                        <MenuItem Header         = 'MadBomb122'>
                            <MenuItem Name       = 'Menu_Info_MadBomb_Donate'
                                      Header     = 'Donate to MadBomb122'/>
                            <MenuItem Name       = 'Menu_Info_MadBomb_GitHub'
                                      Header     = 'Original GUI/Script Source -> GitHub'/>
                        </MenuItem>
                        <MenuItem     Name       = 'Menu_Info_BlackViper'
                                      Header     = 'BlackViper Service Configuration Website'/>
                        <MenuItem     Name       = 'Menu_Info_Secure_Digits_Plus'
                                      Header     = 'Secure Digits Plus: Fighting Entropy'/>
                    </MenuItem>
                </Menu>
                <Grid Grid.Row                   = '1'>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width  = '*'/>
                    </Grid.ColumnDefinitions>
                    <TabControl BorderBrush      = 'Gainsboro' 
                                Grid.Row         = '1' 
                                Name             = 'TabControl'>
                        <TabControl.Resources>
                            <Style TargetType    = 'TabItem'>
                                <Setter Property = 'Template'>
                                    <Setter.Value>
                                        <ControlTemplate TargetType                   = 'TabItem'>
                                            <Border Name                              = 'Border' 
                                                    BorderThickness                   = '1,1,1,0' 
                                                    BorderBrush                       = 'Gainsboro' 
                                                    CornerRadius                      = '4,4,0,0' 
                                                    Margin                            = '2,0'>
                                                <ContentPresenter x:Name              = 'ContentSite' 
                                                                  VerticalAlignment   = 'Center' 
                                                                  HorizontalAlignment = 'Center' 
                                                                  ContentSource       = 'Header' 
                                                                  Margin              = '10,2'/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property      = 'IsSelected' 
                                                         Value         = 'True'>
                                                    <Setter TargetName = 'Border' 
                                                            Property   = 'Background' 
                                                            Value      = 'LightSkyBlue'/>
                                                </Trigger>
                                                <Trigger Property      = 'IsSelected' 
                                                         Value         = 'False'>
                                                    <Setter TargetName = 'Border' 
                                                            Property   = 'Background' 
                                                            Value      = 'GhostWhite'/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </TabControl.Resources>
                        <TabItem Name   = 'Service_Dialog_Tab' 
                                 Header = 'Service Dialog'>
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height = '30'/>
                                <RowDefinition Height = '30'/>
                                <RowDefinition Height =  '*'/>
                            </Grid.RowDefinitions>
                            <Grid Grid.Row="0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width = '*'/>
                                <ColumnDefinition Width = '*'/>
                            </Grid.ColumnDefinitions>
                                <Button   Grid.Column = '0' Margin ='5' Name = 'Service_Dialog_Load'   Content           = 'Load Services'/>
                                <TextBlock Grid.Column       = '1' 
                                               Margin         = '5' 
                                               TextAlignment  = 'Center'>Service State:
							            <Run   Background     = '#66FF66' 
                                               Text           = 'Compliant'/> /
                                        <Run   Background     = '#FFFF66' 
                                               Text           = 'Unspecified'/> /
                                        <Run   Background     = '#FF6666' 
                                               Text           = 'Non Compliant'/>
                            </TextBlock>
                            </Grid>
                            <Grid Grid.Row            = '1'>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width = '*'/>
                                    <ColumnDefinition Width = '*'/>
                                </Grid.ColumnDefinitions>
                                <TextBox  Grid.Column = '0' Margin ='5' Name = 'Service_Dialog_Search' TextWrapping      = 'Wrap'>Search</TextBox>
                                <ComboBox Grid.Column = '1' Margin ='5' Name = 'Service_Dialog_Select' VerticalAlignment = 'Center'>
                                    <ComboBoxItem Content = 'Checked'/>
                                    <ComboBoxItem Content = 'Common Name' IsSelected='True'/>
                                    <ComboBoxItem Content = 'Service Name'/>
                                    <ComboBoxItem Content = 'Current Setting'/>
                                </ComboBox>
                            </Grid>
                                <DataGrid Grid.Row            = '2'
                                          Grid.Column         = '0'
                                          Name                = 'Service_Dialog_Grid'
                                          FrozenColumnCount   = '2' 
                                          AutoGenerateColumns = 'False' 
                                          AlternationCount    = '2' 
                                          HeadersVisibility   = 'Column' 
                                          CanUserResizeRows   = 'False' 
                                          CanUserAddRows      = 'False' 
                                          IsTabStop           = 'True' 
                                          IsTextSearchEnabled = 'True' 
                                          SelectionMode       = 'Extended'>
                                    <DataGrid.RowStyle>
                                        <Style TargetType     = '{x:Type DataGridRow}'>
                                            <Style.Triggers>
                                                <Trigger Property    = 'AlternationIndex'
                                                         Value       = '0'>
                                                    <Setter Property = 'Background'
                                                            Value    = 'White'/>
                                                </Trigger>
                                                <Trigger Property    = 'AlternationIndex'
                                                         Value       = '1'>
                                                    <Setter Property = 'Background'
                                                            Value    = '#FFD8D8D8'/>
                                                </Trigger>
                                                <Trigger Property    = 'IsMouseOver'
                                                         Value       = 'True'>
                                                    <Setter Property = 'ToolTip'>
                                                        <Setter.Value>
                                                            <TextBlock Text         = '{Binding Service_Description}'
                                                                       TextWrapping = 'Wrap'
                                                                       Width        = '400'
                                                                       Background   = '#FFFFFFBF'
                                                                       Foreground   = 'Black'/>
                                                        </Setter.Value>
                                                    </Setter>
                                                    <Setter Property                = 'ToolTipService.ShowDuration'
                                                            Value                   = '360000000'/>
                                                </Trigger>
                                                <MultiDataTrigger>
                                                    <MultiDataTrigger.Conditions>
                                                        <Condition Binding          = '{Binding Service_Toggle}'
                                                                   Value            = 'True'/>
                                                        <Condition Binding          = '{Binding Matches}' 
                                                                   Value            = 'False'/>
                                                    </MultiDataTrigger.Conditions>
                                                    <Setter Property                = 'Background' 
                                                            Value                   = '#F08080'/>
                                                </MultiDataTrigger>
                                                <MultiDataTrigger>
                                                    <MultiDataTrigger.Conditions>
                                                        <Condition Binding          = '{Binding Service_Toggle}'
                                                                   Value            = 'False'/>
                                                        <Condition Binding          = '{Binding Matches}' 
                                                                   Value            = 'False'/>
                                                    </MultiDataTrigger.Conditions>
                                                    <Setter Property                = 'Background' 
                                                            Value                   = '#FFFFFF64'/>
                                                </MultiDataTrigger>
                                                <MultiDataTrigger>
                                                    <MultiDataTrigger.Conditions>
                                                        <Condition Binding          = '{Binding Service_Toggle}'
                                                                   Value            = 'True'/>
                                                        <Condition Binding          = '{Binding Matches}'
                                                                   Value            = 'True'/>
                                                    </MultiDataTrigger.Conditions>
                                                    <Setter Property                = 'Background'
                                                            Value                   = 'LightGreen'/>
                                                </MultiDataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </DataGrid.RowStyle>
                                    <DataGrid.Columns>
                                        <DataGridTemplateColumn SortMemberPath      = 'Service_Toggle' 
                                                                CanUserSort         = 'True'>
                                            <DataGridTemplateColumn.Header>
                                                <CheckBox       Name                = 'Service_Profile' 
                                                                IsEnabled           = 'False'/>
                                            </DataGridTemplateColumn.Header>
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <CheckBox IsChecked             = '{Binding Service_Toggle ,
                                                                                                Mode                  = TwoWay,
                                                                                                UpdateSourceTrigger   = PropertyChanged,
                                                                                                NotifyOnTargetUpdated = True}' 
                                                              IsEnabled             = '{Binding ElementName           = Custom_Profile, 
                                                                                                Path                  = IsChecked}'/>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                        <DataGridTextColumn Header                  = 'Display Name' 
                                                            Width                   = '120'
                                                            Binding                 = '{Binding Service_DisplayName}'
                                                            CanUserSort             = 'True'
                                                            IsReadOnly              = 'True'/>
                                        <DataGridTextColumn Header                  = 'Name'
                                                            Width                   = '120'
                                                            Binding                 = '{Binding Service_Name}'
                                                            IsReadOnly              = 'True'/>
                                        <DataGridTextColumn Header                  = 'Current Setting'
                                                            Width                   = '100'
                                                            Binding                 = '{Binding Service_Type}'
                                                            IsReadOnly              = 'True'/>
                                        <DataGridTemplateColumn Header              = 'Profile'
                                                                Width               = '100'
                                                                SortMemberPath      = 'Service_Profile'
                                                                CanUserSort         = 'True'>
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <ComboBox ItemsSource           = '{Binding Service_Type_List}'
                                                              Text                  = '{Binding Path                 = Service_Profile,
                                                                                                Mode                 = TwoWay,
                                                                                                UpdateSourceTrigger  = PropertyChanged}'
                                                              IsEnabled             = '{Binding ElementName          = Custom_Profile,
                                                                                                Path                 = IsChecked}'/>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                        <DataGridTemplateColumn Header              = 'State' 
                                                                Width               = '80' 
                                                                SortMemberPath      = 'Service_State' 
                                                                CanUserSort         = 'True'>
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <ComboBox ItemsSource           = '{Binding Service_State_List}'
                                                              Text                  = '{Binding Path                 = Service_State,
                                                                                                Mode                 = TwoWay,
                                                                                                UpdateSourceTrigger  = PropertyChanged}'
                                                              IsEnabled             = '{Binding ElementName          = Custom_Profile,
                                                                                                Path                 = IsChecked}'/>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                        <DataGridTextColumn Header                  = 'Description'
                                                            Width                   = '120'
                                                            Binding                 = '{Binding Service_Description}'
                                                            CanUserSort             = 'True'
                                                            IsReadOnly              = 'True'/>
                                        <DataGridTextColumn Header                  = 'Path'
                                                            Width                   = '120'
                                                            Binding                 = '{Binding Service_Path}'
                                                            CanUserSort             = 'True'
                                                            IsReadOnly              = 'True'/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </Grid>
                        </TabItem>
                        <TabItem                            Name                    = 'Preferences_Tab'
                                                            Header                  = 'Preferences'>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width = '*'/>
                                    <ColumnDefinition Width = '*'/>
                                    <ColumnDefinition Width = '*'/>
                                </Grid.ColumnDefinitions>
                                <Grid>
                                    <Grid Grid.Column       = '0'>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height = '120'/>
                                            <RowDefinition Height = '150'/>
                                            <RowDefinition Height = '150'/>
                                        </Grid.RowDefinitions>
                                        <GroupBox Grid.Row = '0' Header = 'Display Options' Margin = '5' >
                                            <Grid >
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height = '30'/>
                                                    <RowDefinition Height = '30'/>
                                                    <RowDefinition Height = '30'/>
                                                </Grid.RowDefinitions>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width = '25'/>
                                                    <ColumnDefinition Width = '*'/>
                                                </Grid.ColumnDefinitions>
                                                <CheckBox  Grid.Row = '0' Grid.Column = '0' Margin = '5' Name = 'DisplayActive'/>
                                                <TextBlock Grid.Row = '0' Grid.Column = '1' Margin = '5' >Show Active Services</TextBlock>
                                                <CheckBox  Grid.Row = '1' Grid.Column = '0' Margin = '5' Name = 'DisplayInactive'/>
                                                <TextBlock Grid.Row = '1' Grid.Column = '1' Margin = '5' >Show Inactive Services</TextBlock>
                                                <CheckBox  Grid.Row = '2' Grid.Column = '0' Margin = '5' Name = 'DisplaySkipped'/>
                                                <TextBlock Grid.Row = '2' Grid.Column = '1' Margin = '5' >Show Skipped Services</TextBlock>
                                            </Grid>
                                        </GroupBox>
                                        <GroupBox Grid.Row = '1' Header = 'Miscellaneous' Margin = '5'>
                                            <Grid>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height = '30'/>
                                                    <RowDefinition Height = '30'/>
                                                    <RowDefinition Height = '30'/>
                                                    <RowDefinition Height = '30'/>
                                                </Grid.RowDefinitions>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width = '25'/>
                                                    <ColumnDefinition Width = '*'/>
                                                </Grid.ColumnDefinitions>
                                                <CheckBox  Grid.Row = '0' Grid.Column = '0' Margin = '5' Name = 'MiscSimulate'/>
                                                <TextBlock Grid.Row = '0' Grid.Column = '1' Margin = '5' >Simulate Changes [ Dry Run ]</TextBlock>
                                                <CheckBox  Grid.Row = '1' Grid.Column = '0' Margin = '5' Name = 'MiscXbox'/>
                                                <TextBlock Grid.Row = '1' Grid.Column = '1' Margin = '5' >Skip All Xbox Services</TextBlock>
                                                <CheckBox  Grid.Row = '2' Grid.Column = '0' Margin = '5' Name = 'MiscChange'/>
                                                <TextBlock Grid.Row = '2' Grid.Column = '1' Margin = '5' >Allow Change of Service State</TextBlock>
                                                <CheckBox  Grid.Row = '3' Grid.Column = '0' Margin = '5' Name = 'MiscStopDisabled'/>
                                                <TextBlock Grid.Row = '3' Grid.Column = '1' Margin = '5' >Stop Disabled Services</TextBlock>
                                            </Grid>
                                        </GroupBox>
                                        <GroupBox Grid.Row='2' Header = 'Development' Margin='5'>
                                            <Grid >
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height = '30'/>
                                                    <RowDefinition Height = '30'/>
                                                    <RowDefinition Height = '30'/>
                                                    <RowDefinition Height = '30'/>
                                                </Grid.RowDefinitions>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width = '25'/>
                                                    <ColumnDefinition Width = '*'/>
                                                </Grid.ColumnDefinitions>
                                                <CheckBox  Grid.Row = '0' Grid.Column = '0' Margin = '5' Name = 'DevelDiagErrors' />
                                                <TextBlock Grid.Row = '0' Grid.Column = '1' Margin = '5' >Diagnostic Output [ On Error ]</TextBlock>
                                                <CheckBox  Grid.Row = '1' Grid.Column = '0' Margin = '5' Name = 'DevelLog' />
                                                <TextBlock Grid.Row = '1' Grid.Column = '1' Margin = '5' >Enable Development Logging</TextBlock>
                                                <CheckBox  Grid.Row = '2' Grid.Column = '0' Margin = '5' Name = 'DevelConsole' />
                                                <TextBlock Grid.Row = '2' Grid.Column = '1' Margin = '5' >Show Console Window</TextBlock>
                                                <CheckBox  Grid.Row = '3' Grid.Column = '0' Margin = '5' Name = 'DevelDiagReport' />
                                                <TextBlock Grid.Row = '3' Grid.Column = '1' Margin = '5' >Show Diagnostic</TextBlock>
                                            </Grid>
                                        </GroupBox>
                                    </Grid>
                                </Grid>
                                <Grid Grid.Column='1'>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height = '120'/>
                                        <RowDefinition Height = '150'/>
                                        <RowDefinition Height = '150'/>
                                    </Grid.RowDefinitions>
                                    <GroupBox Grid.Row = '0' Header = 'Bypass / Checks [ Risky Options ]' Margin = '5'>
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height = '30'/>
                                                <RowDefinition Height = '30'/>
                                                <RowDefinition Height = '30'/>
                                            </Grid.RowDefinitions>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width = '25'/>
                                                <ColumnDefinition Width = '*'/>
                                            </Grid.ColumnDefinitions>
                                            <CheckBox   Grid.Row = '0' Margin = '5' Name = 'BypassBuild'/>
                                            <TextBlock  Grid.Row = '0' Margin = '5' Grid.Column = '1' >
                                                Skip Build/Version Check
                                            </TextBlock>
                                            <ComboBox   Grid.Row = '1' Margin = '5' Grid.ColumnSpan = '2' Name = 'BypassEdition'>
                                                <ComboBoxItem Content = 'Override Edition Check' IsSelected = 'True'/>
                                                <ComboBoxItem Content = 'Windows 10 Home'/>
                                                <ComboBoxItem Content = 'Windows 10 Pro'/>
                                            </ComboBox>
                                            <CheckBox   Grid.Row = '2' Margin = '5' Name = 'BypassLaptop'/>
                                            <TextBlock  Grid.Row = '2' Margin = '5' Grid.Column = '1' >
                                                Enable Laptop Tweaks
                                            </TextBlock>
                                        </Grid>
                                    </GroupBox>
                                    <GroupBox Grid.Row = '1' Header = 'Logging' Margin = '5'>
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height = '30'/>
                                                <RowDefinition Height = '30'/>
                                                <RowDefinition Height = '30'/>
                                                <RowDefinition Height = '30'/>
                                            </Grid.RowDefinitions>
                                            <Button  Grid.Row = '0' Margin = '5' Name = 'LoggingService'>Generate Service Log</Button>
                                            <TextBox Grid.Row = '1' Margin = '5' Name = 'LoggingServiceFile' TextAlignment = 'Center' IsEnabled = 'False'>&lt;Click above to use this feature&gt;</TextBox>
                                            <Button  Grid.Row = '2' Margin = '5' Name = 'LoggingScript' >Generate Script Log</Button>
                                            <TextBox Grid.Row = '3' Margin = '5' Name = 'LoggingScriptFile'  TextAlignment = 'Center' IsEnabled = 'False'>&lt;Click above to use this feature&gt;</TextBox>
                                        </Grid>
                                    </GroupBox>
                                    <GroupBox Grid.Row='2' Header='Backup' Margin='5'>
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height ='30'/>
                                                <RowDefinition Height ='30'/>
                                                <RowDefinition Height ='30'/>
                                                <RowDefinition Height ='30'/>
                                            </Grid.RowDefinitions>
                                            <Button  Grid.Row = '0' Margin = '5' Name = 'BackupRegistry'>Export (.reg) File</Button>
                                            <TextBox Grid.Row = '1' Margin = '5' Name = 'BackupRegistryFile'  TextAlignment = 'Center' IsEnabled = 'False'>&lt;Click above to use this feature&gt;</TextBox>
                                            <Button  Grid.Row = '2' Margin = '5' Name = 'BackupTemplate'>Export (.csv) File</Button>
                                            <TextBox Grid.Row = '3' Margin = '5' Name = 'BackupTemplateFile'  TextAlignment = 'Center' IsEnabled = 'False'>&lt;Click above to use this feature&gt;</TextBox>
                                        </Grid>
                                    </GroupBox>
                                </Grid>
                                <Grid Grid.Column='2'>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height = '90'/>
                                        <RowDefinition Height = '90'/>
                                    </Grid.RowDefinitions>
                                    <GroupBox Grid.Row = '0' Header = 'Service Configuration' Margin = '5'>
                                        <Grid Grid.Row = '0'>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height = '25'/>
                                                <RowDefinition Height = '35'/>
                                            </Grid.RowDefinitions>
                                            <TextBlock Grid.Row = '0' Margin = '5' Name = 'ServiceConfig' >Black Viper (Sparks v1.0)</TextBlock>
                                            <ComboBox  Grid.Row = '1' Margin = '5' Name = 'ServiceProfile' Height ='24'>
                                                <ComboBoxItem Content = 'Black Viper (Sparks v1.0)' IsSelected = 'True'/>
                                                <ComboBoxItem Content = 'DevOPS (MC/SDP v1.0)' IsEnabled = 'False'/>
                                            </ComboBox>
                                        </Grid>
                                    </GroupBox>
                                    <GroupBox Grid.Row = '1' Header = 'User Interface' Margin = '5'>
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height = '25'/>
                                                <RowDefinition Height = '35'/>
                                            </Grid.RowDefinitions>
                                            <TextBlock Grid.Row = '0' Margin = '5' Name = 'ScriptConfig' >DevOPS (MC/SDP v1.0)</TextBlock>
                                            <ComboBox  Grid.Row = '1' Margin = '5' Name = 'ScriptProfile' Height = '24' >
                                                <ComboBoxItem Content = 'DevOPS (MC/SDP v1.0)' IsSelected =  'True'/>
                                                <ComboBoxItem Content = 'MadBomb (MadBomb122 v1.0)' IsEnabled  = 'False' />
                                            </ComboBox>
                                        </Grid>
                                    </GroupBox>
                                </Grid>
                            </Grid>
                        </TabItem>
                        <TabItem Name = 'Console_Tab' Header = 'Console'>
                            <Grid Background = '#FFE5E5E5'>
                                <ScrollViewer VerticalScrollBarVisibility = 'Visible'>
                                    <TextBlock Name = 'Console_Output' TextTrimming = 'CharacterEllipsis' Background = 'White' FontFamily = 'Lucida Console'/>
                                </ScrollViewer>
                            </Grid>
                        </TabItem>
                        <TabItem Name = 'Diagnostic_Tab' Header = 'Diagnostic' Visibility = 'Visible'>
                            <Grid Background = '#FFE5E5E5'>
                                <ScrollViewer VerticalScrollBarVisibility = 'Visible'>
                                    <TextBlock Name = 'Diagnostic_Output' TextTrimming = 'CharacterEllipsis' Background = 'White' FontFamily = 'Lucida Console'/>
                                </ScrollViewer>
                            </Grid>
                        </TabItem>
                    </TabControl>
                </Grid>
                <Grid Grid.Row = '2'>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width = '*'/>
                        <ColumnDefinition Width = '*'/>
                    </Grid.ColumnDefinitions>
                    <Button Grid.Column = '0' Name =  'Start' Content = 'Start'  FontWeight = 'Bold' Margin = '10'/>
                    <Button Grid.Column = '1' Name = 'Cancel' Content = 'Cancel' FontWeight = 'Bold' Margin = '10'/>
                </Grid>
            </Grid>
        </Window>
"@

        $Named = @( @( 'Home' , 'Pro' | % { "$_`_Default" } ; "Safe" , "Tweaked" | % { "Desktop_$_" } ; "Laptop_Safe" ) | % { "$_`_Max" , "$_`_Min" } | % { "Menu_Config_$_" } ;
                    @( 'Feedback' , 'FAQ' , 'About' , 'Copyright' ; @( 'Donate' , 'GitHub' | % { "MadBomb_$_" } ) ; 'BlackViper' , "Secure_Digits_Plus" ) | % { "Menu_Info_$_" } ;
                    "TabControl" ; "Tab" , "Load" , "Search" , "Select" , "Grid" | % { "Service_Dialog_$_" } ; "Service_Profile" , "Preferences_Tab" ; 
                    "Active" , "Inactive" , "Skipped"               | % { "Display$_" } ; "Simulate" , "Xbox" , "Change" , "StopDisabled" | % { "Misc$_"    } ;
                    "DiagErrors" , "Log" , "Console" , "DiagReport" | % { "Devel$_"   } ; "Build" , "Edition" , "Laptop"                  | % { "Bypass$_"  } ;
                    "Service" , "Script" | % { $_ , "$_`File" }     | % { "Logging$_" } ; "Registry" , "Template" | % { $_ , "$_`File" }  | % { "Backup$_"  } ;
                    "Service" , "Script"                            | % { "$_`Config" , "$_`Profile" } ; "Console" , "Diagnostic" | % { "$_`_Tab" , "$_`_Output" } ; "Start" , "Cancel" )

        $GUI   = Convert-XAMLToWindow -Xaml $Xaml -NE $Named -Passthru
    }

    If ( $Alert )
    {
        $XAML = @"
        <Window xmlns        = "http://schemas.microsoft.com/winfx/2006/xaml/presentation"
            xmlns:x          = "http://schemas.microsoft.com/winfx/2006/xaml"
            Title            = "Notice" 
            Height           = "225" 
            Width            = "300" 
            BorderBrush      = "Black" 
            Background       = "White" 
            WindowStyle      = "ToolWindow">
            <Grid Background     = "#FFE5E5E5">
                <GroupBox Header = "Caution" Margin="5">
                    <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height = "3*"/>
                    <RowDefinition Height = "25" />
                    <RowDefinition Height = "50" />
                </Grid.RowDefinitions>
                <TextBlock Grid.Row = "0" Margin = "5" Name = "Tbox" TextWrapping = "Wrap"/>
                <CheckBox  Grid.Row = "1" Margin = "5" Name = "Cbox" Content = "CheckBox" HorizontalAlignment = "Left" />
                        <Grid Grid.Row = "2">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width = "*"/>
                                <ColumnDefinition Width = "*"/>
                            </Grid.ColumnDefinitions>
                            <Button Grid.Column = "0" Margin ="10" Name = "Yes" Content = "Yes"  />
                            <Button Grid.Column = "1" Margin ="10" Name = "No"  Content = "No"  />
                        </Grid>
                    </Grid>
                </GroupBox>
            </Grid>
        </Window>
"@

        $Named = "Tbox" , "Cbox" , "Yes" , "No"

        $GUI   = Convert-XAMLToWindow -Xaml $Xaml -NE $Named -Passthru

    }

    [ PSCustomObject ]@{ 

        XAML  = $Xaml
        Named = $Named
        GUI   = $GUI
    }

}#____                                                                            __//¯¯\\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//¯¯\\___  
#//¯¯\\__________________________________________________________________________/¯¯¯    ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯        ____    ____ __ ____ __ ____ __ ____ __ ____ __ ____    ___// 
    Function Initialize-ScriptMode # Script Variable Collection ________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    {#/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯      
        [ CmdLetBinding () ] Param (

            [ Parameter ( ParameterSetName =     'All' ) ] [ Switch ] $All     , 
            [ Parameter ( ParameterSetName =     'Min' ) ] [ Switch ] $Min     , 
            [ Parameter ( ParameterSetName =    'BSCC' ) ] [ Switch ] $BSCC    , 
            [ Parameter ( ParameterSetName =    'BSCR' ) ] [ Switch ] $BSCR    , 
            [ Parameter ( ParameterSetName =    'BSCB' ) ] [ Switch ] $BSCB    , 
            [ Parameter ( ParameterSetName =     'BAF' ) ] [ Switch ] $BAF     , 
            [ Parameter ( ParameterSetName =    'SNIS' ) ] [ Switch ] $SNIS    , 
            [ Parameter ( ParameterSetName =     'SSS' ) ] [ Switch ] $SSS     , 
            [ Parameter ( ParameterSetName =     'SAS' ) ] [ Switch ] $SAS     , 
            [ Parameter ( ParameterSetName =     'SDS' ) ] [ Switch ] $SDS     , 
            [ Parameter ( ParameterSetName =     'SIC' ) ] [ Switch ] $SIC     , 
            [ Parameter ( ParameterSetName =     'CSS' ) ] [ Switch ] $CSS     , 
            [ Parameter ( ParameterSetName =     'USC' ) ] [ Switch ] $USC     , 
            [ Parameter ( ParameterSetName =     'USE' ) ] [ Switch ] $USE     , 
            [ Parameter ( ParameterSetName =    'ATOS' ) ] [ Switch ] $ATOS    , 
            [ Parameter ( ParameterSetName =     'Dry' ) ] [ Switch ] $Dry     , 
            [ Parameter ( ParameterSetName =    'Devl' ) ] [ Switch ] $Devl    , 
            [ Parameter ( ParameterSetName =     'SBC' ) ] [ Switch ] $SBC     , 
            [ Parameter ( ParameterSetName =     'SXB' ) ] [ Switch ] $SXB     , 
            [ Parameter ( ParameterSetName =    'SECH' ) ] [ Switch ] $SECH    , 
            [ Parameter ( ParameterSetName =    'SECP' ) ] [ Switch ] $SECP    , 
            [ Parameter ( ParameterSetName =     'SEC' ) ] [ Switch ] $SEC     , 
            [ Parameter ( ParameterSetName = 'Default' ) ] [ Switch ] $Default , 
            [ Parameter ( ParameterSetName =    'Safe' ) ] [ Switch ] $Safe    , 
            [ Parameter ( ParameterSetName = 'Tweaked' ) ] [ Switch ] $Tweaked , 
            [ Parameter ( ParameterSetName =    'Auto' ) ] [ Switch ] $Auto    , 
            [ Parameter ( ParameterSetName =    'Diag' ) ] [ Switch ] $Diag    , 
            [ Parameter ( ParameterSetName =     'Log' ) ] [ Switch ] $Log     , 
            [ Parameter ( ParameterSetName =    'Logc' ) ] [ Switch ] $Logc    )

        $Arch     = GCIM Win32_ComputerSystem | % { $_.PCSystemType | % { $_ -eq 1  , $_ -ne 1 } }

        $X        = $(

            If ( $All     ) { @{ 0 = '-all'     ; 1 =  1 ; 2 = $True  ; 3 = 'All_or_Min=-Full'                              } }
            If ( $Min     ) { @{ 0 = '-min'     ; 1 =  1 ; 2 = $True  ; 3 = 'All_or_Min=-Min'                               } }
            If ( $BSCC    ) { @{ 0 = '-bscc'    ; 1 =  2 ; 2 = $True  ; 3 = "Config=1" , "Type=1" | % { "BackupService$_" } } }
            If ( $BSCR    ) { @{ 0 = '-bscr'    ; 1 =  2 ; 2 = $True  ; 3 = "Config=1" , "Type=0" | % { "BackupService$_" } } }
            If ( $BSCB    ) { @{ 0 = '-bscb'    ; 1 =  2 ; 2 = $True  ; 3 = "Config=1" , "Type=2" | % { "BackupService$_" } } }
            If ( $BAF     ) { @{ 0 = '-baf'     ; 1 =  1 ; 2 = $True  ; 3 = 'LogBeforeAfter=1'                              } } 
            If ( $SNIS    ) { @{ 0 = '-snis'    ; 1 =  1 ; 2 = $True  ; 3 = 'ShowNonInstalled=1'                            } }
            If ( $SSS     ) { @{ 0 = '-sss'     ; 1 =  1 ; 2 = $True  ; 3 = 'ShowSkipped=1'                                 } }
            If ( $SAS     ) { @{ 0 = '-sas'     ; 1 =  1 ; 2 = $True  ; 3 = 'ShowAlreadySet=1'                              } }
            If ( $SDS     ) { @{ 0 = '-sds'     ; 1 =  1 ; 2 = $True  ; 3 = 'StopDisabled=1'                                } }
            If ( $SIC     ) { @{ 0 = '-sic'     ; 1 =  1 ; 2 = $True  ; 3 = 'InternetCheck=1'                               } }
            If ( $CSS     ) { @{ 0 = '-css'     ; 1 =  1 ; 2 = $True  ; 3 = 'ChangeState=1'                                 } }
            If ( $USC     ) { @{ 0 = '-usc'     ; 1 =  1 ; 2 = $True  ; 3 = 'ScriptVerCheck=1'                              } }
            If ( $USE     ) { @{ 0 = '-use'     ; 1 =  1 ; 2 = $True  ; 3 = 'ServiceVerCheck=1'                             } }
            If ( $ATOS    ) { @{ 0 = '-atos'    ; 1 =  1 ; 2 = $True  ; 3 = 'AcceptToS=Accepted'                            } }
            If ( $Dry     ) { @{ 0 = '-dry'     ; 1 =  1 ; 2 = $True  ; 3 = 'DryRun=1'                                      } }
            If ( $Devl    ) { @{ 0 = '-devl'    ; 1 =  1 ; 2 = $True  ; 3 = 'DevLog=1'                                      } }
            If ( $SBC     ) { @{ 0 = '-sbc'     ; 1 =  1 ; 2 = $True  ; 3 = 'BuildCheck=1'                                  } }
            If ( $SXB     ) { @{ 0 = '-sxb'     ; 1 =  1 ; 2 = $True  ; 3 = 'XboxService=1'                                 } }
            If ( $SECH    ) { @{ 0 = '-sech'    ; 1 =  1 ; 2 = $True  ; 3 = 'EditionCheck=Home'                             } }
            If ( $SECP    ) { @{ 0 = '-secp'    ; 1 =  1 ; 2 = $True  ; 3 = 'EditionCheck=Pro'                              } }
            If ( $SEC     ) { @{ 0 = '-sec'     ; 1 = -1 ; 2 = $True  ; 3 = 'EditionCheck=Pro'                              } }
            If ( $Default ) { @{ 0 = '-default' ; 1 =  1 ; 2 = $False ; 3 = 'Black_Viper=1' , 'BV_ArgUsed=2'                } }
            If ( $Safe    ) { @{ 0 = '-safe'    ; 1 =  1 ; 2 = $False ; 3 = 'Black_Viper=2' , 'BV_ArgUsed=2'                } }
            If ( $Tweaked ) { @{ 0 = '-tweaked' ; 1 =  1 ; 2 = $False ; 3 = ( 0 , 3 | % { "BlackViper=$_" } )[$Arch] , ( 1 , 2 | % { "BV_ArgUsed=$_" } )[$Arch] } }
            If ( $Auto    ) { @{ 0 = '-auto'    ; 1 =  1 ; 2 = $False ; 3 = 'Automated=1' , 'AcceptToS=Accepted'            } }
            If ( $Diag    ) { @{ 0 = '-diag'    ; 1 =  2 ; 2 = $True  ; 3 = 'Diagnostic=1' , 'Automated=0'                  } }
            If ( $Log     ) { @{ 0 = '-log'     ; 1 = -1 ; 2 = $True  ; 3 = 'ScriptLog=1' , 'LogName=-'                     } }
            If ( $LogC    ) { @{ 0 = '-logc'    ; 1 = -1 ; 2 = $True  ; 3 = 'ScriptLog=2' , 'LogName=-'                     } } )

        Return [ PSCustomObject ]@{ 
        
            Arg   = $X[0]
            Match = $X[1]
            Gui   = $X[2]
            Var   = $X[3]
        }                                                                           #____ -- ____    ____ -- ____    ____ -- ____    ____ -- ____      
}#____                                                                            __//¯¯\\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//¯¯\\___  
#//¯¯\\__________________________________________________________________________/¯¯¯    ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯        ____    ____ __ ____ __ ____ __ ____ __ ____ __ ____    ___// 
    Function Initialize-Script # Script Variable Collection ____________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    {#/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯      
        $PassedArg             = $args # <-- Replace $Args w/ 'Initialize-ScriptMode -$Switch'

        IEX "Using Namespace System.Security.Principal"

        ( "Windows" | % { "( [ $_`Principal ][ $_`Identity ]::GetCurrent() ).IsInRole( 'Administrator' )" } ) | % {

            If ( ( IEX $_ ) -ne $True )
            { 
                Write-Theme -Action "Access [!]" "Limited, attempting elevation" 12 4 15

                SAPS PowerShell "-NoProfile -ExecutionPolicy Bypass -File `"$PSCommandPath`" $PassedArg" -Verb RunAs
                
                If ( ( IEX $_ ) -ne $True )
                {
                    Write-Theme -Action "Exception [!]" "Elevation has failed" 12 4 15
                    Read-Host "Press Enter to Exit"
                    Exit
                }
            }

            Write-Theme -Action "Access [+]" "Granted" 11 11 15
        }                                                                           #____ -- ____    ____ -- ____    ____ -- ____    ____ -- ____     
}#____                                                                            __//¯¯\\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//¯¯\\___  
#//¯¯\\__________________________________________________________________________/¯¯¯    ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯        ____    ____ __ ____ __ ____ __ ____ __ ____ __ ____    ___// 
    Function Get-CurrentServices # Retrieves/Displays Current Services _________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    {#/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯      
        [ CmdLetBinding () ] Param (

            [ Parameter ( ParameterSetName = "Theme" ) ] [ Switch ] $Display )

        $Return = GCIM Win32_Service | % {
    
            [ PSCustomObject ]@{ 
            
                Name        = $_.Name 
                Status      = $_.State
                StartType   = $_.StartMode
                DisplayName = $_.DisplayName
                PathName    = $_.PathName
                Description = $_.Description
            }
        }

        If ( $Display )
        {
            $Range               = 0..( $Return.Count - 1 )
            $Section             = 0..( $Return.Count - 1 )
            $Subtable            = 0..( $Return.Count - 1 )
    
            $Names               = @( "Status" , "StartType" ; @( "" , "Display" , "Path" | % { "$_`Name" } ) )

            ForEach ( $i in 0..( $Return.Count - 1 ) )
            {
                $X               = $Return[$I]
        
                $Section[$I]     = "( $( $X.DisplayName ) )"
        
                $Splat           = @{ 

                    Items        = 0..4 | % {       $Names[$_]   }
                    Values       = 0..4 | % { $X.$( $Names[$_] ) }

                }

                $SubTable[$I]    = New-SubTable @Splat
            }

            $Table = New-Table -Depth $Range.Count -Title "Current Services" -ID $Section -Table $SubTable
    
            Write-Theme -Table $Table -Prompt "Press Enter to Continue" 

            $Return
        }

        If ( !$Display )
        {
            $Return
        }                                                                           #____ -- ____    ____ -- ____    ____ -- ____    ____ -- ____      
}#____                                                                            __//¯¯\\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//¯¯\\___  
#//¯¯\\__________________________________________________________________________/¯¯¯    ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯        ____    ____ __ ____ __ ____ __ ____ __ ____ __ ____    ___// 
    Function Resolve-Windows # CIM / Edition Collection Table __________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    {#/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯      
        [ CmdLetBinding ( ) ] Param (

            [ Parameter ( ParameterSetName =  "System" ) ] [ Switch ] $System  ,
            [ Parameter ( ParameterSetName =      "OS" ) ] [ Switch ] $MSInfo  ,
            [ Parameter ( ParameterSetName = "Edition" ) ] [ Switch ] $Edition ,
            [ Parameter ( ParameterSetName =     "SKU" ) ] [ Switch ] $SKU     ,
            [ Parameter ( ParameterSetName =    "Type" ) ] [ Switch ] $Type    )

        $OS , $CS           = "Operating" , "Computer" | % { GCIM Win32_$_`System }

        If ( $System )
        {
            $CS
        }

        If ( $MSInfo )
        {
            $OS
        }

        If ( $Edition )
        {
            $VS                 = @( ( 1507 , 10240 , "Threshold 1" , "Release To Manufacturing" ) ,
                                     ( 1511 , 10586 , "Threshold 2" , "November Update"          ) ,
                                     ( 1607 , 14393 , "Redstone 1"  , "Anniversary Update"       ) ,
                                     ( 1703 , 15063 , "Redstone 2"  , "Creators Update"          ) ,
                                     ( 1709 , 16299 , "Redstone 3"  , "Fall Creators Update"     ) ,
                                     ( 1803 , 17134 , "Redstone 4"  , "April 2018 Update"        ) ,
                                     ( 1809 , 17763 , "Redstone 5"  , "October 2018 Update"      ) ,
                                     ( 1903 , 18362 , "19H1"        , "May 2019 Update"          ) ,
                                     ( 1909 , 18363 , "19H2"        , "November 2019 Update"     ) ,
                                     ( 2004 , 19000 , "20H1"        , "Unreleased"               ) )
        
            ForEach ( $i in 0..10 )
            {
                GP 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion' | ? { $VS[$I] -eq $_.ReleaseID } | % {
                
                Return [ PSCustomObject ]@{ 
            
                        Version     = $VS[$I][0]
                        Build       = 10 , 0 , $VS[$I][1] -join '.'
                        CodeName    = $VS[$I][2]
                        Name        = $VS[$I][3]
                    }
                }
            }
        }

        If ( $SKU )
        {
            (   0 , "Undefined" ) ,
            (   1 , "Ultimate Edition" ) ,
            (   2 , "Home Basic Edition" ) ,
            (   3 , "Home Premium Edition" ) ,
            (   4 , "Enterprise Edition" ) ,
            (   5 , "Home Basic N Edition" ) ,
            (   6 , "Business Edition" ) ,
            (   7 , "Standard Server Edition" ) ,
            (   8 , "Datacenter Server Edition" ) ,
            (   9 , "Small Business Server Edition" ) ,
            (  10 , "Enterprise Server Edition" ) ,
            (  11 , "Starter Edition" ) ,
            (  12 , "Datacenter Server Core Edition" ) ,
            (  13 , "Standard Server Core Edition" ) ,
            (  14 , "Enterprise Server Core Edition" ) ,
            (  15 , "Enterprise Server IA64 Edition" ) ,
            (  16 , "Business N Edition" ) ,
            (  17 , "Web Server Edition" ) ,
            (  18 , "Cluster Server Edition" ) ,
            (  19 , "Home Server Edition" ) ,
            (  20 , "Storage Express Server Edition" ) ,
            (  21 , "Storage Standard Server Edition" ) ,
            (  22 , "Storage Workgroup Server Edition" ) ,
            (  23 , "Storage Enterprise Server Edition" ) ,
            (  24 , "Server For Small Business Edition" ) ,
            (  25 , "Small Business Server Premium Edition" ) ,
            (  26 , "Home Premium N" ) ,
            (  27 , "Enterprise N" ) ,
            (  28 , "Ultimate N" ) ,
            (  29 , "Web Server Core" ) ,
            (  30 , "Windows Essential Business Server Management Server" ) ,
            (  31 , "Windows Essential Business Server Security Server" ) ,
            (  32 , "Windows Essential Business Server Messaging Server" ) ,
            (  33 , "Server Foundation" ) ,
            (  34 , "Windows Home Server" ) ,
            (  35 , "Windows Server 2008 without Hyper-V for Windows Essential Server Solutions" ) ,
            (  36 , "Server Standard No Hyper-V Full" ) ,
            (  37 , "Server Datacenter No Hyper-V Full" ) ,
            (  38 , "Server Enterprise No Hyper-V Full" ) ,
            (  39 , "Server Datacenter No Hyper-V Core" ) ,
            (  40 , "Server Standard No Hyper-V Core" ) ,
            (  41 , "Server Enterprise No Hyper-V Core" ) ,
            (  42 , "Microsoft Hyper-V Server" ) ,
            (  43 , "Storage Server Express Core" ) ,
            (  44 , "Storage Server Standard Core" ) ,
            (  45 , "Server Workgroup Core" ) ,
            (  46 , "Storage Server Enterprise Core" ) ,
            (  47 , "Starter N" ) ,
            (  48 , "Professional" ) ,
            (  49 , "Professional N" ) ,
            (  50 , "Windows Small Business Server 2011 Essentials" ) ,
            (  51 , "Server For SB Solutions" ) , 
            (  52 , "Server Solutions Premium" ) ,
            (  53 , "Server Solutions Premium Core" ) ,
            (  54 , "Server For SB Solutions EM" ) ,
            (  55 , "Server For SB Solutions EM" ) ,
            (  56 , "Windows MultiPoint Server" ) ,
            (  59 , "Windows Essential Server Solution Management" ) ,
            (  60 , "Windows Essential Server Solution Additional" ) , 
            (  61 , "Windows Essential Server Solution Management SVC" ) ,
            (  62 , "Windows Essential Server Solution Additional SVC" ) ,
            (  63 , "Small Business Server Premium Core" ) ,
            (  64 , "Server Hyper Core V" ) ,
            (  66 , "Starter E" ) , 
            (  67 , "Home Basic E" ) , 
            (  68 , "Home Premium E" ) , 
            (  69 , "Professional E" ) , 
            (  70 , "Enterprise E" ) , 
            (  71 , "Ultimate E" ) , 
            (  72 , "Server Enterprise (Evaluation)" ) , 
            (  76 , "Windows Multipoint Server Standard" ) , 
            (  77 , "Windows Multipoint Server Premium" ) , 
            (  79 , "Server Standard (Evaluation)" ) , 
            (  80 , "Server Datacenter (Evaluation)" ) , 
            (  84 , "Enterprise N (Evaluation)" ) , 
            (  87 , "Windows Thin PC" ) ,
            (  89 , "Windows Embedded Industry" ) ,
            (  95 , "Storage Server Workgroup (Evaluation)" ) , 
            (  96 , "Storage Server Standard (Evaluation)" ) , 
            (  97 , "Windows RT" ) ,
            (  98 , "Windows 8 China" ) , 
            (  99 , "Windows 8 Single Language" ) , 
            ( 101 , "Windows 8" ) ,
            ( 103 , "Windows Professional with Media Center" ) ,
            ( 104 , "Windows Mobile" ) ,
            ( 118 , "Windows Embedded Handheld" ) ,
            ( 123 , "Windows IoT Core" ) | % {

                If ( $_[0] -eq $OS.OperatingSystemSKU )
                {
                    Return [ PSCustomObject ]@{ 
                    
                        ID   = $_[0]
                        SKU  = $_[1]
                    }
                }
            }
        }

        If ( $Type )
        {
            Return [ PSCustomObject ]@{

                ID      = $CS.PCSystemType
                Chassis = @( "" , "Desktop" , "Mobile/Laptop" , "Workstation" , "Server" , "Server" , "Appliance" , "Server" , "Maximum" )[ $CS.PCSystemType ]
            }
        }

                                                                                    #____ -- ____    ____ -- ____    ____ -- ____    ____ -- ____      
}#____                                                                            __//¯¯\\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//¯¯\\___  
#//¯¯\\__________________________________________________________________________/¯¯¯    ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯        ____    ____ __ ____ __ ____ __ ____ __ ____ __ ____    ___// 
    Function Resolve-ScriptVars # Script Variable Collection ___________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    {#/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯      
        
        # Operating System Delimiter

        [ Environment ]::OSVersion.Version.Major | % {
        
            If ( $_ -ne 10 )
            {
                Write-Theme -Action "Exception [!]" "Only Windows 10 Client is currently supported" 12 4 15
                Read-Host "Press Enter to Exit"
                Exit
            }
        }

        Resolve-Script -Path | % { "$( $_.Parent )\Services" } | % {
        
            [ PSCustomObject ]@{

                FileBase           = [ PSCustomObject ]@{
 
                    Settings       = "$_\BVSetting.xml"
                    Service        = "$_\$( $Control.ServiceConfig ).csv"
                }

                Environment        = [ PSCustomObject ]@{ 

                    System         = Resolve-Windows -System
                    MSInfo         = Resolve-Windows -MSInfo
                    Edition        = Resolve-Windows -Edition
                    SKU            = Resolve-Windows -SKU
                    Type           = Resolve-Windows -Type
                }

                Service            = [ PSCustomObject ]@{

                    Type           = 'Skip' , 'Disabled' , 'Manual' , 'Auto' ,           'Auto'
                    Status         = 'Skip' , 'Disabled' , 'Manual' , 'Auto' , 'Auto (Delayed)'
                    Mode           =     '' ,        '4' ,      '3' ,    '2' ,              '2'
                    State          = 'Running' , 'Stopped'
                    Xbox           = 'XblAuthManager' , 'XblGameSave' , 'XboxNetApiSvc' , 'XboxGipSvc' , 'xbgm'
                    NetTCP         = "Msmq" , "Pipe" , "Tcp" | % { "Net$_`Activator" }
                    Filter         = 'CheckboxChecked' , 'CName' , 'ServiceName' , 'CurrType' , 'BVType' , 'SrvState' , 'SrvDesc' , 'SrvPath' , 'RowColor'
                    Devel          = 'ScriptLog' , 'Diagnostic' , 'LogBeforeAfter' , 'DryRun' , 'ShowNonInstalled' , 'ShowAlreadySet' | % { "WPF_$_`_CB" }
                    Skip           = @( "BcastDVRUserService" , "DevicePickerUserSvc" , "DevicesFlowUserSvc" , "PimIndexMaintenanceSvc" , "PrintWorkflowUserSvc" , 
                                     "UnistoreSvc" , "UserDataSvc" , "WpnUserService" | % { "$_`_?????" } ; 'AppXSVC' , 'BrokerInfrastructure' , 'ClipSVC' , 
                                     'CoreMessagingRegistrar' , 'DcomLaunch' , 'EntAppSvc' , 'gpsvc' , 'LSM' , 'MpsSvc' , 'msiserver' , 'NgcCtnrSvc' , 'NgcSvc' , 
                                     'RpcEptMapper' , 'RpcSs' , 'Schedule' , 'SecurityHealthService' , 'sppsvc' , 'StateRepository' , 'SystemEventsBroker' ,
	                                 'tiledatamodelsvc' , 'WdNisSvc' , 'WinDefend' )
                }

                Defaults           = [ PSCustomObject ]@{

                    Viper          = 0
                    Automated      = 0
                    All            = '-Min'
                    ViperTag       = 'BV-'
                    Execute        = 2
                    Error          = 0
                    Log            = 0
                    Config         = 0
                    Script         = 0
                    Laptop         = Resolve-Windows -Type | % { $_.Chassis }
                    Errors         = 0
                    GUI            = 0
                }
            }
        }                                                                           #____ -- ____    ____ -- ____    ____ -- ____    ____ -- ____      
}#____                                                                            __//¯¯\\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//¯¯\\___  
#//¯¯\\__________________________________________________________________________/¯¯¯    ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯        ____    ____ __ ____ __ ____ __ ____ __ ____ __ ____    ___// 
    Function Get-ServiceProfile #_______________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    {#/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯      

        $Switch                     = 'Skip' , 'Disabled' , 'Manual' , 'Auto' , 'Auto (Delayed)'
        
        $Config                     = ( Get-Service *_* | ? ServiceType -eq 224 )[0].Name.Split( '_' )[-1]

        $Collect                    = [ PSCustomObject ]@{
        
            Scoped                  = @( )
            NonScoped               = @( )
            Skipped                 = Resolve-ScriptVars  | % { $_.Service.Skip } | % { $_.Replace( '?????' , $Config ) } | Sort
            Full                    = Get-CurrentServices | Sort Name
        }
        
        Resolve-ScriptVars          | % { $_.FileBase } | % { IPCSV $_.Service } | % { 

            [ PSCustomObject ]@{ 

                Service             = $_.Service.Replace( '?????' , "$Config"  )
                "10H:D+"            = $Switch[$_."10H:D+"]
                "10H:D-"            = $Switch[$_."10H:D-"]
                "10P:D+"            = $Switch[$_."10P:D+"]
                "10P:D-"            = $Switch[$_."10P:D-"]
                "DT:S+"             = $Switch[$_."DT:S+"]
                "DT:S-"             = $Switch[$_."DT:S-"]
                "LT:S+"             = $Switch[$_."LT:S+"]
                "LT:S-"             = $Switch[$_."LT:S-"]
                "DT:T+"             = $Switch[$_."DT:T+"]
                "DT:T-"             = $Switch[$_."DT:T-"]
            }

        } | Sort Service | % {

            If ( $_.Service -in $Collect.Full.Name )
            {
                $Collect.Scoped    += $_
            }

            Else 
            { 
                $Collect.NonScoped += $_ 
            }
        }

        $Collect
                                                                                    #____ -- ____    ____ -- ____    ____ -- ____    ____ -- ____      
}#____                                                                            __//¯¯\\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//¯¯\\___  
#//¯¯\\__________________________________________________________________________/¯¯¯    ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯        ____    ____ __ ____ __ ____ __ ____ __ ____ __ ____    ___// 
    Function Get-SettingProfile #_______________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    {#/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯      
        Resolve-ScriptVars | % { Import-CLIXML $_.FileBase.Settings }               #____ -- ____    ____ -- ____    ____ -- ____    ____ -- ____       
}#____                                                                            __//¯¯\\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//¯¯\\___  
#//¯¯\\__________________________________________________________________________/¯¯¯    ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯        ____    ____ __ ____ __ ____ __ ____ __ ____ __ ____    ___// 
    Function Start-DiagnosticCheck #____________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    {#/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯      
        $Script               = Resolve-Script -Version

        Resolve-ScriptVars    | % {
    
            $Defaults         = $_.Defaults
            $Environment      = $_.Environment
            $Filebase         = $_.FileBase
            $Service          = $_.Service
        }

        $Section              = @(  "Script" , "System" | % { "$_ Information" } ; "Initialization" ; "Display" , "Miscellaneous" , 
                                    "Development" , "Bypass/Force" , "Logging" , "Backup" | % { "$_ Settings" } ; "Version Control" ) | % { "[ $_ ]" }

        $Subtable             = 0..9

        $Splat                = @{ 
            
            Items             = "Script Version" , "Release Type" , "Service File" , "Minimum Version" , "Maximum Version"
            Values            = $Script.Version , $Script.Release , $Filebase.Service , "1507 ( Threshold 1 )" , "1909 ( 19H2 ) "
        }

        $Subtable[0]          = New-SubTable @Splat

        $Splat                = @{ 

            Items             = "Operating System" , "Edition / SKU" , "Build" , "Version" , "Chassis Type"
            Values            = $Environment | % { "$( $_.MSInfo.Caption ) [$( $_.MSInfo.OSArchitecture )]" , $_.SKU.SKU , $_.Edition.Build , $_.Edition.Version , $_.Type.Chassis }
        }

        $Subtable[1]          = New-SubTable @Splat

        $Splat                = @{

            Items             = "Argument List" , "Terms of Service" 
            Values            = $Control | % { $_.PassedArgs , $_.TermsOfService }
        }

        $Subtable[2]          = New-SubTable @Splat

        $Splat                = @{

            Items             = "Active" , "Inactive" , "Skipped" | % { "Show $_ SVC" }
            Values            = $Control | % { $_.DisplayActive , $_.DisplayInactive , $_.DisplaySkipped }
        }
        
        $Subtable[3]          = New-SubTable @Splat
        
        $Splat                = @{ 
        
            Items             = "Simulate Changes" , "Xbox Services" , "Change * SVC State" , "Stop * Disabled SVC"
            Values            = $Control | % { $_.MiscSimulate , $_.MiscXbox , $_.MiscChange ,$_.MiscStopDisabled }
        }

        $Subtable[4]          = New-SubTable @Splat

        $Splat                = @{ 

            Items             = "Diagnostic Errors" , "Devel Log" , "Enable Console" , "Report Diagnostic"
            Values            = $Control | % { $_.DevelDiagErrors , $_.DevelLog , $_.DevelConsole , $_.DevelDiagReport }
        }

        $Subtable[5]          = New-Subtable @Splat

        $Splat                = @{ 

            Items             = "Build" , "Edition" , "Laptop" | % { "Bypass $_" }
            Values            = $Control | % { $_.BypassBuild , $_.BypassEdition , $_.BypassLaptop }
        }

        $Subtable[6]          = New-SubTable @Splat

        $Splat                = @{

            Items             = "Service" , "Script" | % { "Log $_" , "Log $_ File" }
            Values            = $Control | % { $_.LoggingService , $_.LoggingServiceFile , $_.LoggingScript , $_.LoggingScriptFile }
        }

        $Subtable[7]          = New-SubTable @Splat

        $Splat                = @{ 

            Items             = "Registry" , "(.reg) File" , "Template" , "(.csv) File" | % { "Backup $_" }
            Values            = $Control | % { $_.BackupRegistry , $_.BackupRegistryPath , $_.BackupTemplate , $_.BackupTemplatePath }
        }

        $Subtable[8]          = New-SubTable @Splat

        $Splat                = @{

            Items             = "Service" ,"Script" | % { "$_ Config" , "$_ Profile" }
            Values            = $Control | % { $_.ServiceConfig , $_.ServiceProfile , $_.ScriptConfig , $_.ScriptProfile }
        }

        $Subtable[9]          = New-Subtable @Splat

        $Table                = New-Table -Title "Diagnostic/Startup Panel" -Depth 10 -ID $Section -Table $Subtable
        
        Write-Theme -Table $Table -Prompt "Press Enter to Continue, CTRL+C to Exit"

	                                                                                #____ -- ____    ____ -- ____    ____ -- ____    ____ -- ____      
}#____                                                                            __//¯¯\\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//¯¯\\___  
#//¯¯\\__________________________________________________________________________/¯¯¯    ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯        ____    ____ __ ____ __ ____ __ ____ __ ____ __ ____    ___// 
    Function Select-ServiceProfile #____________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    {#/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯      
        [ CmdLetBinding () ] Param (

            [ Parameter ( ValueFromPipeline ) ] [ PSCustomObject ] $Config = ( Get-ServiceProfile ) ,
            [ ValidateSet ( "10H:D+" , "10H:D-" , "10P:D+" , "10P:D-" , "DT:S+" , "DT:S-" , "LT:S+" , " LT:S-" , "DT:T+" , "DT:T-" ) ]
            [ Parameter ( Mandatory ) ]         [         String ] $Subset )

            $Output  = @( )

            ForEach ( $i in 0..( $Config.Full.Count - 1 ) )
            {
                $Return    = [ PSCustomObject ]@{

                    DisplayName = $Config.Full.DisplayName[$I]
                    Name        = $Config.Full.Name[$I]
                    Status      = $Config.Full.Status[$I]
                    Profile     = "N/A"
                    StartType   = $Config.Full.StartType[$I]
                }
               
                If ( $Return.Name -in $Config.Scoped.Service )
                {
                    $Return.Profile = $Config.Scoped.$Subset[ ( 0..( $Config.Scoped.Service.Count - 1 ) | ? { $Config.Scoped.Service[$_] -eq $Return.Name } ) ]
                }

                If ( $Return.Name -in $Config.NonScoped.Service )
                {
                    $Return.Profile = $Config.NonScoped.$Subset[ ( 0..( $Config.NonScoped.Service.Count - 1 ) | ? { $Config.NonScoped.Service[$_] -eq $Return.Name } ) ]
                }

                $Output += $Return
            }

            $Output
	                                                                                #____ -- ____    ____ -- ____    ____ -- ____    ____ -- ____      
}#____                                                                            __//¯¯\\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//¯¯\\___  
#//¯¯\\__________________________________________________________________________/¯¯¯    ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯        ____    ____ __ ____ __ ____ __ ____ __ ____ __ ____    ___// 
    Function Load-MadBombRevisedGUI #___________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    {#/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯      
        $Services   = Get-ServiceProfile

        Return-ViperBombGUI -Main | % { 
        
            $Xaml                 = $_.Xaml
            $GUI                  = $_.GUI
            $Named                = $_.Named
        }

        $GUI.Menu_Config_Home_Default_Max    | % { 
        
            $_.Add_Click({ $Current = Select-ServiceProfile -Config $Services -Subset 10H:D+ })
        }

        $GUI.Menu_Config_Home_Default_Min    | % { $_.Add_Click({ Select-ServiceProfile -Config $Services -Subset 10H:D+ }) }
        $GUI.Menu_Config_Pro_Default_Max     | % { $_.Add_Click({ Select-ServiceProfile -Config $Services -Subset 10P:D+ }) }
        $GUI.Menu_Config_Pro_Default_Min     | % { $_.Add_Click({ Select-ServiceProfile -Config $Services -Subset 10P:D+ }) }
        $GUI.Menu_Config_Desktop_Safe_Max    | % { $_.Add_Click({ Select-ServiceProfile -Config $Services -Subset DT:S+  }) }
        $GUI.Menu_Config_Desktop_Safe_Min    | % { $_.Add_Click({ Select-ServiceProfile -Config $Services -Subset DT:S+  }) }
        $GUI.Menu_Config_Desktop_Tweaked_Max | % { $_.Add_Click({ Select-ServiceProfile -Config $Services -Subset DT:T+  }) }
        $GUI.Menu_Config_Desktop_Tweaked_Min | % { $_.Add_Click({ Select-ServiceProfile -Config $Services -Subset DT:T+  }) }
        $GUI.Menu_Config_Laptop_Safe_Max     | % { $_.Add_Click({ Select-ServiceProfile -Config $Services -Subset LT:S+  }) }
        $GUI.Menu_Config_Laptop_Safe_Min     | % { $_.Add_Click({ Select-ServiceProfile -Config $Services -Subset LT:S-  }) }



        $GUI.Menu_Info.Feedback              | % { $_.Add_Click({ Start "https://GitHub.com/madbomb122/BlackViperScript/issues" }) }
        $GUI.Menu_Info.FAQ                   | % { $_.Add_Click({ Resolve-Script -Version | % { Start $_.Site } }) }
        $GUI.Menu_Info.About                 | % { $_.Add_Click({ 
        
            $Splat = @{ Title   = "ViperBomb Service Configuration Utility"
                        Message = "This program allows deployment of service congiruation templates based on:" ,
                                  "- Black Viper's Service Configuration Profile" , 
                                  "- Custom Service Configuration Profile [If properly formatted]" ,
                                  "- A backup of your Service Configuration Profile made by this program." -join "`n" }
            Show-Message @Splat })
        }

        $GUI.Menu_Copyright                  | % { $_.Add_Click({ 
        
            $Splat = @{ Title   = "Copyright Information"
                        Message = @( Resolve-Script -Copyright ) -join "`n" }

            Show-Message @Splat })
        }

        $GUI.Menu_Info_Madbomb_Donate        | % { $_.Add_Click({ Start "https://www.amazon.com/gp/registry/wishlist/YBAYWBJES5DE" }) }
        $GUI.Menu_Info_Madbomb_GitHub        | % { $_.Add_Click({ Start "https://GitHub.com/madbomb122/BlackViperScript"           }) }
        $GUI.Menu_Info_BlackViper            | % { $_.Add_Click({ Start "http://www.blackviper.com" }) }
        $GUI.Menu_Secure_Digits_Plus         | % { $_.Add_Click({ Show-Message -Message "Currently Desktop only" ; Start "https://securedigitsplus.com" }) }

        Show-WPFWindow -GUI $GUI                                                    #____ -- ____    ____ -- ____    ____ -- ____    ____ -- ____      
}#____                                                                            __//¯¯\\__//==\\__/----\__//==\\__/----\__//==\\__/----\__//¯¯\\___  
#//¯¯\\__________________________________________________________________________/¯¯¯    ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯¯ ¯¯ ¯¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯        ____    ____ __ ____ __ ____ __ ____ __ ____ __ ____    ___// 
    Function StartScript #______________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    {#/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯ -- ¯¯¯¯    ¯¯¯¯      
        [ CmdLetBinding () ] Param (

            [ Parameter ( Mandatory ) ] [ PSCustomObject ] $Global )

        Write-Theme -Array ( Resolve-Script -Copyright ) -Title "Terms of Service" -Prompt "Press Enter to Accept" | % { 

            If ( $_ -eq $True )
            {
                Write-Theme -Action "Accepted [+]" "Terms of Service was accepted" 11 11 15
                $Global = $Control
                $Global.TermsOfService = 1
            }

            If ( $_ -eq $False )
            {
                Write-Theme -Action "Exception [!]" "User failed to accept Terms of Service" 12 4 15
                Break
            }
        }

        $Control.PassedArgs | % { 

            If ( $_ -ne "N/A" )
            {
                Write-Theme -Action "Loading [~]" "Switch $_" 
                
                $PassedArgs = IEX "Initialize-ScriptMode $_"
            }
        }
        
        Write-Theme -Action "Loading [~]" "Service Status & Defaults"

        $Service  = Get-ServiceProfile

        $Setting  = Get-SettingProfile

        Resolve-ScriptVars | % {
        
            $FileBase    = $_.FileBase
            $Defaults    = $_.Defaults
            $Environment = $_.Environment
            $Toggle      = $_.Service 
        }

	    If ( $PassedArg.Length -gt 0 )
        { 
            "Initialize-ScriptMode $PassedArg"
        }

    	$Collection = $Service.Skipped | ? { $_ -in $Service.Full.Name }

        Resolve-Windows -Edition | % { 
        
            If ( $_.Version -gt 1703 )
            {
                $Collection += 'xbgm'
            }
            
            If ( $_.Version -gt 1803 )
            {
                $Collection += "UsoSvc"
            }
        }

    	If ( $Diagnostic -In 1 , 2 )
        {
            $Script:Automated = 0 
        }

	    If ( $Diagnostic -eq 2 )
        {
		    Clear-Host
		    DiagnosticCheck 1
		    Exit
	    } 

    ElseIf ( $BV_ArgUsed -eq 1 )
    {
		CreateLog
		Error_Top

		$Script:ErrorDi = 'Tweaked + Laptop (Not supported)'
		
        If ( $Automated -eq 1 )
        {
            $Splat    = @{ 
            
                Text  = "Script is set to Automated and..."
                Color = 2
                Log   = 1 
            } 
            
            DisplayOutLML @Splat
        }
		
        $Splat    = @{ 
        
            Text  = "Laptops can't use Tweaked option."
            Color = 2 
            Log   = 1 
        } 
        
        DisplayOutLML @Splat

		Error_Bottom

	} 

    ElseIf ( $BV_ArgUsed -In 2 , 3 )
    {
	    $Script:RunScript = 1

		If ( $AcceptToS -ne 0 )
        {
			If ( $LoadServiceConfig -eq 1 )
            { 
                Black_Viper_Set 
            } 
            
            Else
            { 
                Black_Viper_Set $Black_Viper $All_or_Min 
            }
		} 

        Else 
        {
			TOS
		}
	}

    ElseIf ( $Automated -eq 1 )
    {
		CreateLog

		$Script:ErrorDi = 'Automated Selected, No Service Selected'
		
        Error_Top

        $Splat    = @{ 
        
            Text  = "Script is set to Automated and no Service"
            Color = 2
            Log   = 1 
        } 
        
        DisplayOutLML @Splat
        
        $Splat    = @{ 
        
            Text  = "Configuration option was selected."
            Color = 2
            Log   = 1 
        } 
        
        DisplayOutLML @Splat
		
        Error_Bottom
	} 

    ElseIf ( $AcceptToS -ne 0 )
    {
		$Script:RunScript = 1

		GuiStart
	} 

    Else 
    {
		TOS
	}
}



##########
# Pre-Script/Needed Variable -End
##########
# Multi Use Functions -Start
##########

Function AutomatedExitCheck ( [ Int ] $ExitBit )
{
	If ( $Automated -ne 1 )
    { 
        Read-Host -Prompt "`nPress Any key to Close..." 
    }

	If ( $ExitBit -eq 1 )
    { 
        LogEnd
        CloseExit 
    }
}

Function LogEnd
{ 
    If ( 0 -notin $ScriptLog , $LogStarted )
    {
        $Splat = @{ 
        
            LiteralPath = $LogFile
            Encoding    = Unicode
            NoNewLine   = $True
            Append      = $True 
        
        }

        Echo "--End of Log ($( Get-Date -Format 'MM/dd/yyyy hh:mm:ss tt'))--" | Out-File @Splat 
    } 
}

Function Get-Time
{ 
    Return Get-Date -Format "hh:mm:ss tt"
}

Function CloseExit
{ 
    If ( $GuiSwitch )
    { 
        $Form.Close() 
    }
    
    Exit 
}

Function OpenWebsite ( [ String ] $Url )
{ 
    Start $Url
}

Function ShowInvalid ( [ Bool ] $InvalidA )
{ 
    If ( $InvalidA )
    { 
        Write-Host "`nInvalid Input" -F 12 -B 0 -N
    } 
    
    Return $False 
}

Function DownloadFile ( [ String ] $Url , [ String ] $FilePath )
{
    [ System.Net.WebClient ]::new().DownloadFile( $URL , $FilePath )
}

Function QMarkServices ( [ String ] $SRV )
{ 
    Return $( If ( $SRV -Match '_\?+$' )
    {
        ( Get-Service | ? { $_.ServiceType -eq 224 } )[0] | % { 
        
            $SRV.Replace( "_\?+$" , $_.Name.Split( '_' )[-1] )
        }   
    }

    Else
    {
        $SRV
    })
}

Function SearchSrv ( [ String ] $SRV , [ String ] $Fil )
{ 
    #Return ( $CurrServices.Where({$_.Name -eq $Srv}, 'First')).$Fil

    Return ( GCIM Win32_Service | ? { $_.Name -eq $SRV } )[0].$Fil
}

Function Get-ServicePath
{
    Return "HKLM:\SYSTEM\CurrentControlSet\Services"
}

Function AutoDelayTest ( [ String ] $Srv )
{
    ForEach ( $i in Get-Service | % { $_.Name } )
    {
        GP "$( Get-ServicePath )\$I" | % { $_.DelayedAutoStart } | % {
        
            If ( $_ -ne $Null )
            {
                [ PSCustomObject ]@{ Name = $I ; DelayedAutoStart = $_ }
            }

            Else 
            {
                [ PSCustomObject ]@{ Name = $I ; DelayedAutoStart = '-' }
            }
        }
    }
}



Function AutoDelaySet ( [ String ] $Srv , [ Int ] $EnDi )
{
    $Splat   = @{

        Path  = "$( Get-ServicePath )\$Srv\"
        Name  = "DelayedAutoStart"
        Type  = "DWORD"
        Value = $EnDi
    }

    SP @Splat
}

Function DisplayOut 
{
    [ CmdLetBinding () ] Param ( 
    
        [ Parameter ( Position = 0 , Mandatory = $True ) ][ Alias ( 'T' ) ] [ String [] ] $Text  ,
        [ Parameter ( Position = 1 , Mandatory = $True ) ][ Alias ( 'C' ) ] [    Int [] ] $Color ,
        [ Parameter ( Position = 2                     ) ][ Alias ( 'L' ) ] [    Switch ] $Log   ,
		[ Parameter ( Position = 3                     ) ][ Alias ( 'G' ) ] [    Switch ] $Gui   )

	If ( $Gui )
    { 
        TBoxService @args 
    }
	
    For ( $i = 0 ; $i -lt $Text.Length ; $i++ )
    { 
        Write-Host $Text[$i] -F $colors[$Color[$i]] -B 0 -N 
    }
    
    Write-Host
	
    If ( $Log -and $ScriptLog -eq 1 )
    {
        $Splat = @{ 

            LiteralPath = $LogFile
            Encoding    = "Unicode"
            Append      = $True
        }

        Echo "$( Get-Time ): $( $Text -Join ' ' )" | Out-File @Splat 
    }
}



Function DisplayOutLML
{
	Param ( [ Alias ( 'T' ) ] [ String ] $Text  ,
		    [ Alias ( 'C' ) ] [    Int ] $Color ,
		    [ Alias ( 'L' ) ] [ Switch ] $Log   )

    DisplayOut '| ' , $Text.PadRight( 50 ) , ' |' -C 14 , $Color , 14 -L:$Log
}

$MLine , $MBLine = "-" , " " | % { '|'.PadRight( 53 , $_ ) + '|' }

Function MenuLine ( [ Switch ] $L )
{ 
    DisplayOut $MLine -C 14 -L:$L 
}

Function MenuBlankLine ( [ Switch ] $L )
{ 
    DisplayOut $MBLine -C 14 -L:$L 
}

Function Error_Top 
{
	Clear-Host
	DiagnosticCheck 0
	MenuLine -L
	DisplayOutLML ( ''.PadRight( 22 ) + 'Error' ) -C 13 -L
	MenuLine -L
	MenuBlankLine -L
}

Function Error_Bottom 
{
	MenuBlankLine -L
	MenuLine -L
	
    If ( $Diagnostic -eq 1 )
    {
        DiagnosticCheck 0 
    }

	AutomatedExitCheck 1
}

##########
# Multi Use Functions -End
##########
# TOS -Start
##########

Function TOSLine ( [ Int ] $BC )
{ 
    DisplayOut $MLine -C $BC
}

Function TOSBlankLine ( [ Int ] $BC )
{ 
    DisplayOut $MBLine -C $BC 
}

Function ShowCopyright 
{ 
    Clear-Host
    DisplayOut $Copyright -C 14 
}

Function TOSDisplay ( [ Switch ] $C )
{
	If ( !$C )
    { 
        Clear-Host 
    }
	
    $BC = 14

	If ( $Release_Type -ne 'Stable' )
    {
		$BC = 15

		TOSLine 15
    
        $Splat = @{ 
        
            Text  = '|'.PadRight( 22 ) , 'Caution!!!'.PadRight( 31 ) , '|'
            Color = 15 , 13 , 15

        }

		DisplayOut @Splat
		
        TOSBlankLine 15

        $Splat = @{ 
        
            Text  = '|' , '         This script is still being tested.         ' , '|'
            Color = 15 , 14 , 15 
        } 
        
        DisplayOut @Splat

        $Splat = @{ 
            
            Text  = '|'.PadRight( 17 ) , 'USE AT YOUR OWN RISK.'.PadRight( 36 ) , '|' 
            Color = 15 , 14 , 15 
        }
        
        DisplayOut @Splat

		TOSBlankLine 15
	}

	If ( $OSBit -ne '64-bit' )
    {
	    $BC = 15

		TOSLine 15

        $Splat = @{
        
            Text  = '|'.PadRight( 22 ) , 'WARNING!!!'.PadRight( 31 ) , '|' 
            Color = 15 , 13 , 15
        } 
        
        DisplayOut @Splat

		TOSBlankLine 15
    
        $Splat = @{ 
        
            Text  = '|' , '        These settings are ment for x64 Bit.        ' , '|' 
            Color = 15 , 14 , 15
        } 
        
        DisplayOut @Splat

        $Splat = @{ 
        
            Text  = '|'.PadRight( 17 ) , 'USE AT YOUR OWN RISK.'.PadRight( 36 ) , '|'
            Color = 15 , 14 , 15
        }
        
        DisplayOut @Splat

		TOSBlankLine 15
	}

	TOSLine $BC
    
    $Splat = @{ 
    
        Text  = '|'.PadRight( 21 ) , 'Terms of Use'.PadRight( 32 ) , '|'
        Color = $BC , 11 , $BC
    }
    
    DisplayOut @Splat

	TOSLine $BC

	TOSBlankLine $BC

    $Splat = @{ 
    
        Text  = '|' , ' This program comes with ABSOLUTELY NO WARRANTY.    ' , '|'
        Color = $BC , 2 , $BC
    } 
    
    DisplayOut @Splat 

    $Splat = @{ 
    
        Text  = '|' , ' This is free software, and you are welcome to      ' , '|'
        Color = $BC , 2 , $BC
    } 
    
    DisplayOut @Splat 

    $Splat = @{ 
    
        Text  = '|' , ' redistribute it under certain conditions.          ' , '|'
        Color = $BC , 2 , $BC
    } 
    
    DisplayOut @Splat
	
    TOSBlankLine $BC

    $Splat = @{ 
    
        Text  = '|' , ' Read License file for full Terms.'.PadRight( 52 ) , '|'
        Color = $BC , 2 , $BC
    } 
    
    DisplayOut @Splat

	TOSBlankLine $BC

    $Splat = @{ 
    
        Text  = '|' , ' Use the switch ' , '-copy' , ' to see License Information or ' , '|'
        Color = $BC , 2 , 14 , 2 , $BC
    }
    
    DisplayOut @Splat

    $Splat = @{ 
    
        Text  = '|' , ' enter ' , 'L' , ' below.'.PadRight( 45 ) , '|'
        Color = $BC , 2 , 14 , 2 , $BC
    } 
    
    DisplayOut @Splat 

	TOSBlankLine $BC

	TOSLine $BC
}

Function TOS 
{
	$Invalid = $False
	$CR      = $False
	
    While ( $TOS -ne 'Out' )
    {
		TOSDisplay -C:$CR
		
        $CR      = $False
		$Invalid = ShowInvalid $Invalid
		$TOS     = Read-Host "`nDo you Accept? (Y)es/(N)o"
		
        If ( $TOS -In 'n' , 'no' )
        {
			Exit
		} 

        ElseIf ( $TOS -In 'y' , 'yes' )
        {
			$TOS              = 'Out'
			$Script:AcceptToS = 'Accepted'
			$Script:RunScript = 1

            If ( $LoadServiceConfig -eq 1 )
            { 
                Black_Viper_Set 
            }
            
            ElseIf ( $Black_Viper -eq 0 )
            { 
                GuiStart 
            }
            
            Else
            { 
                Black_Viper_Set $Black_Viper $All_or_Min 
            }
		}

        ElseIf ( $TOS -eq 'l' )
        {
			$CR      = $True
            ShowCopyright
		} 
        
        Else 
        {
			$Invalid = $True
		}

	} 

    Return
}

##########
# TOS -End
##########
# GUI -Start
##########

Function OpenSaveDiaglog ( [ Int ] $SorO )
{
    IEX "Using Namespace System.Windows.Forms"
    
    
    If ( $SorO -eq 0 )
    { 
        $SOFileDialog = New-Object System.Windows.Forms.OpenFileDialog 
    } 
    
    Else
    { 
        $SOFileDialog = New-Object System.Windows.Forms.SaveFileDialog 
    }
    
    $SOFilter = $( If ( $SorO -ne 2 ) { 'CSV (*.csv)| *.csv' } Else { 'Registration File (*.reg)| *.reg' } )

    $SOFileDialog | % { 

        $_.InitialDirectory = $FileBase
	    $_.Filter           = $SOFilter
	    $_.ShowDialog()
    }

	$SOFPath = $SOFileDialog.FileName
	
    If ( $SOFPath )
    {
        If ( $SorO -eq 0 )
        {
			$Script:ServiceConfigFile = $SOFPath
            $WPF_LoadFileTxtBox.Text  = $ServiceConfigFile
            RunDisableCheck
		} 

        ElseIf ( $SorO -eq 1 )
        {
			Save_Service $SOFPath
		} 

        ElseIf ( $SorO -eq 2 )
        {
			RegistryServiceFile $SOFPath
		}
	}
}

Function HideShowCustomSrvStuff 
{
    
	$Vis , $TF , $WPF_CustomNoteGrid.Visibility = $(

    If ( ( $WPF_ServiceConfig.SelectedIndex + 1 ) -eq $BVCount )
    { 
        'Visible',$False,'Visible' 
    } 
    
    Else
    { 
        'Hidden' , $True , 'Collapsed' 
    })

	$WPF_RadioAll        | % { $_.IsEnabled  = $TF  }
	$WPF_RadioMin        | % { $_.IsEnabled  = $TF  }
	$WPF_CustomNote      | % { $_.Visibility = $Vis }
	$WPF_LoadFileTxtBox  | % { $_.Visibility = $Vis }
	$WPF_btnOpenFile     | % { $_.Visibility = $Vis }
}

Function SetServiceVersion 
{
	If ( Test-Path -LiteralPath $BVServiceFilePath -PathType Leaf )
    {
		$TMP                   = Import-Csv -LiteralPath $BVServiceFilePath
		$Script:ServiceVersion = $TMP[0].'BV-Def-Home'
		$Script:ServiceDate    = $TMP[0].'BV-Def-Pro'
		Return $True
	}

	$Script:ServiceVersion     = 'Missing File'
	$Script:ServiceDate        = 'BlackViper.csv'
	Return $False
}

Function ClickedDonate
{ 
    OpenWebsite $Donate_Url
    $Script:ConsideredDonation = 'Yes' 
}

Function UpdateSetting 
{
	$VarList      | % {

        $Splat    = @{ 
        
            Name  = $_.Name.Split('_')[1]
            Value = @( 0 , 1 )[ $_.Value.IsChecked ]
            Scope = "Script"
        }

		SV @Splat
	}

	$Script:All_or_Min = @( "-Min" , "-Full" )[ $WPF_RadioAll.IsChecked ]

	UpdateEdition

	$Script:LogName           = $WPF_LogNameInput.Text
	$Script:BackupServiceType = $WPF_BackupServiceType.SelectedIndex
}

Function SaveSetting 
{
	UpdateSetting

	$Black_Viper = $WPF_ServiceConfig.SelectedIndex

	If ( ( $Black_Viper + 1 ) -eq $BVCount -or ( $IsLaptop -eq '-Lap' -and $LaptopTweaked -ne 1 -and $Black_Viper -ge 2 ) ) # <--- I would change this.
    { 
        $Black_Viper = 0 
    }

	$Settings = @{

		AcceptToS           = $AcceptToS
		EditionCheck        = $EditionCheck
		BuildCheck          = $BuildCheck
		LaptopTweaked       = $LaptopTweaked
		Black_Viper         = $Black_Viper
		All_or_Min          = $All_or_Min
		BackupServiceConfig = $BackupServiceConfig
		BackupServiceType   = $BackupServiceType
		InternetCheck       = $InternetCheck
		ScriptVerCheck      = $ScriptVerCheck
		ServiceVerCheck     = $ServiceVerCheck
		ShowConsole         = $ShowConsole
		XboxService         = $XboxService
		StopDisabled        = $StopDisabled
		ChangeState         = $ChangeState
		ShowSkipped         = $ShowSkipped
	}

	If ( $ConsideredDonation -eq 'Yes' )
    { 
        $Settings.ConsideredDonation = 'Yes' 
    }
	
    If ( $WPF_DevLogCB.IsChecked )
    {
		$Settings | % {
			
            $_.ScriptLog        = $Script_Log
			$_.LogName          = $Log_Name
			$_.Diagnostic       = $Diagn_ostic
			$_.LogBeforeAfter   = $Log_Before_After
			$_.DryRun           = $Dry_Run
			$_.ShowNonInstalled = $Show_Non_Installed
			$_.ShowAlreadySet   = $Show_Already_Set
		}
	} 

    Else 
    {
		$Settings | % {

			$_.ScriptLog        = $ScriptLog
			$_.LogName          = $LogName
			$_.Diagnostic       = $Diagnostic
			$_.LogBeforeAfter   = $LogBeforeAfter
			$_.DryRun           = $DryRun
			$_.ShowNonInstalled = $ShowNonInstalled
			$_.ShowAlreadySet   = $ShowAlreadySet
		}
	}

	If ( Test-Path -LiteralPath $SettingPath -PathType Leaf )
    {
		$Tmp = ( Import-Clixml -LiteralPath $SettingPath | ConvertTo-Xml ).Objects.Object.Property."#text"

		If ( ( $Tmp.Count / 2 ) -eq $Settings.Count )
        {
			$T1 = While ( $Tmp )
            { 
                $Key , $Val , $Tmp = $Tmp
                
                [ PSCustomObject ]@{

                    Name = $Key
                    Val  = $Val 
                }
            }

			$Tmp = ( $Settings | ConvertTo-Xml ).Objects.Object.Property."#text"

			$T2 = While ( $Tmp )
            { 
                $Key, $Val, $Tmp = $Tmp

                [ PSCustomObject ]@{
                
                    Name = $Key
                    Val  = $Val 
                } 
            }
			
            If ( Compare $T1 $T2 -Property Name , Val )
            { 
                $SaveSettingFile = $True 
            }

        } 
        
        Else 
        {
			$SaveSettingFile = $True
		}
	} 

    Else 
    {
		$SaveSettingFile = $True
	}

	If ( $SaveSettingFile )
    { 
        $Settings | Export-Clixml -LiteralPath $SettingPath 
    }
}

Function ShowConsoleWin ( [ Int ] $Choice ) # 0 = Hide , 5 = Show
{ 
    [ Console.Window ]::ShowWindow( $ConsolePtr , $Choice ) 
}

Function GuiStart 
{
	# Needed to Hide Console window
    
    $Type = @( )
    
    ( "Kernel" , "IntPtr GetConsoleWindow()" ) , ( "user" , "bool ShowWindow(IntPtr hWnd, Int32 nCmdShow)" ) | % {

        $Type += "[DllImport('$( $_[0] )32.dll')] public static extern $( $_[1] )"
    }

    $Splat = @{

        Name             = "Window"
        NameSpace        = "Console"
        MemberDefinition = $Type -join "`n"
    }

	Add-Type @Splat
    
    $Script:ConsolePtr   = [ Console.Window ]::GetConsoleWindow()

	Clear-Host

    $Splat    = @{ 
    
        Text  = "Preparing GUI, Please wait..."
        Color = 15
    } 
    
    DisplayOut @Splat

	$Script:GuiSwitch = $True

    $XAML             = Return-ViperBombGUI

	[ Void ][ System.Reflection.Assembly ]::LoadWithPartialName( 'presentationframework' )

	$Form       = [ Windows.Markup.XamlReader ]::Load( ( New-Object System.Xml.XmlNodeReader $xaml ) )

	$xaml.SelectNodes( '//*[@Name]' ) | % {

        $Splat = @{ 
        
            Name  = "WPF_$( $_.Name )"
            Value = $Form.FindName( $_.Name )
            Scope = "Script"
        }
        
        SV @Splat 
    }

	$PowerShell   = [ PowerShell ]::Create()
	
    $PowerShell   | % { 
    
        $_.RunSpace = [ RunSpaceFactory ]::CreateRunspace()
        $_.RunSpace.Open()
    }

	[ System.Reflection.Assembly ]::LoadWithPartialName( 'System.Windows.Forms' ) | Out-Null

	[ System.Collections.ArrayList ] $Script:VarList = GV "WPF_*_CB"

	$Script:DataGridListBlank = @{}

	$Form.add_closing{

		If ( ! $RanScript -And [ Windows.Forms.Messagebox ]::Show( 'Are you sure you want to exit?' , 'Exit' , 'YesNo' ) -eq 'No' )
        { 
            $_.Cancel = $True 
        }

		SaveSetting
		LogEnd
		ShowConsoleWin 5
	}

	$WPF_RunScriptButton.Add_Click{

		If ( $EBFailCount -eq 0 )
        {
			RunScriptFun
		} 

        ElseIf ( $EBFailCount -eq 1 ) 
        {
            $Splat = @{ 
            
                M  = "You are Running this script on $WinEdition.." , 
                     "Edition Requirements: Windows 10 - Home or Pro (64-Bit)." , 
                     "`n" , 
                     "Do you still want to run this script?" -join "`n"
                CB = "Skip Edition Checks"
            }

            PopWindow @Splat
        } 

        ElseIf ( $EBFailCount -eq 2 )
        {
            $Splat = @{
            
                M  = "You are Running this script on $Win10Ver.." , 
                     "--Build Requirements--" , 
                     "  Min Version: $MinVerName ($MinVer)" , 
                     "  Max Version: $MaxVerName ($MaxVer)." , 
                     "`n" , 
                     "Do you still want to run this script?" -join "`n"
                CB = "Skip All Build checks"
            }

            PopWindow @Splat
		} 

        ElseIf ( $EBFailCount -eq 3 )
        {
            $Splat = @{ 
            
                M  = "You are Running this script on $WinEdition $Win10Ver.." , 
                     "--Requirements--" , 
                     "  Edition: Windows 10 - Home or Pro (64-Bit)" , 
                     "  Min Version: $MinVerName ($MinVer)" , 
                     "  Max Version: $MaxVerName ($MaxVer)" , 
                     "`n" , 
                     "Do you still want to run this script?" -join "`n" 
                CB = "Skip All Build & Edition checks"
            }

            PopWindow @Splat
		}
	}

	$WPF_ACUcheckboxChecked.Add_Click{

		$tmp                          = $WPF_ACUcheckboxChecked.IsChecked

		If ( $WPF_FilterTxt.Text -ne '' )
        {
			$Script:DGUpdate          = $False
			$TxtFilter                = $WPF_FilterTxt.Text
			$Filter                   = $FilterList[$WPF_FilterType.SelectedIndex]
			$TableFilter              = $DataGridListCust.Where{ $_.$Filter -Match $TxtFilter }
			
            $TableFilter.ForEach{ 
            
                $_.CheckboxChecked    = $tmp 
            }

			$WPF_dataGrid.ItemsSource = $TableFilter
			$Script:DGUpdate          = $True
		} 

        Else 
        {
			$DataGridListCust.ForEach{ 

                $_.CheckboxChecked    = $tmp 
            }
		}
		$WPF_dataGrid.Items.Refresh()
	}

	$WPF_CustomBVCB.Add_Click{
		
        $tmp                              = $WPF_CustomBVCB.IsChecked
		$WPF_ACUcheckboxChecked.IsEnabled = $tmp
		$Script:DataGridLCust             = $tmp
		$WPF_SaveCustomSrvButton.Content , $WPF_dataGrid.ItemsSource = If ( $tmp ) 
        {
            'Save Selection' , $DataGridListCust
		} 

        Else 
        {
			'Save Current' , $DataGridListOrig
		}

		RunDisableCheck
		DGFilter
	}

	$WPF_DevLogCB.Add_Click{

		$tmp = $WPF_DevLogCB.IsChecked

		If ( ! $tmp )
        {
			$Script:ScriptLog          = $Script_Log
			$Script:LogName            = $Log_Name
			$Script:Diagnostic         = $Diagn_ostic
			$Script:Automated          = $Auto_mated
			$Script:LogBeforeAfter     = $Log_Before_After
			$Script:DryRun             = $Dry_Run
			$Script:ShowNonInstalled   = $Show_Non_Installed
			$Script:ShowSkipped        = $Show_Skipped
			$Script:ShowAlreadySet     = $Show_Already_Set
		} 

        Else 
        {
			UpdateSetting
			$Script:Script_Log         = $ScriptLog
			$Script:Log_Name           = $LogName
			$Script:Diagn_ostic        = $Diagnostic
			$Script:Auto_mated         = $Automated
			$Script:Log_Before_After   = $LogBeforeAfter
			$Script:Dry_Run            = $DryRun
			$Script:Show_Non_Installed = $ShowNonInstalled
			$Script:Show_Skipped       = $ShowSkipped
			$Script:Show_Already_Set   = $ShowAlreadySet
			DevLogSet
		}

		$DevLogList.ForEach{

			$TmpWPF = GV -Name $_ -ValueOnly

			$TmpWPF.IsChecked          = If ( ( GV -Name ( $_.Split('_')[1] ) -ValueOnly ) -eq 0 ) { $False } Else { $True }
			$TmpWPF.IsEnabled          = ! $tmp
		}

		$WPF_LogNameInput.IsEnabled    = If ( $ScriptLog -eq 0 -or $tmp ) { $False } Else { $True }
		$WPF_LogNameInput.Text         = $LogName
	}

	[ System.Windows.RoutedEventHandler ] $DGclickEvent = {
		
        If ( $DataGridLCust -and $DGUpdate -and $WPF_dataGrid.SelectedItem )
        {
			If ( $null -ne $( $WPF_dataGrid.Items.SortDescriptions.PropertyName ) )
            {
				$Script:SortCol        = $WPF_dataGrid.Items.SortDescriptions.PropertyName
				$Script:SortDir        = $WPF_dataGrid.Items.SortDescriptions.Direction
			}

			$CurrObj                   = $WPF_dataGrid.CurrentItem
			$CurrObj.Matches           = If ( $CurrObj.CurrType -eq $CurrObj.BVType ) { $True } Else { $False }
			$CurrObj.RowColor          = RowColorRet $CurrObj.Matches $CurrObj.CheckboxChecked
			$WPF_dataGrid.ItemsSource  = $DataGridListBlank
			
            If ( $null -ne $SortCol ) 
            {
				If ( $WPF_FilterTxt.Text -eq '' ) 
                {
					If ( $SortDir -eq 'Descending' )
                    {
						$DataGridListCust     = $DataGridListCust | Sort $SortCol -Descending
					} 

                    Else 
                    {
						$DataGridListCust     = $DataGridListCust | Sort $SortCol
					}

					$WPF_dataGrid.ItemsSource = $DataGridListCust
				} 

                Else 
                {
					If ( $SortDir -eq 'Descending' ) 
                    {
						$DataGridListFilter   = $DataGridListFilter | Sort $SortCol -Descending
					} 

                    Else 
                    {
						$DataGridListFilter   = $DataGridListFilter | Sort $SortCol
					}

					$WPF_dataGrid.ItemsSource = $DataGridListFilter
				}
			} 

            Else 
            {
				If ( $WPF_FilterTxt.Text -eq '' )
                {
					$WPF_dataGrid.ItemsSource = $DataGridListCust
				} 

                Else 
                {
					$WPF_dataGrid.ItemsSource = $DataGridListFilter
				}
			}
		}

		$Script:DGUpdate = $True
	}

	$WPF_dataGrid.AddHandler( [ System.Windows.Controls.CheckBox ]::CheckedEvent   , $DGclickEvent )
	$WPF_dataGrid.AddHandler( [ System.Windows.Controls.CheckBox ]::UnCheckedEvent , $DGclickEvent )
	$WPF_dataGrid.Add_PreviewMouseWheel{ $Script:DGUpdate = $False }

	$WPF_LaptopTweaked_CB.Add_Checked{

		If ( $WPF_ServiceConfig.Items.Count -eq 3 )
        {
			$tmp = If ( $WPF_ServiceConfig.SelectedIndex -eq 2 ) { $True } Else { $False }
			
            $WPF_ServiceConfig.Items.RemoveAt( 2 )
			
            [ Void ] $WPF_ServiceConfig.Items.Add( 'Tweaked' )
			[ Void ] $WPF_ServiceConfig.Items.Add( 'Custom Setting *' )

			If ( $tmp ) 
            { 
                $WPF_ServiceConfig.SelectedIndex = 3 
            }
			
            $Script:LaptopTweaked = 1
			$Script:BVCount++

			HideShowCustomSrvStuff
		}
	}

	$WPF_LaptopTweaked_CB.Add_UnChecked{

		If ( $WPF_ServiceConfig.Items.Count -eq 4 )
        {
			If ( $WPF_ServiceConfig.SelectedIndex -eq 2 )
            {
                $WPF_ServiceConfig.SelectedIndex = 0 
            }
			
            $WPF_ServiceConfig.Items.RemoveAt( 2 )
			
            $Script:LaptopTweaked = 0
			$Script:BVCount--
			
            HideShowCustomSrvStuff
		}
	}

	$WPF_ShowDiagButton.Add_Click{
		
        UpdateSetting

        $WPF_TabControl.Items[4] | % { 
        
            $_.Visibility = 'Visible'
            $_.IsSelected = $True 
        }
        
        $WPF_DiagnosticOutput.text = ''
		
        Clear-Host
                
        $DiagnosticInformation = @{ 
        
            ST = 0..55
            FG = 0..55 
        }

        $DiagnosticInformation | % {

            ForEach ( $I in 0..53 )
            {
                If ( $I -eq 0 )
                {
                    $_.FG[$I] = 13
                }

                If ( $I -in 1 , 53 )
                {
                    $_.FG[$I] = 11
                }

                If ( $i -in 5..8 + 10..16 + 20..21 + 24..47 + 50..51 )
                {
                    $_.FG[$I] = 14 , 15
                }

                If ( $I -in 2 , 3 , 8 , 17 , 19 , 22 , 48 , 52 )
                {
                    $_.FG[$I] = 14
                }

                If ( $I -in 4 , 9 , 18 , 23 , 49 )
                {
                    $_.FG[$I] = 2
                }
            }

            $_.ST[ 0] = " Diagnostic Information below, will be copied to the clipboard.`n"

		    $Script:DiagString = ''
		
            $_.ST[ 1] = ' ********START********'
    		$_.ST[ 2] = ' Diagnostic Output, Some items may be blank'
		    $_.ST[ 3] = ''
            $_.ST[ 4] = ' --------Script Info--------'
		    $_.ST[ 5] = ' Script Version: ' , $Script_Version
            $_.ST[ 6] = ' Release Type: ' , $Release_Type
            $_.ST[ 7] = ' Services Version: ' , $ServiceVersion
		    $_.ST[ 8] = ''
    		$_.ST[ 9] = ' --------System Info--------'
		    $_.ST[10] = ' Window: ' , $FullWinEdition
		    $_.ST[11] = ' Bit: ' , $OSBit
		    $_.ST[12] = ' Edition SKU#: ' , $WinSku
		    $_.ST[13] = ' Build: ' , $BuildVer
		    $_.ST[14] = ' Version: ' , $Win10Ver
		    $_.ST[15] = ' PC Type: ' , $PCType
		    $_.ST[16] = ' Desktop/Laptop: ' , $IsLaptop.Substring( 1 )
		    $_.ST[17] = ''
    		$_.ST[18] = ' --------Script Requirements--------'
		    $_.ST[19] = ' Windows 10 - Home or Pro (64-Bit)'
    		$_.ST[20] = ' Min Version: ' , "$MinVerName ($MinVer)"
    		$_.ST[21] = ' Max Version: ' , "$MaxVerName ($MaxVer)"
    		$_.ST[22] = ''
    		$_.ST[23] = ' --------Current Settings--------'
		    $_.ST[24] = ' BlackViper: ' , $WPF_ServiceConfig.Text
		    $_.ST[25] = ' All/Min: ' , ( "Min" , "All" )[ $All_or_Min -eq '-full' ]
            $_.ST[26] = ' ToS: ' , $AcceptToS
		    $_.ST[27] = ' Automated: ' , $Automated
		    $_.ST[28] = ' ScriptVerCheck: ' , $ScriptVerCheck
    		$_.ST[29] = ' ServiceVerCheck: ' , $ServiceVerCheck
    		$_.ST[30] = ' InternetCheck: ' , $InternetCheck
	    	$_.ST[31] = ' ShowAlreadySet: ' , $ShowAlreadySet
		    $_.ST[32] = ' ShowNonInstalled: ' , $ShowNonInstalled
    		$_.ST[33] = ' ShowSkipped: ' , $ShowSkipped
    		$_.ST[34] = ' XboxService: ' , $XboxService
	    	$_.ST[35] = ' StopDisabled: ' , $StopDisabled
		    $_.ST[36] = ' ChangeState: ' , $ChangeState
    		$_.ST[37] = ' EditionCheck: ' , $EditionCheck
	    	$_.ST[38] = ' BuildCheck: ' , $BuildCheck
    		$_.ST[39] = ' DryRun: ' , $DryRun
    		$_.ST[40] = ' ScriptLog: ' , $ScriptLog
	    	$_.ST[41] = ' LogName: ' , $LogName
		    $_.ST[42] = ' LogBeforeAfter: ' , $LogBeforeAfter
		    $_.ST[43] = ' DevLog: ' , $DevLog
    		$_.ST[44] = ' BackupServiceConfig: ' , $BackupServiceConfig
	    	$_.ST[45] = ' BackupServiceType: ' , $WPF_BackupServiceType.Text
		    $_.ST[46] = ' ShowConsole: ' , $ShowConsole
    		$_.ST[47] = ' LaptopTweaked: ' , $LaptopTweaked
	    	$_.ST[48] = ''
    		$_.ST[49] = ' --------Misc Info--------'
	    	$_.ST[50] = ' Run Button txt: ' , $WPF_RunScriptButton.Content
		    $_.ST[51] = ' Args: ' , $PassedArg
    		$_.ST[52] = ''
	    	$_.ST[53] = ' ********END********'
        }

		$DiagString | Set-Clipboard

		[ Windows.Forms.Messagebox ]::Show( 'Diagnostic Information, has been copied to the clipboard.' , 'Notice' , 'OK' ) | Out-Null

        # GUI Functions

	    $WPF_TabControl.Add_SelectionChanged{ 

            If ( ! $ServicesGenerated -and $WPF_ServicesDG_Tab.IsSelected )
            { 
                $Script:ServicesGenerated = $True
                GenerateServices 
            } 
        }

	    $WPF_ServiceConfig           | % { 

            $_.Add_SelectionChanged{ 

                HideShowCustomSrvStuff
                RunDisableCheck 
            }
        }
	
        $WPF_EditionConfig           | % { 
    
            $_.Add_SelectionChanged{ 
        
                RunDisableCheck 
            }
        }

	    $WPF_FilterTxt               | % { 

            $_.Add_TextChanged{ 
            
                DGFilter 
            }
        }
	
        $WPF_ShowConsole_CB          | % { 
    
            $_.Add_Checked{ 
        
                ShowConsoleWin 5 #5 = Show
            }
        }
     
	    $WPF_ShowConsole_CB          | % { 

            $_.Add_UnChecked{ 
        
                ShowConsoleWin 0 #0 = Hide 
            }
        }
     
	    $WPF_BuildCheck_CB           | % { 

            $_.Add_Click{ 
        
                RunDisableCheck 
            }
        }

	    $WPF_EditionCheckCB          | % { 

            $_.Add_Click{ 
        
                RunDisableCheck 
            }
        }

	    $WPF_ScriptLog_CB            | % { 

            $_.Add_Click{ 
            
                $WPF_LogNameInput.IsEnabled = $WPF_ScriptLog_CB.IsChecked 
            }
        }

	    $WPF_btnOpenFile             | % { 

            $_.Add_Click{ 
            
                OpenSaveDiaglog 0 
            }
        }

	    $WPF_SaveCustomSrvButton     | % { 

            $_.Add_Click{ 
        
                OpenSaveDiaglog 1 
            }
        }

	    $WPF_SaveRegButton           | % { 

            $_.Add_Click{ 
        
                OpenSaveDiaglog 2 
            }
        }

	    $WPF_ContactButton           | % { 

            $_.Add_Click{ 
        
                OpenWebsite 'mailto:madbomb122@gmail.com' 
            }
        }

	    $WPF_LoadServicesButton      | % { 

            $_.Add_Click{
        
                GenerateServices 
            }
        }

	    $WPF_UpdateServiceButton     | % { 

            $_.Add_Click{ 
        
                UpdateCheckNow -Ser 
            } 
        }
	
        $WPF_UpdateScriptButton      | % { 

            $_.Add_Click{ 
        
                UpdateCheckNow -Srp 
            }
        }

	    $WPF_UpdateBothButton        | % { 

            $_.Add_Click{ 
        
                UpdateCheckNow -Ser -Srp 
            }
        }
	
        $WPF_BlackViperWSButton      | % { 

            $_.Add_Click{ 
        
                OpenWebsite 'http://www.blackviper.com/' 
            }
        }

	    $WPF_Madbomb122WSButton      | % { 

            $_.Add_Click{ 
        
                OpenWebsite 'https://GitHub.com/madbomb122/' 
            }
        }

	    $WPF_FeedbackButton          | % { 

            $_.Add_Click{ 
            
                OpenWebsite "$MySite/issues" 
            }
        }

	    $WPF_FAQButton               | % { 

            $_.Add_Click{ 
            
                OpenWebsite "$MySite/blob/master/README.md" 
            }
        }

	    $WPF_DonateButton            | % { 

            $_.Add_Click{ 
        
                ClickedDonate 
            }
        }

	    $WPF_CopyrightButton         | % {

            $_.Add_Click{ 
        
                [ Windows.Forms.Messagebox ]::Show( $Copyright , 'Copyright' , 'OK' ) | Out-Null 
            }
        }

	    $WPF_AboutButton             | % { 

            $_.Add_Click{ 
        
                [ Windows.Forms.Messagebox ]::Show( "This script lets you set Windows 10's services based on Black `
                Viper's Service Configurations, your own Service Configuration (If in a proper format), or a backup `
                of your Service Configurations made by this script.`n`nThis script was created by MadBomb122." , 'About' , 'OK' ) | Out-Null 
            }
        }

    	$Script:RunScript = 0

	    If ( $All_or_Min -eq '-Full' )
        { 
            $WPF_RadioAll.IsChecked = $True 
        } 
    
        Else
        { 
            $WPF_RadioMin.IsChecked = $True 
        }

	    $WPF_LogNameInput.Text = $LogName

	    If ( $ScriptLog -eq 1 )
        { 
            $WPF_ScriptLog_CB.IsChecked = $True
            $WPF_LogNameInput.IsEnabled = $True 
        }

	    If ( $IsLaptop -eq '-Lap' )
        {
		    $WPF_ServiceConfig.Items.RemoveAt( 2 )
	    } 
    
        Else 
        {
		    $WPF_LaptopTweakGrid.Visibility = 'Collapsed'
		    $WPF_LaptopTweakBox.Visibility  = 'Hidden'
	    }

	    $Script:BVCount = $WPF_ServiceConfig.Items.Count

	    $VarList.ForEach{ 

            $_.Value.IsChecked = If ( $( GV -Name ( $_.Name.Split( '_' )[1] ) -ValueOnly ) -eq 1 ) { $True } Else { $False } 
        }

	    EditionBuildCBSet

	    $WPF_BackupServiceType    | % { 

            $_.SelectedIndex      = $BackupServiceType 
        }

        $WPF_ServiceConfig        | % { 

            $_.SelectedIndex      = $Black_Viper 
        }

	    $WPF_LoadFileTxtBox       | % { 

            $_.Text               = $ServiceConfigFile 
        }

	    $WPF_LoadServicesButton   | % { 
        
            $_.IsEnabled          = SetServiceVersion
        }

	    $WPF_Service_Ver_Txt.Text = "Service Version: $ServiceVersion ($ServiceDate)"

	    If ( $Release_Type -ne 'Stable' )
        {
		    If ( $ShowConsole -eq 1 )
            { 
                $WPF_ShowConsole_CB.IsChecked = $True 
            }

		    $WPF_ShowConsole_CB.Visibility = 'Hidden'
	    } 

        ElseIf ( $ShowConsole -eq 0 )
        {
		    ShowConsoleWin 0
    	}

	    $Script:ServiceImport = 1
	    HideShowCustomSrvStuff
	    RunDisableCheck

	    If ( $Release_Type -eq 'Stable' )
        { 
            Clear-Host 
        }

        $Splat    = @{ 
            
            Text  = "Displaying GUI Now"
            Color = 14 
        } 
        
        DisplayOut @Splat

	    $Splat    = @{ 

            Text  = "To exit you can close the GUI or PowerShell Window."
            Color = 14
        } 
        
        DisplayOut @Splat

        $Form.ShowDialog() | Out-Null
    }
}

Function RunScriptFun 
{
	SaveSetting
	$Script:RunScript                   = 1
	$Script:Black_Viper                 = $WPF_ServiceConfig.SelectedIndex + 1
	
    If ( $Black_Viper -eq $BVCount )
    {
		If ( ! ( Test-Path -LiteralPath $ServiceConfigFile -PathType Leaf ) -And $null -ne $ServiceConfigFile )
        {
			[ Windows.Forms.Messagebox ]::Show( "The File '$ServiceConfigFile' does not exist." , 'Error' , 'OK' ) | Out-Null
			
            $Script:RunScript           = 0
		} 

        Else 
        {
			$Script:LoadServiceConfig   = 1
			$Script:Black_Viper         = 0
		}
	}

	If ( $RunScript -eq 1 )
    {
		$Script:RanScript               = $True
		$WPF_RunScriptButton.IsEnabled  = $False
		$WPF_RunScriptButton.Content    = 'Run Disabled while changing services.'

		$a                              = New-Object -COMObject WScript.Shell

		$a.Popup( 'Script will start in 1 Second.' , 1 , 'This is to prevent clicking Run again.' , 0 ) | Out-Null

		$WPF_TabControl.Items[3]        | % { 
            
            $_.Visibility               = 'Visible'
		    $_.IsSelected               = $True
        }

		If ( $WPF_CustomBVCB.IsChecked )
        {
			$Script:LoadServiceConfig   = 2
			$WPF_FilterTxt.text         = ''
			$Script:csv                 = $WPF_dataGrid.Items.ForEach{
				
                $STF                    = $ServicesTypeFull.IndexOf( $_.BVType )
				
                If ( ! $_.CheckboxChecked )
                { 
                    $STF *= -1 
                }

				[ PSCustomObject ]@{ 

                    ServiceName = $_.ServiceName
                    StartType   = $STF
                    Status      = $_.SrvState 
                }
			}

		} 

        ElseIf ( $Script:LoadServiceConfig -NotIn 1 , 2 )
        {
			$Script:LoadServiceConfig = 0
		}

		Black_Viper_Set $Black_Viper $All_or_Min
	} 

    Else 
    {
		RunDisableCheck
	}
}

Function PopWindow 
{
	Param (
		[ Alias (  'M' ) ] [ String ] $Message ,
		[ Alias ( 'CB' ) ] [ String ] $ChkBox  )

    [ XML ] $XAMLPW = @"
    <Window xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Title="Caution" Height="215" Width="285" BorderBrush="Black" Background="White" WindowStyle="ToolWindow">
	    <Grid Background="#FFE5E5E5">
		    <Button Name="Button0" Content="Yes" HorizontalAlignment="Left" Margin="10,151,0,0" VerticalAlignment="Top" Width="76"/>
		    <Button Name="Button1" Content="No" HorizontalAlignment="Left" Margin="95,151,0,0" VerticalAlignment="Top" Width="76"/>
		    <TextBlock Name="Tbox" HorizontalAlignment="Left" Margin="10,10,0,0" TextWrapping="Wrap" VerticalAlignment="Top" Height="113" Width="247"/>
		    <CheckBox Name="Cbox" Content="CheckBox" HorizontalAlignment="Left" Margin="10,131,0,0" VerticalAlignment="Top"/>
	    </Grid>
    </Window>
"@

	[ Void ][ System.Reflection.Assembly ]::LoadWithPartialName( 'presentationframework' )
	
    $FormPW = [ Windows.Markup.XamlReader ]::Load( ( New-Object System.Xml.XmlNodeReader $XAMLPW ) )

	$XAMLPW.SelectNodes( '//*[@Name]' ) | % { 
        
        $Splat = @{ Name  = "WPFPW_$( $_.Name )" 
                    Value = $FormPW.FindName( $_.Name )
                    Scope = Script 
        }

        SV @Splat
    }

	$PowerShellPW = [ PowerShell ]::Create()
	
    $PowerShellPW | % { 

        $_.RunSpace = [ RunSpaceFactory ]::CreateRunspace()
	    $_.Runspace.Open()
    }

	[ System.Reflection.Assembly ]::LoadWithPartialName( 'System.Windows.Forms' ) | Out-Null

	$WPFPW_Tbox.Text    = $Message
	$WPFPW_Cbox.Content = $ChkBox
	$tmpEB              = $EBFailCount

	$WPFPW_Button0.Add_Click{ 

        $FormPW.Close()
        RunScriptFun 
    }

	$WPFPW_Button1.Add_Click{ 

        $FormPW.Close() 
    }

	$WPFPW_Cbox.Add_Checked{

		If ( $EBFailCount -In 1 , 3 )
        { 
            $Script:EditionCheck         = 'Pro'
            EditionBuildCBSet 
        }

		If ( $EBFailCount -In 2 , 3 )
        { 
            $Script:BuildCheck           = 1
            $WPF_BuildCheck_CB.IsChecked = $True 
        }

		EditionBuildCBSet
		$EBFailCount = 0
	}

	$WPFPW_Cbox.Add_UnChecked{

		If ( $EBFailCount -In 1 , 3 )
        { 
            $Script:EditionCheck         = 0
            EditionBuildCBSet 
        }

		If ( $EBFailCount -In 2 , 3 )
        { 
            $Script:BuildCheck           = 0
            $WPF_BuildCheck_CB.IsChecked = $False 
        }

		$EBFailCount = $tmpEB
	}
	$FormPW.ShowDialog() | Out-Null
}

Function EditionBuildCBSet 
{
	$WPF_EditionCheckCB.IsChecked    = If ( $EditionCheck -ne 0 ) { $True } Else { $False }
	$WPF_EditionConfig.SelectedIndex = If ( 'Home' -In $WinEdition , $EditionCheck ) { 1 } ElseIf ( 'Pro' -In $WinEdition , $EditionCheck ) { 2 } Else { 0 }
}

Function UpdateEdition 
{
	If ( $WPF_EditionCheckCB.IsChecked )
    {
		$Script:EditionCheck = If ( $WPF_EditionConfig.SelectedIndex -ne 0 ) { $WPF_EditionConfig.Text } Else { 0 }
	} 

    Else 
    {
		$Script:EditionCheck = 0
	}
}

Function RowColorRet( [ Bool ] $Match , [ Bool ] $checkbox )
{
	If ( !$Match )
    {
		If ( $checkbox )
        { 
            Return 'Red' 
        } 
        
        Else
        { 
            Return 'Yellow' 
        }
	} 

    Else 
    {
		If ( $checkbox )
        { 
            Return 'Green' 
        } 
        
        Else
        { 
            Return 'None' 
        }
	}
}

Function DGFilter 
{
	$Script:DGUpdate          = $False
	$TxtFilter                = $WPF_FilterTxt.Text
	$Filter                   = $FilterList[$WPF_FilterType.SelectedIndex]
	$TableFilter              = If ( $DataGridLCust ) { $DataGridListCust } Else { $DataGridListOrig }
	$WPF_dataGrid.ItemsSource = $Script:DataGridListFilter = $TableFilter.Where{ $_.$Filter -Match $TxtFilter }
	$Script:DGUpdate          = $True
}

Function RunDisableCheck 
{
	$Script:EBFailCount       = 0
	$Script:BuildCheck        = If ( $WPF_BuildCheck_CB.IsChecked ) { 1 } Else { 0 }
	UpdateEdition

	$EBFailCount              = 0

	If ( ! ( $EditionCheck -In 'Home' , 'Pro' -or $WinSkuList -Contains $WinSku ) )
    { 
        $Script:EBFailCount   = 1 
    }

	If ( $Win10Ver -NotIn $MinVer..$MaxVer -And $BuildCheck -ne 1 )
    { 
        $Script:EBFailCount  += 2 
    }

	If ( $EBFailCount -ne 0 )
    {
		$TmpHead              = 'Black Viper'
	} 

    ElseIf ( ( $WPF_ServiceConfig.SelectedIndex + 1 ) -eq $BVCount )
    {
		$WPF_RunScriptButton.IsEnabled           = $False
		$WPF_LoadServicesButton.IsEnabled        = $False
		
        If ( ! $ServiceConfigFile -or ! ( Test-Path -LiteralPath $ServiceConfigFile -PathType Leaf ) )
        {
            $Buttontxt        = 'Run Disabled, No Custom Service List File Selected or Does not exist.'
		} 

        Else 
        {
			[ System.Collections.ArrayList ] $Tempcheck = Import-Csv -LiteralPath $ServiceConfigFile
			
            If ( $null -In $Tempcheck[0].StartType , $Tempcheck[0].ServiceName )
            {
				$tmpG                             = $Tempcheck[0].'BV-Safe-Desk'
				
                If ( $tmpG -In 'GernetatedByMadBomb122' , 'GeneratedByMadBomb122' )
                {
					$Script:ServiceConfigFile     = ''
					$WPF_LoadFileTxtBox.Text      = ''
					$Buttontxt                    = 'Run Disabled, No Custom Service List File Selected or Does not exist.'

					[ Windows.Forms.Messagebox ]::Show( "Please don't load the 'BlackViper.csv' File... `nSelect another 'File' or Select a 'Serivce Configuration' above." , 'Error' , 'OK' ) | Out-Null
				} 

                Else 
                {
					    $Buttontxt = 'Run Disabled, Invalid Custom Service File.'
				}
            } 
            
            Else 
            {
				$WPF_RunScriptButton.IsEnabled    = $True
				$WPF_LoadServicesButton.IsEnabled = $True
				$Buttontxt = 'Run Script with Custom Service List'
			}
		}

		$TmpHead = 'Custom Service'
	} 

    Else 
    {
		$TmpHead    = If ( $WPF_ServiceConfig.SelectedIndex -eq 0 ) 
        { 
            'Win Default' 
        } 
        
        Else 
        { 
            'Black Viper' 
        }
		
        $Buttontxt  = If ( $WPF_CustomBVCB.IsChecked ) 
        { 
            'Run Script with Customize Service List' 
        } 
        
        Else 
        { 
            'Run Script' 
        }

		$WPF_RunScriptButton      | % { $_.IsEnabled = $True }
		$WPF_LoadServicesButton   | % { $_.IsEnabled = $True }
	}

	$tmp                          = $WPF_FilterType.SelectedIndex
	
    For ( $i = ( $WPF_FilterType.Items.Count - 1 ) ; $i -ge 4 ; $i-- )
    { 
        $WPF_FilterType.Items.RemoveAt( $i ) 
    }

    $TmpHead , "State" , "Description" , "Path" , "Row Color" | % { 
        
        [ Void ] $WPF_FilterType.Items.Add( $_ )
    }

	$WPF_FilterType                 | % { $_.SelectedIndex = $tmp }

	$WPF_dataGrid.Columns[4].Header = $TmpHead
	$WPF_RunScriptButton.Content    = $Buttontxt
}

Function GenerateServices 
{
	$Black_Viper                    = $WPF_ServiceConfig.SelectedIndex + 1
	
    If ( $Black_Viper -eq $BVCount )
    {
		If ( $Script:ServiceGen -eq 0 )
        { 
            $Script:ServiceImport   = 1 
        }

		$Script:LoadServiceConfig   = 1
		$ServiceFilePath            = $WPF_LoadFileTxtBox.Text
		$Script:ServiceGen          = 1
	} 

    Else 
    {
		If ( $Script:ServiceGen -eq 1 )
        { 
            $Script:ServiceImport   = 1 
        }
		
        $FullMin , $WPF_ACUcheckboxChecked.IsChecked = If ( $WPF_RadioAll.IsChecked ) 
        { 
            '-Full' , $True 
        } 
        
        Else
        { 
            '-Min' , $False 
        }

		$Script:LoadServiceConfig   = 0
		$ServiceFilePath            = $BVServiceFilePath
		$Script:ServiceGen          = 0
	}

	$BVS = If ( $LoadServiceConfig -eq 1 )
    {
		'StartType'
	} 

    ElseIf ( $Black_Viper -eq 1 )
    {
		$ServiceMaker + 'Def-' + $WinEdition
	} 

    ElseIf ( $Black_Viper -eq 2 )
    {
		$ServiceMaker + 'Safe' + $IsLaptop
	} 

    ElseIf ( $Black_Viper -eq 3 )
    {
		$ServiceMaker + 'Tweaked-Desk'
	}

	$Script:XboxService             = If ( $WPF_XboxService_CB.IsChecked ) { 1 } Else { 0 }
	
    If ( $ServiceImport -eq 1 )
    {
		[ System.Collections.ArrayList ] $Script:ServCB = Import-Csv -LiteralPath $ServiceFilePath

		$Script:ServiceImport       = 0
	}

	[ System.Collections.ArrayList ] $Script:DataGridListOrig = @{}

	$Script:DataGridListCust        = $ServCB.ForEach{

		$ServiceName = QMarkServices $_.ServiceName
		
        If ( $CurrServices.Name -Contains $ServiceName )
        {
			$tmp                    = ForEach ( $srv in $CurrServices )
            { 
                If ( $srv.Name -eq $ServiceName )
                { 
                    $srv
                    Break 
                } 
            }

			$ServiceCommName           = $tmp.DisplayName
			$ServiceCurrType           = $tmp.StartType
			$SrState                   = $tmp.Status
			$SrvDescription            = $tmp.Description
			$SrvPath                   = $tmp.PathName

			[ Int ]$ServiceTypeNum     = $_.$BVS
			
            $ServiceCurrType           = If ( $ServiceCurrType -eq 'Disabled' )
            {
				$ServicesTypeFull[1]
			} 

            ElseIf ( $ServiceCurrType -eq 'Manual' )
            {
				$ServicesTypeFull[2]
			} 

            ElseIf ( $ServiceCurrType -eq 'Auto' )
            {
				If ( AutoDelayTest $ServiceName -eq 1 )
                { 
                    $ServicesTypeFull[4] 
                } 
                
                Else
                { 
                    $ServicesTypeFull[3] 
                }
			}

			$checkbox                  = $True

			If ( $ServiceTypeNum -In -4..0 )
            {
				If ( $FullMin -ne '-Full' )
                { 
                    $checkbox          = $False 
                }

				$ServiceTypeNum       *= -1
			}

			If ( $XboxService -eq 1 -and $XboxServiceArr -Contains $ServiceName ) 
            { 
                $checkbox              = $False 
            }
			
            $ServiceType               = $ServicesTypeFull[$ServiceTypeNum]
			$Match                     = If ( $ServiceType -eq $ServiceCurrType ) { $True } Else { $False }
			$RowColor                  = RowColorRet $Match $checkbox

			[ PSCustomObject ]@{ 
    
                CheckboxChecked        = $checkbox
                CName                  = $ServiceCommName
                ServiceName            = $ServiceName
                CurrType               = $ServiceCurrType
                BVType                 = $ServiceType
                StartType              = $ServiceTypeNum
                ServiceTypeListDG      = $ServicesTypeFull
                SrvStateListDG         = $SrvStateList
                SrvState               = $SrState
                SrvDesc                = $SrvDescription
                SrvPath                = $SrvPath
                Matches                = $Match
                RowColor               = $RowColor 
            }

			$Script:DataGridListOrig += [ PSCustomObject ]@{ 

                CheckboxChecked        = $checkbox
                CName                  = $ServiceCommName
                ServiceName            = $ServiceName
                CurrType               = $ServiceCurrType
                BVType                 = $ServiceType
                StartType              = $ServiceTypeNum
                ServiceTypeListDG      = $ServicesTypeFull
                SrvStateListDG         = $SrvStateList
                SrvState               = $SrState
                SrvDesc                = $SrvDescription
                SrvPath                = $SrvPath
                Matches                = $Match
                RowColor               = $RowColor 
            }
		}
	}

	$WPF_dataGrid.ItemsSource = If ( $WPF_CustomBVCB.IsChecked ) { $DataGridListCust } Else { $DataGridListOrig }
}

    Function TBoxDiag 
    {
	    Param ( [ Alias ( 'T' ) ] [ String [] ] $Text , 
                [ Alias ( 'C' ) ] [    Int [] ] $Color )

	    $WPF_DiagnosticOutput.Dispatcher.Invoke(
		    [ Action ]{
			
                For ( $i = 0 ; $i -lt $Text.Length ; $i++ )
                {
				    $Run              = New-Object System.Windows.Documents.Run
				
                    $Run              | % { 
                
                        $_.Foreground = $colorsGUI[($Color[$i])]
				        $_.Text       = $Text[$i]
				    }
            
                $WPF_DiagnosticOutput.Inlines.Add( $Run )
			
                }

			    $WPF_DiagnosticOutput.Inlines.Add( ( New-Object System.Windows.Documents.LineBreak ) ) } , 'Normal'
	    )

	    $Script:DiagString           += "$( $Text -Join '' )`r`n"
	        
                $Splat                = @{ 

                    Text              = $Text
                    Color             = $Color 
                } 

                DisplayOut @Splat
    }

##########
# GUI -End
##########
# Update Functions -Start
##########

Function InternetCheck
{ 
    If ( $InternetCheck -eq 1 -or ( Test-Connection 1.1.1.1 -Count 1 -Quiet ) )
    { 
        Return $True 
    } 

    Return $False 
}

Function UpdateCheckAuto 
{
	If ( InternetCheck )
    {
        UpdateCheck -NAuto:$False
	} 

    Else 
    {
		$Script:ErrorDi = 'No Internet'

		Error_Top

        $Splat    = @{ 

            Text  = "No Internet connection detected or GitHub.com"
            Color = 2
            Log   = 1 
        } 
        
        DisplayOutLML @Splat

        $Splat    = @{ 
        
            Text  = "is currently down."
            Color = 2
            Log   = 1 
        } 
        
        DisplayOutLML @Splat
        
        $Splat    = @{ 
        
            Text  = "Tested by pinging GitHub.com"
            Color = 2
            Log   = 1 
        }
        
        DisplayOutLML @Splat

		MenuBlankLine -L

        $Splat    = @{ 
        
            Text  = "To skip use one of the following methods"
            Color = 2
            Log   = 1 
        } 
        
        DisplayOutLML @Splat
		
        $Splat    = @{ 
        
            Text  = '|' , ' 1. Run Script or bat file with ' , '-sic' , ' switch'.PadRight( 16 ) , '|'
            Color = 14 , 2 , 15 , 2 , 14
            Log   = 1
        } 
        
        DisplayOut @Splat
		
        $Splat    = @{ 
        
            Text  = '|' , ' 2. Change ' , 'InternetCheck' , ' in Script file'.PadRight( 28 ) , '|'
            Color = 14 , 2 , 15 , 2 , 14
            Log   = 1
        } 
        
        DisplayOut @Splat

        $Splat    = @{ 
        
            Text  = '|' , ' 3. Change ' , 'InternetCheck' , ' in bat file'.PadRight( 28 ) , '|'
            Color = 14 , 2 , 15 , 2 , 14
            Log   = 1 
        } 
        
        DisplayOut @Splat
		
        MenuBlankLine -L
		MenuLine -L

		If ( ! ( Test-Path -LiteralPath $BVServiceFilePath -PathType Leaf ) )
        {
			MenuBlankLine -L
            
            $Splat    = @{ 
            
                Text  = '|' , ' The File ' , 'BlackViper.csv' , ' is missing and the script  ' , '|'
                Color = "" 
                Log   = 1 
            } 
            
            DisplayOut @Splat
            
            $Splat    = @{ 
            
                Text  = "can't run w/o it."
                Color = 2
                Log   = 1 
            } 
            
            DisplayOutLML @Splat
			
            MenuBlankLine -L
			MenuLine -L
			AutomatedExitCheck 1
		} 

        Else 
        {
			AutomatedExitCheck 0
		}
	}
}

Function UpdateCheckNow 
{
	If ( InternetCheck ) 
    {
		UpdateCheck @args
	} 

    Else 
    {
		$Script:ErrorDi = 'No Internet'
		[ Windows.Forms.Messagebox ]::Show( 'No Internet connection detected or GitHub is down. `
        If you are connected to the internet, Click the Skip internet checkbox.' , 'Error: No Internet' , 'OK' , 'Error' ) | Out-Null
	}
}

Function UpdateCheck 
{
	Param ( [ Switch ] $NAuto = $True , [ Alias ( 'Srp' ) ] [ Switch ] $SrpCheck , [ Alias ( 'Ser' ) ] [ Switch ] $SerCheck )

	Try 
    {
		$CSV_Ver        = Invoke-WebRequest $Version_Url -ErrorAction Stop | ConvertFrom-Csv
		$Message        = ''
	} 

    Catch 
    {
		$CSV_Ver        = $False
		$Message        = 'Error: Unable to check for update, try again later.'
		
        If ( $ScriptLog -eq 1 )
        { 
            Write-Output "$( GetTime ): $Message" | Out-File -LiteralPath $LogFile -Encoding Unicode -Append 
        }
	}

	If ( ( $SerCheck -or $ServiceVerCheck -eq 1 ) -and ! $CSV_Ver )
    {
		$WebVersion     = $CSV_Ver[1].Version
		$ServVer        = If ( $ServiceVersion -eq 'Missing File' ) { '0.0' } Else { $ServiceVersion }

		If ( $LoadServiceConfig -In 0 , 1 -And $WebVersion -gt $ServVer )
        {
			$Choice     = 6
			If ( $NAuto )
            {
				$UpdateFound , $UpdateTitle = If ( $ServiceVersion -eq 'Missing File' )
                {
					'Download Missing BlackViper.csv file?' , 'Missing File'
				} 

                Else 
                {
					"Update Service File from $ServVer to $WebVersion ?",'Update Found'
				}
				
                $a      = New-Object -COMObject WScript.Shell

				$Choice = $a.popup( $UpdateFound , 20 , $UpdateTitle , 4 )
			}

			If ( $Choice -eq 6 )
            {
				If ( $ScriptLog -eq 1 )
                { 
                    Write-Output "$( GetTime ): Downloading update for 'BlackViper.csv'" | Out-File -LiteralPath $LogFile -Encoding Unicode -Append
                }

				DownloadFile $Service_Url $BVServiceFilePath
				
                $Message = "Service File Updated to $WebVersion"
				
                If ( $LoadServiceConfig -ne 2 )
                {
					[ System.Collections.ArrayList ]$Script:csv = Import-Csv -LiteralPath $BVServiceFilePath
					SetServiceVersion
				} 

                Else 
                {
					$WPF_Service_Ver_Txt.Text = "Service Version: $WebVersion"
				}
			} 

            ElseIf ( !$SrpCheck )
            {
				$NAuto = $False
			}
		} 

        ElseIf ( $NAuto )
        {
			$Message       = 'No Service update Found.'
		}
	}

	If ( ( $SrpCheck -or $ScriptVerCheck -eq 1 ) -and !$CSV_Ver )
    {
		$CSVLine , $RT     = If ( $Release_Type -eq 'Stable' ) { 0 ,'' } Else { 2 , 'Testing/' }
		
        $WebScriptVer      = $CSV_Ver[$CSVLine].Version + "." + $CSV_Ver[$CSVLine].MinorVersion

		If ( $WebScriptVer -gt $Script_Version )
        {
			$Choice = 6
			
            If ( $NAuto )
            {
				$A         = New-Object -COMObject WScript.Shell
				$Choice    = $A.popup( "Update Script File from $Script_Version to $WebScriptVer ?" , 20 , 'Update Found' , 4 )
			}

			If ( $Choice -eq 6 )
            {
				$Script:RanScript = $True
				ScriptUpdateFun $RT
			} 

            ElseIf ( $Message -eq '' )
            {
				$NAuto     = $False
			}
		} 
        
        ElseIf ( $NAuto )
        {
			$Message = If ( $Message -eq '' ) { 'No Script update Found.' } Else { 'Congrats you have the latest Service and Script version.' }
		}
	}

	If ( $NAuto ) { [ Windows.Forms.Messagebox ]::Show( $Message , 'Update' , 'OK' ) | Out-Null }
}

Function ScriptUpdateFun ( [ String ] $RT )
{
	SaveSetting

	$Script_Url            = $URL_Base + $RT + 'BlackViper-Win10.ps1'
	$ScrpFilePath          = $FileBase + 'BlackViper-Win10.ps1'
	$Script:RanScript      = $True
	$FullVer               = $WebScriptVer + '.' + $WebScriptMinorVer
	$UpArg                 = ''

	If ( ! $GuiSwitch )
    {
		If ( $LoadServiceConfig -eq 1 )
        {
			$UpArg        += "-lcsc $ServiceConfigFile "
		} 

        ElseIf ( $LoadServiceConfig -eq 2 )
        {
			$TempSrv       = $Env:Temp + '\TempSrv.csv'
            $Script:csv    | Export-Csv -LiteralPath $TempSrv -Force -Delimiter ','
            $UpArg        += "-lcsc $TempSrv "
		}
	}

	$ArgList.ForEach{

        $TruCount          = 0
        
        If ( $GuiSwitch -and ! $_.Gui )
        { 
            $TC            = -1 
        } 
        
        Else
        { 
            $tmp           = $_.Var.Split('=')
            $Count         = $_.Match
            $TC            = $Count*2 
        }

		For ( $i = 0 ; $i -lt $TC ; $i += 2 )
        {
			$var           = GV -Name $tmp[$i] -ValueOnly
			
            If ( $var -eq $tmp[$i+1] )
            { 
                $TruCount++ 
            }
		}

		If ( $TruCount -eq $Count )
        { 
            $Script:Uparg += $_.Arg + " "
        }
	}
	
    If ( $ScriptLog -eq 1 )
    { 
        $UpArg            += "-logc $LogName " 
    }

	Clear-Host
	MenuLine -L
	MenuBlankLine -L

    $Splat    = @{ 
    
        Text  = ''.PadRight( 18 ) + 'Update Found!'
        Color = 13 
        Log   = 1 
    } 
    
    DisplayOutLML @Splat
	
    MenuBlankLine -L
	
    $Splat    = @{ 
    
        Text  = '|' , ' Updating from version ' , "$Script_Version".PadRight( 30 ) , '|'
        Color = 14 , 15 , 11 , 14 
        Log   = 1 
    }
    
    DisplayOut @Splat

	MenuBlankLine -L
	
    $Splat    = @{ 
    
        Text  = '|' , ' Downloading version ' , "$FullVer".PadRight( 31 ) , '|'
        Color = 14 , 15 , 11 , 14
        Log   = 1 
    } 
    
    DisplayOut @Splat
	
    $Splat    = @{ 
    
        Text  = "Will run after download is complete."
        Color = 15
        Log   = 1 
    } 
    
    DisplayOutLML @Splat

	MenuBlankLine -L
	MenuLine -L

	DownloadFile $Script_Url $ScrpFilePath
	SAPS Powershell "-NoProfile -ExecutionPolicy Bypass -File `"$ScrpFilePath`" $UpArg" -Verb RunAs
	CloseExit
}

##########
# Update Functions -End
##########
# Log/Backup Functions -Start
##########

Function ServiceBAfun ( [ String ] $ServiceBA )
{
	If ( $LogBeforeAfter -eq 1 )
    {
		$ServiceBAFile = "$FileBase$Env:computername-$ServiceBA.log"

		If ( $ServiceBA -eq 'Services-Before' ) 
        { 
            $CurrServices | Out-File -LiteralPath $ServiceBAFile 
        } 
        
        Else
        { 
            Get-Service | Select DisplayName , Name , StartType , Status | Out-File -LiteralPath $ServiceBAFile 
        }
    } 
    
    ElseIf ( $LogBeforeAfter -eq 2 )
    {
		$TMPServices = If ( $ServiceBA -eq 'Services-Before' )
        { 
            $CurrServices 
        } 
        
        Else
        { 
            Get-Service | Select DisplayName , Name , StartType , Status 
        }

        "`n$ServiceBA -Start" , ''.PadRight( 37 , '-' ) , $TMPServices , ''.PadRight( 37 , '-' ) , "$ServiceBA -End`n" | % {
            
            Echo $_ | Out-File -LiteralPath $LogFile -Encoding Unicode -Append
        }
	}
}

Function Save_Service ( [ String ] $SavePath )
{
	If ( $WPF_CustomBVCB.IsChecked )
    {
		$SaveService         = $WPF_dataGrid.Items.ForEach{
			
            $STF             = $ServicesTypeFull.IndexOf( $_.BVType )
			
            If ( !$_.CheckboxChecked )
            { 
                $STF        *= -1 
            }
			
            $ServiceName     = $_.ServiceName
			
            If ( $ServiceName -Like "*$ServiceEnd" )
            { 
                $ServiceName = $ServiceName.Replace( '_.+' , '_?????' )
            }

			[ PSCustomObject ]@{ 
            
                ServiceName  = $ServiceName
                StartType    = $STF
                Status       = $_.SrvState 
            }
		}
	} 

    Else 
    {
		$SaveService   = GenerateSaveService
	}

	$SaveService       | Export-Csv -LiteralPath $SavePath -Encoding Unicode -Force -Delimiter ','
	
    [ Windows.Forms.Messagebox ]::Show( "File saved as '$SavePath'" , 'File Saved' , 'OK' ) | Out-Null
}

Function Save_ServiceBackup
{
	$SaveService       = @()
	$ServiceSavePath   = $FileBase + $Env:computername + '-Service-Backup.csv'
	$SaveService       = GenerateSaveService
	$SaveService       | Export-Csv -LiteralPath $ServiceSavePath -Encoding Unicode -Force -Delimiter ','
}

Function GenerateSaveService 
{
	$TMPServiceL       = $AllService.ForEach{
	    
        $ServiceName   = $_.Name

		If ( $Skip_Services -NotContains $ServiceName ) 
        {
			$tmp       = $_.StartType
			$StartType = If ( $tmp -eq 'Disabled' ) 
            { 
                1 
            } 

            ElseIf ( $tmp -eq 'Manual' )
            { 
                2 
            }
            
            ElseIf ( $tmp -eq 'Auto' )
            { 
                If ( AutoDelayTest $ServiceName -eq 1 )
                { 
                    4 
                } 
                
                Else
                { 
                    3
                }
			} 
            
            Else 
            {
				$tmp
			}

			If ( $ServiceName -Like "*$ServiceEnd" )
            { 
                $ServiceName = $ServiceName.Replace( '_.+' , '_?????' )
            }

			[ PSCustomObject ]@{ 

                ServiceName  = $ServiceName
                StartType    = $StartType
                Status       = $_.Status 
            }
		}
	}

	Return $TMPServiceL
}

Function RegistryServiceFileBackup 
{
	$SavePath = $FileBase + $Env:computername + '-Service-Backup.reg'
	
    If ( $WPF_CustomBVCB.IsChecked )
    { 
        GenerateRegistryCustom $SavePath 
    } 
    
    Else
    { 
        GenerateRegistryRegular $SavePath 
    }
}

Function RegistryServiceFile ( [ String ] $TempFP )
{
	If ( $WPF_CustomBVCB.IsChecked )
    { 
        GenerateRegistryCustom $TempFP 
    } 
    
    Else
    { 
        GenerateRegistryRegular $TempFP 
    }
	
    [ Windows.Forms.Messagebox ]::Show( "Registry File saved as '$TempFP'" , 'File Saved' , 'OK' ) | Out-Null
}

Function GenerateRegistryRegular( [ String ] $TempFP )
{
	Echo "Windows Registry Editor Version 5.00`n" | Out-File -LiteralPath $TempFP
	
    $AllService.ForEach{

		$ServiceName        = $_.Name

		If ( $Skip_Services -NotContains $ServiceName ) 
        {
            $tmp            = $_.StartType
			$ServiceTypeNum = If ( $tmp -eq 'Disabled' ) { 4 } ElseIf ( $tmp -eq 'Manual' ) { 3 } ElseIf ( $tmp -eq 'Auto' ) { 2 }
			$Num            = '"Start"=dword:0000000' + $ServiceTypeNum

			Echo "[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\$ServiceName]" | Out-File -LiteralPath $TempFP -Append

			Echo $Num | Out-File -LiteralPath $TempFP -Append

			If ( $ServiceTypeNum -eq 2 -and ( AutoDelayTest $ServiceName -eq 1 ) )
            { 
                Echo '"DelayedAutostart"=dword:00000001' | Out-File -LiteralPath $TempFP -Append 
            }

			Echo '' | Out-File -LiteralPath $TempFP -Append
		}
	}
}

Function GenerateRegistryCustom ( [ String ] $TempFP )
{
	Echo "Windows Registry Editor Version 5.00`n" | Out-File -LiteralPath $TempFP

	$WPF_dataGrid.Items.ForEach{
		
        If ( $_.CheckboxChecked )
        {
			$ServiceName    = QMarkServices $_.ServiceName

			$ServiceTypeNum = $ServicesTypeFull.IndexOf( $_.BVType )

			If ( $ServiceTypeNum -ne 0 -And $Skip_Services -NotContains $ServiceName )
            {
				$Num        = '"Start"=dword:0000000' + $ServicesRegTypeList[$ServiceTypeNum]

				Echo "[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\$ServiceName]" | Out-File -LiteralPath $TempFP -Append

				Echo $Num | Out-File -LiteralPath $TempFP -Append
				
                If ( $ServiceTypeNum -eq 4 )
                { 
                    Echo '"DelayedAutostart"=dword:00000001' | Out-File -LiteralPath $TempFP -Append 
                }

				Echo '' | Out-File -LiteralPath $TempFP -Append
			}
		}
	}
}

Function DevLogSet 
{
	$Script:ScriptLog        = 1
	$Script:LogName          = 'Dev-Log.log'
	$Script:Diagnostic       = 1
	$Script:Automated        = 0
	$Script:LogBeforeAfter   = 2
	$Script:DryRun           = 1
	$Script:AcceptToS        = 'Accepted'
	$Script:ShowNonInstalled = 1
	$Script:ShowSkipped      = 1
	$Script:ShowAlreadySet   = 1
}

Function CreateLog 
{
	If ( $DevLog -eq 1 )
    { 
        DevLogSet 
    }

	If ( $ScriptLog -ne 0 )
    {
		$Script:LogFile      = $FileBase + $LogName
		$Time                = Get-Date -Format 'MM/dd/yyyy hh:mm:ss tt'
		
        If ( $ScriptLog -eq 2 )
        {
			"$( GetTime ): Updated Script File running" , "`n--Start of Log ($Time)--" | % { 

                Echo $_      | Out-File -LiteralPath $LogFile -Encoding Unicode -NoNewline -Append
            }
			
            $ScriptLog       = 1
		} 

        Else 
        {
			Echo "--Start of Log ($Time)--" | Out-File -LiteralPath $LogFile -Encoding Unicode
		}
	}

	$Script:LogStarted = 1
}

Function DiagnosticCheck ( [ Int ] $Bypass )
{
    Get-ScriptVersion | % { 

        $Script_Version = $_.Version
        $Release_Type   = $_.Release
    }

	If ( $Release_Type -ne 'Stable' -or 1 -In $Bypass , $Diagnostic )
    {
        $DiagnosticInformation = @{ ST = 0..53 ; FG = 0..53 }

        $DiagnosticInformation | % {

            ForEach ( $I in 0..53 )
            {
                If ( $I -eq 0 )
                {
                    $_.FG[$I] = 13
                }

                If ( $I -in 1 , 53 )
                {
                    $_.FG[$I] = 11
                }

                If ( $i -in 5..8 + 10..16 + 20..21 + 24..47 + 50..51 )
                {
                    $_.FG[$I] = 14 , 15
                }

                If ( $I -in 2 , 3 , 8 , 17 , 19 , 22 , 48 , 52 )
                {
                    $_.FG[$I] = 14
                }

                If ( $I -in 4 , 9 , 18 , 23 , 49 )
                {
                    $_.FG[$I] = 2
                }
            }

            $_.ST[ 0] = " Diagnostic Information below, will be copied to the clipboard.`n"

		    $Script:DiagString = ''
		
            $_.ST[ 1] = ' ********START********'
    		$_.ST[ 2] = ' Diagnostic Output, Some items may be blank'
		    $_.ST[ 3] = ''
            $_.ST[ 4] = ' --------Script Info--------'
		    $_.ST[ 5] = ' Script Version: ' , $Script_Version
            $_.ST[ 6] = ' Release Type: ' , $Release_Type
            $_.ST[ 7] = ' Services Version: ' , $ServiceVersion
		    $_.ST[ 8] = ''
    		$_.ST[ 9] = ' --------System Info--------'
		    $_.ST[10] = ' Window: ' , $FullWinEdition
		    $_.ST[11] = ' Bit: ' , $OSBit
		    $_.ST[12] = ' Edition SKU#: ' , $WinSku
		    $_.ST[13] = ' Build: ' , $BuildVer
		    $_.ST[14] = ' Version: ' , $Win10Ver
		    $_.ST[15] = ' PC Type: ' , $PCType
		    $_.ST[16] = ' Desktop/Laptop: ' , $IsLaptop.Substring( 1 )
		    $_.ST[17] = ''
    		$_.ST[18] = ' --------Script Requirements--------'
		    $_.ST[19] = ' Windows 10 - Home or Pro (64-Bit)'
    		$_.ST[20] = ' Min Version: ' , "$MinVerName ($MinVer)"
    		$_.ST[21] = ' Max Version: ' , "$MaxVerName ($MaxVer)"
    		$_.ST[22] = ''
    		$_.ST[23] = ' --------Current Settings--------'
		    $_.ST[24] = ' BlackViper: ' , $WPF_ServiceConfig.Text
		    $_.ST[25] = ' All/Min: ' , ( "Min" , "All" )[ $All_or_Min -eq '-full' ]
            $_.ST[26] = ' ToS: ' , $AcceptToS
		    $_.ST[27] = ' Automated: ' , $Automated
		    $_.ST[28] = ' ScriptVerCheck: ' , $ScriptVerCheck
    		$_.ST[29] = ' ServiceVerCheck: ' , $ServiceVerCheck
    		$_.ST[30] = ' InternetCheck: ' , $InternetCheck
	    	$_.ST[31] = ' ShowAlreadySet: ' , $ShowAlreadySet
		    $_.ST[32] = ' ShowNonInstalled: ' , $ShowNonInstalled
    		$_.ST[33] = ' ShowSkipped: ' , $ShowSkipped
    		$_.ST[34] = ' XboxService: ' , $XboxService
	    	$_.ST[35] = ' StopDisabled: ' , $StopDisabled
		    $_.ST[36] = ' ChangeState: ' , $ChangeState
    		$_.ST[37] = ' EditionCheck: ' , $EditionCheck
	    	$_.ST[38] = ' BuildCheck: ' , $BuildCheck
    		$_.ST[39] = ' DryRun: ' , $DryRun
    		$_.ST[40] = ' ScriptLog: ' , $ScriptLog
	    	$_.ST[41] = ' LogName: ' , $LogName
		    $_.ST[42] = ' LogBeforeAfter: ' , $LogBeforeAfter
		    $_.ST[43] = ' DevLog: ' , $DevLog
    		$_.ST[44] = ' BackupServiceConfig: ' , $BackupServiceConfig
	    	$_.ST[45] = ' BackupServiceType: ' , $WPF_BackupServiceType.Text
		    $_.ST[46] = ' ShowConsole: ' , $ShowConsole
    		$_.ST[47] = ' LaptopTweaked: ' , $LaptopTweaked
	    	$_.ST[48] = ''
    		$_.ST[49] = ' --------Misc Info--------'
	    	$_.ST[50] = ' Run Button txt: ' , $WPF_RunScriptButton.Content
		    $_.ST[51] = ' Args: ' , $PassedArg
    		$_.ST[52] = ''
	    	$_.ST[53] = ' ********END********'
        }
	}
}

##########
# Log/Backup Functions -End
##########
# Service Change Functions -Start
##########

Function TBoxService
{
	[ Alias ( 'T' ) ] [ String [] ] $Text  ,
	[ Alias ( 'C' ) ] [    Int [] ] $Color ,
	
    $WPF_ServiceListing.Dispatcher.Invoke(
		
        [ Action ]{
			
            For ( $i = 0 ; $i -lt $Text.Length ; $i++ )
            {
				$Run              = New-Object System.Windows.Documents.Run

				$Run              | % { 

                    $_.Foreground = $colorsGUI[($Color[$i])]
				    $_.Text       = $Text[$i]
                }

				$WPF_ServiceListing.Inlines.Add( $Run )
			}

			$WPF_ServiceListing.Inlines.Add( ( New-Object System.Windows.Documents.LineBreak ) )
		},'Normal'
	)
}

Function Black_Viper_Set ( [ Int ] $BVOpt , [ String ] $FullMin )
{
	PreScriptCheck
	
    $ServiceSetOpt , $SrvSetting = If ( $LoadServiceConfig -In 1 , 2 )
    {
		'StartType' , 'Custom'
		$FullMin = ''
	} 

    ElseIf ( $Black_Viper -eq 1 )
    {
		( $ServiceMaker + 'Def-' + $WinEdition ) , 'Default'
	} 

    ElseIf ( $Black_Viper -eq 2 )
    {
		( $ServiceMaker + 'Safe' + $IsLaptop ) , 'Safe'
	} 

    ElseIf ( $Black_Viper -eq 3 )
    {
		( $ServiceMaker + 'Tweaked-Desk' ) , 'Tweaked'
	}

	$SrvSetting += $FullMin
	
    If ( $LogBeforeAfter -eq 2 )
    { 
        DiagnosticCheck 1 
    }

	ServiceBAfun 'Services-Before'
	ServiceSet $ServiceSetOpt $SrvSetting $( If ( $FullMin -eq '-Full' ) { $True } Else { $False } )
}

Function ServiceSet ( [ String ] $BVService , [ String ] $BVSet , [ Bool ] $BVNeg )
{
	$StopWatch      = New-Object System.Diagnostics.Stopwatch

	If ( $GuiSwitch ) 
    { 
        $WPF_ServiceListing.text = '' 
    }

	$BVChanged      = 0
	$BVAlready      = 0
	$BVSkipped      = 0
	$BVStopped      = 0
	$BVRunning      = 0
	$BVError        = 0
	$BVNotInstalled = 0
	$Txtd           = If ( $DryRun -ne 1 )
    { 
        "`n Changing Service Please wait...`n"
        $StopWatch.Start() 
    } 
    
    Else 
    { 
        "`n List of Service that would be changed on Non-Dry Run/Dev Log...`n" 
    }
    
    $Splat    = @{ 
    
        Text  = "$Txtd Service Setting: ", $BVSet
        Color = 14 , 15
        Log   = 1
        GUI   = $GuiSwitch
    }

    DisplayOut @Splat

    $Splat    = @{ 
    
        Text  = " Service_Name - Current -> Change_To"
        Color = 14
        Log   = 1
        GUI   = $GuiSwitch
    }
        
    DisplayOut @Splat

	$Splat    = @{ 
    
        Text  = ''.PadRight( 40 , '-' ) 
        Color = 14
        Log   = 1
        GUI   = $GuiSwitch
    } 
    
    DisplayOut @Splat
	
    $CSV.ForEach{
		
        $DispTempT              = @()
		$DispTempC              = @()
		
        [ Int ] $ServiceTypeNum = $_.$BVService
		
        If ( $ServiceTypeNum -In -4..-1 -and $BVNeg )
        { 
            $ServiceTypeNum    *= -1 
        }

		$ServiceType            = $ServicesTypeList[$ServiceTypeNum]
		$ServiceName            = QMarkServices $_.ServiceName
		$ServiceCommName        = SearchSrv $ServiceName 'DisplayName'
		$ServiceCurrType        = ServiceCheck $ServiceName $ServiceType
		
        $State                  = $_.Status
		
        If ( $null -In $ServiceName , $ServiceCurrType )
        {
			If ( $ShowNonInstalled -eq 1 )
            { 
                $DispTempT     += " No service with name $( $_.ServiceName )" 
                $DispTempC     += 13 
            }
			
            $BVNotInstalled++
			$ServiceTypeNum     = 9
		} 

        ElseIf ( $ServiceTypeNum -In -4..0 )
        {
			If ( $ShowSkipped -eq 1 )
            {
				If ( $null -ne $ServiceCommName )
                { 
                    $DispTempT += " Skipping $ServiceCommName ($ServiceName)" 
                } 
                
                Else
                { 
                    $DispTempT += " Skipping $( $_.ServiceName )" 
                }

				$DispTempC     += 14
			}

			$ServiceTypeNum     = 9
			
            $BVSkipped++
		} 

        ElseIf ( $ServiceTypeNum -In 1..4 )
        {
			If ( $ServicesTypeList -Contains $ServiceCurrType )
            {
				$DispTemp       = " $ServiceCommName ($ServiceName) - $ServiceCurrType -> $ServiceType"
				
                Try 
                {
					If ( $DryRun -ne 1 )
                    {
						Set-Service $ServiceName -StartupType $ServiceType -ErrorAction Stop
						
                        If ( $ServiceTypeNum -eq 4 )
                        { 
                            AutoDelaySet $ServiceName 1 
                        }
					}

					If ( $ServiceTypeNum -eq 4 )
                    { 
                        $DispTemp += ' (Delayed)' 
                    }

					$DispTempC += 11
					$BVChanged ++
				} 

                Catch 
                {
					$DispTemp   = "Unable to Change $ServiceCommName ($ServiceName)"
					$DispTempC += 12
					$BVError++
				}

				$DispTempT     += $DispTemp
			} 

            ElseIf ( $ServiceCurrType -eq 'Already' )
            {
				$ADT            = AutoDelayTest $ServiceName
				$DispTemp       = " $ServiceCommName ($ServiceName) "
				
                If ( $ADT -eq 1 -and $ServiceTypeNum -eq 3 )
                {
					$DispTemp  += "- $ServiceType (Delayed) -> $ServiceType"

					If ( $DryRun -ne 1 )
                    { 
                        AutoDelaySet $ServiceName 0 
                    }
					
                    $DispTempT += $DispTemp
					$DispTempC += 11
					$BVChanged ++
				} 

                ElseIf ( $ADT -eq 0 -and $ServiceTypeNum -eq 4 )
                {
					$DispTemp += "- $ServiceType -> $ServiceType (Delayed)"

					If ( $DryRun -ne 1 )
                    { 
                        AutoDelaySet $ServiceName 1 
                    }

					$DispTempT += $DispTemp
					$DispTempC += 11
					$BVChanged ++
				} 

                Else 
                {
					If ( $ShowAlreadySet -eq 1 )
                    {
						$DispTemp += "is already $ServiceType"
						
                        If ( $ServiceTypeNum -eq 4 )
                        { 
                            $DispTemp += ' (Delayed)' 
                        }
                        
						$DispTempT += $DispTemp
						$DispTempC += 15
					}

					$BVAlready ++
				}
			} 

            ElseIf ( $ServiceCurrType -eq 'Xbox' )
            {
				$DispTempT      += " $ServiceCommName ($ServiceName) is an Xbox Service and will be skipped"
				$DispTempC      += 2
				$ServiceTypeNum  = 9
				$BVSkipped      ++
			} 

            ElseIf ( $ServiceCurrType -eq 'Denied' ) 
            {
				If ( $Release_Type -ne 'Stable' )
                { 
                    $DispTempT  += " $ServiceCommName ($ServiceName) can't be changed."
                    $DispTempC  += 14
                    $BVError    ++ 
                }
				
                $ServiceTypeNum = 9
			}

			If ( $DryRun -ne 1 -And $null -ne $ServiceName -And ( $ChangeState -eq 1 -or ( $StopDisabled -eq 1 -And $ServiceTypeNum -eq 1 ) ) )
            {
				If ( $State -eq 'Stopped' )
                {
					If ( ( SearchSrv $ServiceName 'Status' ) -eq 'Running' )
                    {
						Try 
                        {
							Stop-Service $ServiceName -ErrorAction Stop

							$DispTempT += ' -Stopping Service'
							$DispTempC += 13
							$BVStopped ++
						} 

                        Catch 
                        {
							$DispTempT += ' -Unable to Stop Service'
							$DispTempC += 12
							$BVError   ++
						}
					} 

                    Else 
                    {
						$DispTempT     += ' -Already Stopped'
						$DispTempC     += 11
					}
				}

                ElseIf ( $State -eq 'Running' -And $ChangeState -eq 1 ) 
                {
					If ( ( SearchSrv $ServiceName 'Status' ) -eq 'Stopped' )
                    {
						Try 
                        {
							Start-Service $ServiceName -ErrorAction Stop

							$DispTempT += ' -Starting Service'
							$DispTempC += 11
							$BVRunning ++
						} 

                        Catch 
                        {
							$DispTempT += ' -Unable to Start Service'
							$DispTempC += 12
							$BVError   ++
						}
					} 
                    
                    Else 
                    {
						$DispTempT     += ' -Already Started'
						$DispTempC     += 15
					}
				}
			}
		} 

        Else 
        {
            $Splat    = @{ 
            
                Text  = " Error: $( $_.ServiceName ) does not have a valid Setting."
                Color = 13 
                Log   = 1
                GUI   = $GuiSwitch 
            } 
            
            DisplayOut @Splat
			
            $BVError  ++
		}

		If ( $DispTempT.count -ne 0 )
        {         
            $Splat    = @{ 
            
                Text  = $DispTempT
                Color = $DispTempC
                Log   = 1
                GUI   = $GuiSwitch 
            } 
            
            DisplayOut @Splat
	    }
	    
        $Splat    = @{ 
        
            Text  = ''.PadRight( 40 , '-' )
            Color = 14 
            Log   = 1 
            GUI   = $GuiSwitch 
        } 
    }
        
        DisplayOut @Splat

	If ( $DryRun -ne 1 )
    {
		$StopWatch.Stop()
		$StopWatchTime = $StopWatch.Elapsed
		$StopWatch.Reset()
		
        $Splat    = @{ 
        
            Text  = "' Service Changed..."
            Color = 14
            Log   = 1
            GUI   = $GUISwitch 
        }

        DisplayOut @Splat

        $Splat = @{ 
        
            Text  = ' Elapsed Time: ' , $StopWatchTime
            Color = 14 , 15
            Log   = 1
            GUI   = $GuiSwitch 
        } 
        
        DisplayOut @Splat

		If ( 1 -In $StopDisabled , $ChangeState )
        {
            $Splat    = @{ 
            
                Text  = ' Stopped: ' , $BVStopped
                Color = 14 , 15
                Log   = 1
                GUI   = $GuiSwitch 
            }

            DisplayOut @Splat

		    If ( $ChangeState -eq 1 )
            {
                $Splat    = @{
            
                    Text  = ' Running: ' , $BVRunning
                    Color = 14 , 15
                    Log   = 1
                    GUI   = $GuiSwitch 
                } 
            
                DisplayOut @Splat
            }
    	} 

    Else 
    {
	    $Splat    = @{ 

            Text  = ' List of Service Done...'
            Color = 14
            Log   = 1
            GUI   = $GUISwitch
        } 
            
        DisplayOut @Splat

		$Splat    = @{ 

            Text  = "`n If not Non-Dry Run/Dev Log "
            Color = 14
            Log   = 1
            GUI   = $GUISwitch 
        } 

        DisplayOut @Splat
	}
	    $Splat    = @{ 

            Text  = ' Changed: ' , $BVChanged 
            Color = 14 , 15 
            Log   = 1 
            GUI   = $GuiSwitch 
        } 
        
        DisplayOut @Splat

        $Splat    = @{ 
        
            Text  = ' Already: ' , $BVAlready
            Color = 14 , 15
            Log   = 1
            GUI   = $GuiSwitch
        }
            
        DisplayOut @Splat
 
        $Splat    = @{ 
        
            Text  = ' Skipped: ' , $BVSkipped
            Color = 14 , 15
            Log   = 1
            GUI   = $GuiSwitch
        } 
        
        DisplayOut @Splat

	If ( $ShowNonInstalled -eq 1 )
    {
        $Splat    = @{ 
        
            Text  = ' Not Installed: ' , $BVNotInstalled
            Color = 14 , 15
            Log   = 1
            GUI   = $GUISwitch             
        }
         
        DisplayOut @Splat 
    }

	If ( $BVError -ge 1 )
    {
        $Splat    = @{ 
        
            Text  = '  Errors: ',$BVError
            Color = 14 , 15
            Log   = 1
            GUI   = $GUISwitch
        } 
        
        DisplayOut @Splat
    }

	If ( $BackupServiceConfig -eq 1 )
    {
		If ( $BackupServiceType -eq 1 )
        {
            $Splat    = @{ 
            
                Text  = ' Backup of Services Saved as CSV file in script directory.'
                Color = 14
                Log   = 1
                GUI   = $GUISwitch
            } 
            
            DisplayOut @Splat

		} 

        ElseIf ( $BackupServiceType -eq 0 )
        {
            $Splat    = @{ 
            
                Text  = ' Backup of Services Saved as REG file in script directory.'
                Color = 14
                Log   = 1
                GUI   = $GUISwitch
            } 
            
            DisplayOut @Splat

		} 

        ElseIf ( $BackupServiceType -eq 2 )
        {
            $Splat = @{ 
            
                Text  = ' Backup of Services Saved as CSV and REG file in script directory.'
                Color = 14
                Log   = 1
                GUI   = $GUISwitch 
            } 
            
            DisplayOut @Splat
		}
	}

	If ( $DryRun -ne 1 )
    {
        $Splat        = @{ 
        
            Text      = "`nThanks for using my script."
            Color     = 11 
        } 
        
        DisplayOut @Splat

        $Splat        = @{ 
        
            Text      = 'If you like this script please consider giving me a donation,'
            Color     = 11
        }
        
        DisplayOut @Splat
		
        $Splat        = @{ 
        
            Text      = 'Min of $1 from the adjustable Amazon Gift Card.'
            Color     = 11
        }
        
        DisplayOut @Splat
		
        $Splat        = @{ 
        
            Text      = "`nLink to donation:"
            Color     = 15
        }

        DisplayOut @Splat

        $Splat        = @{ 
        
            Text      = $Donate_URL
            Color     = 2
        }

        DisplayOut @Splat
		
        If ( $ConsideredDonation -ne 'Yes' -and $GuiSwitch )
        {
			$A        = New-Object -COMObject WScript.Shell

			$Choice   = $A.popup( "Thanks for using my script.`n
            If you like this script please consider giving me a donation, Min of `$1 from the adjustable Amazon Gift Card.
            `n`nWould you Consider giving a Donation?" , 20 , 'Thank You' , 36 )
			
            If ( $Choice -eq 6 )
            { 
                ClickedDonate 
            }
		}
	}

	ServiceBAfun 'Services-After'
	
    If ( $DevLog -eq 1 -and $Error.Count -gt $ErrCount )
    { 
        Write-Output $Error | Out-File -LiteralPath $LogFile -Encoding Unicode -Append
        $ErrCount = $Error.Count 
    }

	If ( $GuiSwitch )
    {
		GetCurrServices
        RunDisableCheck
		
        $Splat = @{ 
        
            Text  = "`n To exit you can close the GUI or PowerShell Window."
            Color = 14 
            GUI   = $GUISwitch 
        } 
        
        DisplayOut @Splat
	} 

    Else 
    {
		AutomatedExitCheck 1
	}
}

Function ServiceCheck ( [ String ] $S_Name , [ String ] $S_Type )
{
	If ( $CurrServices.Name -Contains $S_Name )
    {
		If ( $Skip_Services -Contains $S_Name )
        { 
            Return 'Denied' 
        }

		If ( $XboxService -eq 1 -and $XboxServiceArr -Contains $S_Name )
        { 
            Return 'Xbox' 
        }

		$C_Type = SearchSrv $S_Name 'StartType'
		
        If ( $S_Type -ne $C_Type ) 
        {
			If ( $S_Name -eq 'lfsvc' -And $C_Type -eq 'disabled' -And ( Test-Path 'HKLM:\SYSTEM\CurrentControlSet\Services\lfsvc\TriggerInfo\3' ) )
            {
				RI 'HKLM:\SYSTEM\CurrentControlSet\Services\lfsvc\TriggerInfo\3' -Recurse -Force
			} 

            ElseIf ( $S_Name -eq 'NetTcpPortSharing' -And $NetTCP -Contains $CurrServices.Name )
            {
				Return 'Manual'
			}

			Return $C_Type
		}

		Return 'Already'
	}

	Return $null
}

##########
# Service Change Functions -End
##########
# Misc Functions -Start
##########

Function LoadWebCSV ( [ Int ] $ErrorChoice )
{
	$Script:ErrorDi , $Pick = If ( $ErrorChoice -eq 0 )
    {
        'Missing File BlackViper.csv -LoadCSV' , ' is Missing.'
	} 

    ElseIf ( $ErrorChoice -eq 1 )
    {
		'Invalid/Corrupt BlackViper.csv' , ' is Invalid or Corrupt.'
	} 

    Else 
    {
		'BlackViper.csv Not Valid for current Update' , ' needs to be Updated.'
	}

	$Invalid      = $False
	While ( $LoadWebCSV -ne 'Out' )
    {
		Error_Top
		
        $Splat    = @{ 
        
            Text  = '|' , ' The File ' , 'BlackViper.csv' , "$Pick".PadRight( 28 ) , '|'
            Color = 14 , 2 , 15 , 2 , 14
            Log   = 1
        }
        
        DisplayOut @Splat
		
        MenuBlankLine

        $Splat    = @{ 
        
            Text  = '|',' Do you want to download ','BlackViper.csv',' ?           ','|'
            Color = 14 , 2 , 15 , 2 , 14
            Log   = 1
        } 
        
        DisplayOut @Splat
		
        MenuBlankLine
		MenuLine

		$Invalid    = ShowInvalid $Invalid

		$LoadWebCSV = Read-Host "`nDownload? (Y)es/(N)o"
		
        If ( $LoadWebCSV -In 'y' , 'yes' )
        {
			DownloadFile $Service_Url $BVServiceFilePath
            $LoadWebCSV = 'Out'
		} 

        ElseIf ( $LoadWebCSV -In 'n' , 'no' )
        {
            $Splat    = @{ 
            
                Text  = 'For manual download save the following File: '
                Color = 2
                Log   = 1
            } 
            
            DisplayOut @Splat

            $Splat    = @{ 
            
                Text  = $Service_Url
                Color = 15
                Log   = 1
            }

            DisplayOut @Splat

		} 

        Else 
        {
			$Invalid  = $True
		}
	}

	If ( $ErrorChoice -In 1..2 )
    { 
        [ System.Collections.ArrayList ] $Script:csv = Import-Csv -LiteralPath $BVServiceFilePath 
    }

	CheckBVcsv
	Return
}

Function LoadWebCSVGUI
{
	ShowConsoleWin 5

	$Script:ErrorDi , $ErrMessage = If ( $ErrorChoice -eq 0 ) 
    {
	    'Missing File BlackViper.csv -LoadCSV',"The File 'BlackViper.csv' is Missing.`nDo you want to download the file 'BlackViper.csv'?"
	} 

    ElseIf ( $ErrorChoice -eq 1 )
    {
		'Invalid/Corrupt BlackViper.csv',"The File 'BlackViper.csv' is Invalid or Corrupt.`nDo you want to download the file 'BlackViper.csv'?"
	}
    
    Else 
    {
		'BlackViper.csv Not Valid for current Update',"The File 'BlackViper.csv' needs to be Updated.`nDo you want to download the file 'BlackViper.csv'?"
	}

	$A = New-Object -COMObject WScript.Shell
	
    $Choice = $a.popup( $ErrMessage , 20 , 'Error' , 20 )
	
    If ( $Choice -eq 6 )
    {
		DownloadFile $Service_Url $BVServiceFilePath

		If ( $ErrorChoice -In 1..2 )
        { 
            [ System.Collections.ArrayList ] $Script:csv = Import-Csv -LiteralPath $BVServiceFilePath 
        }

		CheckBVcsv
	} 

    Else 
    {
		[ Windows.Forms.Messagebox ]::Show( "To get The File 'BlackViper.csv' go to $MySite to save it.`nWithout the file the script won't run",'Information','OK','Information') | Out-Null
		$Form.Close()
		Exit
	}
}

Function PreScriptCheck 
{
	If ( $RunScript -eq 0 )
    { 
        CloseExit 
    }

	If ( $LogStarted -eq 0 )
    { 
        CreateLog 
    }

	$EBCount                 = 0
	$Script:ErrorDi          = ''

	If ( $EditionCheck -eq 'Home' -or $WinSku -in 98 , 100 , 101 )
    {
        $Script:WinEdition   = 'Home'
	} 

    ElseIf ( $EditionCheck -eq 'Pro' -or $WinSku -in 48 , 49 )
    {
		$Script:WinEdition   = 'Pro'
	} 

    Else 
    {
		$Script:ErrorDi      = 'Edition'
		$EditionCheck        = 'Fail'
		$EBCount ++
	}

	If ( $Win10Ver -NotIn $MinVer..$MaxVer -And $BuildCheck -ne 1 )
    {
		If ( $EditionCheck -eq 'Fail' )
        { 
            $Script:ErrorDi += ' & ' 
        }

		$Script:ErrorDi     += 'Build'
		$BuildCheck          =  'Fail'
		$EBCount ++
	}

	If ( $EBCount -ne 0 )
    {
		$Script:ErrorDi     += ' Check Failed'
		$EBCount             = 0
		
        Error_Top

        $Splat = @{ 
        
            Text  = " Script won't run due to the following problem(s)"
            Color = 2
            Log   = 1
        } 
        
        DisplayOut @SplatLML
		

        If ( $EditionCheck -eq 'Fail' )
        {
			$EBCount++

			MenuBlankLine -L
            
            $Splat    = @{ 
            
                Text  = "$EBCount. Not a valid Windows Edition for this Script."
                Color = 2
                Log   = 1 
            }
            
            DisplayOutLML @Splat

            $Splat    = @{ 

                Text  = "Windows 10 Home and Pro Only"
                Color = 2
                Log   = 1
            }

            DisplayOutLML @Splat

			MenuBlankLine -L

            $Splat    = @{ 
            
                Text  = '|' , ' You are using ' , "$FullWinEdition".PadRight( 37 ) , '|'
                Color = 14 , 2 , 15 , 14
                Log   = 1
            } 
            
            DisplayOut @Splat

            $Splat    = @{ 
            
                Text  = '|' , ' SKU #: ' , "$WinSku".PadRight( 44 ) , '|'
                Color = 14 , 2 , 15 , 14 
                Log   = 1 
            } 
            
            DisplayOut @Splat
			
            MenuBlankLine -L
            
            $Splat = @{ 
            
                Text  = "If you are using Home or Pro..."
                Color = 2 
                Log   = 1 
            } 
            
            DisplayOutLML @Splat
            
            $Splat    = @{ 
            
                Text  = "Please contact me or sumbit issue with:"
                Color = 2
                Log   = 1
            } 
            
            DisplayOutLML @Splat

            $Splat    = @{ 
                
                Text  = " 1. The Edition listed above"
                Color = 2
                Log   = 1 
            } 
            
            DisplayOutLML @Splat
            
            $Splat    = @{ 
            
                Text  = " 2. The SKU # listed above"
                Color = 2
                Log   = 1
            } 
            
            DisplayOutLML @Splat
			
            MenuBlankLine -L
            
            $Splat    = @{ 
            
                Text  = "To skip use one of the following methods"
                Color = 2
                Log   = 1
            } 

            DisplayOutLML @Splat  2 -L
			
            $Splat    = @{ 
            
                Text  = '|' , '  1. Run Script or bat file with ' , '-secp' , ' switch'.PadRight( 14 ) , '|'
                Color = 14 , 2 , 15 , 2 , 14
                Log   = 1
            } 
            
            DisplayOut @Splat

            $Splat    = @{ 
            
                Text  = '|' , '  2. Run Script or bat file with ' , '-sech' , ' switch'.PadRight( 14 ) , '|'
                Color = 14 , 2 , 15 , 2 , 14
                Log   = 1 
            } 
            
            DisplayOut @Splat

            $Splat    = @{ 
            
                Text  = '|' , '  3. Change ' , 'EditionCheck' , ' in script file'.PadRight( 28 ) , '|'
                Color = 14 , 2 , 15 , 2 , 14
                Log   = 1
            } 
            
            DisplayOut @Splat

            $Splat    = @{ 
            
                Text  = '|' , '  4. Change ' , 'Skip_EditionCheck' , ' in bat file'.PadRight( 23 ) , '|'
                Color = 14 , 2 , 15 , 2 , 14
                Log   = 1 
            } 
            
            DisplayOut @Splat

			MenuBlankLine -L
			MenuLine -L
		}

		If ( $BuildCheck -eq 'Fail' )
        {
			$EBCount ++

			MenuBlankLine -L
            
            $Splat    = @{ 
            
                Text  = "$EBCount. Not a valid Build for this Script."
                Color = 2
                Log   = 1
            } 
            
            DisplayOutLML @Splat 

            $Splat    = @{
            
                Text  = "Min Version Recommended - Creator's Update (1703)"
                Color = 2
                Log   = 1
            } 
            
            DisplayOutLML @Splat
			
            $Splat    = @{ 
            
                Text  = "Max Version Recommended - $MaxVerName"
                Color = 2
                Log   = 1 
            }

            DisplayOutLML @Splat
			
            MenuBlankLine -L

            $Splat    = @{ 
            
                Text  = '|' , ' You are using Build: ' , "$BuildVer".PadRight( 30 ) , '|'
                Color = 14 , 2 , 15 , 14
                Log   = 1 
            }

            DisplayOut @Splat

            $Splat    = @{ 
            
                Text  = '|' , ' You are using Version: ' , "$Win10Ver".PadRight( 28 ) , '|'
                Color = 14 , 2 , 15 , 14 
                Log   = 1 
            }

            DisplayOut @Splat
			
            MenuBlankLine -L

            $Splat    = @{ 
            
                Text  = 'To skip use one of the following methods'
                Color = 2
                Log   = 1 
            }
            
            DisplayOutLML @Splat
			        
            $Splat    = @{ 
            
                Text  = '|' , '  1. Run Script or bat file with ' , '-sbc' , ' switch'.PadRight( 15 ) , '|'
                Color = 14 , 2 , 15 , 2 , 14
                Log   = 1 
            } 
            
            DisplayOut @Splat

            $Splat    = @{ 
            
                Text  = '|' , '  2. Change ' , 'BuildCheck' , ' in script file'.PadRight( 30 ) , '|'
                Color = 14 , 2 , 15 , 2 , 14
                Log   = 1 
            } 
            
            DisplayOut @Splat

            $Splat    = @{ 
            
                Text  = '|' , '  3. Change ' , 'Skip_BuildCheck' , ' in bat file'.PadRight( 25 ) , '|'
                Color = 14,2,15,2,14
                Log   = 1 
            } 
            
            DisplayOut @Splat
			
            MenuLine -L
		}

		AutomatedExitCheck 1
	}

	If ( $BackupServiceConfig -eq 1 )
    {
		If ( $BackupServiceType -eq 1 )
        {
			Save_ServiceBackup
		} 

        ElseIf ( $BackupServiceType -eq 0 )
        {
			RegistryServiceFileBackup
		} 

        ElseIf ( $BackupServiceType -eq 2 )
        {
			Save_ServiceBackup
            RegistryServiceFileBackup
		}
	}

	If ( $LoadServiceConfig -NotIn 1 , 2 )
    {
		$ServiceFilePath = $BVServiceFilePath
		
        If ( ! ( Test-Path -LiteralPath $BVServiceFilePath -PathType Leaf ) )
        {
			If ( $ServiceVerCheck -eq 0 )
            {
                If ( $ScriptLog -eq 1 )
                { 
                    Write-Output "$(GetTime): Missing File 'BlackViper.csv'" | Out-File -LiteralPath $LogFile -Encoding Unicode -Append 
                }
				
                If ( $GuiSwitch )
                { 
                    LoadWebCSVGUI 0 
                } 
                
                Else
                { 
                    LoadWebCSV 0 
                }
			} 
            
            Else 
            {
				If ( $ScriptLog -eq 1 )
                { 
                    Write-Output "$( GetTime ): Downloading Missing File 'BlackViper.csv'" | Out-File -LiteralPath $LogFile -Encoding Unicode -Append 
                }

				DownloadFile $Service_Url $BVServiceFilePath
			}

			$ServiceVerCheck = 0
		}
	}

	If ( $LoadServiceConfig -eq 1 )
    {
		[ System.Collections.ArrayList ] $Script:csv = Import-Csv -LiteralPath $ServiceConfigFile
	} 

    ElseIf ( $LoadServiceConfig -ne 2 )
    {
		[ System.Collections.ArrayList ] $Script:csv = Import-Csv -LiteralPath $ServiceFilePath
	}
	
    If ( 1 -In $ScriptVerCheck , $ServiceVerCheck ) 
    { 
        UpdateCheckAuto 
    }
	
    If ( $LoadServiceConfig -NotIn 1 , 2 )
    { 
        CheckBVcsv
        $CSV.RemoveAt( 0 ) 
    }
}

Function CheckBVcsv 
{
	$GenBy        = $CSV[0].'BV-Safe-Desk'
	
    If ( $GenBy -NotIn 'GernetatedByMadBomb122' , 'GeneratedByMadBomb122' ) 
    {
	    If ( $Automated -ne 1 )
        {
		    If ( $GuiSwitch )
            { 
                LoadWebCSVGUI 1 
            } 
            
            Else
            { 
                LoadWebCSV 1 
            }
		} 

        Else 
        {
			Error_Top
			
            $Splat    = @{ 
            
                Text  = '|' , ' The File ' , 'BlackViper.csv' , ' is Invalid or Corrupt.     ' , '|'
                Color = 14 , 2 , 15 , 2 , 14
                Log   = 1
            }
             
            DisplayOut @Splat
			
            Error_Bottom
		}
	} 

    ElseIf ( ! ( Test-Path -LiteralPath $BVServiceFilePath -PathType Leaf ) )
    {
	    If ( $GuiSwitch )
        {
			[ Windows.Forms.Messagebox ]::Show( "The File 'BlackViper.csv' is missing and couldn't be downloaded.`nFor Manual download go to $MySite",'Information', 'OK','Information') | Out-Null
		} 

        Else
        {
			$Script:ErrorDi = 'Missing File BlackViper.csv'
			
            Error_Top
			
            $Splat = @{ 
            
                Text  = '|' , ' The File ' , 'BlackViper.csv' , " is missing and couldn't    " , '|'
                Color = 14 , 2 , 15 , 2 , 14
                Log   = 1 
            } 
            
            DisplayOut @Splat

			$Splat    = @{ 

                Text  = 'be download for some reason.'
                Color = 2
                Log   = 1 
            } 
            
            DisplayOutLML @Splat
			
            Error_Bottom
		}
	}

	If ( $GuiSwitch )
    { 
        $WPF_LoadServicesButton.IsEnabled = SetServiceVersion 
    } 
    
    Else
    { 
        SetServiceVersion | Out-Null 
    }
}

Function GetArgs 
{
	If ( $PassedArg -In '-help' , '-h' )
    { 
        ShowHelp 
    }

	If ( $PassedArg -Contains '-copy' )
    { 
        ShowCopyright ;
        Exit 
    }

	If ( $PassedArg -Contains '-lcsc' )
    {
		$tmp                      = $PassedArg[$PassedArg.IndexOf( '-lcsc' ) + 1 ]
		$Script:BV_ArgUsed        = 3
		$Script:LoadServiceConfig = 1
		
        If ( $tmp -ne $null -and ! $tmp.StartsWith( '-' ) )
        {
			$Script:EditionCheck  = 'Pro'
			$Script:BuildCheck    = 1
			
            Set-Location $FileBase
			
            If ( ! ( Test-Path -LiteralPath $tmp -PathType Leaf ) )
            {
                $Script:ErrorDi   = "Missing File $tmp"
				Error_Top
				
                $SrvConFileLen    = $tmp.length
				
                If ( $SrvConFileLen -gt 42 )
                { 
                    $SrvConFileLen = 42 
                }
				
                $Splat    = @{ 
                
                    Text  = '|' , ' The File ' , $tmp , ' is missing.'.PadRight( 42 - $SrvConFileLen ) , '|'
                    Color = 14 , 2 , 15 , 2 , 14
                    Log   = 1
                } 
                
                DisplayOut @Splat
				
                Error_Bottom
			} 

            Else 
            {
				[ System.Collections.ArrayList ]$Tempcheck = Import-Csv -LiteralPath $tmp
				
                If ( $null -In $Tempcheck[0].StartType , $Tempcheck[0].ServiceName )
                {
					Error_Top
					
                    If ( $Tempcheck[0].'BV-Safe-Desk' -In 'GernetatedByMadBomb122' , 'GeneratedByMadBomb122' )
                    {
					    $Splat    = @{ 

                            Text  = '|' , " Please don't load '" , 'BlackViper.csv' , "' by using" , ' -lcsc ' , ' |'
                            Color = 14 , 2 , 15 , 2 , 15 , 14
                            Log   = 1 
                        }

                        DisplayOut @Splat
						
                        $Splat    = @{ 
                        
                            Text  = "Instead use one of the following instead"
                            Color = 2
                            Log   = 1 
                        } 
                        
                        DisplayOutLML @Splat
						
                        $InSwitch = '   -Default   -Safe'
						
                        If ( $IsLaptop -ne '-Lap' )
                        { 
                            $InSwitch += '   -Tweaked' 
                        }
						
                        $Splat    = @{ 
                        
                            Text  = $InSwitch
                            Color = 15
                            Log   = 1 
                        } 
                        
                        DisplayOutLML @Splat
						
                        $Script:ErrorDi = "Can't use -lcsc with BlackViper.csv File"
					} 

                    Else 
                    {
                        $Splat    = @{ 
                        
                            Text  = '|' , ' The File ' , "$tmp".PadRight( 41 ) , ' |'
                            Color = 14 , 2 , 15 , 14
                            Log   = 1
                        } 
                        
                        DisplayOut @Splat

                        $Splat    = @{ 
                        
                            Text  = "is Invalid or Corrupt."
                            Color = 2
                            Log   = 1
                        } 
                        
                        DisplayOutLML @Splat
						
                        $Script:ErrorDi   = 'Invalid CSV File'
					}

					Error_Bottom
				}

				$Script:ServiceConfigFile = $tmp
				$Script:ServiceFilePath   = $tmp
			}
		}

        Else 
        {
			$Script:ErrorDi = "No File Specified."

			Error_Top

            $Splat    = @{ 
            
                Text  = '|' , " No File Specified with" , ' -lcsc ' , 'switch.              ' , ' |'
                Color = 14 , 2 , 15 , 2 , 14
                Log   = 1 
            } 
            
            DisplayOut @Splat
			
            Error_Bottom
		}
	}

	$ArgList.ForEach{
		
        If ( $_.Arg -In $PassedArg )
        {

			$tmp    = $_.Var.Split( '=' )
			$tc     = $tmp.count

			For ( $i = 0 ; $i -lt $tc ; $i += 2 )
            {
				$t1 = $tmp[$i+1]
                $t  = $tmp[$i]

				If ( $t1 -eq '-' )
                {
                    $tmpV = $PassedArg[$PassedArg.IndexOf( $_.Arg ) + 1 ]

					If ( ! $tmpV.StartsWith( '-' ) )
                    { 
                        $t1 = $tmpV 
                    } 
                    
                    Else
                    { 
                        $t = $False 
                    }
				}
				
                If ( $t )
                { 
                    SV $T $T1 -Scope Script 
                }
			}
		}
	}
	
    If ( $PassedArg -Contains '-diagf' )
    { 
        $Script:Diagnostic = 2
        $Script:Automated  = 0
        $Script:ErrorDi    = 'Forced Diag Output' 
    }
}

Function ShowHelp 
{
	Clear-Host
	
    $Splat    = @{ 
   
        Text  = "             List of Switches"
        Color = 13 
    }
     
    DisplayOut @Splat

    $Splat    = @{ 
    
        Text  = ''.PadRight( 53 , '-' )
        Color = 14 
    } 
    
    DisplayOut @Splat

    $Splat    = @{ 
    
        Text  = ' Switch ' , "Description of Switch`n".PadLeft( 31 ) 
        Color = 14 , 15 
    } 
    
    DisplayOut @Splat

    $Splat    = @{ 
    
        Text  = '-- Basic Switches --'
        Color = 2 
    } 
    
    DisplayOut @Splat
	        
    $Splat    = @{ 
        
        Text  = '  -atos    ','        Accepts ToS'
        Color = 14 , 15 
    } 
    
    DisplayOut @Splat
	        
    $Splat    = @{ 
    
        Text  = '  -auto    ' , '        Implies ' , '-atos' , '...Runs the script to be Automated.. Closes on - User Input, Errors, or End of Script'
        Color = 14 , 15 , 14 , 15 
    } 
    
    DisplayOut @Splat

    $Splat    = @{ 
    
        Text  = "`n--Service Configuration Switches--"
        Color = 2 
    } 
    
    DisplayOut @Splat 
    
    $Splat    = @{ 
    
        Text  = '  -default ' , '        Runs the script with Services to Default Configuration'
        Color = 14 , 15 
    } 
    
    DisplayOut @Splat

    $Splat    = @{ 
    
        Text  = '  -safe    ' , "        Runs the script with Services to Black Viper's Safe Configuration"
        Color = 14 , 15 
    } 
    
    DisplayOut @Splat

    $Splat    = @{ 
    
        Text  = '  -tweaked ' , "        Runs the script with Services to Black Viper's Tweaked Configuration"
        Color = 14 , 15 
    } 
    
    DisplayOut @Splat
	        
    $Splat    = @{ 
    
        Text  = '  -lcsc ' , 'File.csv ' , '  Loads Custom Service Configuration, ' , 'File.csv' , ' = Name of your backup/custom file'
        Color = 14 , 11 , 15 , 11 , 15 
    } 
    
    DisplayOut @Splat

    $Splat    = @{ 
    
        Text  = "`n--Service Choice Switches--"
        Color = 2 
    } 
    
    DisplayOut @Splat

	$Splat    = @{ 

        Text  = '  -all     ' , '        Every windows services will change'
        Color = 14 , 15 
    } 
    
    DisplayOut @Splat
	
    $Splat    = @{ 
    
        Text  = '  -min     ' , '        Just the services different from the default to safe/tweaked list'
        Color = 14 , 15 
    } 
    
    DisplayOut @Splat

	$Splat    = @{ 

        Text  = '  -sxb     ' , '        Skips changes to all XBox Services'
        Color = 14 , 15 
    } 
    
    DisplayOut @Splat
	
    $Splat    = @{ 
    
        Text  = "`n--Update Switches--"
        Color = 2 
    }
    
    DisplayOut @Splat
	
    $Splat    = @{ 
    
        Text  = '  -usc     ' , '        Checks for Update to Script file before running'
        Color = 14 , 15 
    } 
    
    DisplayOut @Splat
	
    $Splat    = @{ 
    
        Text  = '  -use     ' , '        Checks for Update to Service file before running'
        Color = 14 , 15 
    }

    DisplayOut @Splat 
	
    $Splat    = @{ 
    
        Text  = '  -sic     ' , "        Skips Internet Check, if you can't ping GitHub.com for some reason"
        Color = 14 , 15 
    } 
    
    DisplayOut @Splat

	$Splat    = @{ 

        Text  = "`n--Log Switches--"
        Color = 2 
    } 
    
    DisplayOut @Splat 
	
    $Splat    = @{ 
    
        Text  = '  -log     ' , '        Makes a log file named using default name ' , 'Script.log'
        Color = 14 , 15 , 11 
    } 
    
    DisplayOut @Splat
	
    $Splat    = @{ 
    
        Text  = '  -log ' , 'File.log ' , ' Makes a log file named ' , 'File.log'
        Color = 14 , 11 , 15 , 11 
    } 
    
    DisplayOut @Splat 
	
    $Splat    = @{ 
        
        Text  = '  -baf     ' , '        Log File of Services Configuration Before and After the script'
        Color = 14 , 15 
    } 
    
    DisplayOut @Splat 

	$Splat    = @{ 

        Text  = "`n--Backup Service Configuration--"
        Color = 2 
    } 
    
    DisplayOut @Splat
	        
    $Splat    = @{ 
    
        Text  = '  -bscc    ' , '        Backup Current Service Configuration, Csv File'
        Color = 14 , 15 
    } 
    
    DisplayOut @Splat 
	
    $Splat    = @{ 
    
        Text  = '  -bscr    ' , '        Backup Current Service Configuration, Reg File'
        Color = 14 , 15 
    } 
    
    DisplayOut @Splat
	        
    $Splat    = @{ 
    
        Text  = '  -bscb    ' , '        Backup Current Service Configuration, Csv and Reg File'
        Color = 14 , 15 
    } 
    
    DisplayOut @Splat

    $Splat    = @{ 
    
        Text  = "`n--Display Switches--"
        Color = 2 
    } 
    
    DisplayOut @Splat
	        
    $Splat    = @{ 
    
        Text  = '  -sas     ' , '        Show Already Set Services'
        Color = 14 , 15 
    } 
    
    DisplayOut @Splat
	        
    $Splat    = @{ 
    
        Text  = '  -snis    ' , '        Show Not Installed Services'
        Color = 14 , 15 
    } 
    
    DisplayOut @Splat
    
    $Splat    = @{ 
    
        Text  = '  -sss     ' , '        Show Skipped Services'
        Color = 14 , 15 
    } 
    
    DisplayOut @Splat 

	$Splat    = @{ 

        Text  = "`n--Misc Switches--"
        Color = 2 
    } 

    DisplayOut @Splat 

    $Splat    = @{ 

        Text  = '  -dry     ' , '        Runs the Script and Shows what services will be changed'
        Color = 14 , 15 
    } 
    
    DisplayOut @Splat 

    $Splat    = @{ 

        Text  = '  -css     ' , '        Change State of Service'
        Color = 14 , 15 
    } 
    
    DisplayOut @Splat 

    $Splat    = @{ 

        Text  = '  -sds     ' , '        Stop Disabled Service'
        Color = 14 , 15 
    } 
    
    DisplayOut @Splat 

    $Splat    = @{ 

        Text  = "`n--AT YOUR OWN RISK Switches--"
        Color = 13 
    } 
    
    DisplayOut @Splat 

    $Splat    = @{ 

        Text  = '  -secp    ' , '        Skips Edition Check by Setting Edition as Pro'
        Color = 14 , 15 
    }
    
    DisplayOut @Splat 

    $Splat    = @{ 

        Text  = '  -sech    ' ,'        Skips Edition Check by Setting Edition as Home'
        Color = 14 , 15 
    }
    
    DisplayOut @Splat 

	$Splat    = @{ 

        Text  = '  -sbc     ' , '        Skips Build Check'
        Color = 14 , 15 
    } 

    DisplayOut @Splat 

    $Splat    = @{ 

        Text  = "`n--Dev Switches--"
        Color = 2 
    }
     
    DisplayOut @Splat 

    $Splat    = @{ 

        Text  = '  -devl    ' , '        Makes a log file with various Diagnostic information, Nothing is Changed '
        Color = 14 , 15 
    } 
    
    DisplayOut @Splat 

    $Splat    = @{ 

        Text  = '  -diag    ' , '        Shows diagnostic information, Stops ' , '-auto'
        Color = 14 , 15, 14 
    }
    
    DisplayOut @Splat 

    $Splat    = @{ 
    
        Text  = '  -diagf   ' , '        Forced diagnostic information, Script does nothing else'
        Color = 14 , 15 
    }

    DisplayOut @Splat 

    $Splat    = @{ 
    
        Text  = "`n--Help--"
        Color = 2 
    }
    
    DisplayOut @Splat

    $Splat    = @{ 

        Text  = '  -help    ' , '        Shows list of switches, then exits script.. alt ' , '-h'
        Color = 14 , 15 , 14 
    }

    DisplayOut @Splat 

    $Splat    = @{ 
        
        Text  = '  -copy    ' , '        Shows Copyright/License Information, then exits script' 
        Color = 14 , 15 
    } 
    
    DisplayOut @Splat 

	AutomatedExitCheck 1
	Exit
}

Function StartScript 
{
	If ( Test-Path -LiteralPath $SettingPath -PathType Leaf )
    {
		$Tmp = ( Import-Clixml -LiteralPath $SettingPath | ConvertTo-Xml ).Objects.Object.Property."#text"
		
        While ( $Tmp )
        { 
            $Key , $Val , $Tmp = $Tmp
            SV $Key $Val -Scope Script 
        }
	}

	$Script:IsLaptop = If ( $PCType -eq 1 ) { '-Desk' } 

    Else 
    { 
        '-Lap'
        If ( $LaptopTweaked -ne 1 -and $Black_Viper -ge 2 )
        { 
            $Script:Black_Viper = 0 
        }
	}

	If ( $PassedArg.Length -gt 0 ) 
    { 
        GetArgs 
    }

	GetCurrServices
	$Script:AllService = $CurrServices | Select Name , StartType , Status

	[ System.Collections.ArrayList ] $Skip_Services =
	"BcastDVRUserService_$ServiceEnd"    ,
	"DevicePickerUserSvc_$ServiceEnd"    ,
	"DevicesFlowUserSvc_$ServiceEnd"     ,
	"PimIndexMaintenanceSvc_$ServiceEnd" ,
	"PrintWorkflowUserSvc_$ServiceEnd"   ,
	"UnistoreSvc_$ServiceEnd"            ,
	"UserDataSvc_$ServiceEnd"            ,
	"WpnUserService_$ServiceEnd"         ,
	'AppXSVC'                            ,
	'BrokerInfrastructure'               ,
	'ClipSVC'                            ,
	'CoreMessagingRegistrar'             ,
	'DcomLaunch'                         ,
	'EntAppSvc'                          ,
	'gpsvc'                              ,
	'LSM'                                ,
	'MpsSvc'                             ,
	'msiserver'                          ,
	'NgcCtnrSvc'                         ,
	'NgcSvc'                             ,
	'RpcEptMapper'                       ,
	'RpcSs'                              ,
	'Schedule'                           ,
	'SecurityHealthService'              ,
	'sppsvc'                             ,
	'StateRepository'                    ,
	'SystemEventsBroker'                 ,
	'tiledatamodelsvc'                   ,
	'WdNisSvc'                           ,
	'WinDefend'

	If ( $Win10Ver -ge 1703 )
    { 
        [ Void ] $Skip_Services.Add( 'xbgm' ) 
    }

	If ( $Win10Ver -ge 1803 )
    { 
        [ Void ] $Skip_Services.Add( 'UsoSvc' )
    }

	If ( $Diagnostic -In 1 , 2)
    { 
        $Script:Automated = 0 
    }

	If ( $Diagnostic -eq 2 )
    {
		Clear-Host
		DiagnosticCheck 1
		Exit
	} 

    ElseIf ( $BV_ArgUsed -eq 1 )
    {
		CreateLog
		Error_Top

		$Script:ErrorDi = 'Tweaked + Laptop (Not supported)'
		
        If ( $Automated -eq 1 )
        {
            $Splat    = @{ 
            
                Text  = "Script is set to Automated and..."
                Color = 2
                Log   = 1 
            } 
            
            DisplayOutLML @Splat
        }
		
        $Splat    = @{ 
        
            Text  = "Laptops can't use Tweaked option."
            Color = 2 
            Log   = 1 
        } 
        
        DisplayOutLML @Splat

		Error_Bottom

	} 

    ElseIf ( $BV_ArgUsed -In 2 , 3 )
    {
	    $Script:RunScript = 1

		If ( $AcceptToS -ne 0 )
        {
			If ( $LoadServiceConfig -eq 1 )
            { 
                Black_Viper_Set 
            } 
            
            Else
            { 
                Black_Viper_Set $Black_Viper $All_or_Min 
            }
		} 

        Else 
        {
			TOS
		}
	} 

    ElseIf ( $Automated -eq 1 )
    {
		CreateLog

		$Script:ErrorDi = 'Automated Selected, No Service Selected'
		
        Error_Top

        $Splat    = @{ 
        
            Text  = "Script is set to Automated and no Service"
            Color = 2
            Log   = 1 
        } 
        
        DisplayOutLML @Splat
        
        $Splat    = @{ 
        
            Text  = "Configuration option was selected."
            Color = 2
            Log   = 1 
        } 
        
        DisplayOutLML @Splat
		
        Error_Bottom
	} 

    ElseIf ( $AcceptToS -ne 0 )
    {
		$Script:RunScript = 1

		GuiStart
	} 

    Else 
    {
		TOS
	}
}


IPMO Hybrid-DSC -Force
#StartScript -Global $Control
