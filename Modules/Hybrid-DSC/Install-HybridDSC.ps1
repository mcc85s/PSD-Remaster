<#___ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____ -- ____  
//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\   ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯   //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//  [ Secure Digits Plus LLC | Hybrid | Desired State Controller ]  \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯       _____________________________________________________        ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯        __/¯¯\__[ Dynamically Engineered Digital Security ]__/¯¯\__         ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\  _________________________ ________________ ___________________________________  //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
\\__//¯¯\\__//¯¯\\__//¯¯\\__// | Application Development | Virtualization | Network and Hardware Magistration | \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\  ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯  //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
\\__//¯¯\\__//¯¯\\__//¯¯\\__//   https://www.securedigitsplus.com | Server-Client | Seedling-Spawning Script    \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\___¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯   ¯¯¯¯¯¯¯¯¯¯¯¯¯   ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ___//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\   [ Provisional Author : Michael C Cook Sr. | "The Buck Stops Here" ]    //¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//   ____    ____    ____    ____    ____    ____    ____    ____    ____   \\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
//¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯  
\\  [ Install-HybridDSC ] @: Installs the module required to provision all aspects of Hybrid-DSC
//   ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    
\\__//¯¯\\__//==\\__/----\__//==\\__/----\__//==\\__//¯¯\\__//==\\__/----\__//==\\__/---\\__//¯¯\\__/----\__//==\\__/----\__//==\\__/----\__//==\\___  
//¯¯\\__________________________________________//¯¯\\__//¯¯\\___________________________¯¯¯¯    ¯¯¯¯ ¯¯ ¯¯¯¯ -- ¯¯¯¯ ¯¯ ¯¯¯¯ -- ¯¯¯¯ ¯¯ ¯¯¯¯ -- ¯¯¯\\ 
\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\___    ____ -- ____ __ ____ -- ____ __ ____ -- ____ __ ___// 
 ¯¯¯¯   [ Declare Namespaces & Load Modules ] __________________________________________//¯¯\\__//¯¯\\==//¯¯\----/¯¯\\==//¯¯\----/¯¯\\==//¯¯\----/¯¯¯  
                                              ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    #>
    "Security.Principal" , "Management.Automation" | % { IEX "Using Namespace System.$_" } 

    $CS , $OS = "Computer" , "Operating" | % { GCIM Win32_$_`System }
    
    "Windows"   | % { IEX "( [ $_`Principal ][ $_`Identity ]::GetCurrent() ).IsInRole( 'Administrator' )" } | ? {
        $False  | ? { [ Int ] $OS.BuildNumber -ge 6000 }
        $True   | % { $MyInvocation | % { SAPS PowerShell -Verb Runas -Args "-File `"$( $_.MyCommand.Path ) $( $_.UnboundArguments )" } } } 

#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
    Function Convert-XAMLToWindow # Modified, originally by Dr. Tobias Weltner    ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    {#\______________________________________________________________________________/¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯      

        Param ( [ Parameter ( Mandatory ) ] [ String ] $XAML , [ String [] ] $NE = $Null , [ Switch ] $PassThru )

        @( "Framework" , "Core" | % { "Presentation$_" } ) + "WindowsBase" | % { Add-Type -AssemblyName $_ }
 
        $NR = [ XML.XMLReader ]::Create( [ IO.StringReader ] $XAML ) ; $OP = [ Windows.Markup.XAMLReader ]::Load( $NR )
        
        $NE | % { $OP | Add-Member -MemberType NoteProperty -Name $_ -Value $OP.FindName( $_ ) -Force }
 
        If ( $PassThru ) { $OP } Else { $Null = $GUI.Dispatcher.InvokeAsync( { $OP = $GUI.ShowDialog() ; SV -Name OP -Value $OP -Scope 1 } ).Wait() ; $OP }

    }#                                                                            ____    ____    ____    ____    ____    ____    ____    ____    ____  
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
    Function Show-WPFWindow # Modified, originally by Dr. Tobias Weltner          ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    {#\______________________________________________________________________________//¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯      
        
        Param ( [ Parameter ( Mandatory ) ] [ Windows.Window ] $GUI )

        $OP = $Null ; $Null = $GUI.Dispatcher.InvokeAsync( { $OP = $GUI.ShowDialog() ; SV -Name OP -Value $OP -Scope 1 } ).Wait() ; $OP 
    }#                                                                            ____    ____    ____    ____    ____    ____    ____    ____    ____  
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
    Function Get-NetworkDrive # Establishes access to a local network drive       ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    {#\______________________________________________________________________________//¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯      

        
        $Schema = "http://schemas.microsoft.com/winfx/2006/xaml" ; $Author = "Secure Digits Plus LLC"

        $Glossary  = 
            "   `$W = 'Width'             " , "   `$H = 'Height'            " , "  `$MA = 'Margin'          " , 
            "  `$HD = 'Header'            " , "  `$GB = 'GroupBox'          " , " `$CHK = 'CheckBox'        " , 
            "  `$TB = 'TextBox'           " , " `$TBL = 'TextBlock'         " , "   `$G = 'Grid'            " , 
            "  `$RD = 'RowDefinition'     " , "  `$CD = 'ColumnDefinition'  " , "  `$GC = 'Grid.Column'     " , 
            " `$GCS = 'Grid.ColumnSpan'   " , "  `$GR = 'Grid.Row'          " , " `$GRS = 'Grid.RowSpan'    " , 
            "  `$SI = 'SelectedIndex'     " , "  `$LA = 'Label'             " , "  `$BU = 'Button'          " , 
            "  `$CO = 'Content'           " , "   `$Q = 'Name'              "
            
        $Glossary | % { IEX $_ } ; $GRD , $GCD = $RD , $CD | % { "$G.$_`s" } ; $Glossary += " `$GRD = '$GRD'" , " `$GCD = '$GCD'" 

        $HAL  =  "Left" ,   "Center" ,  "Right" | % { "HorizontalAlignment = '$_'" } ; $HCAL =  $HAL | % { $_.Replace( 'lA' , 'lContentA' ) } 
        $VAL  =   "Top" ,   "Center" , "Bottom" | % { "VerticalAlignment = '$_'"   } ; $VCAL =  $HAL | % { $_.Replace( 'lA' , 'lContentA' ) } 
        
        $SP = 0..13 | % { "    " * $_ }
          
        $PW , $PWB , $PWC = "Password" | % { "$_" , "$_`Box" , "$_`Char" }

        # Generate XAML

        $X   = @( 2 ; 0..5 | % { 13 } ; 10 , 9 ; 3..6 ; 6 , 5 ; 5..7 ; 7 , 6 , 6 ; 0..5 | % { 7 } ; 6 ; 0..11 | % { 6 } ; 5 ; 5..7 ; 7 , 6 , 6 ; 6..2 ) | % { $SP[$_] }  

        $Y   = @( "<Window" , "  xmlns = '$Schema/presentation'" , "xmlns:x = '$Schema'" , "  Title = '$Author | Hybrid-DSC Module Installation'" , 
                "  $W = '400'" , " $H = '450'" , "Topmost = 'True'" , "$( $HAL[1] )" , "  WindowStartupLocation = 'CenterScreen' >" , 
                "<$GB $HD = 'Access Drive' $MA = '10' >" , "<$G>" , "<$GRD>" ; 4 , "" | % { "<$RD $H = '$_*' />" } ; "</$GRD>" , "<$G $GR = '0' >" , 
                "<$GCD>" ; "" , 2.5 | % { "<$CD $W = '$_*' />" } ; "</$GCD>" , "<$GRD>" ; 0..5 | % { "<$RD $H = '*'/>" } ; "</$GRD>" ;

               @( 0 ; "Name" | % { "Drive $_" , $_ } ) , @( 1 , "Network Path" , "Root" ) , @( 2 ; 0..1 | % { "Description" } ) ,
               @( 3 ; "Username" | % { $_.Replace( 'n' , ' N' ) , $_ } ) , @( 4 ; @( "Password" ) * 2 ) , @( 5 ; @( "Confirm" ) * 2 ) | % {

               If ( $_[0] -in 0..3 ) { $OBJ0 = $TB ; $OBJ1 = "" } If ( $_[0] -notin 0..3 ) { $OBJ0 = $PWB ; $OBJ1 = "$PWC = '*'" }
            
                "<$TBL $GR = '$( $_[0] )' $GC = '0' $MA = '10' $( $VAL[1] ) $( $HAL[2] ) >$( $_[1] )</$TBL>" , 
                "<$OBJ0 $GR = '$( $_[0] )' $GC = '1' $MA = '10' $( $VAL[1] ) $OBJ1 $Q = '$( $_[2] )'></$OBJ0>" } ;
                
                "</$G>" , "<$G $GR = '1' >" , "<$GCD>" ; 0..1 | % { "<$CD $W = '*' />" } ; "</$GCD>" ; ( 0 , "Ok" ) , ( 1 , "Cancel" ) | % { 
                "<$BU $GC = '$( $_[0] )' $Q = '$( $_[1] )' $CO = '$( $_[1] )' $MA = '15' />" } ; "</$G>" , "</$G>" , "</$GB>" , "</Window>" )

        $XML = ( 0..51 | % { $X[$_] + $Y[$_] + "`n" } ) -join ''

        # Load XAML

        $NamedElements = "Name" , "Root" , "Description" , "Username" , "Password" , "Confirm" , "Ok" , "Cancel"

        $GUI = Convert-XAMLtoWindow -Xaml $Xml -NE $NamedElements -PassThru
    
        $GUI | % { 
        
            $_.Cancel.Add_Click({ $GUI.DialogResult = $False })

            $_.Ok.Add_Click({

            $MSG = "Drive Label" , "Root Folder" , "UserName" , "Password" , "Confirmation" | % { 

                "[ System.Windows.MessageBox ]::Show( '$_ Error' , 'Invalid $_' )" }

            If     ( $_.Name.Text -eq "" )                                  { IEX $MSG[0] }
            ElseIf ( $_.Root.Text -eq "" )                                  { IEX $MSG[1] }
            ElseIf ( $_.Username.Text -eq "" )                              { IEX $MSG[2] }
            ElseIf ( $_.Password.Password -eq "" )                          { IEX $MSG[3] }
            ElseIf ( $_.Confirm.Password  -eq "" )                          { IEX $MSG[4] }
            ElseIf ( $_.Password.Password  -notmatch  $_.Confirm.Password ) { IEX $MSG[4] }

            Else { $_.DialogResult = $True }

            })
    
            $Null = $_.Name.Focus()

            $OP = Show-WPFWindow -GUI $_

        }

        If ( $OP -eq $True )
        { 
            IEX "Using Namespace System.Management.Automation"
            $Cred = [ PSCredential ]::New( $GUI.Username.Text , $GUI.Password.SecurePassword )

            $PSDrive = @{ Name        = $GUI.Name.Text
                          PSProvider  = "FileSystem"
                          Root        = $GUI.Root.Text
                          Description = $( $GUI.Description | ? { If ( $_ -ne $Null ) { $_ } Else { "" } } )
                          Credential  = $Cred }

            NDR @PSDrive
        }

        Else { Write-Warning "Either the user cancelled, or the dialogue failed"  }
        
    }#                                                                            ____    ____    ____    ____    ____    ____    ____    ____    ____  
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
    Function Install-HybridDSC #                                                  ¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
    {#\______________________________________________________________________________/¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯      
        
        $Mod    = $ENV:PSModulePath.Split( ';' )
        $Mod    | % { If ( ( Test-Path $_ ) -ne $True ) { NI $_ -ItemType Directory } }

        $Hybrid = $Mod | % { GCI $_ -Recurse "*Hybrid-DSC.ps1*" } 

        $Hybrid | ? { $_ -ne $Null } | % { IPMO $_.FullName ; Echo "Module $( $_.FullName ) Loaded" }

        If ( $Hybrid -eq $Null )
        {
            $Drive  = @( Get-NetworkDrive | % { $_.Root } )
            $DSC    = "$( $Mod | ? { $_ -like "*$env:USERNAME*" } )\Hybrid-DSC" | % { 
                If ( ( Test-Path $_ ) -ne $True ) { NI $_ -ItemType Directory } Else { GI $_ }
            }

            $Module = @( gci "$( $Drive.Root )\Modules" -Recurse "*Hybrid-DSC.ps*" | % { $_.FullName } )
            $Module | % { CP $_ $DSC.FullName }
            $Mod    | % { GCI $_ -Recurse "*Hybrid-DSC.PS1*" } | % { IPMO $_.FullName ; Echo "Module $( $_.FullName ) Loaded" }
        
        }
    }#                                                                            ____    ____    ____    ____    ____    ____    ____    ____    ____  
#//¯¯\\__________________________________________________________________________//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\ 
#\\__//¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__// 
        Install-HybridDSC                                                        #¯¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯\\__//¯¯¯  
     #\______________________________________________________________________________//¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯    ¯¯¯¯      
     #¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯                                                                   
